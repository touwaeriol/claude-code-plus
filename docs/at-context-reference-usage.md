# @ 上下文引用功能使用指南

## 功能概述

Claude Code Plus 插件支持通过 `@` 符号快速引用项目文件作为上下文。这个功能让您可以轻松地将代码文件、配置文件等添加到对话上下文中，帮助 Claude 更好地理解您的项目。

## 使用方法

### 1. 通过 @ 符号触发

在聊天输入框中输入 `@` 符号，会自动弹出文件选择器：

```
用户: 请帮我优化 @Main 文件中的代码
       ↑ 输入 @ 后会弹出文件选择器
```

### 2. 搜索和选择文件

- 在弹出的选择器中输入文件名进行搜索
- 支持模糊匹配（如输入 "main" 可以匹配 "MainActivity.kt"）
- 使用方向键选择文件，按 Enter 确认

### 3. 生成的引用格式

选择文件后，会在输入框中生成 Markdown 链接格式的引用：

```markdown
请帮我优化 [@MainActivity.kt](file:///Users/project/src/MainActivity.kt) 中的代码
```

### 4. 支持的引用类型

- **文件引用**: 引用单个源代码文件
- **Web 引用**: 引用网页内容（输入 URL）
- **符号引用**: 引用特定的类、函数等（未来功能）

## 功能特点

### 智能文件搜索

- **精确匹配**: 优先显示完全匹配的文件名
- **模糊搜索**: 支持部分文件名匹配
- **最近文件**: 显示最近打开和编辑的文件
- **文件类型过滤**: 可按文件扩展名过滤

### IntelliJ IDEA 集成

- 使用 IDEA 的文件索引系统，搜索速度快
- 支持项目范围内的全局搜索
- 自动识别项目结构和文件路径

### 上下文管理

- 引用的文件会作为上下文发送给 Claude
- Claude 可以读取文件内容进行分析
- 支持多个文件引用，构建完整的上下文

## 实现细节

### 核心组件

1. **EnhancedIdeaFileIndexService**: 
   - 实现了 `FileIndexService` 接口
   - 提供文件搜索、符号搜索等功能
   - 集成 IDEA 的 PSI 系统

2. **ChatInputField**:
   - 检测 @ 符号输入
   - 触发上下文选择器弹窗

3. **ChatInputContextSelectorPopup**:
   - 显示文件选择界面
   - 处理搜索和选择逻辑

4. **UnifiedChatInput**:
   - 整合所有输入组件
   - 管理上下文引用状态

### 数据流

1. 用户输入 @ → ChatInputField 检测
2. 触发 onShowContextSelector 回调
3. 显示 ChatInputContextSelectorPopup
4. 用户搜索并选择文件
5. 生成 FileReference 对象
6. 插入 Markdown 链接到输入框

## 扩展性

该系统设计为可扩展的，未来可以添加：

- 数据库模式引用
- API 端点引用
- Docker 容器引用
- Git 提交引用
- 等等...

详见 [内联引用扩展.md](内联引用扩展.md) 了解如何添加新的引用类型。