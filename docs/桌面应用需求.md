# Claude Code Plus 桌面应用：需求文档

## 1. 概述

Claude Code Plus 桌面应用是一个独立的、跨平台的客户端，用于与 Claude AI 进行交互。它为开发人员提供了丰富的、类似 IDE 的用户体验，独立于任何特定的集成开发环境。该应用程序利用共享的 `cli-wrapper` 进行 Claude CLI 交互，并使用 `toolwindow` 模块作为其核心 UI 组件，确保在适用的情况下与 JetBrains 插件的功能保持一致。

## 2. 功能需求

### 2.1. 应用程序布局和结构

*   **FR-1.1**：应用程序应具有一个多标签主窗口，允许用户一次管理多个对话。
*   **FR-1.2**：每个标签页的主视图应为两栏布局，左侧为会话/项目管理面板，右侧为核心聊天界面。
*   **FR-1.3**：应用程序将使用 `toolwindow` 模块中的 `MultiTabChatView` 和 `ChatOrganizer` 组件来实现此结构。
*   **FR-1.4**：聊天界面复用 `toolwindow` 模块提供的基础对话框 UI（参见工具窗口需求文档 2.3 节）。

#### 桌面应用完整 UI 示意图

```
+----------------------------------------------------------------------------------------------------+
| Claude Code Plus Desktop                                                              [-] [□] [×] |
+----------------------------------------------------------------------------------------------------+
| [对话 1 ▼] [对话 2 ▼] [+]                                                                          |
+----------------------------------------------------------------------------------------------------+
|                                                                                                    |
| +--------------------------+ +---------------------------------------------------------------------+ |
| | ▼ 项目 A                 | |                                                                     | |
| |   - 对话 1.1             | |  ┌─────────────────────────────────────────────────────────────┐  | |
| |   - 对话 1.2             | |  │              工具窗口基础对话框 UI（引用）                    │  | |
| |                          | |  │                                                               │  | |
| | ▶ 项目 B                 | |  │  参见：工具窗口需求文档 2.3 节 - 基础聊天界面布局             │  | |
| |                          | |  │                                                               │  | |
| | ▶ 项目 C                 | |  │  包含：                                                       │  | |
| |                          | |  │  - 消息显示区域（用户/Claude对话）                            │  | |
| | [+] 新建项目             | |  │  - 统一输入区域（上下文标签、输入框、模型选择器、发送按钮）  │  | |
| |                          | |  │                                                               │  | |
| +--------------------------+ |  └─────────────────────────────────────────────────────────────┘  | |
|   项目/会话管理面板        |                          聊天对话区域                                 | |
|   （桌面应用特有）          |                      （复用工具窗口组件）                            | |
+----------------------------------------------------------------------------------------------------+
```

### 2.2. 核心 UI 组件

*   **FR-2.1**：核心 UI 组件（包括聊天消息显示、统一输入区域）的详细功能需求在 `toolwindow` 模块的需求文档中定义。
*   **FR-2.2**：有关所有基础组件级功能需求，请参阅工具窗口需求文档。

### 2.3. 桌面特定功能

#### 2.3.1 项目/会话管理面板

*   **FR-3.1**：左侧面板提供分层级的项目和会话管理功能。
*   **FR-3.2**：支持创建、重命名、删除项目分组。
*   **FR-3.3**：支持在项目下创建、管理多个对话会话。
*   **FR-3.4**：提供搜索和过滤对话的功能。
*   **FR-3.5**：显示每个对话的摘要信息（最后更新时间、消息数等）。

#### 2.3.2 服务实现

*   **FR-3.6 (文件索引)**：应用程序必须提供适用于独立桌面环境的 `FileIndexService` 的具体实现 (`SimpleFileIndexService`)。
*   **FR-3.7 (项目服务)**：应用程序必须提供用于处理项目级操作的 `ProjectService` 的具体实现 (`DesktopProjectService`)。
*   **FR-3.8 (持久化存储)**：提供本地存储服务，保存项目结构、会话历史和用户设置。

#### 2.3.3 窗口管理

*   **FR-3.9**：支持多窗口操作，允许用户打开多个独立的应用窗口。
*   **FR-3.10**：支持窗口状态记忆（位置、大小、最大化状态）。
*   **FR-3.11**：提供系统托盘集成（可选）。

## 3. 非功能性需求

*   **NFR-1.1（性能）**：即使在管理大量对话或索引大型项目目录时，应用程序也应快速启动并保持响应。
*   **NFR-1.2（平台支持）**：应用程序必须可在 macOS、Windows 和 Linux 上分发和运行。
*   **NFR-1.3（依赖项）**：应用程序的核心功能需要本地安装 Claude CLI。它必须处理未找到 CLI 的情况并引导用户。
*   **NFR-1.4（安装）**：构建过程必须为目标平台生成本机安装程序（macOS 的 DMG、Windows 的 MSI、Linux 的 DEB）。

## 4. 架构

*   **AR-1.1（模块化）**：桌面应用程序构建在共享模块之上，包括 `cli-wrapper`（用于 CLI 交互）和 `toolwindow`（用于 UI 组件），促进了代码重用和与插件版本的一致性。
*   **AR-1.2（依赖注入）**：应用程序应使用服务容器（`ServiceContainer.kt`）来管理和提供 `ProjectService` 和 `FileIndexService` 等依赖项，确保架构解耦且可测试。
*   **AR-1.3（服务抽象）**：应用程序应使用抽象服务（例如 `ProjectService`、`FileIndexService`），并为桌面环境提供具体实现（`DesktopProjectService`、`SimpleFileIndexService`）。
