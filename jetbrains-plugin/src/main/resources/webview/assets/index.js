var e,t,n,s,o,i,r,a,l,c,u,d,p,h,f,m,g,y,v,b,k,w,S,C,T,E,I,x,A,N,M,R,_,O,D,B,L,F,P,$,U,V,W,G,z,H,K,j,Y,Z,X,J,Q,q,ee,te,ne,se,oe,ie,re,ae,le,ce,ue,de,pe,he,fe,me,ge,ye,ve,be,ke,we=Object.create,Se=Object.defineProperty,Ce=Object.getOwnPropertyDescriptor,Te=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),Ee=e=>{throw TypeError(e)},Ie=(e,t,n)=>t in e?Se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,xe=(e,t)=>Se(e,"name",{value:t,configurable:!0}),Ae=e=>[,,,we(e?.[Te("metadata")]??null)],Ne=["class","method","getter","setter","accessor","field","value","get","set"],Me=e=>void 0!==e&&"function"!=typeof e?Ee("Function expected"):e,Re=(e,t,n,s,o)=>({kind:Ne[e],name:t,metadata:s,addInitializer:e=>n._?Ee("Already initialized"):o.push(Me(e||null))}),_e=(e,t,n,s)=>{for(var o=0,i=e[t>>1],r=i&&i.length;o<r;o++)1&t?i[o].call(n):s=i[o].call(n,s);return s},Oe=(e,t,n,s,o,i)=>{var r,a,l,c,u,d=7&t,p=!!(8&t),h=!!(16&t),f=d>3?e.length+1:d?p?1:2:0,m=Ne[d+5],g=d>3&&(e[f-1]=[]),y=e[f]||(e[f]=[]),v=d&&(!h&&!p&&(o=o.prototype),d<5&&(d>3||!h)&&Ce(d<4?o:{get[n](){return Fe(this,i)},set[n](e){return Pe(this,i,e)}},n));d?h&&d<4&&xe(i,(d>2?"set ":d>1?"get ":"")+n):xe(o,n);for(var b=s.length-1;b>=0;b--)c=Re(d,n,l={},e[3],y),d&&(c.static=p,c.private=h,u=c.access={has:h?e=>Le(o,e):e=>n in e},3^d&&(u.get=h?e=>(1^d?Fe:$e)(e,o,4^d?i:v.get):e=>e[n]),d>2&&(u.set=h?(e,t)=>Pe(e,o,t,4^d?i:v.set):(e,t)=>e[n]=t)),a=(0,s[b])(d?d<4?h?i:v[m]:d>4?void 0:{get:v.get,set:v.set}:o,c),l._=1,4^d||void 0===a?Me(a)&&(d>4?g.unshift(a):d?h?i=a:v[m]=a:o=a):"object"!=typeof a||null===a?Ee("Object expected"):(Me(r=a.get)&&(v.get=r),Me(r=a.set)&&(v.set=r),Me(r=a.init)&&g.unshift(r));return d||((e,t)=>{Ie(t,Te("metadata"),e[3])})(e,o),v&&Se(o,n,v),h?4^d?i:v:o},De=(e,t,n)=>Ie(e,"symbol"!=typeof t?t+"":t,n),Be=(e,t,n)=>t.has(e)||Ee("Cannot "+n),Le=(e,t)=>Object(t)!==t?Ee('Cannot use the "in" operator on this value'):e.has(t),Fe=(e,t,n)=>(Be(e,t,"read from private field"),n?n.call(e):t.get(e)),Pe=(e,t,n,s)=>(Be(e,t,"write to private field"),s?s.call(e,n):t.set(e,n),n),$e=(e,t,n)=>(Be(e,t,"access private method"),n);import{c as Ue,r as Ve,a as We,b as Ge,d as ze,s as He,w as Ke,e as je,u as Ye,f as Ze,o as Xe,g as Je,h as Qe,i as qe,j as et,k as tt,T as nt,l as st,m as ot,n as it,p as rt,v as at,F as lt,q as ct,t as ut,x as dt,y as pt,z as ht,A as ft,B as mt,C as gt,D as yt,E as vt,G as bt,H as kt,I as wt,J as St,K as Ct,L as Tt,M as Et,N as It,O as xt,P as At,Q as Nt,R as Mt,S as Rt,U as _t,V as Ot,W as Dt,X as Bt,Y as Lt,Z as Ft,_ as Pt,$ as $t,a0 as Ut,a1 as Vt,a2 as Wt,a3 as Gt,a4 as zt,a5 as Ht,a6 as Kt,a7 as jt,a8 as Yt,a9 as Zt}from"./vue-vendor.js";import{d as Xt,b as Jt,g as Qt}from"./rsocket.js";import{M as qt}from"./markdown.js";import{_ as en}from"./shiki.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();for(var tn={},nn={byteLength:function(e){var t=cn(e),n=t[0],s=t[1];return 3*(n+s)/4-s},toByteArray:function(e){var t,n,s=cn(e),o=s[0],i=s[1],r=new rn(function(e,t,n){return 3*(t+n)/4-n}(0,o,i)),a=0,l=i>0?o-4:o;for(n=0;n<l;n+=4)t=on[e.charCodeAt(n)]<<18|on[e.charCodeAt(n+1)]<<12|on[e.charCodeAt(n+2)]<<6|on[e.charCodeAt(n+3)],r[a++]=t>>16&255,r[a++]=t>>8&255,r[a++]=255&t;2===i&&(t=on[e.charCodeAt(n)]<<2|on[e.charCodeAt(n+1)]>>4,r[a++]=255&t);1===i&&(t=on[e.charCodeAt(n)]<<10|on[e.charCodeAt(n+1)]<<4|on[e.charCodeAt(n+2)]>>2,r[a++]=t>>8&255,r[a++]=255&t);return r},fromByteArray:function(e){for(var t,n=e.length,s=n%3,o=[],i=16383,r=0,a=n-s;r<a;r+=i)o.push(dn(e,r,r+i>a?a:r+i));1===s?(t=e[n-1],o.push(sn[t>>2]+sn[t<<4&63]+"==")):2===s&&(t=(e[n-2]<<8)+e[n-1],o.push(sn[t>>10]+sn[t>>4&63]+sn[t<<2&63]+"="));return o.join("")}},sn=[],on=[],rn="undefined"!=typeof Uint8Array?Uint8Array:Array,an="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ln=0;ln<64;++ln)sn[ln]=an[ln],on[an.charCodeAt(ln)]=ln;function cn(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function un(e){return sn[e>>18&63]+sn[e>>12&63]+sn[e>>6&63]+sn[63&e]}function dn(e,t,n){for(var s,o=[],i=t;i<n;i+=3)s=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]),o.push(un(s));return o.join("")}on["-".charCodeAt(0)]=62,on["_".charCodeAt(0)]=63;var pn={read:function(e,t,n,s,o){var i,r,a=8*o-s-1,l=(1<<a)-1,c=l>>1,u=-7,d=n?o-1:0,p=n?-1:1,h=e[t+d];for(d+=p,i=h&(1<<-u)-1,h>>=-u,u+=a;u>0;i=256*i+e[t+d],d+=p,u-=8);for(r=i&(1<<-u)-1,i>>=-u,u+=s;u>0;r=256*r+e[t+d],d+=p,u-=8);if(0===i)i=1-c;else{if(i===l)return r?NaN:1/0*(h?-1:1);r+=Math.pow(2,s),i-=c}return(h?-1:1)*r*Math.pow(2,i-s)},write:function(e,t,n,s,o,i){var r,a,l,c=8*i-o-1,u=(1<<c)-1,d=u>>1,p=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,h=s?0:i-1,f=s?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,r=u):(r=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-r))<1&&(r--,l*=2),(t+=r+d>=1?p/l:p*Math.pow(2,1-d))*l>=2&&(r++,l/=2),r+d>=u?(a=0,r=u):r+d>=1?(a=(t*l-1)*Math.pow(2,o),r+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,o),r=0));o>=8;e[n+h]=255&a,h+=f,a/=256,o-=8);for(r=r<<o|a,c+=o;c>0;e[n+h]=255&r,h+=f,r/=256,c-=8);e[n+h-f]|=128*m}};!function(e){const t=nn,n=pn,s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=r,e.SlowBuffer=function(e){+e!=e&&(e=0);return r.alloc(+e)},e.INSPECT_MAX_BYTES=50;const o=2147483647;function i(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,r.prototype),t}function r(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return c(e)}return a(e,t,n)}function a(e,t,n){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!r.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|h(e,t);let s=i(n);const o=s.write(e,t);o!==n&&(s=s.slice(0,o));return s}(e,t);if(ArrayBuffer.isView(e))return function(e){if(j(e,Uint8Array)){const t=new Uint8Array(e);return d(t.buffer,t.byteOffset,t.byteLength)}return u(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(j(e,ArrayBuffer)||e&&j(e.buffer,ArrayBuffer))return d(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(j(e,SharedArrayBuffer)||e&&j(e.buffer,SharedArrayBuffer)))return d(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const s=e.valueOf&&e.valueOf();if(null!=s&&s!==e)return r.from(s,t,n);const o=function(e){if(r.isBuffer(e)){const t=0|p(e.length),n=i(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!=typeof e.length||Y(e.length)?i(0):u(e);if("Buffer"===e.type&&Array.isArray(e.data))return u(e.data)}(e);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return r.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function c(e){return l(e),i(e<0?0:0|p(e))}function u(e){const t=e.length<0?0:0|p(e.length),n=i(t);for(let s=0;s<t;s+=1)n[s]=255&e[s];return n}function d(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let s;return s=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(s,r.prototype),s}function p(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function h(e,t){if(r.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||j(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,s=arguments.length>2&&!0===arguments[2];if(!s&&0===n)return 0;let o=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return z(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return H(e).length;default:if(o)return s?-1:z(e).length;t=(""+t).toLowerCase(),o=!0}}function f(e,t,n){let s=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,n);case"utf8":case"utf-8":return T(this,t,n);case"ascii":return I(this,t,n);case"latin1":case"binary":return x(this,t,n);case"base64":return C(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,t,n);default:if(s)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),s=!0}}function m(e,t,n){const s=e[t];e[t]=e[n],e[n]=s}function g(e,t,n,s,o){if(0===e.length)return-1;if("string"==typeof n?(s=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),Y(n=+n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof t&&(t=r.from(t,s)),r.isBuffer(t))return 0===t.length?-1:y(e,t,n,s,o);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,s,o);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,s,o){let i,r=1,a=e.length,l=t.length;if(void 0!==s&&("ucs2"===(s=String(s).toLowerCase())||"ucs-2"===s||"utf16le"===s||"utf-16le"===s)){if(e.length<2||t.length<2)return-1;r=2,a/=2,l/=2,n/=2}function c(e,t){return 1===r?e[t]:e.readUInt16BE(t*r)}if(o){let s=-1;for(i=n;i<a;i++)if(c(e,i)===c(t,-1===s?0:i-s)){if(-1===s&&(s=i),i-s+1===l)return s*r}else-1!==s&&(i-=i-s),s=-1}else for(n+l>a&&(n=a-l),i=n;i>=0;i--){let n=!0;for(let s=0;s<l;s++)if(c(e,i+s)!==c(t,s)){n=!1;break}if(n)return i}return-1}function v(e,t,n,s){n=Number(n)||0;const o=e.length-n;s?(s=Number(s))>o&&(s=o):s=o;const i=t.length;let r;for(s>i/2&&(s=i/2),r=0;r<s;++r){const s=parseInt(t.substr(2*r,2),16);if(Y(s))return r;e[n+r]=s}return r}function b(e,t,n,s){return K(z(t,e.length-n),e,n,s)}function k(e,t,n,s){return K(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,s)}function w(e,t,n,s){return K(H(t),e,n,s)}function S(e,t,n,s){return K(function(e,t){let n,s,o;const i=[];for(let r=0;r<e.length&&!((t-=2)<0);++r)n=e.charCodeAt(r),s=n>>8,o=n%256,i.push(o),i.push(s);return i}(t,e.length-n),e,n,s)}function C(e,n,s){return 0===n&&s===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(n,s))}function T(e,t,n){n=Math.min(e.length,n);const s=[];let o=t;for(;o<n;){const t=e[o];let i=null,r=t>239?4:t>223?3:t>191?2:1;if(o+r<=n){let n,s,a,l;switch(r){case 1:t<128&&(i=t);break;case 2:n=e[o+1],128==(192&n)&&(l=(31&t)<<6|63&n,l>127&&(i=l));break;case 3:n=e[o+1],s=e[o+2],128==(192&n)&&128==(192&s)&&(l=(15&t)<<12|(63&n)<<6|63&s,l>2047&&(l<55296||l>57343)&&(i=l));break;case 4:n=e[o+1],s=e[o+2],a=e[o+3],128==(192&n)&&128==(192&s)&&128==(192&a)&&(l=(15&t)<<18|(63&n)<<12|(63&s)<<6|63&a,l>65535&&l<1114112&&(i=l))}}null===i?(i=65533,r=1):i>65535&&(i-=65536,s.push(i>>>10&1023|55296),i=56320|1023&i),s.push(i),o+=r}return function(e){const t=e.length;if(t<=E)return String.fromCharCode.apply(String,e);let n="",s=0;for(;s<t;)n+=String.fromCharCode.apply(String,e.slice(s,s+=E));return n}(s)}e.kMaxLength=o,r.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),r.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(r.prototype,"parent",{enumerable:!0,get:function(){if(r.isBuffer(this))return this.buffer}}),Object.defineProperty(r.prototype,"offset",{enumerable:!0,get:function(){if(r.isBuffer(this))return this.byteOffset}}),r.poolSize=8192,r.from=function(e,t,n){return a(e,t,n)},Object.setPrototypeOf(r.prototype,Uint8Array.prototype),Object.setPrototypeOf(r,Uint8Array),r.alloc=function(e,t,n){return function(e,t,n){return l(e),e<=0?i(e):void 0!==t?"string"==typeof n?i(e).fill(t,n):i(e).fill(t):i(e)}(e,t,n)},r.allocUnsafe=function(e){return c(e)},r.allocUnsafeSlow=function(e){return c(e)},r.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==r.prototype},r.compare=function(e,t){if(j(e,Uint8Array)&&(e=r.from(e,e.offset,e.byteLength)),j(t,Uint8Array)&&(t=r.from(t,t.offset,t.byteLength)),!r.isBuffer(e)||!r.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,s=t.length;for(let o=0,i=Math.min(n,s);o<i;++o)if(e[o]!==t[o]){n=e[o],s=t[o];break}return n<s?-1:s<n?1:0},r.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},r.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return r.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const s=r.allocUnsafe(t);let o=0;for(n=0;n<e.length;++n){let t=e[n];if(j(t,Uint8Array))o+t.length>s.length?(r.isBuffer(t)||(t=r.from(t)),t.copy(s,o)):Uint8Array.prototype.set.call(s,t,o);else{if(!r.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(s,o)}o+=t.length}return s},r.byteLength=h,r.prototype._isBuffer=!0,r.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)m(this,t,t+1);return this},r.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},r.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},r.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?T(this,0,e):f.apply(this,arguments)},r.prototype.toLocaleString=r.prototype.toString,r.prototype.equals=function(e){if(!r.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===r.compare(this,e)},r.prototype.inspect=function(){let t="";const n=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(t+=" ... "),"<Buffer "+t+">"},s&&(r.prototype[s]=r.prototype.inspect),r.prototype.compare=function(e,t,n,s,o){if(j(e,Uint8Array)&&(e=r.from(e,e.offset,e.byteLength)),!r.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===s&&(s=0),void 0===o&&(o=this.length),t<0||n>e.length||s<0||o>this.length)throw new RangeError("out of range index");if(s>=o&&t>=n)return 0;if(s>=o)return-1;if(t>=n)return 1;if(this===e)return 0;let i=(o>>>=0)-(s>>>=0),a=(n>>>=0)-(t>>>=0);const l=Math.min(i,a),c=this.slice(s,o),u=e.slice(t,n);for(let r=0;r<l;++r)if(c[r]!==u[r]){i=c[r],a=u[r];break}return i<a?-1:a<i?1:0},r.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},r.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},r.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},r.prototype.write=function(e,t,n,s){if(void 0===t)s="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)s=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===s&&(s="utf8")):(s=n,n=void 0)}const o=this.length-t;if((void 0===n||n>o)&&(n=o),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");s||(s="utf8");let i=!1;for(;;)switch(s){case"hex":return v(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":case"latin1":case"binary":return k(this,e,t,n);case"base64":return w(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),i=!0}},r.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const E=4096;function I(e,t,n){let s="";n=Math.min(e.length,n);for(let o=t;o<n;++o)s+=String.fromCharCode(127&e[o]);return s}function x(e,t,n){let s="";n=Math.min(e.length,n);for(let o=t;o<n;++o)s+=String.fromCharCode(e[o]);return s}function A(e,t,n){const s=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>s)&&(n=s);let o="";for(let i=t;i<n;++i)o+=Z[e[i]];return o}function N(e,t,n){const s=e.slice(t,n);let o="";for(let i=0;i<s.length-1;i+=2)o+=String.fromCharCode(s[i]+256*s[i+1]);return o}function M(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,n,s,o,i){if(!r.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<i)throw new RangeError('"value" argument is out of bounds');if(n+s>e.length)throw new RangeError("Index out of range")}function _(e,t,n,s,o){U(t,s,o,e,n,7);let i=Number(t&BigInt(4294967295));e[n++]=i,i>>=8,e[n++]=i,i>>=8,e[n++]=i,i>>=8,e[n++]=i;let r=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=r,r>>=8,e[n++]=r,r>>=8,e[n++]=r,r>>=8,e[n++]=r,n}function O(e,t,n,s,o){U(t,s,o,e,n,7);let i=Number(t&BigInt(4294967295));e[n+7]=i,i>>=8,e[n+6]=i,i>>=8,e[n+5]=i,i>>=8,e[n+4]=i;let r=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=r,r>>=8,e[n+2]=r,r>>=8,e[n+1]=r,r>>=8,e[n]=r,n+8}function D(e,t,n,s,o,i){if(n+s>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function B(e,t,s,o,i){return t=+t,s>>>=0,i||D(e,0,s,4),n.write(e,t,s,o,23,4),s+4}function L(e,t,s,o,i){return t=+t,s>>>=0,i||D(e,0,s,8),n.write(e,t,s,o,52,8),s+8}r.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const s=this.subarray(e,t);return Object.setPrototypeOf(s,r.prototype),s},r.prototype.readUintLE=r.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);let s=this[e],o=1,i=0;for(;++i<t&&(o*=256);)s+=this[e+i]*o;return s},r.prototype.readUintBE=r.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);let s=this[e+--t],o=1;for(;t>0&&(o*=256);)s+=this[e+--t]*o;return s},r.prototype.readUint8=r.prototype.readUInt8=function(e,t){return e>>>=0,t||M(e,1,this.length),this[e]},r.prototype.readUint16LE=r.prototype.readUInt16LE=function(e,t){return e>>>=0,t||M(e,2,this.length),this[e]|this[e+1]<<8},r.prototype.readUint16BE=r.prototype.readUInt16BE=function(e,t){return e>>>=0,t||M(e,2,this.length),this[e]<<8|this[e+1]},r.prototype.readUint32LE=r.prototype.readUInt32LE=function(e,t){return e>>>=0,t||M(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},r.prototype.readUint32BE=r.prototype.readUInt32BE=function(e,t){return e>>>=0,t||M(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},r.prototype.readBigUInt64LE=X(function(e){V(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||W(e,this.length-8);const s=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,o=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(s)+(BigInt(o)<<BigInt(32))}),r.prototype.readBigUInt64BE=X(function(e){V(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||W(e,this.length-8);const s=t*2**24+65536*this[++e]+256*this[++e]+this[++e],o=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(s)<<BigInt(32))+BigInt(o)}),r.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);let s=this[e],o=1,i=0;for(;++i<t&&(o*=256);)s+=this[e+i]*o;return o*=128,s>=o&&(s-=Math.pow(2,8*t)),s},r.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);let s=t,o=1,i=this[e+--s];for(;s>0&&(o*=256);)i+=this[e+--s]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*t)),i},r.prototype.readInt8=function(e,t){return e>>>=0,t||M(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},r.prototype.readInt16LE=function(e,t){e>>>=0,t||M(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},r.prototype.readInt16BE=function(e,t){e>>>=0,t||M(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},r.prototype.readInt32LE=function(e,t){return e>>>=0,t||M(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},r.prototype.readInt32BE=function(e,t){return e>>>=0,t||M(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},r.prototype.readBigInt64LE=X(function(e){V(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||W(e,this.length-8);const s=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(s)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)}),r.prototype.readBigInt64BE=X(function(e){V(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||W(e,this.length-8);const s=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(s)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)}),r.prototype.readFloatLE=function(e,t){return e>>>=0,t||M(e,4,this.length),n.read(this,e,!0,23,4)},r.prototype.readFloatBE=function(e,t){return e>>>=0,t||M(e,4,this.length),n.read(this,e,!1,23,4)},r.prototype.readDoubleLE=function(e,t){return e>>>=0,t||M(e,8,this.length),n.read(this,e,!0,52,8)},r.prototype.readDoubleBE=function(e,t){return e>>>=0,t||M(e,8,this.length),n.read(this,e,!1,52,8)},r.prototype.writeUintLE=r.prototype.writeUIntLE=function(e,t,n,s){if(e=+e,t>>>=0,n>>>=0,!s){R(this,e,t,n,Math.pow(2,8*n)-1,0)}let o=1,i=0;for(this[t]=255&e;++i<n&&(o*=256);)this[t+i]=e/o&255;return t+n},r.prototype.writeUintBE=r.prototype.writeUIntBE=function(e,t,n,s){if(e=+e,t>>>=0,n>>>=0,!s){R(this,e,t,n,Math.pow(2,8*n)-1,0)}let o=n-1,i=1;for(this[t+o]=255&e;--o>=0&&(i*=256);)this[t+o]=e/i&255;return t+n},r.prototype.writeUint8=r.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,1,255,0),this[t]=255&e,t+1},r.prototype.writeUint16LE=r.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},r.prototype.writeUint16BE=r.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},r.prototype.writeUint32LE=r.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},r.prototype.writeUint32BE=r.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},r.prototype.writeBigUInt64LE=X(function(e,t=0){return _(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),r.prototype.writeBigUInt64BE=X(function(e,t=0){return O(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),r.prototype.writeIntLE=function(e,t,n,s){if(e=+e,t>>>=0,!s){const s=Math.pow(2,8*n-1);R(this,e,t,n,s-1,-s)}let o=0,i=1,r=0;for(this[t]=255&e;++o<n&&(i*=256);)e<0&&0===r&&0!==this[t+o-1]&&(r=1),this[t+o]=(e/i|0)-r&255;return t+n},r.prototype.writeIntBE=function(e,t,n,s){if(e=+e,t>>>=0,!s){const s=Math.pow(2,8*n-1);R(this,e,t,n,s-1,-s)}let o=n-1,i=1,r=0;for(this[t+o]=255&e;--o>=0&&(i*=256);)e<0&&0===r&&0!==this[t+o+1]&&(r=1),this[t+o]=(e/i|0)-r&255;return t+n},r.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},r.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},r.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},r.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},r.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},r.prototype.writeBigInt64LE=X(function(e,t=0){return _(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),r.prototype.writeBigInt64BE=X(function(e,t=0){return O(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),r.prototype.writeFloatLE=function(e,t,n){return B(this,e,t,!0,n)},r.prototype.writeFloatBE=function(e,t,n){return B(this,e,t,!1,n)},r.prototype.writeDoubleLE=function(e,t,n){return L(this,e,t,!0,n)},r.prototype.writeDoubleBE=function(e,t,n){return L(this,e,t,!1,n)},r.prototype.copy=function(e,t,n,s){if(!r.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),s||0===s||(s=this.length),t>=e.length&&(t=e.length),t||(t=0),s>0&&s<n&&(s=n),s===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(s<0)throw new RangeError("sourceEnd out of bounds");s>this.length&&(s=this.length),e.length-t<s-n&&(s=e.length-t+n);const o=s-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,s):Uint8Array.prototype.set.call(e,this.subarray(n,s),t),o},r.prototype.fill=function(e,t,n,s){if("string"==typeof e){if("string"==typeof t?(s=t,t=0,n=this.length):"string"==typeof n&&(s=n,n=this.length),void 0!==s&&"string"!=typeof s)throw new TypeError("encoding must be a string");if("string"==typeof s&&!r.isEncoding(s))throw new TypeError("Unknown encoding: "+s);if(1===e.length){const t=e.charCodeAt(0);("utf8"===s&&t<128||"latin1"===s)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{const i=r.isBuffer(e)?e:r.from(e,s),a=i.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-t;++o)this[o+t]=i[o%a]}return this};const F={};function P(e,t,n){F[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function $(e){let t="",n=e.length;const s="-"===e[0]?1:0;for(;n>=s+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function U(e,t,n,s,o,i){if(e>n||e<t){const n="bigint"==typeof t?"n":"";let s;throw s=0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(i+1)}${n}`:`>= -(2${n} ** ${8*(i+1)-1}${n}) and < 2 ** ${8*(i+1)-1}${n}`,new F.ERR_OUT_OF_RANGE("value",s,e)}!function(e,t,n){V(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||W(t,e.length-(n+1))}(s,o,i)}function V(e,t){if("number"!=typeof e)throw new F.ERR_INVALID_ARG_TYPE(t,"number",e)}function W(e,t,n){if(Math.floor(e)!==e)throw V(e,n),new F.ERR_OUT_OF_RANGE("offset","an integer",e);if(t<0)throw new F.ERR_BUFFER_OUT_OF_BOUNDS;throw new F.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${t}`,e)}P("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),P("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),P("ERR_OUT_OF_RANGE",function(e,t,n){let s=`The value of "${e}" is out of range.`,o=n;return Number.isInteger(n)&&Math.abs(n)>2**32?o=$(String(n)):"bigint"==typeof n&&(o=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(o=$(o)),o+="n"),s+=` It must be ${t}. Received ${o}`,s},RangeError);const G=/[^+/0-9A-Za-z-_]/g;function z(e,t){let n;t=t||1/0;const s=e.length;let o=null;const i=[];for(let r=0;r<s;++r){if(n=e.charCodeAt(r),n>55295&&n<57344){if(!o){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(r+1===s){(t-=3)>-1&&i.push(239,191,189);continue}o=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function H(e){return t.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(G,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function K(e,t,n,s){let o;for(o=0;o<s&&!(o+n>=t.length||o>=e.length);++o)t[o+n]=e[o];return o}function j(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Y(e){return e!=e}const Z=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const s=16*n;for(let o=0;o<16;++o)t[s+o]=e[n]+e[o]}return t}();function X(e){return"undefined"==typeof BigInt?J:e}function J(){throw new Error("BigInt not supported")}}(tn);const hn="claude-code-plus-locale",fn=["zh-CN","en-US","ko-KR","ja-JP"];function mn(e){const t=e.toLowerCase().replace("_","-");return t.startsWith("zh")?"zh-CN":t.startsWith("ko")?"ko-KR":t.startsWith("ja")?"ja-JP":"en-US"}const gn=Ue({legacy:!1,locale:function(){if("undefined"==typeof window)return"en-US";const e=localStorage.getItem(hn);return e&&fn.includes(e)?e:mn(navigator.language||navigator.userLanguage||"en-US")}(),fallbackLocale:"en-US",messages:{"zh-CN":{common:{send:"å‘é€",cancel:"å–æ¶ˆ",confirm:"ç¡®è®¤",save:"ä¿å­˜",delete:"åˆ é™¤",edit:"ç¼–è¾‘",copy:"å¤åˆ¶",close:"å…³é—­",loading:"åŠ è½½ä¸­...",success:"æˆåŠŸ",error:"é”™è¯¯",search:"æœç´¢",clear:"æ¸…ç©º",settings:"è®¾ç½®",tools:"å·¥å…·",unknown:"æœªçŸ¥",remove:"ç§»é™¤",yes:"æ˜¯",no:"å¦",ok:"ç¡®å®š",pending:"ç­‰å¾…",cancelled:"å·²å–æ¶ˆ",copyFailed:"å¤åˆ¶å¤±è´¥",copied:"å·²å¤åˆ¶",renderFailed:"æ¸²æŸ“å¤±è´¥",noMore:"æ²¡æœ‰æ›´å¤šäº†",expand:"å±•å¼€",collapse:"æ”¶èµ·"},chat:{placeholder:"",placeholderWithShortcuts:"",placeholderWithShortcutsCtrl:"",input:{connecting:"æ­£åœ¨åˆå§‹åŒ–è¿žæŽ¥...",disconnected:"è¿žæŽ¥å·²æ–­å¼€ï¼Œè¯·åˆ·æ–°é¡µé¢"},newSession:"æ–°ä¼šè¯",history:"åŽ†å²è®°å½•",thinking:"æ€è€ƒä¸­...",retry:"é‡è¯•",stop:"åœæ­¢",stopGenerating:"åœæ­¢ç”Ÿæˆ",escToInterrupt:"ESC æ‰“æ–­",streamingStatsTooltip:"ç”Ÿæˆç»Ÿè®¡ï¼šè€—æ—¶ â†‘ä¸Šè¡Œtokens â†“ä¸‹è¡Œtokens",slashCommands:"æ–œæ å‘½ä»¤",noMatchingCommands:"æ²¡æœ‰åŒ¹é…çš„å‘½ä»¤",welcome:"ä½ å¥½ï¼æˆ‘æ˜¯ Claudeï¼Œä½ çš„ AI ç¼–ç¨‹åŠ©æ‰‹ã€‚",emptyState:"å¼€å§‹ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œæˆ–é€‰æ‹©ä¸€ä¸ªåŽ†å²è®°å½•ã€‚",sendMessage:"å‘é€æ¶ˆæ¯",sendMessageShortcut:"å‘é€æ¶ˆæ¯ (Enter) | å³é”®æŸ¥çœ‹æ›´å¤šé€‰é¡¹",addContext:"{'@'} æ·»åŠ ä¸Šä¸‹æ–‡",autoCleanupContext:"è‡ªåŠ¨æ¸…ç†ä¸Šä¸‹æ–‡",autoCleanupContextTooltip:"å‘é€æ¶ˆæ¯åŽè‡ªåŠ¨æ¸…ç©ºä¸Šä¸‹æ–‡æ ‡ç­¾",dropFileToAddContext:"é‡Šæ”¾æ–‡ä»¶ä»¥æ·»åŠ åˆ°ä¸Šä¸‹æ–‡",taskQueue:"ä»»åŠ¡é˜Ÿåˆ—",taskQueueCount:"ä»»åŠ¡é˜Ÿåˆ— ({count})",pendingQueue:"å¾…å‘é€ ({count})",taskStatus:{pending:"æŽ’é˜Ÿä¸­",running:"æ‰§è¡Œä¸­",success:"æˆåŠŸ",failed:"å¤±è´¥"},error:{title:"é”™è¯¯",unknown:"æœªçŸ¥é”™è¯¯",initSessionFailed:"åˆå§‹åŒ–ä¼šè¯å¤±è´¥: {message}",switchSessionFailed:"åˆ‡æ¢ä¼šè¯å¤±è´¥: {message}",sendMessageFailed:"å‘é€æ¶ˆæ¯å¤±è´¥: {message}",connecting:"æ­£åœ¨åˆå§‹åŒ–è¿žæŽ¥ï¼Œè¯·ç¨å€™...",disconnected:"è¿žæŽ¥å·²æ–­å¼€ï¼Œæ­£åœ¨å°è¯•é‡æ–°è¿žæŽ¥..."},debug:{title:"è°ƒè¯•ä¿¡æ¯",sessionId:"ä¼šè¯ID",projectPath:"é¡¹ç›®è·¯å¾„",messageCount:"æ¶ˆæ¯æ•°",generating:"ç”Ÿæˆä¸­",pendingTasks:"å¾…å¤„ç†ä»»åŠ¡",contexts:"ä¸Šä¸‹æ–‡",notSet:"æœªè®¾ç½®",generatingStatus:"æ­£åœ¨ç”Ÿæˆä¸­"},enterToSend:"Enter å‘é€æ¶ˆæ¯ Â·",noMessages:"æ²¡æœ‰æ¶ˆæ¯ã€‚è¯·åˆ›å»ºä¼šè¯å¹¶å‘é€æ¶ˆæ¯ã€‚",thinkingLabel:"æ€è€ƒè¿‡ç¨‹",thinkingCollapsed:"æ€è€ƒå®Œæˆ (ç‚¹å‡»å±•å¼€)",generating:"ç”Ÿæˆä¸­...",actualModel:"å®žé™…æ¨¡åž‹",uploadImage:"ä¸Šä¼ å›¾ç‰‡",interruptAndSend:"æ‰“æ–­å‘é€",interruptAndSendShortcut:"æ‰“æ–­å¹¶å‘é€ (Ctrl+Enter)",moreContexts:"è¿˜æœ‰ {count} ä¸ªä¸Šä¸‹æ–‡",tokenTooltip:"è¾“å…¥: {input}, è¾“å‡º: {output}, ç¼“å­˜åˆ›å»º: {cacheCreation}, ç¼“å­˜è¯»å–: {cacheRead}",welcomeScreen:{title:"å¼€å§‹ä¸Ž Claude å¯¹è¯",description:"è¾“å…¥æ‚¨çš„é—®é¢˜æˆ–æƒ³æ³•ï¼ŒClaude å°†å¸®åŠ©æ‚¨ç¼–å†™ä»£ç ã€è§£ç­”ç–‘é—®",askCode:"è¯¢é—®ä»£ç é—®é¢˜",refactor:"é‡æž„çŽ°æœ‰ä»£ç ",debug:"è°ƒè¯•é”™è¯¯",sendHint:"å‘é€æ¶ˆæ¯",newLineHint:"æ¢è¡Œ",interruptHint:"æ‰“æ–­å‘é€",stopHint:"åœæ­¢ç”Ÿæˆ",toggleThinkingHint:"å¼€å…³æ€è€ƒ",switchModeHint:"åˆ‡æ¢æ¨¡å¼",clearToLineStartHint:"æ¸…ç©ºåˆ°è¡Œé¦–"},connectionStatus:{connected:"å·²è¿žæŽ¥",connecting:"æ­£åœ¨è¿žæŽ¥...",disconnected:"æœªè¿žæŽ¥",generating:"ç”Ÿæˆä¸­..."},claudeThinking:"Claude æ­£åœ¨æ€è€ƒ...",loadingHistory:"æ­£åœ¨åŠ è½½åŽ†å²ä¼šè¯...",scrollToBottom:"å›žåˆ°åº•éƒ¨"},tools:{error:"é”™è¯¯",read:"è¯»å–æ–‡ä»¶",write:"å†™å…¥æ–‡ä»¶",edit:"ç¼–è¾‘æ–‡ä»¶",bash:"æ‰§è¡Œå‘½ä»¤",search:"æœç´¢æ–‡ä»¶",status:{pending:"ç­‰å¾…",running:"æ‰§è¡Œä¸­",runningWithDots:"æ‰§è¡Œä¸­...",completed:"å·²å®Œæˆ",failed:"å¤±è´¥",cancelled:"å·²å–æ¶ˆ",success:"æˆåŠŸ"},editSuccess:"ç¼–è¾‘æˆåŠŸ",editFailed:"ç¼–è¾‘å¤±è´¥",confirmed:"å·²ç¡®è®¤",terminated:"å·²ç»ˆæ­¢",copyContent:"å¤åˆ¶å†…å®¹",openInEditor:"åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€",parsingParams:"æ­£åœ¨è§£æžå‚æ•°...",ctrlBToBackground:"Ctrl+B åŽå°è¿è¡Œ",contentTruncated:"å†…å®¹å·²æˆªæ–­",noOutput:"æ— è¾“å‡º",replaceAll:"å…¨éƒ¨æ›¿æ¢",changeNumber:"ä¿®æ”¹ #{number}",questions:"{count} ä¸ªé—®é¢˜",subtask:"å­ä»»åŠ¡",newContent:"æ–°å†…å®¹",label:{path:"è·¯å¾„",pattern:"æ¨¡å¼",lines:"è¡Œæ•°",start:"å¼€å§‹",duration:"è€—æ—¶",filter:"è¿‡æ»¤å™¨",output:"è¾“å‡ºå†…å®¹",result:"ç»“æžœ",searchPattern:"æœç´¢æ¨¡å¼",searchPath:"æœç´¢è·¯å¾„",fileFilter:"æ–‡ä»¶è¿‡æ»¤",fileType:"æ–‡ä»¶ç±»åž‹",outputMode:"è¾“å‡ºæ¨¡å¼",cell:"å•å…ƒ",mode:"æ¨¡å¼",agentType:"ä»£ç†ç±»åž‹",model:"æ¨¡åž‹",prompt:"æç¤º",query:"æœç´¢æŸ¥è¯¢",allowedDomains:"å…è®¸åŸŸå",blockedDomains:"å±è”½åŸŸå"},readTool:{reading:"æ­£åœ¨è¯»å–æ–‡ä»¶...",readResult:"è¯»å–ç»“æžœ"},grepTool:{outputModes:{content:"å†…å®¹",filesWithMatches:"åŒ¹é…æ–‡ä»¶",count:"è®¡æ•°"},options:{ignoreCase:"å¿½ç•¥å¤§å°å†™",showLineNumbers:"æ˜¾ç¤ºè¡Œå·",multiline:"å¤šè¡ŒåŒ¹é…"}},todoTool:{pending:"å¾…å¤„ç†",inProgress:"è¿›è¡Œä¸­",completed:"å·²å®Œæˆ",tasksCount:"{n}é¡¹ä»»åŠ¡"},multiEdit:{changes:"{n}å¤„"},writeTool:{lines:"{n}è¡Œ"}},settings:{title:"è®¾ç½®",language:"è¯­è¨€",theme:"ä¸»é¢˜",autoScroll:"è‡ªåŠ¨æ»šåŠ¨",fontSize:"å­—ä½“å¤§å°",autoLoadContext:"æ–°å»ºä¼šè¯æ—¶è‡ªåŠ¨åŠ è½½ä¸Šæ¬¡å¯¹è¯çš„ä¸Šä¸‹æ–‡ã€‚",temperature:"æ¸©åº¦",temperatureDescription:"æŽ§åˆ¶æ¨¡åž‹çš„åˆ›é€ æ€§ã€‚0 = ç¡®å®šæ€§, 1 = é«˜åˆ›é€ æ€§ã€‚ç•™ç©ºä½¿ç”¨é»˜è®¤å€¼ã€‚"},session:{defaultName:"ä¼šè¯ {time}",close:"å…³é—­ä¼šè¯",sessionId:"ä¼šè¯ ID",copyHint:"å†æ¬¡å•å‡»æˆ–åŒå‡»å¤åˆ¶",copySuccess:"ä¼šè¯ ID å·²å¤åˆ¶",copyFailed:"å¤åˆ¶å¤±è´¥",group:{today:"ä»Šå¤©",yesterday:"æ˜¨å¤©",sevenDays:"7å¤©å†…",thirtyDays:"30å¤©å†…",older:"æ›´æ—©"},search:"æœç´¢ä¼šè¯...",export:"å¯¼å‡ºä¼šè¯",editGroup:"ç¼–è¾‘åˆ†ç»„",createGroup:"åˆ›å»ºåˆ†ç»„",editTag:"ç¼–è¾‘æ ‡ç­¾",createTag:"åˆ›å»ºæ ‡ç­¾",deleteSession:"åˆ é™¤ä¼šè¯",searchFailed:"æœç´¢å¤±è´¥",history:"ä¼šè¯åŽ†å²",sessionCount:"ä¸ªä¼šè¯",noHistory:"æš‚æ— åŽ†å²",active:"æ¿€æ´»ä¸­",noActive:"æ— æ¿€æ´»ä¼šè¯",historySection:"åŽ†å²",unnamed:"æœªå‘½åä¼šè¯",empty:"æš‚æ— æ´»åŠ¨ä¼šè¯",messages:"æ¡æ¶ˆæ¯",loadHistoryFailed:"åŠ è½½åŽ†å²ä¼šè¯å¤±è´¥",deleteSuccess:"ä¼šè¯å·²åˆ é™¤",deleteFailed:"åˆ é™¤ä¼šè¯å¤±è´¥",loadMore:"åŠ è½½æ›´å¤š",scrollToLoadMore:"ä¸‹æ»‘åŠ è½½æ›´å¤š",selected:"å·²é€‰æ‹©"},time:{justNow:"åˆšåˆš",minutesAgo:"{n} åˆ†é’Ÿå‰",hoursAgo:"{n} å°æ—¶å‰",daysAgo:"{n} å¤©å‰"},thinking:{label:"æ€è€ƒ",enabled:"å·²å¼€å¯",disabled:"å·²å…³é—­",alwaysOn:"æ­¤æ¨¡åž‹å¼ºåˆ¶å¼€å¯æ€è€ƒ",notSupported:"æ­¤æ¨¡åž‹ä¸æ”¯æŒæ€è€ƒ",toggleOn:"ç‚¹å‡»å¼€å¯æ€è€ƒ",toggleOff:"ç‚¹å‡»å…³é—­æ€è€ƒ",selectLevel:"é€‰æ‹©æ€è€ƒçº§åˆ«"},context:{usage:"ä¸Šä¸‹æ–‡ä½¿ç”¨: {used} / {max} tokens ({percentage}%)",critical:"ðŸš¨ ä¸Šä¸‹æ–‡çª—å£å³å°†ç”¨å®Œï¼å»ºè®®ç«‹å³å¼€å¯æ–°å¯¹è¯",warning:"ðŸ’¡ ä¸Šä¸‹æ–‡å·²ä½¿ç”¨ä¸€åŠï¼Œæ³¨æ„ç®¡ç†"},keyboard:{sendMessage:"å‘é€æ¶ˆæ¯",closeDialog:"å…³é—­å¯¹è¯æ¡†"},permission:{needsAuth:"éœ€è¦æŽˆæƒ",allow:"å…è®¸",deny:"ä¸å…è®¸",denyReasonPlaceholder:"æ‹’ç»åŽŸå› ï¼ˆå¯é€‰ï¼‰",noParams:"æ— å‚æ•°ä¿¡æ¯",confirm:"ç¡®è®¤",escToDeny:"æŒ‰ ESC ç›´æŽ¥æ‹’ç»",viewInIdea:"åœ¨ IDEA ä¸­æŸ¥çœ‹",expand:"å±•å¼€",collapse:"æ”¶èµ·",edits:"å¤„ä¿®æ”¹",planReady:"è®¡åˆ’å·²å‡†å¤‡",noPlanContent:"æ— è®¡åˆ’å†…å®¹",replace:"æ›¿æ¢",with:"ä¸º",editPreviewTitle:"ç¼–è¾‘é¢„è§ˆ",multiEditPreviewTitle:"å¤šå¤„ç¼–è¾‘é¢„è§ˆ",planPreviewTitle:"è®¡åˆ’é¢„è§ˆ",destination:{session:"æœ¬æ¬¡ä¼šè¯",projectSettings:"é¡¹ç›®è®¾ç½®",userSettings:"ç”¨æˆ·è®¾ç½®",localSettings:"æœ¬åœ°è®¾ç½®"},suggestion:{rememberTo:"è®°ä½ {tool} åˆ°{dest}",rememberWithRuleTo:"è®°ä½ {tool}({rule}) åˆ°{dest}",replaceTo:"æ›¿æ¢è§„åˆ™åˆ°{dest}",removeFrom:"ç§»é™¤ {tool} ä»Ž{dest}",removeRulesFrom:"ç§»é™¤è§„åˆ™ä»Ž{dest}",switchTo:"åˆ‡æ¢åˆ°{mode}",applyTo:"åº”ç”¨åˆ°{dest}",addDirTo:"æ·»åŠ ç›®å½• {dir} åˆ°{dest}",removeDirFrom:"ç§»é™¤ç›®å½• {dir} ä»Ž{dest}"},mode:{default:"é»˜è®¤æ¨¡å¼",acceptEdits:"è‡ªåŠ¨æŽ¥å—ç¼–è¾‘",plan:"è®¡åˆ’æ¨¡å¼",bypassPermissions:"è·³è¿‡æƒé™",bypass:"è·³è¿‡",bypassTooltip:"è·³è¿‡æ‰€æœ‰æƒé™ç¡®è®¤ï¼Œç›´æŽ¥æ‰§è¡Œæ“ä½œ",dontAsk:"ä¸å†è¯¢é—®"}},system:{interrupted:"[ç”¨æˆ·å·²æ‰“æ–­è¯·æ±‚]"},compact:{compacting:"æ­£åœ¨åŽ‹ç¼©ä¼šè¯ä¸Šä¸‹æ–‡...",contextRestored:"ä¸Šä¸‹æ–‡å·²æ¢å¤",sessionSummary:"ï¼ˆä¼šè¯åŽ‹ç¼©æ‘˜è¦ï¼‰",expand:"å±•å¼€",collapse:"æ”¶èµ·",originalTokens:"åŽŸå§‹ Token"},slashCommand:{compact:"åŽ‹ç¼©å½“å‰ä¼šè¯çš„ä¸Šä¸‹æ–‡",context:"æ˜¾ç¤ºå½“å‰ä¼šè¯çš„ä¸Šä¸‹æ–‡ä¿¡æ¯",rename:"é‡å‘½åå½“å‰ä¼šè¯"},askUser:{title:"Claude éœ€è¦æ‚¨çš„å›žç­”",typeSomething:"è¾“å…¥å†…å®¹...",cancel:"å–æ¶ˆ",submit:"æäº¤",answer:"å›žç­”"}},"en-US":{common:{send:"Send",cancel:"Cancel",confirm:"Confirm",save:"Save",delete:"Delete",edit:"Edit",copy:"Copy",close:"Close",loading:"Loading...",success:"Success",error:"Error",search:"Search",clear:"Clear",settings:"Settings",tools:"Tools",unknown:"Unknown",remove:"Remove",yes:"Yes",no:"No",ok:"OK",pending:"Pending",cancelled:"Cancelled",copyFailed:"Copy failed",copied:"Copied",renderFailed:"Render failed",noMore:"No more",expand:"Expand",collapse:"Collapse"},chat:{placeholder:"",placeholderWithShortcuts:"",placeholderWithShortcutsCtrl:"",input:{connecting:"Initializing connection...",disconnected:"Disconnected, please refresh the page"},newSession:"New Session",history:"History",thinking:"Thinking...",retry:"Retry",stop:"Stop",stopGenerating:"Stop Generating",escToInterrupt:"ESC to interrupt",streamingStatsTooltip:"Stats: Duration â†‘Input tokens â†“Output tokens",slashCommands:"Slash Commands",noMatchingCommands:"No matching commands",welcome:"Hello! I am Claude, your AI coding assistant.",emptyState:"Start a new session or select one from history.",sendMessage:"Send Message",sendMessageShortcut:"Send Message (Enter) | Right-click for more options",addContext:"{'@'} Add Context",autoCleanupContext:"Auto Cleanup Context",autoCleanupContextTooltip:"Automatically clear context tags after sending message",dropFileToAddContext:"Drop files here to add to context",taskQueue:"Task Queue",taskQueueCount:"Task Queue ({count})",pendingQueue:"Pending ({count})",taskStatus:{pending:"Pending",running:"Running",success:"Success",failed:"Failed"},error:{title:"Error",unknown:"Unknown error",initSessionFailed:"Failed to initialize session: {message}",switchSessionFailed:"Failed to switch session: {message}",sendMessageFailed:"Failed to send message: {message}",connecting:"Initializing connection, please wait...",disconnected:"Disconnected, reconnecting..."},debug:{title:"Debug Info",sessionId:"Session ID",projectPath:"Project Path",messageCount:"Message Count",generating:"Generating",pendingTasks:"Pending Tasks",contexts:"Contexts",notSet:"Not Set",generatingStatus:"Generating"},enterToSend:"Enter to send message Â·",noMessages:"No messages. Please create a session and send a message.",thinkingLabel:"Thinking",thinkingCollapsed:"Thinking complete (click to expand)",generating:"Generating...",actualModel:"Actual model",uploadImage:"Upload image",interruptAndSend:"Interrupt & Send",interruptAndSendShortcut:"Interrupt and send (Ctrl+Enter)",moreContexts:"{count} more contexts",tokenTooltip:"Input: {input}, Output: {output}, Cache creation: {cacheCreation}, Cache read: {cacheRead}",welcomeScreen:{title:"Start a conversation with Claude",description:"Enter your questions or ideas, Claude will help you write code and answer questions",askCode:"Ask code questions",refactor:"Refactor existing code",debug:"Debug errors",sendHint:"send message",newLineHint:"new line",interruptHint:"interrupt & send",stopHint:"stop generation",toggleThinkingHint:"toggle thinking",switchModeHint:"switch mode",clearToLineStartHint:"clear to line start"},connectionStatus:{connected:"Connected",connecting:"Connecting...",disconnected:"Disconnected",generating:"Generating..."},claudeThinking:"Claude is thinking...",loadingHistory:"Loading history...",scrollToBottom:"Scroll to bottom"},tools:{error:"Error",read:"Read File",write:"Write File",edit:"Edit File",bash:"Execute Command",search:"Search Files",status:{pending:"Pending",running:"Running",runningWithDots:"Running...",completed:"Completed",failed:"Failed",cancelled:"Cancelled",success:"Success"},editSuccess:"Edit successful",editFailed:"Edit failed",confirmed:"Confirmed",terminated:"Terminated",copyContent:"Copy Content",openInEditor:"Open in editor",parsingParams:"Parsing parameters...",ctrlBToBackground:"Ctrl+B to background",contentTruncated:"Content truncated",noOutput:"No output",replaceAll:"Replace all",changeNumber:"Change #{number}",questions:"{count} questions",subtask:"Subtask",newContent:"New content",label:{path:"Path",pattern:"Pattern",lines:"Lines",start:"Start",duration:"Duration",filter:"Filter",output:"Output",result:"Result",searchPattern:"Search pattern",searchPath:"Search path",fileFilter:"File filter",fileType:"File type",outputMode:"Output mode",cell:"Cell",mode:"Mode",agentType:"Agent type",model:"Model",prompt:"Prompt",query:"Search query",allowedDomains:"Allowed domains",blockedDomains:"Blocked domains"},readTool:{reading:"Reading file...",readResult:"Read result"},grepTool:{outputModes:{content:"Content",filesWithMatches:"Files with matches",count:"Count"},options:{ignoreCase:"Ignore case",showLineNumbers:"Show line numbers",multiline:"Multiline"}},todoTool:{pending:"Pending",inProgress:"In progress",completed:"Completed",tasksCount:"{n} tasks"},multiEdit:{changes:"{n} changes"},writeTool:{lines:"{n} lines"}},settings:{title:"Settings",language:"Language",theme:"Theme",autoScroll:"Auto Scroll",fontSize:"Font Size",autoLoadContext:"Automatically load last conversation context when creating a new session.",temperature:"Temperature",temperatureDescription:"Controls model creativity. 0 = deterministic, 1 = highly creative. Leave empty to use default value."},session:{defaultName:"Session {time}",close:"Close session",sessionId:"Session ID",copyHint:"Click again or double-click to copy",copySuccess:"Session ID copied",copyFailed:"Copy failed",group:{today:"Today",yesterday:"Yesterday",sevenDays:"Previous 7 Days",thirtyDays:"Previous 30 Days",older:"Older"},search:"Search sessions...",export:"Export Session",editGroup:"Edit Group",createGroup:"Create Group",editTag:"Edit Tag",createTag:"Create Tag",deleteSession:"Delete Session",searchFailed:"Search failed",history:"Session History",sessionCount:"sessions",noHistory:"No history",active:"Active",noActive:"No active sessions",historySection:"History",unnamed:"Unnamed session",empty:"No active sessions",messages:"messages",loadHistoryFailed:"Failed to load history sessions",deleteSuccess:"Session deleted",deleteFailed:"Failed to delete session",loadMore:"Load more",scrollToLoadMore:"Scroll down to load more",selected:"Selected"},time:{justNow:"Just now",minutesAgo:"{n} min ago",hoursAgo:"{n} hr ago",daysAgo:"{n} days ago"},thinking:{label:"Thinking",enabled:"Enabled",disabled:"Disabled",alwaysOn:"Thinking is always enabled for this model",notSupported:"This model does not support thinking",toggleOn:"Click to enable thinking",toggleOff:"Click to disable thinking",selectLevel:"Select thinking level"},context:{usage:"Context usage: {used} / {max} tokens ({percentage}%)",critical:"ðŸš¨ Context window is almost full! Consider starting a new conversation",warning:"ðŸ’¡ Context is half full, manage carefully"},keyboard:{sendMessage:"Send Message",closeDialog:"Close Dialog"},permission:{needsAuth:"Needs Authorization",allow:"Allow",deny:"Deny",denyReasonPlaceholder:"Reason for denial (optional)",noParams:"No parameters",confirm:"Confirm",escToDeny:"Press ESC to deny",viewInIdea:"View in IDEA",expand:"Expand",collapse:"Collapse",edits:"edits",planReady:"Plan is ready",noPlanContent:"No plan content available",replace:"Replace",with:"With",destination:{session:"this session",projectSettings:"project settings",userSettings:"user settings",localSettings:"local settings"},suggestion:{rememberTo:"Remember {tool} to {dest}",rememberWithRuleTo:"Remember {tool}({rule}) to {dest}",replaceTo:"Replace rules to {dest}",removeFrom:"Remove {tool} from {dest}",removeRulesFrom:"Remove rules from {dest}",switchTo:"Switch to {mode}",applyTo:"Apply to {dest}",addDirTo:"Add directory {dir} to {dest}",removeDirFrom:"Remove directory {dir} from {dest}"},mode:{default:"default mode",acceptEdits:"auto-accept edits",plan:"plan mode",bypassPermissions:"bypass permissions",bypass:"Bypass",bypassTooltip:"Skip all permission confirmations and execute directly"},editPreviewTitle:"Edit Preview",multiEditPreviewTitle:"Multi-Edit Preview",planPreviewTitle:"Plan Preview"},system:{interrupted:"[Request interrupted by user]"},compact:{compacting:"Compacting conversation context...",contextRestored:"Context restored",sessionSummary:"(Session summary)",expand:"Expand",collapse:"Collapse",originalTokens:"Original tokens"},slashCommand:{compact:"Compact current session context",context:"Show current session context info",rename:"Rename current session"},askUser:{title:"Claude needs your answer",typeSomething:"Type something...",cancel:"Cancel",submit:"Submit",answer:"Answer"}},"ko-KR":{common:{send:"ë³´ë‚´ê¸°",cancel:"ì·¨ì†Œ",confirm:"í™•ì¸",save:"ì €ìž¥",delete:"ì‚­ì œ",edit:"íŽ¸ì§‘",copy:"ë³µì‚¬",close:"ë‹«ê¸°",loading:"ë¡œë”© ì¤‘...",success:"ì„±ê³µ",error:"ì˜¤ë¥˜",search:"ê²€ìƒ‰",clear:"ì§€ìš°ê¸°",settings:"ì„¤ì •",tools:"ë„êµ¬",unknown:"ì•Œ ìˆ˜ ì—†ìŒ",remove:"ì œê±°",yes:"ì˜ˆ",no:"ì•„ë‹ˆì˜¤",ok:"í™•ì¸",pending:"ëŒ€ê¸° ì¤‘",cancelled:"ì·¨ì†Œë¨",copyFailed:"ë³µì‚¬ ì‹¤íŒ¨",copied:"ë³µì‚¬ë¨",renderFailed:"ë Œë”ë§ ì‹¤íŒ¨",noMore:"ë” ì´ìƒ ì—†ìŒ",expand:"íŽ¼ì¹˜ê¸°",collapse:"ì ‘ê¸°"},chat:{placeholder:"",placeholderWithShortcuts:"",placeholderWithShortcutsCtrl:"",newSession:"ìƒˆ ì„¸ì…˜",history:"ê¸°ë¡",thinking:"ìƒê° ì¤‘...",retry:"ë‹¤ì‹œ ì‹œë„",stop:"ì¤‘ì§€",stopGenerating:"ìƒì„± ì¤‘ì§€",escToInterrupt:"ESCë¡œ ì¤‘ë‹¨",streamingStatsTooltip:"í†µê³„: ì†Œìš”ì‹œê°„ â†‘ìž…ë ¥ tokens â†“ì¶œë ¥ tokens",slashCommands:"ìŠ¬ëž˜ì‹œ ëª…ë ¹ì–´",noMatchingCommands:"ì¼ì¹˜í•˜ëŠ” ëª…ë ¹ì–´ ì—†ìŒ",welcome:"ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” AI ì½”ë”© ì–´ì‹œìŠ¤í„´íŠ¸ Claudeìž…ë‹ˆë‹¤.",emptyState:"ìƒˆ ì„¸ì…˜ì„ ì‹œìž‘í•˜ê±°ë‚˜ ê¸°ë¡ì—ì„œ ì„ íƒí•˜ì„¸ìš”.",sendMessage:"ë©”ì‹œì§€ ë³´ë‚´ê¸°",sendMessageShortcut:"ë©”ì‹œì§€ ë³´ë‚´ê¸° (Enter) | ë” ë§Žì€ ì˜µì…˜ì€ ì˜¤ë¥¸ìª½ í´ë¦­",addContext:"{'@'} ì»¨í…ìŠ¤íŠ¸ ì¶”ê°€",autoCleanupContext:"ìžë™ ì»¨í…ìŠ¤íŠ¸ ì •ë¦¬",autoCleanupContextTooltip:"ë©”ì‹œì§€ ì „ì†¡ í›„ ì»¨í…ìŠ¤íŠ¸ íƒœê·¸ ìžë™ ì •ë¦¬",dropFileToAddContext:"íŒŒì¼ì„ ì—¬ê¸°ì— ë†“ì•„ ì»¨í…ìŠ¤íŠ¸ì— ì¶”ê°€",taskQueue:"ìž‘ì—… ëŒ€ê¸°ì—´",taskQueueCount:"ìž‘ì—… ëŒ€ê¸°ì—´ ({count})",taskStatus:{pending:"ëŒ€ê¸° ì¤‘",running:"ì‹¤í–‰ ì¤‘",success:"ì„±ê³µ",failed:"ì‹¤íŒ¨"},error:{title:"ì˜¤ë¥˜",unknown:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜",initSessionFailed:"ì„¸ì…˜ ì´ˆê¸°í™” ì‹¤íŒ¨: {message}",switchSessionFailed:"ì„¸ì…˜ ì „í™˜ ì‹¤íŒ¨: {message}",sendMessageFailed:"ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨: {message}"},debug:{title:"ë””ë²„ê·¸ ì •ë³´",sessionId:"ì„¸ì…˜ ID",projectPath:"í”„ë¡œì íŠ¸ ê²½ë¡œ",messageCount:"ë©”ì‹œì§€ ìˆ˜",generating:"ìƒì„± ì¤‘",pendingTasks:"ëŒ€ê¸° ìž‘ì—…",contexts:"ì»¨í…ìŠ¤íŠ¸",notSet:"ì„¤ì • ì•ˆë¨",generatingStatus:"ìƒì„± ì¤‘"},enterToSend:"Enterë¡œ ë©”ì‹œì§€ ë³´ë‚´ê¸° Â·",noMessages:"ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤. ì„¸ì…˜ì„ ë§Œë“¤ê³  ë©”ì‹œì§€ë¥¼ ë³´ë‚´ì„¸ìš”.",thinkingLabel:"ìƒê° ì¤‘",thinkingCollapsed:"ìƒê° ì™„ë£Œ (í´ë¦­í•˜ì—¬ íŽ¼ì¹˜ê¸°)",generating:"ìƒì„± ì¤‘...",actualModel:"ì‹¤ì œ ëª¨ë¸",uploadImage:"ì´ë¯¸ì§€ ì—…ë¡œë“œ",interruptAndSend:"ì¤‘ë‹¨ í›„ ë³´ë‚´ê¸°",interruptAndSendShortcut:"ì¤‘ë‹¨ í›„ ë³´ë‚´ê¸° (Ctrl+Enter)",moreContexts:"{count}ê°œ ë” ë§Žì€ ì»¨í…ìŠ¤íŠ¸",tokenTooltip:"ìž…ë ¥: {input}, ì¶œë ¥: {output}, ìºì‹œ ìƒì„±: {cacheCreation}, ìºì‹œ ì½ê¸°: {cacheRead}",welcomeScreen:{title:"Claudeì™€ ëŒ€í™” ì‹œìž‘í•˜ê¸°",description:"ì§ˆë¬¸ì´ë‚˜ ì•„ì´ë””ì–´ë¥¼ ìž…ë ¥í•˜ì„¸ìš”. Claudeê°€ ì½”ë“œ ìž‘ì„±ê³¼ ì§ˆë¬¸ ë‹µë³€ì„ ë„ì™€ë“œë¦½ë‹ˆë‹¤",askCode:"ì½”ë“œ ì§ˆë¬¸í•˜ê¸°",refactor:"ê¸°ì¡´ ì½”ë“œ ë¦¬íŒ©í† ë§",debug:"ì˜¤ë¥˜ ë””ë²„ê¹…",sendHint:"ë©”ì‹œì§€ ë³´ë‚´ê¸°",newLineHint:"ì¤„ë°”ê¿ˆ",interruptHint:"ì¤‘ë‹¨ í›„ ë³´ë‚´ê¸°",stopHint:"ìƒì„± ì¤‘ì§€",toggleThinkingHint:"ì‚¬ê³  ì „í™˜",switchModeHint:"ëª¨ë“œ ì „í™˜",clearToLineStartHint:"ì¤„ ì‹œìž‘ê¹Œì§€ ì§€ìš°ê¸°"},claudeThinking:"Claudeê°€ ìƒê° ì¤‘ìž…ë‹ˆë‹¤...",scrollToBottom:"ë§¨ ì•„ëž˜ë¡œ ì´ë™"},tools:{read:"íŒŒì¼ ì½ê¸°",write:"íŒŒì¼ ì“°ê¸°",edit:"íŒŒì¼ íŽ¸ì§‘",bash:"ëª…ë ¹ ì‹¤í–‰",search:"íŒŒì¼ ê²€ìƒ‰",status:{pending:"ëŒ€ê¸° ì¤‘",running:"ì‹¤í–‰ ì¤‘",runningWithDots:"ì‹¤í–‰ ì¤‘...",completed:"ì™„ë£Œë¨",failed:"ì‹¤íŒ¨",cancelled:"ì·¨ì†Œë¨",success:"ì„±ê³µ"},editSuccess:"íŽ¸ì§‘ ì„±ê³µ",editFailed:"íŽ¸ì§‘ ì‹¤íŒ¨",confirmed:"í™•ì¸ë¨",terminated:"ì¢…ë£Œë¨",copyContent:"ë‚´ìš© ë³µì‚¬",openInEditor:"íŽ¸ì§‘ê¸°ì—ì„œ ì—´ê¸°",parsingParams:"ë§¤ê°œë³€ìˆ˜ ë¶„ì„ ì¤‘...",contentTruncated:"ë‚´ìš© ìž˜ë¦¼",noOutput:"ì¶œë ¥ ì—†ìŒ",replaceAll:"ëª¨ë‘ êµì²´",changeNumber:"ë³€ê²½ #{number}",questions:"{count}ê°œ ì§ˆë¬¸",subtask:"í•˜ìœ„ ìž‘ì—…",newContent:"ìƒˆ ë‚´ìš©",label:{path:"ê²½ë¡œ",pattern:"íŒ¨í„´",lines:"ì¤„ ìˆ˜",start:"ì‹œìž‘",duration:"ì†Œìš” ì‹œê°„",filter:"í•„í„°",output:"ì¶œë ¥",result:"ê²°ê³¼",searchPattern:"ê²€ìƒ‰ íŒ¨í„´",searchPath:"ê²€ìƒ‰ ê²½ë¡œ",fileFilter:"íŒŒì¼ í•„í„°",fileType:"íŒŒì¼ ìœ í˜•",outputMode:"ì¶œë ¥ ëª¨ë“œ",cell:"ì…€",mode:"ëª¨ë“œ",agentType:"ì—ì´ì „íŠ¸ ìœ í˜•",model:"ëª¨ë¸",prompt:"í”„ë¡¬í”„íŠ¸",query:"ê²€ìƒ‰ì–´",allowedDomains:"í—ˆìš©ëœ ë„ë©”ì¸",blockedDomains:"ì°¨ë‹¨ëœ ë„ë©”ì¸"},readTool:{reading:"íŒŒì¼ ì½ëŠ” ì¤‘...",readResult:"ì½ê¸° ê²°ê³¼"},grepTool:{outputModes:{content:"ë‚´ìš©",filesWithMatches:"ì¼ì¹˜í•˜ëŠ” íŒŒì¼",count:"ê°œìˆ˜"},options:{ignoreCase:"ëŒ€ì†Œë¬¸ìž ë¬´ì‹œ",showLineNumbers:"ì¤„ ë²ˆí˜¸ í‘œì‹œ",multiline:"ì—¬ëŸ¬ ì¤„"}},todoTool:{pending:"ëŒ€ê¸° ì¤‘",inProgress:"ì§„í–‰ ì¤‘",completed:"ì™„ë£Œë¨",tasksCount:"{n}ê°œ ìž‘ì—…"},multiEdit:{changes:"{n}ê°œ ë³€ê²½"},writeTool:{lines:"{n}ì¤„"}},settings:{title:"ì„¤ì •",language:"ì–¸ì–´",theme:"í…Œë§ˆ",autoScroll:"ìžë™ ìŠ¤í¬ë¡¤",fontSize:"ê¸€ê¼´ í¬ê¸°",autoLoadContext:"ìƒˆ ì„¸ì…˜ ìƒì„± ì‹œ ë§ˆì§€ë§‰ ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ë¥¼ ìžë™ìœ¼ë¡œ ë¡œë“œí•©ë‹ˆë‹¤.",temperature:"ì˜¨ë„",temperatureDescription:"ëª¨ë¸ ì°½ì˜ì„±ì„ ì œì–´í•©ë‹ˆë‹¤. 0 = ê²°ì •ì , 1 = ë†’ì€ ì°½ì˜ì„±. ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•˜ë ¤ë©´ ë¹„ì›Œë‘ì„¸ìš”."},session:{defaultName:"ì„¸ì…˜ {time}",group:{today:"ì˜¤ëŠ˜",yesterday:"ì–´ì œ",sevenDays:"ì§€ë‚œ 7ì¼",thirtyDays:"ì§€ë‚œ 30ì¼",older:"ì´ì „"},search:"ì„¸ì…˜ ê²€ìƒ‰...",export:"ì„¸ì…˜ ë‚´ë³´ë‚´ê¸°",editGroup:"ê·¸ë£¹ íŽ¸ì§‘",createGroup:"ê·¸ë£¹ ë§Œë“¤ê¸°",editTag:"íƒœê·¸ íŽ¸ì§‘",createTag:"íƒœê·¸ ë§Œë“¤ê¸°",deleteSession:"ì„¸ì…˜ ì‚­ì œ",searchFailed:"ê²€ìƒ‰ ì‹¤íŒ¨",history:"ì„¸ì…˜ ê¸°ë¡",sessionCount:"ê°œì˜ ì„¸ì…˜",noHistory:"ê¸°ë¡ ì—†ìŒ",active:"í™œì„±",noActive:"í™œì„± ì„¸ì…˜ ì—†ìŒ",historySection:"ê¸°ë¡",unnamed:"ì´ë¦„ ì—†ëŠ” ì„¸ì…˜",messages:"ê°œì˜ ë©”ì‹œì§€"},time:{justNow:"ë°©ê¸ˆ",minutesAgo:"{n}ë¶„ ì „",hoursAgo:"{n}ì‹œê°„ ì „",daysAgo:"{n}ì¼ ì „"},thinking:{label:"ì‚¬ê³ ",enabled:"ì¼œì§",disabled:"êº¼ì§",alwaysOn:"ì´ ëª¨ë¸ì€ ì‚¬ê³ ê°€ í•­ìƒ í™œì„±í™”ë©ë‹ˆë‹¤",notSupported:"ì´ ëª¨ë¸ì€ ì‚¬ê³ ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤",toggleOn:"í´ë¦­í•˜ì—¬ ì‚¬ê³  í™œì„±í™”",toggleOff:"í´ë¦­í•˜ì—¬ ì‚¬ê³  ë¹„í™œì„±í™”"},context:{usage:"ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©ëŸ‰: {used} / {max} í† í° ({percentage}%)",critical:"ðŸš¨ ì»¨í…ìŠ¤íŠ¸ ì°½ì´ ê±°ì˜ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤! ìƒˆ ëŒ€í™”ë¥¼ ì‹œìž‘í•˜ëŠ” ê²ƒì„ ê³ ë ¤í•˜ì„¸ìš”",warning:"ðŸ’¡ ì»¨í…ìŠ¤íŠ¸ê°€ ì ˆë°˜ ì°¼ìŠµë‹ˆë‹¤, ì£¼ì˜í•´ì„œ ê´€ë¦¬í•˜ì„¸ìš”"},keyboard:{sendMessage:"ë©”ì‹œì§€ ë³´ë‚´ê¸°",closeDialog:"ëŒ€í™”ìƒìž ë‹«ê¸°"},permission:{needsAuth:"ìŠ¹ì¸ í•„ìš”",allow:"í—ˆìš©",deny:"ê±°ë¶€",denyReasonPlaceholder:"ê±°ë¶€ ì‚¬ìœ  (ì„ íƒ)",noParams:"ë§¤ê°œë³€ìˆ˜ ì—†ìŒ",confirm:"í™•ì¸",escToDeny:"ESCë¥¼ ëˆŒëŸ¬ ê±°ë¶€",viewInIdea:"IDEAì—ì„œ ë³´ê¸°",expand:"íŽ¼ì¹˜ê¸°",collapse:"ì ‘ê¸°",edits:"ê°œ íŽ¸ì§‘",planReady:"ê³„íš ì¤€ë¹„ë¨",noPlanContent:"ê³„íš ë‚´ìš© ì—†ìŒ",replace:"êµì²´",with:"â†’",editPreviewTitle:"íŽ¸ì§‘ ë¯¸ë¦¬ë³´ê¸°",multiEditPreviewTitle:"ë‹¤ì¤‘ íŽ¸ì§‘ ë¯¸ë¦¬ë³´ê¸°",planPreviewTitle:"ê³„íš ë¯¸ë¦¬ë³´ê¸°",destination:{session:"ì´ ì„¸ì…˜",projectSettings:"í”„ë¡œì íŠ¸ ì„¤ì •",userSettings:"ì‚¬ìš©ìž ì„¤ì •",localSettings:"ë¡œì»¬ ì„¤ì •"},suggestion:{rememberTo:"{tool}ì„(ë¥¼) {dest}ì— ê¸°ì–µ",rememberWithRuleTo:"{tool}({rule})ì„(ë¥¼) {dest}ì— ê¸°ì–µ",replaceTo:"{dest}ì— ê·œì¹™ êµì²´",removeFrom:"{dest}ì—ì„œ {tool} ì œê±°",removeRulesFrom:"{dest}ì—ì„œ ê·œì¹™ ì œê±°",switchTo:"{mode}(ìœ¼)ë¡œ ì „í™˜",applyTo:"{dest}ì— ì ìš©",addDirTo:"{dest}ì— ë””ë ‰í† ë¦¬ {dir} ì¶”ê°€",removeDirFrom:"{dest}ì—ì„œ ë””ë ‰í† ë¦¬ {dir} ì œê±°"},mode:{default:"ê¸°ë³¸ ëª¨ë“œ",acceptEdits:"íŽ¸ì§‘ ìžë™ ìˆ˜ë½",plan:"ê³„íš ëª¨ë“œ",bypassPermissions:"ê¶Œí•œ ìš°íšŒ",bypass:"ìš°íšŒ",bypassTooltip:"ëª¨ë“  ê¶Œí•œ í™•ì¸ì„ ê±´ë„ˆë›°ê³  ì§ì ‘ ì‹¤í–‰"}},system:{interrupted:"[ì‚¬ìš©ìžì— ì˜í•´ ìš”ì²­ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤]"},compact:{compacting:"ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ ì••ì¶• ì¤‘...",contextRestored:"ì»¨í…ìŠ¤íŠ¸ ë³µì›ë¨",sessionSummary:"(ì„¸ì…˜ ìš”ì•½)",expand:"íŽ¼ì¹˜ê¸°",collapse:"ì ‘ê¸°",originalTokens:"ì›ë³¸ í† í°"},slashCommand:{compact:"í˜„ìž¬ ì„¸ì…˜ ì»¨í…ìŠ¤íŠ¸ ì••ì¶•",context:"í˜„ìž¬ ì„¸ì…˜ ì»¨í…ìŠ¤íŠ¸ ì •ë³´ í‘œì‹œ",rename:"í˜„ìž¬ ì„¸ì…˜ ì´ë¦„ ë³€ê²½"}},"ja-JP":{common:{send:"é€ä¿¡",cancel:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«",confirm:"ç¢ºèª",save:"ä¿å­˜",delete:"å‰Šé™¤",edit:"ç·¨é›†",copy:"ã‚³ãƒ”ãƒ¼",close:"é–‰ã˜ã‚‹",loading:"èª­ã¿è¾¼ã¿ä¸­...",success:"æˆåŠŸ",error:"ã‚¨ãƒ©ãƒ¼",search:"æ¤œç´¢",clear:"ã‚¯ãƒªã‚¢",settings:"è¨­å®š",tools:"ãƒ„ãƒ¼ãƒ«",unknown:"ä¸æ˜Ž",remove:"å‰Šé™¤",yes:"ã¯ã„",no:"ã„ã„ãˆ",ok:"OK",pending:"ä¿ç•™ä¸­",cancelled:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿",copyFailed:"ã‚³ãƒ”ãƒ¼å¤±æ•—",copied:"ã‚³ãƒ”ãƒ¼æ¸ˆã¿",renderFailed:"ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¤±æ•—",noMore:"ã“ã‚Œä»¥ä¸Šã¯ã‚ã‚Šã¾ã›ã‚“",expand:"å±•é–‹",collapse:"æŠ˜ã‚ŠãŸãŸã‚€"},chat:{placeholder:"",placeholderWithShortcuts:"",placeholderWithShortcutsCtrl:"",newSession:"æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³",history:"å±¥æ­´",thinking:"è€ƒãˆä¸­...",retry:"å†è©¦è¡Œ",stop:"åœæ­¢",stopGenerating:"ç”Ÿæˆã‚’åœæ­¢",escToInterrupt:"ESC ã§ä¸­æ–­",streamingStatsTooltip:"çµ±è¨ˆï¼šæ‰€è¦æ™‚é–“ â†‘å…¥åŠ›tokens â†“å‡ºåŠ›tokens",slashCommands:"ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒžãƒ³ãƒ‰",noMatchingCommands:"ä¸€è‡´ã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“",welcome:"ã“ã‚“ã«ã¡ã¯ï¼ç§ã¯AIã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®Claudeã§ã™ã€‚",emptyState:"æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã™ã‚‹ã‹ã€å±¥æ­´ã‹ã‚‰é¸æŠžã—ã¦ãã ã•ã„ã€‚",sendMessage:"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡",sendMessageShortcut:"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ (Enter) | å³ã‚¯ãƒªãƒƒã‚¯ã§ãã®ä»–ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³",addContext:"{'@'} ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ ",autoCleanupContext:"ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—",autoCleanupContextTooltip:"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡å¾Œã«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¿ã‚°ã‚’è‡ªå‹•çš„ã«ã‚¯ãƒªã‚¢",dropFileToAddContext:"ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã“ã“ã«ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«è¿½åŠ ",taskQueue:"ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼",taskQueueCount:"ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼ ({count})",taskStatus:{pending:"ä¿ç•™ä¸­",running:"å®Ÿè¡Œä¸­",success:"æˆåŠŸ",failed:"å¤±æ•—"},error:{title:"ã‚¨ãƒ©ãƒ¼",unknown:"ä¸æ˜Žãªã‚¨ãƒ©ãƒ¼",initSessionFailed:"ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆæœŸåŒ–å¤±æ•—: {message}",switchSessionFailed:"ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡æ›¿å¤±æ•—: {message}",sendMessageFailed:"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡å¤±æ•—: {message}"},debug:{title:"ãƒ‡ãƒãƒƒã‚°æƒ…å ±",sessionId:"ã‚»ãƒƒã‚·ãƒ§ãƒ³ID",projectPath:"ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‘ã‚¹",messageCount:"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°",generating:"ç”Ÿæˆä¸­",pendingTasks:"ä¿ç•™ã‚¿ã‚¹ã‚¯",contexts:"ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ",notSet:"æœªè¨­å®š",generatingStatus:"ç”Ÿæˆä¸­"},enterToSend:"Enterã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ Â·",noMessages:"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚",thinkingLabel:"æ€è€ƒä¸­",thinkingCollapsed:"æ€è€ƒå®Œäº† (ã‚¯ãƒªãƒƒã‚¯ã§å±•é–‹)",generating:"ç”Ÿæˆä¸­...",actualModel:"å®Ÿéš›ã®ãƒ¢ãƒ‡ãƒ«",uploadImage:"ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰",interruptAndSend:"ä¸­æ–­ã—ã¦é€ä¿¡",interruptAndSendShortcut:"ä¸­æ–­ã—ã¦é€ä¿¡ (Ctrl+Enter)",moreContexts:"ã‚ã¨{count}å€‹ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ",tokenTooltip:"å…¥åŠ›: {input}, å‡ºåŠ›: {output}, ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä½œæˆ: {cacheCreation}, ã‚­ãƒ£ãƒƒã‚·ãƒ¥èª­å–: {cacheRead}",welcomeScreen:{title:"Claudeã¨ã®ä¼šè©±ã‚’å§‹ã‚ã¾ã—ã‚‡ã†",description:"è³ªå•ã‚„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ClaudeãŒã‚³ãƒ¼ãƒ‰ä½œæˆã‚„è³ªå•ã¸ã®å›žç­”ã‚’ãŠæ‰‹ä¼ã„ã—ã¾ã™",askCode:"ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦è³ªå•",refactor:"æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°",debug:"ã‚¨ãƒ©ãƒ¼ã‚’ãƒ‡ãƒãƒƒã‚°",sendHint:"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡",newLineHint:"æ”¹è¡Œ",interruptHint:"ä¸­æ–­ã—ã¦é€ä¿¡",stopHint:"ç”Ÿæˆåœæ­¢",toggleThinkingHint:"æ€è€ƒåˆ‡æ›¿",switchModeHint:"ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿",clearToLineStartHint:"è¡Œé ­ã¾ã§å‰Šé™¤"},claudeThinking:"ClaudeãŒè€ƒãˆã¦ã„ã¾ã™...",scrollToBottom:"ä¸€ç•ªä¸‹ã¸ç§»å‹•"},tools:{read:"ãƒ•ã‚¡ã‚¤ãƒ«èª­å–",write:"ãƒ•ã‚¡ã‚¤ãƒ«æ›¸è¾¼",edit:"ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†",bash:"ã‚³ãƒžãƒ³ãƒ‰å®Ÿè¡Œ",search:"ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢",status:{pending:"ä¿ç•™ä¸­",running:"å®Ÿè¡Œä¸­",runningWithDots:"å®Ÿè¡Œä¸­...",completed:"å®Œäº†",failed:"å¤±æ•—",cancelled:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿",success:"æˆåŠŸ"},editSuccess:"ç·¨é›†æˆåŠŸ",editFailed:"ç·¨é›†å¤±æ•—",confirmed:"ç¢ºèªæ¸ˆã¿",terminated:"çµ‚äº†æ¸ˆã¿",copyContent:"å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼",openInEditor:"ã‚¨ãƒ‡ã‚£ã‚¿ã§é–‹ã",parsingParams:"ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è§£æžä¸­...",contentTruncated:"å†…å®¹ãŒåˆ‡ã‚Šæ¨ã¦ã‚‰ã‚Œã¾ã—ãŸ",noOutput:"å‡ºåŠ›ãªã—",replaceAll:"ã™ã¹ã¦ç½®æ›",changeNumber:"å¤‰æ›´ #{number}",questions:"{count}ä»¶ã®è³ªå•",subtask:"ã‚µãƒ–ã‚¿ã‚¹ã‚¯",newContent:"æ–°ã—ã„å†…å®¹",label:{path:"ãƒ‘ã‚¹",pattern:"ãƒ‘ã‚¿ãƒ¼ãƒ³",lines:"è¡Œæ•°",start:"é–‹å§‹",duration:"æ‰€è¦æ™‚é–“",filter:"ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼",output:"å‡ºåŠ›",result:"çµæžœ",searchPattern:"æ¤œç´¢ãƒ‘ã‚¿ãƒ¼ãƒ³",searchPath:"æ¤œç´¢ãƒ‘ã‚¹",fileFilter:"ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼",fileType:"ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—",outputMode:"å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰",cell:"ã‚»ãƒ«",mode:"ãƒ¢ãƒ¼ãƒ‰",agentType:"ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¿ã‚¤ãƒ—",model:"ãƒ¢ãƒ‡ãƒ«",prompt:"ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ",query:"æ¤œç´¢ã‚¯ã‚¨ãƒª",allowedDomains:"è¨±å¯ãƒ‰ãƒ¡ã‚¤ãƒ³",blockedDomains:"ãƒ–ãƒ­ãƒƒã‚¯ãƒ‰ãƒ¡ã‚¤ãƒ³"},readTool:{reading:"ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚Šä¸­...",readResult:"èª­å–çµæžœ"},grepTool:{outputModes:{content:"å†…å®¹",filesWithMatches:"ä¸€è‡´ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«",count:"ã‚«ã‚¦ãƒ³ãƒˆ"},options:{ignoreCase:"å¤§æ–‡å­—å°æ–‡å­—ã‚’ç„¡è¦–",showLineNumbers:"è¡Œç•ªå·ã‚’è¡¨ç¤º",multiline:"è¤‡æ•°è¡Œ"}},todoTool:{pending:"ä¿ç•™ä¸­",inProgress:"é€²è¡Œä¸­",completed:"å®Œäº†",tasksCount:"{n}ä»¶ã®ã‚¿ã‚¹ã‚¯"},multiEdit:{changes:"{n}ç®‡æ‰€"},writeTool:{lines:"{n}è¡Œ"}},settings:{title:"è¨­å®š",language:"è¨€èªž",theme:"ãƒ†ãƒ¼ãƒž",autoScroll:"è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«",fontSize:"ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º",autoLoadContext:"æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆæ™‚ã«å‰å›žã®ä¼šè©±ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è‡ªå‹•çš„ã«èª­ã¿è¾¼ã¿ã¾ã™ã€‚",temperature:"æ¸©åº¦",temperatureDescription:"ãƒ¢ãƒ‡ãƒ«ã®å‰µé€ æ€§ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚0 = ç¢ºå®šçš„ã€1 = é«˜å‰µé€ æ€§ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ç©ºæ¬„ã«ã—ã¦ãã ã•ã„ã€‚"},session:{defaultName:"ã‚»ãƒƒã‚·ãƒ§ãƒ³ {time}",group:{today:"ä»Šæ—¥",yesterday:"æ˜¨æ—¥",sevenDays:"éŽåŽ»7æ—¥é–“",thirtyDays:"éŽåŽ»30æ—¥é–“",older:"ä»¥å‰"},search:"ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ¤œç´¢...",export:"ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ",editGroup:"ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç·¨é›†",createGroup:"ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ",editTag:"ã‚¿ã‚°ã‚’ç·¨é›†",createTag:"ã‚¿ã‚°ã‚’ä½œæˆ",deleteSession:"ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤",searchFailed:"æ¤œç´¢å¤±æ•—",history:"ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´",sessionCount:"ä»¶ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³",noHistory:"å±¥æ­´ãªã—",active:"ã‚¢ã‚¯ãƒ†ã‚£ãƒ–",noActive:"ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ãªã—",historySection:"å±¥æ­´",unnamed:"ç„¡é¡Œã®ã‚»ãƒƒã‚·ãƒ§ãƒ³",messages:"ä»¶ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"},time:{justNow:"ãŸã£ãŸä»Š",minutesAgo:"{n}åˆ†å‰",hoursAgo:"{n}æ™‚é–“å‰",daysAgo:"{n}æ—¥å‰"},thinking:{label:"æ€è€ƒ",enabled:"ã‚ªãƒ³",disabled:"ã‚ªãƒ•",alwaysOn:"ã“ã®ãƒ¢ãƒ‡ãƒ«ã¯æ€è€ƒãŒå¸¸ã«æœ‰åŠ¹ã§ã™",notSupported:"ã“ã®ãƒ¢ãƒ‡ãƒ«ã¯æ€è€ƒã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“",toggleOn:"ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ€è€ƒã‚’æœ‰åŠ¹ã«ã™ã‚‹",toggleOff:"ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ€è€ƒã‚’ç„¡åŠ¹ã«ã™ã‚‹"},context:{usage:"ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä½¿ç”¨é‡: {used} / {max} ãƒˆãƒ¼ã‚¯ãƒ³ ({percentage}%)",critical:"ðŸš¨ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒã»ã¼ã„ã£ã±ã„ã§ã™ï¼æ–°ã—ã„ä¼šè©±ã‚’å§‹ã‚ã‚‹ã“ã¨ã‚’æ¤œè¨Žã—ã¦ãã ã•ã„",warning:"ðŸ’¡ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒåŠåˆ†ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€æ³¨æ„ã—ã¦ç®¡ç†ã—ã¦ãã ã•ã„"},keyboard:{sendMessage:"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡",closeDialog:"ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‰ã˜ã‚‹"},permission:{needsAuth:"æ‰¿èªãŒå¿…è¦",allow:"è¨±å¯",deny:"æ‹’å¦",denyReasonPlaceholder:"æ‹’å¦ç†ç”±ï¼ˆä»»æ„ï¼‰",noParams:"ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãªã—",confirm:"ç¢ºèª",escToDeny:"ESCã§æ‹’å¦",viewInIdea:"IDEAã§è¡¨ç¤º",expand:"å±•é–‹",collapse:"æŠ˜ã‚ŠãŸãŸã‚€",edits:"ä»¶ã®ç·¨é›†",planReady:"ãƒ—ãƒ©ãƒ³ãŒæº–å‚™ã§ãã¾ã—ãŸ",noPlanContent:"ãƒ—ãƒ©ãƒ³å†…å®¹ãŒã‚ã‚Šã¾ã›ã‚“",replace:"ç½®æ›",with:"â†’",editPreviewTitle:"ç·¨é›†ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼",multiEditPreviewTitle:"è¤‡æ•°ç·¨é›†ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼",planPreviewTitle:"ãƒ—ãƒ©ãƒ³ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼",destination:{session:"ã“ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³",projectSettings:"ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š",userSettings:"ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š",localSettings:"ãƒ­ãƒ¼ã‚«ãƒ«è¨­å®š"},suggestion:{rememberTo:"{tool}ã‚’{dest}ã«è¨˜æ†¶",rememberWithRuleTo:"{tool}({rule})ã‚’{dest}ã«è¨˜æ†¶",replaceTo:"{dest}ã«ãƒ«ãƒ¼ãƒ«ã‚’ç½®æ›",removeFrom:"{dest}ã‹ã‚‰{tool}ã‚’å‰Šé™¤",removeRulesFrom:"{dest}ã‹ã‚‰ãƒ«ãƒ¼ãƒ«ã‚’å‰Šé™¤",switchTo:"{mode}ã«åˆ‡æ›¿",applyTo:"{dest}ã«é©ç”¨",addDirTo:"{dest}ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª{dir}ã‚’è¿½åŠ ",removeDirFrom:"{dest}ã‹ã‚‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª{dir}ã‚’å‰Šé™¤"},mode:{default:"ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¢ãƒ¼ãƒ‰",acceptEdits:"ç·¨é›†ã‚’è‡ªå‹•æ‰¿èª",plan:"ãƒ—ãƒ©ãƒ³ãƒ¢ãƒ¼ãƒ‰",bypassPermissions:"æ¨©é™ã‚’ãƒã‚¤ãƒ‘ã‚¹",bypass:"ãƒã‚¤ãƒ‘ã‚¹",bypassTooltip:"ã™ã¹ã¦ã®æ¨©é™ç¢ºèªã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ç›´æŽ¥å®Ÿè¡Œ"}},system:{interrupted:"[ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚Šãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒä¸­æ–­ã•ã‚Œã¾ã—ãŸ]"},compact:{compacting:"ä¼šè©±ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’åœ§ç¸®ä¸­...",contextRestored:"ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒå¾©å…ƒã•ã‚Œã¾ã—ãŸ",sessionSummary:"ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã®è¦ç´„ï¼‰",expand:"å±•é–‹",collapse:"æŠ˜ã‚ŠãŸãŸã‚€",originalTokens:"å…ƒã®ãƒˆãƒ¼ã‚¯ãƒ³"},slashCommand:{compact:"ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’åœ§ç¸®",context:"ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã‚’è¡¨ç¤º",rename:"ç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®åå‰ã‚’å¤‰æ›´"}}}});function yn(e){gn.global.locale.value=e,"undefined"!=typeof window&&localStorage.setItem(hn,e)}function vn(){return gn.global.locale.value}function bn(e,t){return!(null===e||"object"!=typeof e||!("$typeName"in e)||"string"!=typeof e.$typeName)&&(void 0===t||t.typeName===e.$typeName)}var kn,wn;function Sn(){let e=0,t=0;for(let s=0;s<28;s+=7){let n=this.buf[this.pos++];if(e|=(127&n)<<s,!(128&n))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(15&n)<<28,t=(112&n)>>4,!(128&n))return this.assertBounds(),[e,t];for(let s=3;s<=31;s+=7){let n=this.buf[this.pos++];if(t|=(127&n)<<s,!(128&n))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function Cn(e,t,n){for(let i=0;i<28;i+=7){const s=e>>>i,o=!(s>>>7==0&&0==t),r=255&(o?128|s:s);if(n.push(r),!o)return}const s=e>>>28&15|(7&t)<<4,o=!!(t>>3);if(n.push(255&(o?128|s:s)),o){for(let e=3;e<31;e+=7){const s=t>>>e,o=!(s>>>7==0),i=255&(o?128|s:s);if(n.push(i),!o)return}n.push(t>>>31&1)}}(wn=kn||(kn={}))[wn.DOUBLE=1]="DOUBLE",wn[wn.FLOAT=2]="FLOAT",wn[wn.INT64=3]="INT64",wn[wn.UINT64=4]="UINT64",wn[wn.INT32=5]="INT32",wn[wn.FIXED64=6]="FIXED64",wn[wn.FIXED32=7]="FIXED32",wn[wn.BOOL=8]="BOOL",wn[wn.STRING=9]="STRING",wn[wn.BYTES=12]="BYTES",wn[wn.UINT32=13]="UINT32",wn[wn.SFIXED32=15]="SFIXED32",wn[wn.SFIXED64=16]="SFIXED64",wn[wn.SINT32=17]="SINT32",wn[wn.SINT64=18]="SINT64";const Tn=4294967296;function En(e){const t="-"===e[0];t&&(e=e.slice(1));const n=1e6;let s=0,o=0;function i(t,i){const r=Number(e.slice(t,i));o*=n,s=s*n+r,s>=Tn&&(o+=s/Tn|0,s%=Tn)}return i(-24,-18),i(-18,-12),i(-12,-6),i(-6),t?An(s,o):xn(s,o)}function In(e,t){if(({lo:e,hi:t}=function(e,t){return{lo:e>>>0,hi:t>>>0}}(e,t)),t<=2097151)return String(Tn*t+e);const n=16777215&(e>>>24|t<<8),s=t>>16&65535;let o=(16777215&e)+6777216*n+6710656*s,i=n+8147497*s,r=2*s;const a=1e7;return o>=a&&(i+=Math.floor(o/a),o%=a),i>=a&&(r+=Math.floor(i/a),i%=a),r.toString()+Nn(i)+Nn(o)}function xn(e,t){return{lo:0|e,hi:0|t}}function An(e,t){return t=~t,e?e=1+~e:t+=1,xn(e,t)}const Nn=e=>{const t=String(e);return"0000000".slice(t.length)+t};function Mn(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function Rn(){let e=this.buf[this.pos++],t=127&e;if(!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,!(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let n=5;128&e&&n<10;n++)e=this.buf[this.pos++];if(128&e)throw new Error("invalid varint");return this.assertBounds(),t>>>0}var _n={};const On=Dn();function Dn(){const e=new DataView(new ArrayBuffer(8));if("function"==typeof BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64&&(!!globalThis.Deno||"object"!=typeof process||"1"!==_n.BUF_BIGINT_DISABLE)){const t=BigInt("-9223372036854775808"),n=BigInt("9223372036854775807"),s=BigInt("0"),o=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){const s="bigint"==typeof e?e:BigInt(e);if(s>n||s<t)throw new Error(`invalid int64: ${e}`);return s},uParse(e){const t="bigint"==typeof e?e:BigInt(e);if(t>o||t<s)throw new Error(`invalid uint64: ${e}`);return t},enc(t){return e.setBigInt64(0,this.parse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(t){return e.setBigInt64(0,this.uParse(t),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigInt64(0,!0)),uDec:(t,n)=>(e.setInt32(0,t,!0),e.setInt32(4,n,!0),e.getBigUint64(0,!0))}}return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),Bn(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),Ln(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),Bn(e),En(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),Ln(e),En(e)),dec:(e,t)=>function(e,t){let n=xn(e,t);const s=2147483648&n.hi;s&&(n=An(n.lo,n.hi));const o=In(n.lo,n.hi);return s?"-"+o:o}(e,t),uDec:(e,t)=>In(e,t)}}function Bn(e){if(!/^-?[0-9]+$/.test(e))throw new Error("invalid int64: "+e)}function Ln(e){if(!/^[0-9]+$/.test(e))throw new Error("invalid uint64: "+e)}function Fn(e,t){switch(e){case kn.STRING:return"";case kn.BOOL:return!1;case kn.DOUBLE:case kn.FLOAT:return 0;case kn.INT64:case kn.UINT64:case kn.SFIXED64:case kn.FIXED64:case kn.SINT64:return t?"0":On.zero;case kn.BYTES:return new Uint8Array(0);default:return 0}}const Pn=Symbol.for("reflect unsafe local");function $n(e,t){const n=e[t.localName].case;return void 0===n?n:t.fields.find(e=>e.localName===n)}function Un(e,t){const n=t.localName;if(t.oneof)return e[t.oneof.localName].case===n;if(2!=t.presence)return void 0!==e[n]&&Object.prototype.hasOwnProperty.call(e,n);switch(t.fieldKind){case"list":return e[n].length>0;case"map":return Object.keys(e[n]).length>0;case"scalar":return!function(e,t){switch(e){case kn.BOOL:return!1===t;case kn.STRING:return""===t;case kn.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return 0==t}}(t.scalar,e[n]);case"enum":return e[n]!==t.enum.values[0].number}throw new Error("message field with implicit presence")}function Vn(e,t){return Object.prototype.hasOwnProperty.call(e,t)&&void 0!==e[t]}function Wn(e,t){if(t.oneof){const n=e[t.oneof.localName];return n.case===t.localName?n.value:void 0}return e[t.localName]}function Gn(e,t,n){t.oneof?e[t.oneof.localName]={case:t.localName,value:n}:e[t.localName]=n}function zn(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}function Hn(e,t){var n,s,o,i;if(zn(e)&&Pn in e&&"add"in e&&"field"in e&&"function"==typeof e.field){if(void 0!==t){const r=t,a=e.field();return r.listKind==a.listKind&&r.scalar===a.scalar&&(null===(n=r.message)||void 0===n?void 0:n.typeName)===(null===(s=a.message)||void 0===s?void 0:s.typeName)&&(null===(o=r.enum)||void 0===o?void 0:o.typeName)===(null===(i=a.enum)||void 0===i?void 0:i.typeName)}return!0}return!1}function Kn(e,t){var n,s,o,i;if(zn(e)&&Pn in e&&"has"in e&&"field"in e&&"function"==typeof e.field){if(void 0!==t){const r=t,a=e.field();return r.mapKey===a.mapKey&&r.mapKind==a.mapKind&&r.scalar===a.scalar&&(null===(n=r.message)||void 0===n?void 0:n.typeName)===(null===(s=a.message)||void 0===s?void 0:s.typeName)&&(null===(o=r.enum)||void 0===o?void 0:o.typeName)===(null===(i=a.enum)||void 0===i?void 0:i.typeName)}return!0}return!1}function jn(e,t){return zn(e)&&Pn in e&&"desc"in e&&zn(e.desc)&&"message"===e.desc.kind&&(void 0===t||e.desc.typeName==t.typeName)}function Yn(e){const t=e.fields[0];return Zn(e.typeName)&&void 0!==t&&"scalar"==t.fieldKind&&"value"==t.name&&1==t.number}function Zn(e){return e.startsWith("google.protobuf.")&&["DoubleValue","FloatValue","Int64Value","UInt64Value","Int32Value","UInt32Value","BoolValue","StringValue","BytesValue"].includes(e.substring(16))}function Xn(e,t){if(bn(t,e))return t;const n=function(e){let t;if(function(e){switch(e.file.edition){case 999:return!1;case 998:return!0;default:return e.fields.some(e=>2!=e.presence&&"message"!=e.fieldKind&&!e.oneof)}}(e)){const n=is.get(e);let s,o;if(n)({prototype:s,members:o}=n);else{s={},o=new Set;for(const t of e.members)"oneof"!=t.kind&&("scalar"!=t.fieldKind&&"enum"!=t.fieldKind||2!=t.presence&&(o.add(t),s[t.localName]=rs(t)));is.set(e,{prototype:s,members:o})}t=Object.create(s),t.$typeName=e.typeName;for(const i of e.members)if(!o.has(i)){if("field"==i.kind){if("message"==i.fieldKind)continue;if(("scalar"==i.fieldKind||"enum"==i.fieldKind)&&2!=i.presence)continue}t[i.localName]=rs(i)}}else{t={$typeName:e.typeName};for(const n of e.members)"oneof"!=n.kind&&2!=n.presence||(t[n.localName]=rs(n))}return t}(e);return void 0!==t&&function(e,t,n){for(const s of e.members){let e,o=n[s.localName];if(null!=o){if("oneof"==s.kind){const t=$n(n,s);if(!t)continue;e=t,o=Wn(n,t)}else e=s;switch(e.fieldKind){case"message":o=es(e,o);break;case"scalar":o=Jn(e,o);break;case"list":o=qn(e,o);break;case"map":o=Qn(e,o)}Gn(t,e,o)}}}(e,n,t),n}function Jn(e,t){return e.scalar==kn.BYTES?ts(t):t}function Qn(e,t){if(zn(t)){if(e.scalar==kn.BYTES)return ns(t,ts);if("message"==e.mapKind)return ns(t,t=>es(e,t))}return t}function qn(e,t){if(Array.isArray(t)){if(e.scalar==kn.BYTES)return t.map(ts);if("message"==e.listKind)return t.map(t=>es(e,t))}return t}function es(e,t){if("message"==e.fieldKind&&!e.oneof&&Yn(e.message))return Jn(e.message.fields[0],t);if(zn(t)){if("google.protobuf.Struct"==e.message.typeName&&"google.protobuf.Value"!==e.parent.typeName)return t;if(!bn(t,e.message))return Xn(e.message,t)}return t}function ts(e){return Array.isArray(e)?new Uint8Array(e):e}function ns(e,t){const n={};for(const s of Object.entries(e))n[s[0]]=t(s[1]);return n}const ss=Symbol(),is=new WeakMap;function rs(e){if("oneof"==e.kind)return{case:void 0};if("list"==e.fieldKind)return[];if("map"==e.fieldKind)return{};if("message"==e.fieldKind)return ss;const t=e.getDefaultValue();return void 0!==t?"scalar"==e.fieldKind&&e.longAsString?t.toString():t:"scalar"==e.fieldKind?Fn(e.scalar,e.longAsString):e.enum.values[0].number}class as extends Error{constructor(e,t,n="FieldValueInvalidError"){super(t),this.name=n,this.field=()=>e}}const ls=Symbol.for("@bufbuild/protobuf/text-encoding");function cs(){if(null==globalThis[ls]){const e=new globalThis.TextEncoder,t=new globalThis.TextDecoder;globalThis[ls]={encodeUtf8:t=>e.encode(t),decodeUtf8:e=>t.decode(e),checkUtf8(e){try{return encodeURIComponent(e),!0}catch(t){return!1}}}}return globalThis[ls]}var us,ds;(ds=us||(us={}))[ds.Varint=0]="Varint",ds[ds.Bit64=1]="Bit64",ds[ds.LengthDelimited=2]="LengthDelimited",ds[ds.StartGroup=3]="StartGroup",ds[ds.EndGroup=4]="EndGroup",ds[ds.Bit32=5]="Bit32";const ps=34028234663852886e22,hs=-34028234663852886e22,fs=4294967295,ms=2147483647,gs=-2147483648;class ys{constructor(e=cs().encodeUtf8){this.encodeUtf8=e,this.stack=[],this.chunks=[],this.buf=[]}finish(){this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]);let e=0;for(let s=0;s<this.chunks.length;s++)e+=this.chunks[s].length;let t=new Uint8Array(e),n=0;for(let s=0;s<this.chunks.length;s++)t.set(this.chunks[s],n),n+=this.chunks[s].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(ks(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return bs(e),Mn(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.encodeUtf8(e);return this.uint32(t.byteLength),this.raw(t)}float(e){!function(e){if("string"==typeof e){const t=e;if(e=Number(e),Number.isNaN(e)&&"NaN"!==t)throw new Error("invalid float32: "+t)}else if("number"!=typeof e)throw new Error("invalid float32: "+typeof e);if(Number.isFinite(e)&&(e>ps||e<hs))throw new Error("invalid float32: "+e)}(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){ks(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){bs(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return bs(e),Mn(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),s=On.enc(e);return n.setInt32(0,s.lo,!0),n.setInt32(4,s.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),s=On.uEnc(e);return n.setInt32(0,s.lo,!0),n.setInt32(4,s.hi,!0),this.raw(t)}int64(e){let t=On.enc(e);return Cn(t.lo,t.hi,this.buf),this}sint64(e){const t=On.enc(e),n=t.hi>>31;return Cn(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}uint64(e){const t=On.uEnc(e);return Cn(t.lo,t.hi,this.buf),this}}class vs{constructor(e,t=cs().decodeUtf8){this.decodeUtf8=t,this.varint64=Sn,this.uint32=Rn,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength)}tag(){let e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e,t){let n=this.pos;switch(e){case us.Varint:for(;128&this.buf[this.pos++];);break;case us.Bit64:this.pos+=4;case us.Bit32:this.pos+=4;break;case us.LengthDelimited:let n=this.uint32();this.pos+=n;break;case us.StartGroup:for(;;){const[e,n]=this.tag();if(n===us.EndGroup){if(void 0!==t&&e!==t)throw new Error("invalid end group tag");break}this.skip(n,e)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(n,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return On.dec(...this.varint64())}uint64(){return On.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(1&e);return e=(e>>>1|(1&t)<<31)^n,t=t>>>1^n,On.dec(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return On.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return On.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.decodeUtf8(this.bytes())}}function bs(e){if("string"==typeof e)e=Number(e);else if("number"!=typeof e)throw new Error("invalid int32: "+typeof e);if(!Number.isInteger(e)||e>ms||e<gs)throw new Error("invalid int32: "+e)}function ks(e){if("string"==typeof e)e=Number(e);else if("number"!=typeof e)throw new Error("invalid uint32: "+typeof e);if(!Number.isInteger(e)||e>fs||e<0)throw new Error("invalid uint32: "+e)}function ws(e,t,n){const s=Ss(e,n);if(!0!==s)return new as(e,`list item #${t+1}: ${Ts(e,n,s)}`)}function Ss(e,t){return void 0!==e.scalar?Cs(t,e.scalar):void 0!==e.enum?e.enum.open?Number.isInteger(t):e.enum.values.some(e=>e.number===t):jn(t,e.message)}function Cs(e,t){switch(t){case kn.DOUBLE:return"number"==typeof e;case kn.FLOAT:return"number"==typeof e&&(!(!Number.isNaN(e)&&Number.isFinite(e))||(!(e>ps||e<hs)||`${e.toFixed()} out of range`));case kn.INT32:case kn.SFIXED32:case kn.SINT32:return!("number"!=typeof e||!Number.isInteger(e))&&(!(e>ms||e<gs)||`${e.toFixed()} out of range`);case kn.FIXED32:case kn.UINT32:return!("number"!=typeof e||!Number.isInteger(e))&&(!(e>fs||e<0)||`${e.toFixed()} out of range`);case kn.BOOL:return"boolean"==typeof e;case kn.STRING:return"string"==typeof e&&(cs().checkUtf8(e)||"invalid UTF8");case kn.BYTES:return e instanceof Uint8Array;case kn.INT64:case kn.SFIXED64:case kn.SINT64:if("bigint"==typeof e||"number"==typeof e||"string"==typeof e&&e.length>0)try{return On.parse(e),!0}catch(n){return`${e} out of range`}return!1;case kn.FIXED64:case kn.UINT64:if("bigint"==typeof e||"number"==typeof e||"string"==typeof e&&e.length>0)try{return On.uParse(e),!0}catch(n){return`${e} out of range`}return!1}}function Ts(e,t,n){return n="string"==typeof n?`: ${n}`:`, got ${Es(t)}`,void 0!==e.scalar?`expected ${function(e){switch(e){case kn.STRING:return"string";case kn.BOOL:return"boolean";case kn.INT64:case kn.SINT64:case kn.SFIXED64:return"bigint (int64)";case kn.UINT64:case kn.FIXED64:return"bigint (uint64)";case kn.BYTES:return"Uint8Array";case kn.DOUBLE:return"number (float64)";case kn.FLOAT:return"number (float32)";case kn.FIXED32:case kn.UINT32:return"number (uint32)";case kn.INT32:case kn.SFIXED32:case kn.SINT32:return"number (int32)"}}(e.scalar)}`+n:void 0!==e.enum?`expected ${e.enum.toString()}`+n:`expected ${Is(e.message)}`+n}function Es(e){switch(typeof e){case"object":return null===e?"null":e instanceof Uint8Array?`Uint8Array(${e.length})`:Array.isArray(e)?`Array(${e.length})`:Hn(e)?xs(e.field()):Kn(e)?As(e.field()):jn(e)?Is(e.desc):bn(e)?`message ${e.$typeName}`:"object";case"string":return e.length>30?"string":`"${e.split('"').join('\\"')}"`;case"boolean":case"number":return String(e);case"bigint":return String(e)+"n";default:return typeof e}}function Is(e){return`ReflectMessage (${e.typeName})`}function xs(e){switch(e.listKind){case"message":return`ReflectList (${e.message.toString()})`;case"enum":return`ReflectList (${e.enum.toString()})`;case"scalar":return`ReflectList (${kn[e.scalar]})`}}function As(e){switch(e.mapKind){case"message":return`ReflectMap (${kn[e.mapKey]}, ${e.message.toString()})`;case"enum":return`ReflectMap (${kn[e.mapKey]}, ${e.enum.toString()})`;case"scalar":return`ReflectMap (${kn[e.mapKey]}, ${kn[e.scalar]})`}}function Ns(e,t,n=!0){return new Rs(e,t,n)}const Ms=new WeakMap;class Rs{get sortedFields(){const e=Ms.get(this.desc);if(e)return e;const t=this.desc.fields.concat().sort((e,t)=>e.number-t.number);return Ms.set(this.desc,t),t}constructor(e,t,n=!0){this.lists=new Map,this.maps=new Map,this.check=n,this.desc=e,this.message=this[Pn]=null!=t?t:Xn(e),this.fields=e.fields,this.oneofs=e.oneofs,this.members=e.members}findNumber(e){return this._fieldsByNumber||(this._fieldsByNumber=new Map(this.desc.fields.map(e=>[e.number,e]))),this._fieldsByNumber.get(e)}oneofCase(e){return _s(this.message,e),$n(this.message,e)}isSet(e){return _s(this.message,e),Un(this.message,e)}clear(e){_s(this.message,e),function(e,t){const n=t.localName;if(t.oneof){const s=t.oneof.localName;e[s].case===n&&(e[s]={case:void 0})}else if(2!=t.presence)delete e[n];else switch(t.fieldKind){case"map":e[n]={};break;case"list":e[n]=[];break;case"enum":e[n]=t.enum.values[0].number;break;case"scalar":e[n]=Fn(t.scalar,t.longAsString)}}(this.message,e)}get(e){_s(this.message,e);const t=Wn(this.message,e);switch(e.fieldKind){case"list":let n=this.lists.get(e);return n&&n[Pn]===t||this.lists.set(e,n=new Os(e,t,this.check)),n;case"map":let s=this.maps.get(e);return s&&s[Pn]===t||this.maps.set(e,s=new Ds(e,t,this.check)),s;case"message":return Ls(e,t,this.check);case"scalar":return void 0===t?Fn(e.scalar,!1):Ws(e,t);case"enum":return null!=t?t:e.enum.values[0].number}}set(e,t){if(_s(this.message,e),this.check){const n=function(e,t){const n="list"==e.fieldKind?Hn(t,e):"map"==e.fieldKind?Kn(t,e):Ss(e,t);if(!0===n)return;let s;switch(e.fieldKind){case"list":s=`expected ${xs(e)}, got ${Es(t)}`;break;case"map":s=`expected ${As(e)}, got ${Es(t)}`;break;default:s=Ts(e,t,n)}return new as(e,s)}(e,t);if(n)throw n}let n;n="message"==e.fieldKind?Bs(e,t):Kn(t)||Hn(t)?t[Pn]:Gs(e,t),Gn(this.message,e,n)}getUnknown(){return this.message.$unknown}setUnknown(e){this.message.$unknown=e}}function _s(e,t){if(t.parent.typeName!==e.$typeName)throw new as(t,`cannot use ${t.toString()} with message ${e.$typeName}`,"ForeignFieldError")}class Os{field(){return this._field}get size(){return this._arr.length}constructor(e,t,n){this._field=e,this._arr=this[Pn]=t,this.check=n}get(e){const t=this._arr[e];return void 0===t?void 0:Ps(this._field,t,this.check)}set(e,t){if(e<0||e>=this._arr.length)throw new as(this._field,`list item #${e+1}: out of range`);if(this.check){const n=ws(this._field,e,t);if(n)throw n}this._arr[e]=Fs(this._field,t)}add(e){if(this.check){const t=ws(this._field,this._arr.length,e);if(t)throw t}this._arr.push(Fs(this._field,e))}clear(){this._arr.splice(0,this._arr.length)}[Symbol.iterator](){return this.values()}keys(){return this._arr.keys()}*values(){for(const e of this._arr)yield Ps(this._field,e,this.check)}*entries(){for(let e=0;e<this._arr.length;e++)yield[e,Ps(this._field,this._arr[e],this.check)]}}class Ds{constructor(e,t,n=!0){this.obj=this[Pn]=null!=t?t:{},this.check=n,this._field=e}field(){return this._field}set(e,t){if(this.check){const n=function(e,t,n){const s=Cs(t,e.mapKey);if(!0!==s)return new as(e,`invalid map key: ${Ts({scalar:e.mapKey},t,s)}`);const o=Ss(e,n);return!0!==o?new as(e,`map entry ${Es(t)}: ${Ts(e,n,o)}`):void 0}(this._field,e,t);if(n)throw n}return this.obj[Us(e)]=function(e,t){if("message"==e.mapKind)return Bs(e,t);return Gs(e,t)}(this._field,t),this}delete(e){const t=Us(e),n=Object.prototype.hasOwnProperty.call(this.obj,t);return n&&delete this.obj[t],n}clear(){for(const e of Object.keys(this.obj))delete this.obj[e]}get(e){let t=this.obj[Us(e)];return void 0!==t&&(t=$s(this._field,t,this.check)),t}has(e){return Object.prototype.hasOwnProperty.call(this.obj,Us(e))}*keys(){for(const e of Object.keys(this.obj))yield Vs(e,this._field.mapKey)}*entries(){for(const e of Object.entries(this.obj))yield[Vs(e[0],this._field.mapKey),$s(this._field,e[1],this.check)]}[Symbol.iterator](){return this.entries()}get size(){return Object.keys(this.obj).length}*values(){for(const e of Object.values(this.obj))yield $s(this._field,e,this.check)}forEach(e,t){for(const n of this.entries())e.call(t,n[1],n[0],this)}}function Bs(e,t){return jn(t)?Zn(t.message.$typeName)&&!e.oneof&&"message"==e.fieldKind?t.message.value:"google.protobuf.Struct"==t.desc.typeName&&"google.protobuf.Value"!=e.parent.typeName?Hs(t.message):t.message:t}function Ls(e,t,n){return void 0!==t&&(Yn(e.message)&&!e.oneof&&"message"==e.fieldKind?t={$typeName:e.message.typeName,value:Ws(e.message.fields[0],t)}:"google.protobuf.Struct"==e.message.typeName&&"google.protobuf.Value"!=e.parent.typeName&&zn(t)&&(t=zs(t))),new Rs(e.message,t,n)}function Fs(e,t){return"message"==e.listKind?Bs(e,t):Gs(e,t)}function Ps(e,t,n){return"message"==e.listKind?Ls(e,t,n):Ws(e,t)}function $s(e,t,n){return"message"==e.mapKind?Ls(e,t,n):t}function Us(e){return"string"==typeof e||"number"==typeof e?e:String(e)}function Vs(e,t){switch(t){case kn.STRING:return e;case kn.INT32:case kn.FIXED32:case kn.UINT32:case kn.SFIXED32:case kn.SINT32:{const t=Number.parseInt(e);if(Number.isFinite(t))return t;break}case kn.BOOL:switch(e){case"true":return!0;case"false":return!1}break;case kn.UINT64:case kn.FIXED64:try{return On.uParse(e)}catch(n){}break;default:try{return On.parse(e)}catch(s){}}return e}function Ws(e,t){switch(e.scalar){case kn.INT64:case kn.SFIXED64:case kn.SINT64:"longAsString"in e&&e.longAsString&&"string"==typeof t&&(t=On.parse(t));break;case kn.FIXED64:case kn.UINT64:"longAsString"in e&&e.longAsString&&"string"==typeof t&&(t=On.uParse(t))}return t}function Gs(e,t){switch(e.scalar){case kn.INT64:case kn.SFIXED64:case kn.SINT64:"longAsString"in e&&e.longAsString?t=String(t):"string"!=typeof t&&"number"!=typeof t||(t=On.parse(t));break;case kn.FIXED64:case kn.UINT64:"longAsString"in e&&e.longAsString?t=String(t):"string"!=typeof t&&"number"!=typeof t||(t=On.uParse(t))}return t}function zs(e){const t={$typeName:"google.protobuf.Struct",fields:{}};if(zn(e))for(const[n,s]of Object.entries(e))t.fields[n]=js(s);return t}function Hs(e){const t={};for(const[n,s]of Object.entries(e.fields))t[n]=Ks(s);return t}function Ks(e){switch(e.kind.case){case"structValue":return Hs(e.kind.value);case"listValue":return e.kind.value.values.map(Ks);case"nullValue":case void 0:return null;default:return e.kind.value}}function js(e){const t={$typeName:"google.protobuf.Value",kind:{case:void 0}};switch(typeof e){case"number":t.kind={case:"numberValue",value:e};break;case"string":t.kind={case:"stringValue",value:e};break;case"boolean":t.kind={case:"boolValue",value:e};break;case"object":if(null===e){const e=0;t.kind={case:"nullValue",value:e}}else if(Array.isArray(e)){const n={$typeName:"google.protobuf.ListValue",values:[]};if(Array.isArray(e))for(const t of e)n.values.push(js(t));t.kind={case:"listValue",value:n}}else t.kind={case:"structValue",value:zs(e)}}return t}function Ys(e){const t=function(){if(!Xs){Xs=[];const e=function(){Zs||(Zs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Zs.slice(0,-2).concat("-","_"));return Zs}();for(let t=0;t<e.length;t++)Xs[e[t].charCodeAt(0)]=t;Xs["-".charCodeAt(0)]=e.indexOf("+"),Xs["_".charCodeAt(0)]=e.indexOf("/")}return Xs}();let n=3*e.length/4;"="==e[e.length-2]?n-=2:"="==e[e.length-1]&&(n-=1);let s,o=new Uint8Array(n),i=0,r=0,a=0;for(let l=0;l<e.length;l++){if(s=t[e.charCodeAt(l)],void 0===s)switch(e[l]){case"=":r=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string")}switch(r){case 0:a=s,r=1;break;case 1:o[i++]=a<<2|(48&s)>>4,a=s,r=2;break;case 2:o[i++]=(15&a)<<4|(60&s)>>2,a=s,r=3;break;case 3:o[i++]=(3&a)<<6|s,r=0}}if(1==r)throw Error("invalid base64 string");return o.subarray(0,i)}let Zs,Xs;function Js(e){let t=!1;const n=[];for(let s=0;s<e.length;s++){let o=e.charAt(s);switch(o){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(o),t=!1;break;default:t&&(t=!1,o=o.toUpperCase()),n.push(o)}}return n.join("")}const Qs=new Set(["constructor","toString","toJSON","valueOf"]);function qs(e){return Qs.has(e)?e+"$":e}function eo(e){for(const t of e.field)Vn(t,"jsonName")||(t.jsonName=Js(t.name));e.nestedType.forEach(eo)}function to(e,t){switch(e){case kn.STRING:return t;case kn.BYTES:{const n=function(e){const t=[],n={tail:e,c:"",next(){return 0!=this.tail.length&&(this.c=this.tail[0],this.tail=this.tail.substring(1),!0)},take(e){if(this.tail.length>=e){const t=this.tail.substring(0,e);return this.tail=this.tail.substring(e),t}return!1}};for(;n.next();)if("\\"===n.c){if(n.next())switch(n.c){case"\\":t.push(n.c.charCodeAt(0));break;case"b":t.push(8);break;case"f":t.push(12);break;case"n":t.push(10);break;case"r":t.push(13);break;case"t":t.push(9);break;case"v":t.push(11);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":{const e=n.c,s=n.take(2);if(!1===s)return!1;const o=parseInt(e+s,8);if(Number.isNaN(o))return!1;t.push(o);break}case"x":{const e=n.c,s=n.take(2);if(!1===s)return!1;const o=parseInt(e+s,16);if(Number.isNaN(o))return!1;t.push(o);break}case"u":{const e=n.c,s=n.take(4);if(!1===s)return!1;const o=parseInt(e+s,16);if(Number.isNaN(o))return!1;const i=new Uint8Array(4);new DataView(i.buffer).setInt32(0,o,!0),t.push(i[0],i[1],i[2],i[3]);break}case"U":{const e=n.c,s=n.take(8);if(!1===s)return!1;const o=On.uEnc(e+s),i=new Uint8Array(8),r=new DataView(i.buffer);r.setInt32(0,o.lo,!0),r.setInt32(4,o.hi,!0),t.push(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]);break}}}else t.push(n.c.charCodeAt(0));return new Uint8Array(t)}(t);if(!1===n)throw new Error(`cannot parse ${kn[e]} default value: ${t}`);return n}case kn.INT64:case kn.SFIXED64:case kn.SINT64:return On.parse(t);case kn.UINT64:case kn.FIXED64:return On.uParse(t);case kn.DOUBLE:case kn.FLOAT:switch(t){case"inf":return Number.POSITIVE_INFINITY;case"-inf":return Number.NEGATIVE_INFINITY;case"nan":return Number.NaN;default:return parseFloat(t)}case kn.BOOL:return"true"===t;case kn.INT32:case kn.UINT32:case kn.SINT32:case kn.FIXED32:case kn.SFIXED32:return parseInt(t,10)}}function*no(e){switch(e.kind){case"file":for(const t of e.messages)yield t,yield*no(t);yield*e.enums,yield*e.services,yield*e.extensions;break;case"message":for(const t of e.nestedMessages)yield t,yield*no(t);yield*e.nestedEnums,yield*e.nestedExtensions}}function so(...e){const t=function(){const e=new Map,t=new Map,n=new Map;return{kind:"registry",types:e,extendees:t,[Symbol.iterator]:()=>e.values(),get files(){return n.values()},addFile(e,t,s){if(n.set(e.proto.name,e),!t)for(const n of no(e))this.add(n);if(s)for(const n of e.dependencies)this.addFile(n,t,s)},add(n){if("extension"==n.kind){let e=t.get(n.extendee.typeName);e||t.set(n.extendee.typeName,e=new Map),e.set(n.number,n)}e.set(n.typeName,n)},get:t=>e.get(t),getFile:e=>n.get(e),getMessage(t){const n=e.get(t);return"message"==(null==n?void 0:n.kind)?n:void 0},getEnum(t){const n=e.get(t);return"enum"==(null==n?void 0:n.kind)?n:void 0},getExtension(t){const n=e.get(t);return"extension"==(null==n?void 0:n.kind)?n:void 0},getExtensionFor(e,n){var s;return null===(s=t.get(e.typeName))||void 0===s?void 0:s.get(n)},getService(t){const n=e.get(t);return"service"==(null==n?void 0:n.kind)?n:void 0}}}();if(!e.length)return t;if("$typeName"in e[0]&&"google.protobuf.FileDescriptorSet"==e[0].$typeName){for(const n of e[0].file)Co(n,t);return t}if("$typeName"in e[0]){let n=function(e){const s=[];for(const n of e.dependency){if(null!=t.getFile(n))continue;if(i.has(n))continue;const r=o(n);if(!r)throw new Error(`Unable to resolve ${n}, imported by ${e.name}`);"kind"in r?t.addFile(r,!1,!0):(i.add(r.name),s.push(r))}return s.concat(...s.map(n))};const s=e[0],o=e[1],i=new Set;for(const e of[s,...n(s)].reverse())Co(e,t)}else for(const n of e)for(const e of n.files)t.addFile(e);return t}const oo=998,io=999,ro=9,ao=10,lo=11,co=12,uo=14,po=3,ho=2,fo=1,mo=0,go=1,yo=2,vo=3,bo=1,ko=2,wo=1,So={998:{fieldPresence:1,enumType:2,repeatedFieldEncoding:2,utf8Validation:3,messageEncoding:1,jsonFormat:2,enforceNamingStyle:2,defaultSymbolVisibility:1},999:{fieldPresence:2,enumType:1,repeatedFieldEncoding:1,utf8Validation:2,messageEncoding:1,jsonFormat:1,enforceNamingStyle:2,defaultSymbolVisibility:1},1e3:{fieldPresence:1,enumType:1,repeatedFieldEncoding:1,utf8Validation:2,messageEncoding:1,jsonFormat:1,enforceNamingStyle:2,defaultSymbolVisibility:1},1001:{fieldPresence:1,enumType:1,repeatedFieldEncoding:1,utf8Validation:2,messageEncoding:1,jsonFormat:1,enforceNamingStyle:1,defaultSymbolVisibility:2}};function Co(e,t){var n,s;const o={kind:"file",proto:e,deprecated:null!==(s=null===(n=e.options)||void 0===n?void 0:n.deprecated)&&void 0!==s&&s,edition:Ro(e),name:e.name.replace(/\.proto$/,""),dependencies:_o(e,t),enums:[],messages:[],extensions:[],services:[],toString:()=>`file ${e.name}`},i=new Map,r={get:e=>i.get(e),add(e){var t;$o(!0===(null===(t=e.proto.options)||void 0===t?void 0:t.mapEntry)),i.set(e.typeName,e)}};for(const a of e.enumType)Io(a,o,void 0,t);for(const a of e.messageType)xo(a,o,void 0,t,r);for(const a of e.service)Ao(a,o,t);To(o,t);for(const a of i.values())Eo(a,t,r);for(const a of o.messages)Eo(a,t,r),To(a,t);t.addFile(o,!0)}function To(e,t){switch(e.kind){case"file":for(const n of e.proto.extension){const s=Mo(n,e,t);e.extensions.push(s),t.add(s)}break;case"message":for(const n of e.proto.extension){const s=Mo(n,e,t);e.nestedExtensions.push(s),t.add(s)}for(const n of e.nestedMessages)To(n,t)}}function Eo(e,t,n){const s=e.proto.oneofDecl.map(t=>function(e,t){return{kind:"oneof",proto:e,deprecated:!1,parent:t,fields:[],name:e.name,localName:qs(Js(e.name)),toString(){return`oneof ${t.typeName}.${this.name}`}}}(t,e)),o=new Set;for(const i of e.proto.field){const r=Bo(i,s),a=Mo(i,e,t,r,n);e.fields.push(a),e.field[a.localName]=a,void 0===r?e.members.push(a):(r.fields.push(a),o.has(r)||(o.add(r),e.members.push(r)))}for(const i of s.filter(e=>o.has(e)))e.oneofs.push(i);for(const i of e.nestedMessages)Eo(i,t,n)}function Io(e,t,n,s){var o,i,r,a,l;const c=function(e,t){const n=(s=e,(s.substring(0,1)+s.substring(1).replace(/[A-Z]/g,e=>"_"+e)).toLowerCase()+"_");var s;for(const o of t){if(!o.name.toLowerCase().startsWith(n))return;const e=o.name.substring(n.length);if(0==e.length)return;if(/^\d/.test(e))return}return n}(e.name,e.value),u={kind:"enum",proto:e,deprecated:null!==(i=null===(o=e.options)||void 0===o?void 0:o.deprecated)&&void 0!==i&&i,file:t,parent:n,open:!0,name:e.name,typeName:Oo(e,n,t),value:{},values:[],sharedPrefix:c,toString(){return`enum ${this.typeName}`}};u.open=function(e){var t;return wo==Po("enumType",{proto:e.proto,parent:null!==(t=e.parent)&&void 0!==t?t:e.file})}(u),s.add(u);for(const d of e.value){const e=d.name;u.values.push(u.value[d.number]={kind:"enum_value",proto:d,deprecated:null!==(a=null===(r=d.options)||void 0===r?void 0:r.deprecated)&&void 0!==a&&a,parent:u,name:e,localName:qs(null==c?e:e.substring(c.length)),number:d.number,toString:()=>`enum value ${u.typeName}.${e}`})}(null!==(l=null==n?void 0:n.nestedEnums)&&void 0!==l?l:t.enums).push(u)}function xo(e,t,n,s,o){var i,r,a,l;const c={kind:"message",proto:e,deprecated:null!==(r=null===(i=e.options)||void 0===i?void 0:i.deprecated)&&void 0!==r&&r,file:t,parent:n,name:e.name,typeName:Oo(e,n,t),fields:[],field:{},oneofs:[],members:[],nestedEnums:[],nestedMessages:[],nestedExtensions:[],toString(){return`message ${this.typeName}`}};!0===(null===(a=e.options)||void 0===a?void 0:a.mapEntry)?o.add(c):((null!==(l=null==n?void 0:n.nestedMessages)&&void 0!==l?l:t.messages).push(c),s.add(c));for(const u of e.enumType)Io(u,t,c,s);for(const u of e.nestedType)xo(u,t,c,s,o)}function Ao(e,t,n){var s,o;const i={kind:"service",proto:e,deprecated:null!==(o=null===(s=e.options)||void 0===s?void 0:s.deprecated)&&void 0!==o&&o,file:t,name:e.name,typeName:Oo(e,void 0,t),methods:[],method:{},toString(){return`service ${this.typeName}`}};t.services.push(i),n.add(i);for(const r of e.method){const e=No(r,i,n);i.methods.push(e),i.method[e.localName]=e}}function No(e,t,n){var s,o,i,r;let a;a=e.clientStreaming&&e.serverStreaming?"bidi_streaming":e.clientStreaming?"client_streaming":e.serverStreaming?"server_streaming":"unary";const l=n.getMessage(Do(e.inputType)),c=n.getMessage(Do(e.outputType));$o(l,`invalid MethodDescriptorProto: input_type ${e.inputType} not found`),$o(c,`invalid MethodDescriptorProto: output_type ${e.inputType} not found`);const u=e.name;return{kind:"rpc",proto:e,deprecated:null!==(o=null===(s=e.options)||void 0===s?void 0:s.deprecated)&&void 0!==o&&o,parent:t,name:u,localName:qs(u.length?qs(u[0].toLowerCase()+u.substring(1)):u),methodKind:a,input:l,output:c,idempotency:null!==(r=null===(i=e.options)||void 0===i?void 0:i.idempotencyLevel)&&void 0!==r?r:mo,toString:()=>`rpc ${t.typeName}.${u}`}}function Mo(e,t,n,s,o){var i,r,a;const l=void 0===o,c={kind:"field",proto:e,deprecated:null!==(r=null===(i=e.options)||void 0===i?void 0:i.deprecated)&&void 0!==r&&r,name:e.name,number:e.number,scalar:void 0,message:void 0,enum:void 0,presence:Lo(e,s,l,t),listKind:void 0,mapKind:void 0,mapKey:void 0,delimitedEncoding:void 0,packed:void 0,longAsString:!1,getDefaultValue:void 0};if(l){const s="file"==t.kind?t:t.file,o="file"==t.kind?void 0:t,i=Oo(e,o,s);c.kind="extension",c.file=s,c.parent=o,c.oneof=void 0,c.typeName=i,c.jsonName=`[${i}]`,c.toString=()=>`extension ${i}`;const r=n.getMessage(Do(e.extendee));$o(r,`invalid FieldDescriptorProto: extendee ${e.extendee} not found`),c.extendee=r}else{const n=t;$o("message"==n.kind),c.parent=n,c.oneof=s,c.localName=s?Js(e.name):qs(Js(e.name)),c.jsonName=e.jsonName,c.toString=()=>`field ${n.typeName}.${e.name}`}const u=e.label,d=e.type,p=null===(a=e.options)||void 0===a?void 0:a.jstype;if(u===po){const s=d==lo?null==o?void 0:o.get(Do(e.typeName)):void 0;if(s){c.fieldKind="map";const{key:e,value:t}=function(e){const t=e.fields.find(e=>1===e.number),n=e.fields.find(e=>2===e.number);return $o(t&&"scalar"==t.fieldKind&&t.scalar!=kn.BYTES&&t.scalar!=kn.FLOAT&&t.scalar!=kn.DOUBLE&&n&&"list"!=n.fieldKind&&"map"!=n.fieldKind),{key:t,value:n}}(s);return c.mapKey=e.scalar,c.mapKind=t.fieldKind,c.message=t.message,c.delimitedEncoding=!1,c.enum=t.enum,c.scalar=t.scalar,c}switch(c.fieldKind="list",d){case lo:case ao:c.listKind="message",c.message=n.getMessage(Do(e.typeName)),$o(c.message),c.delimitedEncoding=Fo(e,t);break;case uo:c.listKind="enum",c.enum=n.getEnum(Do(e.typeName)),$o(c.enum);break;default:c.listKind="scalar",c.scalar=d,c.longAsString=p==fo}return c.packed=function(e,t){if(e.label!=po)return!1;switch(e.type){case ro:case co:case ao:case lo:return!1}const n=e.options;if(n&&Vn(n,"packed"))return n.packed;return bo==Po("repeatedFieldEncoding",{proto:e,parent:t})}(e,t),c}switch(d){case lo:case ao:c.fieldKind="message",c.message=n.getMessage(Do(e.typeName)),$o(c.message,`invalid FieldDescriptorProto: type_name ${e.typeName} not found`),c.delimitedEncoding=Fo(e,t),c.getDefaultValue=()=>{};break;case uo:{const t=n.getEnum(Do(e.typeName));$o(void 0!==t,`invalid FieldDescriptorProto: type_name ${e.typeName} not found`),c.fieldKind="enum",c.enum=n.getEnum(Do(e.typeName)),c.getDefaultValue=()=>Vn(e,"defaultValue")?function(e,t){const n=e.values.find(e=>e.name===t);if(!n)throw new Error(`cannot parse ${e} default value: ${t}`);return n.number}(t,e.defaultValue):void 0;break}default:c.fieldKind="scalar",c.scalar=d,c.longAsString=p==fo,c.getDefaultValue=()=>Vn(e,"defaultValue")?to(d,e.defaultValue):void 0}return c}function Ro(e){switch(e.syntax){case"":case"proto2":return oo;case"proto3":return io;case"editions":if(e.edition in So)return e.edition;throw new Error(`${e.name}: unsupported edition`);default:throw new Error(`${e.name}: unsupported syntax "${e.syntax}"`)}}function _o(e,t){return e.dependency.map(n=>{const s=t.getFile(n);if(!s)throw new Error(`Cannot find ${n}, imported by ${e.name}`);return s})}function Oo(e,t,n){let s;return s=t?`${t.typeName}.${e.name}`:n.proto.package.length>0?`${n.proto.package}.${e.name}`:`${e.name}`,s}function Do(e){return e.startsWith(".")?e.substring(1):e}function Bo(e,t){if(!Vn(e,"oneofIndex"))return;if(e.proto3Optional)return;const n=t[e.oneofIndex];return $o(n,`invalid FieldDescriptorProto: oneof #${e.oneofIndex} for field #${e.number} not found`),n}function Lo(e,t,n,s){if(e.label==ho)return vo;if(e.label==po)return yo;if(t||e.proto3Optional)return go;if(n)return go;const o=Po("fieldPresence",{proto:e,parent:s});return o!=yo||e.type!=lo&&e.type!=ao?o:go}function Fo(e,t){return e.type==ao||ko==Po("messageEncoding",{proto:e,parent:t})}function Po(e,t){var n,s;const o=null===(n=t.proto.options)||void 0===n?void 0:n.features;if(o){const t=o[e];if(0!=t)return t}if("kind"in t){if("message"==t.kind)return Po(e,null!==(s=t.parent)&&void 0!==s?s:t.file);const n=So[t.edition];if(!n)throw new Error(`feature default for edition ${t.edition} not found`);return n[e]}return Po(e,t.parent)}function $o(e,t){if(!e)throw new Error(t)}function Uo(e){const t=function(e){const t=Object.create({syntax:"",edition:0});return Object.assign(t,Object.assign(Object.assign({$typeName:"google.protobuf.FileDescriptorProto",dependency:[],publicDependency:[],weakDependency:[],optionDependency:[],service:[],extension:[]},e),{messageType:e.messageType.map(Vo),enumType:e.enumType.map(zo)}))}(e);t.messageType.forEach(eo);return so(t,()=>{}).getFile(t.name)}function Vo(e){var t,n,s,o,i,r,a,l;const c=Object.create({visibility:0});return Object.assign(c,{$typeName:"google.protobuf.DescriptorProto",name:e.name,field:null!==(n=null===(t=e.field)||void 0===t?void 0:t.map(Wo))&&void 0!==n?n:[],extension:[],nestedType:null!==(o=null===(s=e.nestedType)||void 0===s?void 0:s.map(Vo))&&void 0!==o?o:[],enumType:null!==(r=null===(i=e.enumType)||void 0===i?void 0:i.map(zo))&&void 0!==r?r:[],extensionRange:null!==(l=null===(a=e.extensionRange)||void 0===a?void 0:a.map(e=>Object.assign({$typeName:"google.protobuf.DescriptorProto.ExtensionRange"},e)))&&void 0!==l?l:[],oneofDecl:[],reservedRange:[],reservedName:[]})}function Wo(e){const t=Object.create({label:1,typeName:"",extendee:"",defaultValue:"",oneofIndex:0,jsonName:"",proto3Optional:!1});return Object.assign(t,Object.assign(Object.assign({$typeName:"google.protobuf.FieldDescriptorProto"},e),{options:e.options?Go(e.options):void 0}))}function Go(e){var t,n,s;const o=Object.create({ctype:0,packed:!1,jstype:0,lazy:!1,unverifiedLazy:!1,deprecated:!1,weak:!1,debugRedact:!1,retention:0});return Object.assign(o,Object.assign(Object.assign({$typeName:"google.protobuf.FieldOptions"},e),{targets:null!==(t=e.targets)&&void 0!==t?t:[],editionDefaults:null!==(s=null===(n=e.editionDefaults)||void 0===n?void 0:n.map(e=>Object.assign({$typeName:"google.protobuf.FieldOptions.EditionDefault"},e)))&&void 0!==s?s:[],uninterpretedOption:[]}))}function zo(e){const t=Object.create({visibility:0});return Object.assign(t,{$typeName:"google.protobuf.EnumDescriptorProto",name:e.name,reservedName:[],reservedRange:[],value:e.value.map(e=>Object.assign({$typeName:"google.protobuf.EnumValueDescriptorProto"},e))})}function Ho(e,t,...n){return n.reduce((e,t)=>e.nestedMessages[t],e.messages[t])}const Ko=Ho(Uo({name:"google/protobuf/descriptor.proto",package:"google.protobuf",messageType:[{name:"FileDescriptorSet",field:[{name:"file",number:1,type:11,label:3,typeName:".google.protobuf.FileDescriptorProto"}],extensionRange:[{start:536e6,end:536000001}]},{name:"FileDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"package",number:2,type:9,label:1},{name:"dependency",number:3,type:9,label:3},{name:"public_dependency",number:10,type:5,label:3},{name:"weak_dependency",number:11,type:5,label:3},{name:"option_dependency",number:15,type:9,label:3},{name:"message_type",number:4,type:11,label:3,typeName:".google.protobuf.DescriptorProto"},{name:"enum_type",number:5,type:11,label:3,typeName:".google.protobuf.EnumDescriptorProto"},{name:"service",number:6,type:11,label:3,typeName:".google.protobuf.ServiceDescriptorProto"},{name:"extension",number:7,type:11,label:3,typeName:".google.protobuf.FieldDescriptorProto"},{name:"options",number:8,type:11,label:1,typeName:".google.protobuf.FileOptions"},{name:"source_code_info",number:9,type:11,label:1,typeName:".google.protobuf.SourceCodeInfo"},{name:"syntax",number:12,type:9,label:1},{name:"edition",number:14,type:14,label:1,typeName:".google.protobuf.Edition"}]},{name:"DescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"field",number:2,type:11,label:3,typeName:".google.protobuf.FieldDescriptorProto"},{name:"extension",number:6,type:11,label:3,typeName:".google.protobuf.FieldDescriptorProto"},{name:"nested_type",number:3,type:11,label:3,typeName:".google.protobuf.DescriptorProto"},{name:"enum_type",number:4,type:11,label:3,typeName:".google.protobuf.EnumDescriptorProto"},{name:"extension_range",number:5,type:11,label:3,typeName:".google.protobuf.DescriptorProto.ExtensionRange"},{name:"oneof_decl",number:8,type:11,label:3,typeName:".google.protobuf.OneofDescriptorProto"},{name:"options",number:7,type:11,label:1,typeName:".google.protobuf.MessageOptions"},{name:"reserved_range",number:9,type:11,label:3,typeName:".google.protobuf.DescriptorProto.ReservedRange"},{name:"reserved_name",number:10,type:9,label:3},{name:"visibility",number:11,type:14,label:1,typeName:".google.protobuf.SymbolVisibility"}],nestedType:[{name:"ExtensionRange",field:[{name:"start",number:1,type:5,label:1},{name:"end",number:2,type:5,label:1},{name:"options",number:3,type:11,label:1,typeName:".google.protobuf.ExtensionRangeOptions"}]},{name:"ReservedRange",field:[{name:"start",number:1,type:5,label:1},{name:"end",number:2,type:5,label:1}]}]},{name:"ExtensionRangeOptions",field:[{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"},{name:"declaration",number:2,type:11,label:3,typeName:".google.protobuf.ExtensionRangeOptions.Declaration",options:{retention:2}},{name:"features",number:50,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"verification",number:3,type:14,label:1,typeName:".google.protobuf.ExtensionRangeOptions.VerificationState",defaultValue:"UNVERIFIED",options:{retention:2}}],nestedType:[{name:"Declaration",field:[{name:"number",number:1,type:5,label:1},{name:"full_name",number:2,type:9,label:1},{name:"type",number:3,type:9,label:1},{name:"reserved",number:5,type:8,label:1},{name:"repeated",number:6,type:8,label:1}]}],enumType:[{name:"VerificationState",value:[{name:"DECLARATION",number:0},{name:"UNVERIFIED",number:1}]}],extensionRange:[{start:1e3,end:536870912}]},{name:"FieldDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"number",number:3,type:5,label:1},{name:"label",number:4,type:14,label:1,typeName:".google.protobuf.FieldDescriptorProto.Label"},{name:"type",number:5,type:14,label:1,typeName:".google.protobuf.FieldDescriptorProto.Type"},{name:"type_name",number:6,type:9,label:1},{name:"extendee",number:2,type:9,label:1},{name:"default_value",number:7,type:9,label:1},{name:"oneof_index",number:9,type:5,label:1},{name:"json_name",number:10,type:9,label:1},{name:"options",number:8,type:11,label:1,typeName:".google.protobuf.FieldOptions"},{name:"proto3_optional",number:17,type:8,label:1}],enumType:[{name:"Type",value:[{name:"TYPE_DOUBLE",number:1},{name:"TYPE_FLOAT",number:2},{name:"TYPE_INT64",number:3},{name:"TYPE_UINT64",number:4},{name:"TYPE_INT32",number:5},{name:"TYPE_FIXED64",number:6},{name:"TYPE_FIXED32",number:7},{name:"TYPE_BOOL",number:8},{name:"TYPE_STRING",number:9},{name:"TYPE_GROUP",number:10},{name:"TYPE_MESSAGE",number:11},{name:"TYPE_BYTES",number:12},{name:"TYPE_UINT32",number:13},{name:"TYPE_ENUM",number:14},{name:"TYPE_SFIXED32",number:15},{name:"TYPE_SFIXED64",number:16},{name:"TYPE_SINT32",number:17},{name:"TYPE_SINT64",number:18}]},{name:"Label",value:[{name:"LABEL_OPTIONAL",number:1},{name:"LABEL_REPEATED",number:3},{name:"LABEL_REQUIRED",number:2}]}]},{name:"OneofDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"options",number:2,type:11,label:1,typeName:".google.protobuf.OneofOptions"}]},{name:"EnumDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"value",number:2,type:11,label:3,typeName:".google.protobuf.EnumValueDescriptorProto"},{name:"options",number:3,type:11,label:1,typeName:".google.protobuf.EnumOptions"},{name:"reserved_range",number:4,type:11,label:3,typeName:".google.protobuf.EnumDescriptorProto.EnumReservedRange"},{name:"reserved_name",number:5,type:9,label:3},{name:"visibility",number:6,type:14,label:1,typeName:".google.protobuf.SymbolVisibility"}],nestedType:[{name:"EnumReservedRange",field:[{name:"start",number:1,type:5,label:1},{name:"end",number:2,type:5,label:1}]}]},{name:"EnumValueDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"number",number:2,type:5,label:1},{name:"options",number:3,type:11,label:1,typeName:".google.protobuf.EnumValueOptions"}]},{name:"ServiceDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"method",number:2,type:11,label:3,typeName:".google.protobuf.MethodDescriptorProto"},{name:"options",number:3,type:11,label:1,typeName:".google.protobuf.ServiceOptions"}]},{name:"MethodDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"input_type",number:2,type:9,label:1},{name:"output_type",number:3,type:9,label:1},{name:"options",number:4,type:11,label:1,typeName:".google.protobuf.MethodOptions"},{name:"client_streaming",number:5,type:8,label:1,defaultValue:"false"},{name:"server_streaming",number:6,type:8,label:1,defaultValue:"false"}]},{name:"FileOptions",field:[{name:"java_package",number:1,type:9,label:1},{name:"java_outer_classname",number:8,type:9,label:1},{name:"java_multiple_files",number:10,type:8,label:1,defaultValue:"false"},{name:"java_generate_equals_and_hash",number:20,type:8,label:1,options:{deprecated:!0}},{name:"java_string_check_utf8",number:27,type:8,label:1,defaultValue:"false"},{name:"optimize_for",number:9,type:14,label:1,typeName:".google.protobuf.FileOptions.OptimizeMode",defaultValue:"SPEED"},{name:"go_package",number:11,type:9,label:1},{name:"cc_generic_services",number:16,type:8,label:1,defaultValue:"false"},{name:"java_generic_services",number:17,type:8,label:1,defaultValue:"false"},{name:"py_generic_services",number:18,type:8,label:1,defaultValue:"false"},{name:"deprecated",number:23,type:8,label:1,defaultValue:"false"},{name:"cc_enable_arenas",number:31,type:8,label:1,defaultValue:"true"},{name:"objc_class_prefix",number:36,type:9,label:1},{name:"csharp_namespace",number:37,type:9,label:1},{name:"swift_prefix",number:39,type:9,label:1},{name:"php_class_prefix",number:40,type:9,label:1},{name:"php_namespace",number:41,type:9,label:1},{name:"php_metadata_namespace",number:44,type:9,label:1},{name:"ruby_package",number:45,type:9,label:1},{name:"features",number:50,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],enumType:[{name:"OptimizeMode",value:[{name:"SPEED",number:1},{name:"CODE_SIZE",number:2},{name:"LITE_RUNTIME",number:3}]}],extensionRange:[{start:1e3,end:536870912}]},{name:"MessageOptions",field:[{name:"message_set_wire_format",number:1,type:8,label:1,defaultValue:"false"},{name:"no_standard_descriptor_accessor",number:2,type:8,label:1,defaultValue:"false"},{name:"deprecated",number:3,type:8,label:1,defaultValue:"false"},{name:"map_entry",number:7,type:8,label:1},{name:"deprecated_legacy_json_field_conflicts",number:11,type:8,label:1,options:{deprecated:!0}},{name:"features",number:12,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:536870912}]},{name:"FieldOptions",field:[{name:"ctype",number:1,type:14,label:1,typeName:".google.protobuf.FieldOptions.CType",defaultValue:"STRING"},{name:"packed",number:2,type:8,label:1},{name:"jstype",number:6,type:14,label:1,typeName:".google.protobuf.FieldOptions.JSType",defaultValue:"JS_NORMAL"},{name:"lazy",number:5,type:8,label:1,defaultValue:"false"},{name:"unverified_lazy",number:15,type:8,label:1,defaultValue:"false"},{name:"deprecated",number:3,type:8,label:1,defaultValue:"false"},{name:"weak",number:10,type:8,label:1,defaultValue:"false",options:{deprecated:!0}},{name:"debug_redact",number:16,type:8,label:1,defaultValue:"false"},{name:"retention",number:17,type:14,label:1,typeName:".google.protobuf.FieldOptions.OptionRetention"},{name:"targets",number:19,type:14,label:3,typeName:".google.protobuf.FieldOptions.OptionTargetType"},{name:"edition_defaults",number:20,type:11,label:3,typeName:".google.protobuf.FieldOptions.EditionDefault"},{name:"features",number:21,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"feature_support",number:22,type:11,label:1,typeName:".google.protobuf.FieldOptions.FeatureSupport"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],nestedType:[{name:"EditionDefault",field:[{name:"edition",number:3,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"value",number:2,type:9,label:1}]},{name:"FeatureSupport",field:[{name:"edition_introduced",number:1,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"edition_deprecated",number:2,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"deprecation_warning",number:3,type:9,label:1},{name:"edition_removed",number:4,type:14,label:1,typeName:".google.protobuf.Edition"}]}],enumType:[{name:"CType",value:[{name:"STRING",number:0},{name:"CORD",number:1},{name:"STRING_PIECE",number:2}]},{name:"JSType",value:[{name:"JS_NORMAL",number:0},{name:"JS_STRING",number:1},{name:"JS_NUMBER",number:2}]},{name:"OptionRetention",value:[{name:"RETENTION_UNKNOWN",number:0},{name:"RETENTION_RUNTIME",number:1},{name:"RETENTION_SOURCE",number:2}]},{name:"OptionTargetType",value:[{name:"TARGET_TYPE_UNKNOWN",number:0},{name:"TARGET_TYPE_FILE",number:1},{name:"TARGET_TYPE_EXTENSION_RANGE",number:2},{name:"TARGET_TYPE_MESSAGE",number:3},{name:"TARGET_TYPE_FIELD",number:4},{name:"TARGET_TYPE_ONEOF",number:5},{name:"TARGET_TYPE_ENUM",number:6},{name:"TARGET_TYPE_ENUM_ENTRY",number:7},{name:"TARGET_TYPE_SERVICE",number:8},{name:"TARGET_TYPE_METHOD",number:9}]}],extensionRange:[{start:1e3,end:536870912}]},{name:"OneofOptions",field:[{name:"features",number:1,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:536870912}]},{name:"EnumOptions",field:[{name:"allow_alias",number:2,type:8,label:1},{name:"deprecated",number:3,type:8,label:1,defaultValue:"false"},{name:"deprecated_legacy_json_field_conflicts",number:6,type:8,label:1,options:{deprecated:!0}},{name:"features",number:7,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:536870912}]},{name:"EnumValueOptions",field:[{name:"deprecated",number:1,type:8,label:1,defaultValue:"false"},{name:"features",number:2,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"debug_redact",number:3,type:8,label:1,defaultValue:"false"},{name:"feature_support",number:4,type:11,label:1,typeName:".google.protobuf.FieldOptions.FeatureSupport"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:536870912}]},{name:"ServiceOptions",field:[{name:"features",number:34,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"deprecated",number:33,type:8,label:1,defaultValue:"false"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:536870912}]},{name:"MethodOptions",field:[{name:"deprecated",number:33,type:8,label:1,defaultValue:"false"},{name:"idempotency_level",number:34,type:14,label:1,typeName:".google.protobuf.MethodOptions.IdempotencyLevel",defaultValue:"IDEMPOTENCY_UNKNOWN"},{name:"features",number:35,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],enumType:[{name:"IdempotencyLevel",value:[{name:"IDEMPOTENCY_UNKNOWN",number:0},{name:"NO_SIDE_EFFECTS",number:1},{name:"IDEMPOTENT",number:2}]}],extensionRange:[{start:1e3,end:536870912}]},{name:"UninterpretedOption",field:[{name:"name",number:2,type:11,label:3,typeName:".google.protobuf.UninterpretedOption.NamePart"},{name:"identifier_value",number:3,type:9,label:1},{name:"positive_int_value",number:4,type:4,label:1},{name:"negative_int_value",number:5,type:3,label:1},{name:"double_value",number:6,type:1,label:1},{name:"string_value",number:7,type:12,label:1},{name:"aggregate_value",number:8,type:9,label:1}],nestedType:[{name:"NamePart",field:[{name:"name_part",number:1,type:9,label:2},{name:"is_extension",number:2,type:8,label:2}]}]},{name:"FeatureSet",field:[{name:"field_presence",number:1,type:14,label:1,typeName:".google.protobuf.FeatureSet.FieldPresence",options:{retention:1,targets:[4,1],editionDefaults:[{value:"EXPLICIT",edition:900},{value:"IMPLICIT",edition:999},{value:"EXPLICIT",edition:1e3}]}},{name:"enum_type",number:2,type:14,label:1,typeName:".google.protobuf.FeatureSet.EnumType",options:{retention:1,targets:[6,1],editionDefaults:[{value:"CLOSED",edition:900},{value:"OPEN",edition:999}]}},{name:"repeated_field_encoding",number:3,type:14,label:1,typeName:".google.protobuf.FeatureSet.RepeatedFieldEncoding",options:{retention:1,targets:[4,1],editionDefaults:[{value:"EXPANDED",edition:900},{value:"PACKED",edition:999}]}},{name:"utf8_validation",number:4,type:14,label:1,typeName:".google.protobuf.FeatureSet.Utf8Validation",options:{retention:1,targets:[4,1],editionDefaults:[{value:"NONE",edition:900},{value:"VERIFY",edition:999}]}},{name:"message_encoding",number:5,type:14,label:1,typeName:".google.protobuf.FeatureSet.MessageEncoding",options:{retention:1,targets:[4,1],editionDefaults:[{value:"LENGTH_PREFIXED",edition:900}]}},{name:"json_format",number:6,type:14,label:1,typeName:".google.protobuf.FeatureSet.JsonFormat",options:{retention:1,targets:[3,6,1],editionDefaults:[{value:"LEGACY_BEST_EFFORT",edition:900},{value:"ALLOW",edition:999}]}},{name:"enforce_naming_style",number:7,type:14,label:1,typeName:".google.protobuf.FeatureSet.EnforceNamingStyle",options:{retention:2,targets:[1,2,3,4,5,6,7,8,9],editionDefaults:[{value:"STYLE_LEGACY",edition:900},{value:"STYLE2024",edition:1001}]}},{name:"default_symbol_visibility",number:8,type:14,label:1,typeName:".google.protobuf.FeatureSet.VisibilityFeature.DefaultSymbolVisibility",options:{retention:2,targets:[1],editionDefaults:[{value:"EXPORT_ALL",edition:900},{value:"EXPORT_TOP_LEVEL",edition:1001}]}}],nestedType:[{name:"VisibilityFeature",enumType:[{name:"DefaultSymbolVisibility",value:[{name:"DEFAULT_SYMBOL_VISIBILITY_UNKNOWN",number:0},{name:"EXPORT_ALL",number:1},{name:"EXPORT_TOP_LEVEL",number:2},{name:"LOCAL_ALL",number:3},{name:"STRICT",number:4}]}]}],enumType:[{name:"FieldPresence",value:[{name:"FIELD_PRESENCE_UNKNOWN",number:0},{name:"EXPLICIT",number:1},{name:"IMPLICIT",number:2},{name:"LEGACY_REQUIRED",number:3}]},{name:"EnumType",value:[{name:"ENUM_TYPE_UNKNOWN",number:0},{name:"OPEN",number:1},{name:"CLOSED",number:2}]},{name:"RepeatedFieldEncoding",value:[{name:"REPEATED_FIELD_ENCODING_UNKNOWN",number:0},{name:"PACKED",number:1},{name:"EXPANDED",number:2}]},{name:"Utf8Validation",value:[{name:"UTF8_VALIDATION_UNKNOWN",number:0},{name:"VERIFY",number:2},{name:"NONE",number:3}]},{name:"MessageEncoding",value:[{name:"MESSAGE_ENCODING_UNKNOWN",number:0},{name:"LENGTH_PREFIXED",number:1},{name:"DELIMITED",number:2}]},{name:"JsonFormat",value:[{name:"JSON_FORMAT_UNKNOWN",number:0},{name:"ALLOW",number:1},{name:"LEGACY_BEST_EFFORT",number:2}]},{name:"EnforceNamingStyle",value:[{name:"ENFORCE_NAMING_STYLE_UNKNOWN",number:0},{name:"STYLE2024",number:1},{name:"STYLE_LEGACY",number:2}]}],extensionRange:[{start:1e3,end:9995},{start:9995,end:1e4},{start:1e4,end:10001}]},{name:"FeatureSetDefaults",field:[{name:"defaults",number:1,type:11,label:3,typeName:".google.protobuf.FeatureSetDefaults.FeatureSetEditionDefault"},{name:"minimum_edition",number:4,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"maximum_edition",number:5,type:14,label:1,typeName:".google.protobuf.Edition"}],nestedType:[{name:"FeatureSetEditionDefault",field:[{name:"edition",number:3,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"overridable_features",number:4,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"fixed_features",number:5,type:11,label:1,typeName:".google.protobuf.FeatureSet"}]}]},{name:"SourceCodeInfo",field:[{name:"location",number:1,type:11,label:3,typeName:".google.protobuf.SourceCodeInfo.Location"}],nestedType:[{name:"Location",field:[{name:"path",number:1,type:5,label:3,options:{packed:!0}},{name:"span",number:2,type:5,label:3,options:{packed:!0}},{name:"leading_comments",number:3,type:9,label:1},{name:"trailing_comments",number:4,type:9,label:1},{name:"leading_detached_comments",number:6,type:9,label:3}]}],extensionRange:[{start:536e6,end:536000001}]},{name:"GeneratedCodeInfo",field:[{name:"annotation",number:1,type:11,label:3,typeName:".google.protobuf.GeneratedCodeInfo.Annotation"}],nestedType:[{name:"Annotation",field:[{name:"path",number:1,type:5,label:3,options:{packed:!0}},{name:"source_file",number:2,type:9,label:1},{name:"begin",number:3,type:5,label:1},{name:"end",number:4,type:5,label:1},{name:"semantic",number:5,type:14,label:1,typeName:".google.protobuf.GeneratedCodeInfo.Annotation.Semantic"}],enumType:[{name:"Semantic",value:[{name:"NONE",number:0},{name:"SET",number:1},{name:"ALIAS",number:2}]}]}]}],enumType:[{name:"Edition",value:[{name:"EDITION_UNKNOWN",number:0},{name:"EDITION_LEGACY",number:900},{name:"EDITION_PROTO2",number:998},{name:"EDITION_PROTO3",number:999},{name:"EDITION_2023",number:1e3},{name:"EDITION_2024",number:1001},{name:"EDITION_1_TEST_ONLY",number:1},{name:"EDITION_2_TEST_ONLY",number:2},{name:"EDITION_99997_TEST_ONLY",number:99997},{name:"EDITION_99998_TEST_ONLY",number:99998},{name:"EDITION_99999_TEST_ONLY",number:99999},{name:"EDITION_MAX",number:2147483647}]},{name:"SymbolVisibility",value:[{name:"VISIBILITY_UNSET",number:0},{name:"VISIBILITY_LOCAL",number:1},{name:"VISIBILITY_EXPORT",number:2}]}]}),1);var jo,Yo,Zo,Xo,Jo,Qo,qo,ei,ti,ni,si,oi,ii,ri,ai,li,ci,ui,di,pi,hi,fi,mi,gi,yi,vi,bi,ki,wi,Si,Ci,Ti,Ei,Ii,xi,Ai,Ni,Mi,Ri,_i;(Yo=jo||(jo={}))[Yo.DECLARATION=0]="DECLARATION",Yo[Yo.UNVERIFIED=1]="UNVERIFIED",(Xo=Zo||(Zo={}))[Xo.DOUBLE=1]="DOUBLE",Xo[Xo.FLOAT=2]="FLOAT",Xo[Xo.INT64=3]="INT64",Xo[Xo.UINT64=4]="UINT64",Xo[Xo.INT32=5]="INT32",Xo[Xo.FIXED64=6]="FIXED64",Xo[Xo.FIXED32=7]="FIXED32",Xo[Xo.BOOL=8]="BOOL",Xo[Xo.STRING=9]="STRING",Xo[Xo.GROUP=10]="GROUP",Xo[Xo.MESSAGE=11]="MESSAGE",Xo[Xo.BYTES=12]="BYTES",Xo[Xo.UINT32=13]="UINT32",Xo[Xo.ENUM=14]="ENUM",Xo[Xo.SFIXED32=15]="SFIXED32",Xo[Xo.SFIXED64=16]="SFIXED64",Xo[Xo.SINT32=17]="SINT32",Xo[Xo.SINT64=18]="SINT64",(Qo=Jo||(Jo={}))[Qo.OPTIONAL=1]="OPTIONAL",Qo[Qo.REPEATED=3]="REPEATED",Qo[Qo.REQUIRED=2]="REQUIRED",(ei=qo||(qo={}))[ei.SPEED=1]="SPEED",ei[ei.CODE_SIZE=2]="CODE_SIZE",ei[ei.LITE_RUNTIME=3]="LITE_RUNTIME",(ni=ti||(ti={}))[ni.STRING=0]="STRING",ni[ni.CORD=1]="CORD",ni[ni.STRING_PIECE=2]="STRING_PIECE",(oi=si||(si={}))[oi.JS_NORMAL=0]="JS_NORMAL",oi[oi.JS_STRING=1]="JS_STRING",oi[oi.JS_NUMBER=2]="JS_NUMBER",(ri=ii||(ii={}))[ri.RETENTION_UNKNOWN=0]="RETENTION_UNKNOWN",ri[ri.RETENTION_RUNTIME=1]="RETENTION_RUNTIME",ri[ri.RETENTION_SOURCE=2]="RETENTION_SOURCE",(li=ai||(ai={}))[li.TARGET_TYPE_UNKNOWN=0]="TARGET_TYPE_UNKNOWN",li[li.TARGET_TYPE_FILE=1]="TARGET_TYPE_FILE",li[li.TARGET_TYPE_EXTENSION_RANGE=2]="TARGET_TYPE_EXTENSION_RANGE",li[li.TARGET_TYPE_MESSAGE=3]="TARGET_TYPE_MESSAGE",li[li.TARGET_TYPE_FIELD=4]="TARGET_TYPE_FIELD",li[li.TARGET_TYPE_ONEOF=5]="TARGET_TYPE_ONEOF",li[li.TARGET_TYPE_ENUM=6]="TARGET_TYPE_ENUM",li[li.TARGET_TYPE_ENUM_ENTRY=7]="TARGET_TYPE_ENUM_ENTRY",li[li.TARGET_TYPE_SERVICE=8]="TARGET_TYPE_SERVICE",li[li.TARGET_TYPE_METHOD=9]="TARGET_TYPE_METHOD",(ui=ci||(ci={}))[ui.IDEMPOTENCY_UNKNOWN=0]="IDEMPOTENCY_UNKNOWN",ui[ui.NO_SIDE_EFFECTS=1]="NO_SIDE_EFFECTS",ui[ui.IDEMPOTENT=2]="IDEMPOTENT",(pi=di||(di={}))[pi.DEFAULT_SYMBOL_VISIBILITY_UNKNOWN=0]="DEFAULT_SYMBOL_VISIBILITY_UNKNOWN",pi[pi.EXPORT_ALL=1]="EXPORT_ALL",pi[pi.EXPORT_TOP_LEVEL=2]="EXPORT_TOP_LEVEL",pi[pi.LOCAL_ALL=3]="LOCAL_ALL",pi[pi.STRICT=4]="STRICT",(fi=hi||(hi={}))[fi.FIELD_PRESENCE_UNKNOWN=0]="FIELD_PRESENCE_UNKNOWN",fi[fi.EXPLICIT=1]="EXPLICIT",fi[fi.IMPLICIT=2]="IMPLICIT",fi[fi.LEGACY_REQUIRED=3]="LEGACY_REQUIRED",(gi=mi||(mi={}))[gi.ENUM_TYPE_UNKNOWN=0]="ENUM_TYPE_UNKNOWN",gi[gi.OPEN=1]="OPEN",gi[gi.CLOSED=2]="CLOSED",(vi=yi||(yi={}))[vi.REPEATED_FIELD_ENCODING_UNKNOWN=0]="REPEATED_FIELD_ENCODING_UNKNOWN",vi[vi.PACKED=1]="PACKED",vi[vi.EXPANDED=2]="EXPANDED",(ki=bi||(bi={}))[ki.UTF8_VALIDATION_UNKNOWN=0]="UTF8_VALIDATION_UNKNOWN",ki[ki.VERIFY=2]="VERIFY",ki[ki.NONE=3]="NONE",(Si=wi||(wi={}))[Si.MESSAGE_ENCODING_UNKNOWN=0]="MESSAGE_ENCODING_UNKNOWN",Si[Si.LENGTH_PREFIXED=1]="LENGTH_PREFIXED",Si[Si.DELIMITED=2]="DELIMITED",(Ti=Ci||(Ci={}))[Ti.JSON_FORMAT_UNKNOWN=0]="JSON_FORMAT_UNKNOWN",Ti[Ti.ALLOW=1]="ALLOW",Ti[Ti.LEGACY_BEST_EFFORT=2]="LEGACY_BEST_EFFORT",(Ii=Ei||(Ei={}))[Ii.ENFORCE_NAMING_STYLE_UNKNOWN=0]="ENFORCE_NAMING_STYLE_UNKNOWN",Ii[Ii.STYLE2024=1]="STYLE2024",Ii[Ii.STYLE_LEGACY=2]="STYLE_LEGACY",(Ai=xi||(xi={}))[Ai.NONE=0]="NONE",Ai[Ai.SET=1]="SET",Ai[Ai.ALIAS=2]="ALIAS",(Mi=Ni||(Ni={}))[Mi.EDITION_UNKNOWN=0]="EDITION_UNKNOWN",Mi[Mi.EDITION_LEGACY=900]="EDITION_LEGACY",Mi[Mi.EDITION_PROTO2=998]="EDITION_PROTO2",Mi[Mi.EDITION_PROTO3=999]="EDITION_PROTO3",Mi[Mi.EDITION_2023=1e3]="EDITION_2023",Mi[Mi.EDITION_2024=1001]="EDITION_2024",Mi[Mi.EDITION_1_TEST_ONLY=1]="EDITION_1_TEST_ONLY",Mi[Mi.EDITION_2_TEST_ONLY=2]="EDITION_2_TEST_ONLY",Mi[Mi.EDITION_99997_TEST_ONLY=99997]="EDITION_99997_TEST_ONLY",Mi[Mi.EDITION_99998_TEST_ONLY=99998]="EDITION_99998_TEST_ONLY",Mi[Mi.EDITION_99999_TEST_ONLY=99999]="EDITION_99999_TEST_ONLY",Mi[Mi.EDITION_MAX=2147483647]="EDITION_MAX",(_i=Ri||(Ri={}))[_i.VISIBILITY_UNSET=0]="VISIBILITY_UNSET",_i[_i.VISIBILITY_LOCAL=1]="VISIBILITY_LOCAL",_i[_i.VISIBILITY_EXPORT=2]="VISIBILITY_EXPORT";const Oi={readUnknownFields:!0};function Di(e,t,n){const s=Ns(e,void 0,!1);return Bi(s,new vs(t),function(e){return e?Object.assign(Object.assign({},Oi),e):Oi}(n),!1,t.byteLength),s.message}function Bi(e,t,n,s,o){var i;const r=s?t.len:t.pos+o;let a,l;const c=null!==(i=e.getUnknown())&&void 0!==i?i:[];for(;t.pos<r&&([a,l]=t.tag(),!s||l!=us.EndGroup);){const s=e.findNumber(a);if(!s){const e=t.skip(l,a);n.readUnknownFields&&c.push({no:a,wireType:l,data:e});continue}Li(e,t,s,l,n)}if(s&&(l!=us.EndGroup||a!==o))throw new Error("invalid end group tag");c.length>0&&e.setUnknown(c)}function Li(e,t,n,s,o){var i;switch(n.fieldKind){case"scalar":e.set(n,Pi(t,n.scalar));break;case"enum":const r=Pi(t,kn.INT32);if(n.enum.open)e.set(n,r);else{if(n.enum.values.some(e=>e.number===r))e.set(n,r);else if(o.readUnknownFields){const t=[];Mn(r,t);const o=null!==(i=e.getUnknown())&&void 0!==i?i:[];o.push({no:n.number,wireType:s,data:new Uint8Array(t)}),e.setUnknown(o)}}break;case"message":e.set(n,Fi(t,o,n,e.get(n)));break;case"list":!function(e,t,n,s){var o;const i=n.field();if("message"===i.listKind)return void n.add(Fi(e,s,i));const r=null!==(o=i.scalar)&&void 0!==o?o:kn.INT32,a=t==us.LengthDelimited&&r!=kn.STRING&&r!=kn.BYTES;if(!a)return void n.add(Pi(e,r));const l=e.uint32()+e.pos;for(;e.pos<l;)n.add(Pi(e,r))}(t,s,e.get(n),o);break;case"map":!function(e,t,n){const s=t.field();let o,i;const r=e.uint32(),a=e.pos+r;for(;e.pos<a;){const[t]=e.tag();switch(t){case 1:o=Pi(e,s.mapKey);break;case 2:switch(s.mapKind){case"scalar":i=Pi(e,s.scalar);break;case"enum":i=e.int32();break;case"message":i=Fi(e,n,s)}}}void 0===o&&(o=Fn(s.mapKey,!1));if(void 0===i)switch(s.mapKind){case"scalar":i=Fn(s.scalar,!1);break;case"enum":i=s.enum.values[0].number;break;case"message":i=Ns(s.message,void 0,!1)}t.set(o,i)}(t,e.get(n),o)}}function Fi(e,t,n,s){const o=n.delimitedEncoding,i=null!=s?s:Ns(n.message,void 0,!1);return Bi(i,e,t,o,o?n.number:e.uint32()),i}function Pi(e,t){switch(t){case kn.STRING:return e.string();case kn.BOOL:return e.bool();case kn.DOUBLE:return e.double();case kn.FLOAT:return e.float();case kn.INT32:return e.int32();case kn.INT64:return e.int64();case kn.UINT64:return e.uint64();case kn.FIXED64:return e.fixed64();case kn.BYTES:return e.bytes();case kn.FIXED32:return e.fixed32();case kn.SFIXED32:return e.sfixed32();case kn.SFIXED64:return e.sfixed64();case kn.SINT64:return e.sint64();case kn.UINT32:return e.uint32();case kn.SINT32:return e.sint32()}}function $i(e,t){const n=Di(Ko,Ys(e));n.messageType.forEach(eo),n.dependency=[];return so(n,e=>{}).getFile(n.name)}const Ui={writeUnknownFields:!0};function Vi(e,t,n){return Wi(new ys,function(e){return e?Object.assign(Object.assign({},Ui),e):Ui}(n),Ns(e,t)).finish()}function Wi(e,t,n){var s;for(const o of n.sortedFields)if(n.isSet(o))Gi(e,t,n,o);else if(3==o.presence)throw new Error(`cannot encode ${o} to binary: required field not set`);if(t.writeUnknownFields)for(const{no:o,wireType:i,data:r}of null!==(s=n.getUnknown())&&void 0!==s?s:[])e.tag(o,i).raw(r);return e}function Gi(e,t,n,s){var o;switch(s.fieldKind){case"scalar":case"enum":zi(e,n.desc.typeName,s.name,null!==(o=s.scalar)&&void 0!==o?o:kn.INT32,s.number,n.get(s));break;case"list":!function(e,t,n,s){var o;if("message"==n.listKind){for(const o of s)Hi(e,t,n,o);return}const i=null!==(o=n.scalar)&&void 0!==o?o:kn.INT32;if(n.packed){if(!s.size)return;e.tag(n.number,us.LengthDelimited).fork();for(const t of s)ji(e,n.parent.typeName,n.name,i,t);return void e.join()}for(const r of s)zi(e,n.parent.typeName,n.name,i,n.number,r)}(e,t,s,n.get(s));break;case"message":Hi(e,t,s,n.get(s));break;case"map":for(const[o,i]of n.get(s))Ki(e,t,s,o,i)}}function zi(e,t,n,s,o,i){ji(e.tag(o,function(e){switch(e){case kn.BYTES:case kn.STRING:return us.LengthDelimited;case kn.DOUBLE:case kn.FIXED64:case kn.SFIXED64:return us.Bit64;case kn.FIXED32:case kn.SFIXED32:case kn.FLOAT:return us.Bit32;default:return us.Varint}}(s)),t,n,s,i)}function Hi(e,t,n,s){n.delimitedEncoding?Wi(e.tag(n.number,us.StartGroup),t,s).tag(n.number,us.EndGroup):Wi(e.tag(n.number,us.LengthDelimited).fork(),t,s).join()}function Ki(e,t,n,s,o){var i;switch(e.tag(n.number,us.LengthDelimited).fork(),zi(e,n.parent.typeName,n.name,n.mapKey,1,s),n.mapKind){case"scalar":case"enum":zi(e,n.parent.typeName,n.name,null!==(i=n.scalar)&&void 0!==i?i:kn.INT32,2,o);break;case"message":Wi(e.tag(2,us.LengthDelimited).fork(),t,o).join()}e.join()}function ji(e,t,n,s,o){try{switch(s){case kn.STRING:e.string(o);break;case kn.BOOL:e.bool(o);break;case kn.DOUBLE:e.double(o);break;case kn.FLOAT:e.float(o);break;case kn.INT32:e.int32(o);break;case kn.INT64:e.int64(o);break;case kn.UINT64:e.uint64(o);break;case kn.FIXED64:e.fixed64(o);break;case kn.BYTES:e.bytes(o);break;case kn.FIXED32:e.fixed32(o);break;case kn.SFIXED32:e.sfixed32(o);break;case kn.SFIXED64:e.sfixed64(o);break;case kn.SINT64:e.sint64(o);break;case kn.UINT32:e.uint32(o);break;case kn.SINT32:e.sint32(o)}}catch(i){if(i instanceof Error)throw new Error(`cannot encode field ${t}.${n} to binary: ${i.message}`);throw i}}const Yi=$i("ChJhaV9hZ2VudF9ycGMucHJvdG8SC2FpYWdlbnQucnBjIrQICg5Db25uZWN0T3B0aW9ucxIsCghwcm92aWRlchgBIAEoDjIVLmFpYWdlbnQucnBjLlByb3ZpZGVySACIAQESEgoFbW9kZWwYAiABKAlIAYgBARIaCg1zeXN0ZW1fcHJvbXB0GAMgASgJSAKIAQESGwoOaW5pdGlhbF9wcm9tcHQYBCABKAlIA4gBARIXCgpzZXNzaW9uX2lkGAUgASgJSASIAQESHgoRcmVzdW1lX3Nlc3Npb25faWQYBiABKAlIBYgBARI7CghtZXRhZGF0YRgHIAMoCzIpLmFpYWdlbnQucnBjLkNvbm5lY3RPcHRpb25zLk1ldGFkYXRhRW50cnkSOQoPcGVybWlzc2lvbl9tb2RlGAogASgOMhsuYWlhZ2VudC5ycGMuUGVybWlzc2lvbk1vZGVIBogBARIpChxkYW5nZXJvdXNseV9za2lwX3Blcm1pc3Npb25zGAsgASgISAeIAQESLwoiYWxsb3dfZGFuZ2Vyb3VzbHlfc2tpcF9wZXJtaXNzaW9ucxgMIAEoCEgIiAEBEiUKGGluY2x1ZGVfcGFydGlhbF9tZXNzYWdlcxgNIAEoCEgJiAEBEiIKFWNvbnRpbnVlX2NvbnZlcnNhdGlvbhgOIAEoCEgKiAEBEh0KEHRoaW5raW5nX2VuYWJsZWQYDyABKAhIC4gBARIVCghiYXNlX3VybBgUIAEoCUgMiAEBEhQKB2FwaV9rZXkYFSABKAlIDYgBARIzCgxzYW5kYm94X21vZGUYFiABKA4yGC5haWFnZW50LnJwYy5TYW5kYm94TW9kZUgOiAEBEiEKFHJlcGxheV91c2VyX21lc3NhZ2VzGB4gASgISA+IAQESGwoOY2hyb21lX2VuYWJsZWQYKCABKAhIEIgBARovCg1NZXRhZGF0YUVudHJ5EgsKA2tleRgBIAEoCRINCgV2YWx1ZRgCIAEoCToCOAFCCwoJX3Byb3ZpZGVyQggKBl9tb2RlbEIQCg5fc3lzdGVtX3Byb21wdEIRCg9faW5pdGlhbF9wcm9tcHRCDQoLX3Nlc3Npb25faWRCFAoSX3Jlc3VtZV9zZXNzaW9uX2lkQhIKEF9wZXJtaXNzaW9uX21vZGVCHwodX2Rhbmdlcm91c2x5X3NraXBfcGVybWlzc2lvbnNCJQojX2FsbG93X2Rhbmdlcm91c2x5X3NraXBfcGVybWlzc2lvbnNCGwoZX2luY2x1ZGVfcGFydGlhbF9tZXNzYWdlc0IYChZfY29udGludWVfY29udmVyc2F0aW9uQhMKEV90aGlua2luZ19lbmFibGVkQgsKCV9iYXNlX3VybEIKCghfYXBpX2tleUIPCg1fc2FuZGJveF9tb2RlQhcKFV9yZXBsYXlfdXNlcl9tZXNzYWdlc0IRCg9fY2hyb21lX2VuYWJsZWQirwIKDENhcGFiaWxpdGllcxIVCg1jYW5faW50ZXJydXB0GAEgASgIEhgKEGNhbl9zd2l0Y2hfbW9kZWwYAiABKAgSIgoaY2FuX3N3aXRjaF9wZXJtaXNzaW9uX21vZGUYAyABKAgSPwoac3VwcG9ydGVkX3Blcm1pc3Npb25fbW9kZXMYBCADKA4yGy5haWFnZW50LnJwYy5QZXJtaXNzaW9uTW9kZRIcChRjYW5fc2tpcF9wZXJtaXNzaW9ucxgFIAEoCBIdChVjYW5fc2VuZF9yaWNoX2NvbnRlbnQYBiABKAgSEQoJY2FuX3RoaW5rGAcgASgIEhoKEmNhbl9yZXN1bWVfc2Vzc2lvbhgIIAEoCBIdChVjYW5fcnVuX2luX2JhY2tncm91bmQYCSABKAgi9wEKDUNvbm5lY3RSZXN1bHQSEgoKc2Vzc2lvbl9pZBgBIAEoCRInCghwcm92aWRlchgCIAEoDjIVLmFpYWdlbnQucnBjLlByb3ZpZGVyEioKBnN0YXR1cxgDIAEoDjIaLmFpYWdlbnQucnBjLlNlc3Npb25TdGF0dXMSEgoFbW9kZWwYBCABKAlIAIgBARI0CgxjYXBhYmlsaXRpZXMYBSABKAsyGS5haWFnZW50LnJwYy5DYXBhYmlsaXRpZXNIAYgBARIQCgNjd2QYBiABKAlIAogBAUIICgZfbW9kZWxCDwoNX2NhcGFiaWxpdGllc0IGCgRfY3dkIlUKF1NldFBlcm1pc3Npb25Nb2RlUmVzdWx0EikKBG1vZGUYASABKA4yGy5haWFnZW50LnJwYy5QZXJtaXNzaW9uTW9kZRIPCgdzdWNjZXNzGAIgASgIIjoKDFN0YXR1c1Jlc3VsdBIqCgZzdGF0dXMYASABKA4yGi5haWFnZW50LnJwYy5TZXNzaW9uU3RhdHVzIksKDlNldE1vZGVsUmVzdWx0EioKBnN0YXR1cxgBIAEoDjIaLmFpYWdlbnQucnBjLlNlc3Npb25TdGF0dXMSDQoFbW9kZWwYAiABKAki5wQKDENvbnRlbnRCbG9jaxImCgR0ZXh0GAEgASgLMhYuYWlhZ2VudC5ycGMuVGV4dEJsb2NrSAASLgoIdGhpbmtpbmcYAiABKAsyGi5haWFnZW50LnJwYy5UaGlua2luZ0Jsb2NrSAASLQoIdG9vbF91c2UYAyABKAsyGS5haWFnZW50LnJwYy5Ub29sVXNlQmxvY2tIABIzCgt0b29sX3Jlc3VsdBgEIAEoCzIcLmFpYWdlbnQucnBjLlRvb2xSZXN1bHRCbG9ja0gAEigKBWltYWdlGAUgASgLMhcuYWlhZ2VudC5ycGMuSW1hZ2VCbG9ja0gAEj8KEWNvbW1hbmRfZXhlY3V0aW9uGAYgASgLMiIuYWlhZ2VudC5ycGMuQ29tbWFuZEV4ZWN1dGlvbkJsb2NrSAASMwoLZmlsZV9jaGFuZ2UYByABKAsyHC5haWFnZW50LnJwYy5GaWxlQ2hhbmdlQmxvY2tIABI2Cg1tY3BfdG9vbF9jYWxsGAggASgLMh0uYWlhZ2VudC5ycGMuTWNwVG9vbENhbGxCbG9ja0gAEjEKCndlYl9zZWFyY2gYCSABKAsyGy5haWFnZW50LnJwYy5XZWJTZWFyY2hCbG9ja0gAEi8KCXRvZG9fbGlzdBgKIAEoCzIaLmFpYWdlbnQucnBjLlRvZG9MaXN0QmxvY2tIABIoCgVlcnJvchgLIAEoCzIXLmFpYWdlbnQucnBjLkVycm9yQmxvY2tIABIsCgd1bmtub3duGAwgASgLMhkuYWlhZ2VudC5ycGMuVW5rbm93bkJsb2NrSABCBwoFYmxvY2siGQoJVGV4dEJsb2NrEgwKBHRleHQYASABKAkiRwoNVGhpbmtpbmdCbG9jaxIQCgh0aGlua2luZxgBIAEoCRIWCglzaWduYXR1cmUYAiABKAlIAIgBAUIMCgpfc2lnbmF0dXJlIpQBCgxUb29sVXNlQmxvY2sSCgoCaWQYASABKAkSEQoJdG9vbF9uYW1lGAIgASgJEhEKCXRvb2xfdHlwZRgDIAEoCRIXCgppbnB1dF9qc29uGAQgASgMSACIAQESKgoGc3RhdHVzGAUgASgOMhouYWlhZ2VudC5ycGMuQ29udGVudFN0YXR1c0INCgtfaW5wdXRfanNvbiKIAQoPVG9vbFJlc3VsdEJsb2NrEhMKC3Rvb2xfdXNlX2lkGAEgASgJEhkKDGNvbnRlbnRfanNvbhgCIAEoDEgAiAEBEhAKCGlzX2Vycm9yGAMgASgIEhUKCGFnZW50X2lkGAQgASgJSAGIAQFCDwoNX2NvbnRlbnRfanNvbkILCglfYWdlbnRfaWQiNgoKSW1hZ2VCbG9jaxIoCgZzb3VyY2UYASABKAsyGC5haWFnZW50LnJwYy5JbWFnZVNvdXJjZSJlCgtJbWFnZVNvdXJjZRIMCgR0eXBlGAEgASgJEhIKCm1lZGlhX3R5cGUYAiABKAkSEQoEZGF0YRgDIAEoCUgAiAEBEhAKA3VybBgEIAEoCUgBiAEBQgcKBV9kYXRhQgYKBF91cmwimgEKFUNvbW1hbmRFeGVjdXRpb25CbG9jaxIPCgdjb21tYW5kGAEgASgJEhMKBm91dHB1dBgCIAEoCUgAiAEBEhYKCWV4aXRfY29kZRgDIAEoBUgBiAEBEioKBnN0YXR1cxgEIAEoDjIaLmFpYWdlbnQucnBjLkNvbnRlbnRTdGF0dXNCCQoHX291dHB1dEIMCgpfZXhpdF9jb2RlImcKD0ZpbGVDaGFuZ2VCbG9jaxIqCgZzdGF0dXMYASABKA4yGi5haWFnZW50LnJwYy5Db250ZW50U3RhdHVzEigKB2NoYW5nZXMYAiADKAsyFy5haWFnZW50LnJwYy5GaWxlQ2hhbmdlIigKCkZpbGVDaGFuZ2USDAoEcGF0aBgBIAEoCRIMCgRraW5kGAIgASgJItQBChBNY3BUb29sQ2FsbEJsb2NrEhMKBnNlcnZlchgBIAEoCUgAiAEBEhEKBHRvb2wYAiABKAlIAYgBARIbCg5hcmd1bWVudHNfanNvbhgDIAEoDEgCiAEBEhgKC3Jlc3VsdF9qc29uGAQgASgMSAOIAQESKgoGc3RhdHVzGAUgASgOMhouYWlhZ2VudC5ycGMuQ29udGVudFN0YXR1c0IJCgdfc2VydmVyQgcKBV90b29sQhEKD19hcmd1bWVudHNfanNvbkIOCgxfcmVzdWx0X2pzb24iHwoOV2ViU2VhcmNoQmxvY2sSDQoFcXVlcnkYASABKAkiNQoNVG9kb0xpc3RCbG9jaxIkCgVpdGVtcxgBIAMoCzIVLmFpYWdlbnQucnBjLlRvZG9JdGVtIisKCFRvZG9JdGVtEgwKBHRleHQYASABKAkSEQoJY29tcGxldGVkGAIgASgIIh0KCkVycm9yQmxvY2sSDwoHbWVzc2FnZRgBIAEoCSIqCgxVbmtub3duQmxvY2sSDAoEdHlwZRgBIAEoCRIMCgRkYXRhGAIgASgJIloKDk1lc3NhZ2VDb250ZW50EioKB2NvbnRlbnQYASADKAsyGS5haWFnZW50LnJwYy5Db250ZW50QmxvY2sSEgoFbW9kZWwYAiABKAlIAIgBAUIICgZfbW9kZWwi3QMKClJwY01lc3NhZ2USJwoIcHJvdmlkZXIYASABKA4yFS5haWFnZW50LnJwYy5Qcm92aWRlchIoCgR1c2VyGAIgASgLMhguYWlhZ2VudC5ycGMuVXNlck1lc3NhZ2VIABIyCglhc3Npc3RhbnQYAyABKAsyHS5haWFnZW50LnJwYy5Bc3Npc3RhbnRNZXNzYWdlSAASLAoGcmVzdWx0GAQgASgLMhouYWlhZ2VudC5ycGMuUmVzdWx0TWVzc2FnZUgAEjAKDHN0cmVhbV9ldmVudBgFIAEoCzIYLmFpYWdlbnQucnBjLlN0cmVhbUV2ZW50SAASKgoFZXJyb3IYBiABKAsyGS5haWFnZW50LnJwYy5FcnJvck1lc3NhZ2VIABI5Cg1zdGF0dXNfc3lzdGVtGAcgASgLMiAuYWlhZ2VudC5ycGMuU3RhdHVzU3lzdGVtTWVzc2FnZUgAEj8KEGNvbXBhY3RfYm91bmRhcnkYCCABKAsyIy5haWFnZW50LnJwYy5Db21wYWN0Qm91bmRhcnlNZXNzYWdlSAASNQoLc3lzdGVtX2luaXQYCSABKAsyHi5haWFnZW50LnJwYy5TeXN0ZW1Jbml0TWVzc2FnZUgAQgkKB21lc3NhZ2UitQEKC1VzZXJNZXNzYWdlEiwKB21lc3NhZ2UYASABKAsyGy5haWFnZW50LnJwYy5NZXNzYWdlQ29udGVudBIfChJwYXJlbnRfdG9vbF91c2VfaWQYAiABKAlIAIgBARIWCglpc19yZXBsYXkYAyABKAhIAYgBARIRCgR1dWlkGAQgASgJSAKIAQFCFQoTX3BhcmVudF90b29sX3VzZV9pZEIMCgpfaXNfcmVwbGF5QgcKBV91dWlkIqwBChBBc3Npc3RhbnRNZXNzYWdlEiwKB21lc3NhZ2UYASABKAsyGy5haWFnZW50LnJwYy5NZXNzYWdlQ29udGVudBIPCgJpZBgCIAEoCUgAiAEBEh8KEnBhcmVudF90b29sX3VzZV9pZBgDIAEoCUgBiAEBEhEKBHV1aWQYBCABKAlIAogBAUIFCgNfaWRCFQoTX3BhcmVudF90b29sX3VzZV9pZEIHCgVfdXVpZCLBAgoNUmVzdWx0TWVzc2FnZRIPCgdzdWJ0eXBlGAEgASgJEhgKC2R1cmF0aW9uX21zGAIgASgDSACIAQESHAoPZHVyYXRpb25fYXBpX21zGAMgASgDSAGIAQESEAoIaXNfZXJyb3IYBCABKAgSEQoJbnVtX3R1cm5zGAUgASgFEhcKCnNlc3Npb25faWQYBiABKAlIAogBARIbCg50b3RhbF9jb3N0X3VzZBgHIAEoAUgDiAEBEhcKCnVzYWdlX2pzb24YCCABKAxIBIgBARITCgZyZXN1bHQYCSABKAlIBYgBAUIOCgxfZHVyYXRpb25fbXNCEgoQX2R1cmF0aW9uX2FwaV9tc0INCgtfc2Vzc2lvbl9pZEIRCg9fdG90YWxfY29zdF91c2RCDQoLX3VzYWdlX2pzb25CCQoHX3Jlc3VsdCIlCgxFcnJvck1lc3NhZ2USFQoNZXJyb3JfbWVzc2FnZRgBIAEoCSJaChNTdGF0dXNTeXN0ZW1NZXNzYWdlEg8KB3N1YnR5cGUYASABKAkSEwoGc3RhdHVzGAIgASgJSACIAQESEgoKc2Vzc2lvbl9pZBgDIAEoCUIJCgdfc3RhdHVzIo8BChZDb21wYWN0Qm91bmRhcnlNZXNzYWdlEg8KB3N1YnR5cGUYASABKAkSEgoKc2Vzc2lvbl9pZBgCIAEoCRI7ChBjb21wYWN0X21ldGFkYXRhGAMgASgLMhwuYWlhZ2VudC5ycGMuQ29tcGFjdE1ldGFkYXRhSACIAQFCEwoRX2NvbXBhY3RfbWV0YWRhdGEiWwoPQ29tcGFjdE1ldGFkYXRhEhQKB3RyaWdnZXIYASABKAlIAIgBARIXCgpwcmVfdG9rZW5zGAIgASgFSAGIAQFCCgoIX3RyaWdnZXJCDQoLX3ByZV90b2tlbnMigQIKEVN5c3RlbUluaXRNZXNzYWdlEhIKCnNlc3Npb25faWQYASABKAkSEAoDY3dkGAIgASgJSACIAQESEgoFbW9kZWwYAyABKAlIAYgBARIcCg9wZXJtaXNzaW9uX21vZGUYBCABKAlIAogBARIbCg5hcGlfa2V5X3NvdXJjZRgFIAEoCUgDiAEBEg0KBXRvb2xzGAYgAygJEi8KC21jcF9zZXJ2ZXJzGAcgAygLMhouYWlhZ2VudC5ycGMuTWNwU2VydmVySW5mb0IGCgRfY3dkQggKBl9tb2RlbEISChBfcGVybWlzc2lvbl9tb2RlQhEKD19hcGlfa2V5X3NvdXJjZSItCg1NY3BTZXJ2ZXJJbmZvEgwKBG5hbWUYASABKAkSDgoGc3RhdHVzGAIgASgJIpQBCgtTdHJlYW1FdmVudBIMCgR1dWlkGAEgASgJEhIKCnNlc3Npb25faWQYAiABKAkSKwoFZXZlbnQYAyABKAsyHC5haWFnZW50LnJwYy5TdHJlYW1FdmVudERhdGESHwoScGFyZW50X3Rvb2xfdXNlX2lkGAQgASgJSACIAQFCFQoTX3BhcmVudF90b29sX3VzZV9pZCKNAwoPU3RyZWFtRXZlbnREYXRhEjcKDW1lc3NhZ2Vfc3RhcnQYASABKAsyHi5haWFnZW50LnJwYy5NZXNzYWdlU3RhcnRFdmVudEgAEkIKE2NvbnRlbnRfYmxvY2tfc3RhcnQYAiABKAsyIy5haWFnZW50LnJwYy5Db250ZW50QmxvY2tTdGFydEV2ZW50SAASQgoTY29udGVudF9ibG9ja19kZWx0YRgDIAEoCzIjLmFpYWdlbnQucnBjLkNvbnRlbnRCbG9ja0RlbHRhRXZlbnRIABJAChJjb250ZW50X2Jsb2NrX3N0b3AYBCABKAsyIi5haWFnZW50LnJwYy5Db250ZW50QmxvY2tTdG9wRXZlbnRIABI3Cg1tZXNzYWdlX2RlbHRhGAUgASgLMh4uYWlhZ2VudC5ycGMuTWVzc2FnZURlbHRhRXZlbnRIABI1CgxtZXNzYWdlX3N0b3AYBiABKAsyHS5haWFnZW50LnJwYy5NZXNzYWdlU3RvcEV2ZW50SABCBwoFZXZlbnQiXgoRTWVzc2FnZVN0YXJ0RXZlbnQSOAoMbWVzc2FnZV9pbmZvGAEgASgLMh0uYWlhZ2VudC5ycGMuTWVzc2FnZVN0YXJ0SW5mb0gAiAEBQg8KDV9tZXNzYWdlX2luZm8idAoQTWVzc2FnZVN0YXJ0SW5mbxIPCgJpZBgBIAEoCUgAiAEBEhIKBW1vZGVsGAIgASgJSAGIAQESKgoHY29udGVudBgDIAMoCzIZLmFpYWdlbnQucnBjLkNvbnRlbnRCbG9ja0IFCgNfaWRCCAoGX21vZGVsIlkKFkNvbnRlbnRCbG9ja1N0YXJ0RXZlbnQSDQoFaW5kZXgYASABKAUSMAoNY29udGVudF9ibG9jaxgCIAEoCzIZLmFpYWdlbnQucnBjLkNvbnRlbnRCbG9jayJKChZDb250ZW50QmxvY2tEZWx0YUV2ZW50Eg0KBWluZGV4GAEgASgFEiEKBWRlbHRhGAIgASgLMhIuYWlhZ2VudC5ycGMuRGVsdGEiJgoVQ29udGVudEJsb2NrU3RvcEV2ZW50Eg0KBWluZGV4GAEgASgFIm0KEU1lc3NhZ2VEZWx0YUV2ZW50EhcKCmRlbHRhX2pzb24YASABKAxIAIgBARImCgV1c2FnZRgCIAEoCzISLmFpYWdlbnQucnBjLlVzYWdlSAGIAQFCDQoLX2RlbHRhX2pzb25CCAoGX3VzYWdlIhIKEE1lc3NhZ2VTdG9wRXZlbnQirQEKBURlbHRhEiwKCnRleHRfZGVsdGEYASABKAsyFi5haWFnZW50LnJwYy5UZXh0RGVsdGFIABI0Cg50aGlua2luZ19kZWx0YRgCIAEoCzIaLmFpYWdlbnQucnBjLlRoaW5raW5nRGVsdGFIABI3ChBpbnB1dF9qc29uX2RlbHRhGAMgASgLMhsuYWlhZ2VudC5ycGMuSW5wdXRKc29uRGVsdGFIAEIHCgVkZWx0YSIZCglUZXh0RGVsdGESDAoEdGV4dBgBIAEoCSIhCg1UaGlua2luZ0RlbHRhEhAKCHRoaW5raW5nGAEgASgJIiYKDklucHV0SnNvbkRlbHRhEhQKDHBhcnRpYWxfanNvbhgBIAEoCSLuAgoFVXNhZ2USGQoMaW5wdXRfdG9rZW5zGAEgASgFSACIAQESGgoNb3V0cHV0X3Rva2VucxgCIAEoBUgBiAEBEiAKE2NhY2hlZF9pbnB1dF90b2tlbnMYAyABKAVIAogBARIsCghwcm92aWRlchgEIAEoDjIVLmFpYWdlbnQucnBjLlByb3ZpZGVySAOIAQESFQoIcmF3X2pzb24YBSABKAxIBIgBARIiChVjYWNoZV9jcmVhdGlvbl90b2tlbnMYBiABKAVIBYgBARIeChFjYWNoZV9yZWFkX3Rva2VucxgHIAEoBUgGiAEBQg8KDV9pbnB1dF90b2tlbnNCEAoOX291dHB1dF90b2tlbnNCFgoUX2NhY2hlZF9pbnB1dF90b2tlbnNCCwoJX3Byb3ZpZGVyQgsKCV9yYXdfanNvbkIYChZfY2FjaGVfY3JlYXRpb25fdG9rZW5zQhQKEl9jYWNoZV9yZWFkX3Rva2VucyI0CgdIaXN0b3J5EikKCG1lc3NhZ2VzGAEgAygLMhcuYWlhZ2VudC5ycGMuUnBjTWVzc2FnZSKsAQoOSGlzdG9yeVNlc3Npb24SEgoKc2Vzc2lvbl9pZBgBIAEoCRIaChJmaXJzdF91c2VyX21lc3NhZ2UYAiABKAkSEQoJdGltZXN0YW1wGAMgASgDEhUKDW1lc3NhZ2VfY291bnQYBCABKAUSFAoMcHJvamVjdF9wYXRoGAUgASgJEhkKDGN1c3RvbV90aXRsZRgGIAEoCUgAiAEBQg8KDV9jdXN0b21fdGl0bGUiRgoVSGlzdG9yeVNlc3Npb25zUmVzdWx0Ei0KCHNlc3Npb25zGAEgAygLMhsuYWlhZ2VudC5ycGMuSGlzdG9yeVNlc3Npb24iLAoZSGFzSWRlRW52aXJvbm1lbnRSZXNwb25zZRIPCgdoYXNfaWRlGAEgASgIIh8KDFF1ZXJ5UmVxdWVzdBIPCgdtZXNzYWdlGAEgASgJIkUKF1F1ZXJ5V2l0aENvbnRlbnRSZXF1ZXN0EioKB2NvbnRlbnQYASADKAsyGS5haWFnZW50LnJwYy5Db250ZW50QmxvY2siIAoPU2V0TW9kZWxSZXF1ZXN0Eg0KBW1vZGVsGAEgASgJIkUKGFNldFBlcm1pc3Npb25Nb2RlUmVxdWVzdBIpCgRtb2RlGAEgASgOMhsuYWlhZ2VudC5ycGMuUGVybWlzc2lvbk1vZGUiVwobU2V0TWF4VGhpbmtpbmdUb2tlbnNSZXF1ZXN0EiAKE21heF90aGlua2luZ190b2tlbnMYASABKAVIAIgBAUIWChRfbWF4X3RoaW5raW5nX3Rva2VucyKCAQoaU2V0TWF4VGhpbmtpbmdUb2tlbnNSZXN1bHQSKgoGc3RhdHVzGAEgASgOMhouYWlhZ2VudC5ycGMuU2Vzc2lvblN0YXR1cxIgChNtYXhfdGhpbmtpbmdfdG9rZW5zGAIgASgFSACIAQFCFgoUX21heF90aGlua2luZ190b2tlbnMiUAoZR2V0SGlzdG9yeVNlc3Npb25zUmVxdWVzdBITCgttYXhfcmVzdWx0cxgBIAEoBRITCgZvZmZzZXQYAiABKAVIAIgBAUIJCgdfb2Zmc2V0IocBChJMb2FkSGlzdG9yeVJlcXVlc3QSFwoKc2Vzc2lvbl9pZBgBIAEoCUgAiAEBEhkKDHByb2plY3RfcGF0aBgCIAEoCUgBiAEBEg4KBm9mZnNldBgDIAEoBRINCgVsaW1pdBgEIAEoBUINCgtfc2Vzc2lvbl9pZEIPCg1fcHJvamVjdF9wYXRoIm8KGUdldEhpc3RvcnlNZXRhZGF0YVJlcXVlc3QSFwoKc2Vzc2lvbl9pZBgBIAEoCUgAiAEBEhkKDHByb2plY3RfcGF0aBgCIAEoCUgBiAEBQg0KC19zZXNzaW9uX2lkQg8KDV9wcm9qZWN0X3BhdGgifAoPSGlzdG9yeU1ldGFkYXRhEhMKC3RvdGFsX2xpbmVzGAEgASgFEhIKCnNlc3Npb25faWQYAiABKAkSFAoMcHJvamVjdF9wYXRoGAMgASgJEhkKDGN1c3RvbV90aXRsZRgEIAEoCUgAiAEBQg8KDV9jdXN0b21fdGl0bGUicgoNSGlzdG9yeVJlc3VsdBIpCghtZXNzYWdlcxgBIAMoCzIXLmFpYWdlbnQucnBjLlJwY01lc3NhZ2USDgoGb2Zmc2V0GAIgASgFEg0KBWNvdW50GAMgASgFEhcKD2F2YWlsYWJsZV9jb3VudBgEIAEoBSIOCgxFbXB0eVJlcXVlc3QiDwoNRW1wdHlSZXNwb25zZSJEChZHZXRJZGVTZXR0aW5nc1Jlc3BvbnNlEioKCHNldHRpbmdzGAEgASgLMhguYWlhZ2VudC5ycGMuSWRlU2V0dGluZ3MiSQoOUXVlc3Rpb25PcHRpb24SDQoFbGFiZWwYASABKAkSGAoLZGVzY3JpcHRpb24YAiABKAlIAIgBAUIOCgxfZGVzY3JpcHRpb24ihAEKDFF1ZXN0aW9uSXRlbRIQCghxdWVzdGlvbhgBIAEoCRITCgZoZWFkZXIYAiABKAlIAIgBARIsCgdvcHRpb25zGAMgAygLMhsuYWlhZ2VudC5ycGMuUXVlc3Rpb25PcHRpb24SFAoMbXVsdGlfc2VsZWN0GAQgASgIQgkKB19oZWFkZXIiRgoWQXNrVXNlclF1ZXN0aW9uUmVxdWVzdBIsCglxdWVzdGlvbnMYASADKAsyGS5haWFnZW50LnJwYy5RdWVzdGlvbkl0ZW0iUgoOVXNlckFuc3dlckl0ZW0SEAoIcXVlc3Rpb24YASABKAkSEwoGaGVhZGVyGAIgASgJSACIAQESDgoGYW5zd2VyGAMgASgJQgkKB19oZWFkZXIiRwoXQXNrVXNlclF1ZXN0aW9uUmVzcG9uc2USLAoHYW5zd2VycxgBIAMoCzIbLmFpYWdlbnQucnBjLlVzZXJBbnN3ZXJJdGVtIlQKE1Blcm1pc3Npb25SdWxlVmFsdWUSEQoJdG9vbF9uYW1lGAEgASgJEhkKDHJ1bGVfY29udGVudBgCIAEoCUgAiAEBQg8KDV9ydWxlX2NvbnRlbnQi2wIKEFBlcm1pc3Npb25VcGRhdGUSLwoEdHlwZRgBIAEoDjIhLmFpYWdlbnQucnBjLlBlcm1pc3Npb25VcGRhdGVUeXBlEi8KBXJ1bGVzGAIgAygLMiAuYWlhZ2VudC5ycGMuUGVybWlzc2lvblJ1bGVWYWx1ZRI2CghiZWhhdmlvchgDIAEoDjIfLmFpYWdlbnQucnBjLlBlcm1pc3Npb25CZWhhdmlvckgAiAEBEi4KBG1vZGUYBCABKA4yGy5haWFnZW50LnJwYy5QZXJtaXNzaW9uTW9kZUgBiAEBEhMKC2RpcmVjdG9yaWVzGAUgAygJEkIKC2Rlc3RpbmF0aW9uGAYgASgOMiguYWlhZ2VudC5ycGMuUGVybWlzc2lvblVwZGF0ZURlc3RpbmF0aW9uSAKIAQFCCwoJX2JlaGF2aW9yQgcKBV9tb2RlQg4KDF9kZXN0aW5hdGlvbiKqAQoYUmVxdWVzdFBlcm1pc3Npb25SZXF1ZXN0EhEKCXRvb2xfbmFtZRgBIAEoCRISCgppbnB1dF9qc29uGAIgASgMEhgKC3Rvb2xfdXNlX2lkGAMgASgJSACIAQESPQoWcGVybWlzc2lvbl9zdWdnZXN0aW9ucxgEIAMoCzIdLmFpYWdlbnQucnBjLlBlcm1pc3Npb25VcGRhdGVCDgoMX3Rvb2xfdXNlX2lkIpIBChlSZXF1ZXN0UGVybWlzc2lvblJlc3BvbnNlEhAKCGFwcHJvdmVkGAEgASgIEjkKEnBlcm1pc3Npb25fdXBkYXRlcxgCIAMoCzIdLmFpYWdlbnQucnBjLlBlcm1pc3Npb25VcGRhdGUSGAoLZGVueV9yZWFzb24YAyABKAlIAIgBAUIOCgxfZGVueV9yZWFzb24isQEKFFNlc3Npb25Db21tYW5kTm90aWZ5Ei0KBHR5cGUYASABKA4yHy5haWFnZW50LnJwYy5TZXNzaW9uQ29tbWFuZFR5cGUSFwoKc2Vzc2lvbl9pZBgCIAEoCUgAiAEBEhUKCG5ld19uYW1lGAMgASgJSAGIAQESEwoGbG9jYWxlGAQgASgJSAKIAQFCDQoLX3Nlc3Npb25faWRCCwoJX25ld19uYW1lQgkKB19sb2NhbGUilQQKElRoZW1lQ2hhbmdlZE5vdGlmeRISCgpiYWNrZ3JvdW5kGAEgASgJEhIKCmZvcmVncm91bmQYAiABKAkSFAoMYm9yZGVyX2NvbG9yGAMgASgJEhgKEHBhbmVsX2JhY2tncm91bmQYBCABKAkSHQoVdGV4dF9maWVsZF9iYWNrZ3JvdW5kGAUgASgJEhwKFHNlbGVjdGlvbl9iYWNrZ3JvdW5kGAYgASgJEhwKFHNlbGVjdGlvbl9mb3JlZ3JvdW5kGAcgASgJEhIKCmxpbmtfY29sb3IYCCABKAkSEwoLZXJyb3JfY29sb3IYCSABKAkSFQoNd2FybmluZ19jb2xvchgKIAEoCRIVCg1zdWNjZXNzX2NvbG9yGAsgASgJEhcKD3NlcGFyYXRvcl9jb2xvchgMIAEoCRIYChBob3Zlcl9iYWNrZ3JvdW5kGA0gASgJEhQKDGFjY2VudF9jb2xvchgOIAEoCRIXCg9pbmZvX2JhY2tncm91bmQYDyABKAkSFwoPY29kZV9iYWNrZ3JvdW5kGBAgASgJEhwKFHNlY29uZGFyeV9mb3JlZ3JvdW5kGBEgASgJEhMKC2ZvbnRfZmFtaWx5GBIgASgJEhEKCWZvbnRfc2l6ZRgTIAEoBRIaChJlZGl0b3JfZm9udF9mYW1pbHkYFCABKAkSGAoQZWRpdG9yX2ZvbnRfc2l6ZRgVIAEoBSKEAwoLSWRlU2V0dGluZ3MSGAoQZGVmYXVsdF9tb2RlbF9pZBgBIAEoCRIaChJkZWZhdWx0X21vZGVsX25hbWUYAiABKAkSIgoaZGVmYXVsdF9ieXBhc3NfcGVybWlzc2lvbnMYAyABKAgSIwobZW5hYmxlX3VzZXJfaW50ZXJhY3Rpb25fbWNwGAQgASgIEhwKFGVuYWJsZV9qZXRicmFpbnNfbWNwGAUgASgIEiAKGGluY2x1ZGVfcGFydGlhbF9tZXNzYWdlcxgGIAEoCBIeChZkZWZhdWx0X3RoaW5raW5nX2xldmVsGAcgASgJEh8KF2RlZmF1bHRfdGhpbmtpbmdfdG9rZW5zGAggASgFEiEKGWRlZmF1bHRfdGhpbmtpbmdfbGV2ZWxfaWQYCSABKAkSOQoPdGhpbmtpbmdfbGV2ZWxzGAogAygLMiAuYWlhZ2VudC5ycGMuVGhpbmtpbmdMZXZlbENvbmZpZxIXCg9wZXJtaXNzaW9uX21vZGUYCyABKAkiUgoTVGhpbmtpbmdMZXZlbENvbmZpZxIKCgJpZBgBIAEoCRIMCgRuYW1lGAIgASgJEg4KBnRva2VucxgDIAEoBRIRCglpc19jdXN0b20YBCABKAgiRgoYSWRlU2V0dGluZ3NDaGFuZ2VkTm90aWZ5EioKCHNldHRpbmdzGAEgASgLMhguYWlhZ2VudC5ycGMuSWRlU2V0dGluZ3MivwMKF0FjdGl2ZUZpbGVDaGFuZ2VkTm90aWZ5EhcKD2hhc19hY3RpdmVfZmlsZRgBIAEoCBIRCgRwYXRoGAIgASgJSACIAQESGgoNcmVsYXRpdmVfcGF0aBgDIAEoCUgBiAEBEhEKBG5hbWUYBCABKAlIAogBARIRCgRsaW5lGAUgASgFSAOIAQESEwoGY29sdW1uGAYgASgFSASIAQESFQoNaGFzX3NlbGVjdGlvbhgHIAEoCBIXCgpzdGFydF9saW5lGAggASgFSAWIAQESGQoMc3RhcnRfY29sdW1uGAkgASgFSAaIAQESFQoIZW5kX2xpbmUYCiABKAVIB4gBARIXCgplbmRfY29sdW1uGAsgASgFSAiIAQESHQoQc2VsZWN0ZWRfY29udGVudBgMIAEoCUgJiAEBQgcKBV9wYXRoQhAKDl9yZWxhdGl2ZV9wYXRoQgcKBV9uYW1lQgcKBV9saW5lQgkKB19jb2x1bW5CDQoLX3N0YXJ0X2xpbmVCDwoNX3N0YXJ0X2NvbHVtbkILCglfZW5kX2xpbmVCDQoLX2VuZF9jb2x1bW5CEwoRX3NlbGVjdGVkX2NvbnRlbnQi3AMKEVNlcnZlckNhbGxSZXF1ZXN0Eg8KB2NhbGxfaWQYASABKAkSDgoGbWV0aG9kGAIgASgJEhUKC3BhcmFtc19qc29uGAMgASgMSAASQAoRYXNrX3VzZXJfcXVlc3Rpb24YCiABKAsyIy5haWFnZW50LnJwYy5Bc2tVc2VyUXVlc3Rpb25SZXF1ZXN0SAASQwoScmVxdWVzdF9wZXJtaXNzaW9uGAsgASgLMiUuYWlhZ2VudC5ycGMuUmVxdWVzdFBlcm1pc3Npb25SZXF1ZXN0SAASPAoPc2Vzc2lvbl9jb21tYW5kGBQgASgLMiEuYWlhZ2VudC5ycGMuU2Vzc2lvbkNvbW1hbmROb3RpZnlIABI4Cg10aGVtZV9jaGFuZ2VkGBUgASgLMh8uYWlhZ2VudC5ycGMuVGhlbWVDaGFuZ2VkTm90aWZ5SAASQQoQc2V0dGluZ3NfY2hhbmdlZBgWIAEoCzIlLmFpYWdlbnQucnBjLklkZVNldHRpbmdzQ2hhbmdlZE5vdGlmeUgAEkMKE2FjdGl2ZV9maWxlX2NoYW5nZWQYFyABKAsyJC5haWFnZW50LnJwYy5BY3RpdmVGaWxlQ2hhbmdlZE5vdGlmeUgAQggKBnBhcmFtcyL+AQoSU2VydmVyQ2FsbFJlc3BvbnNlEg8KB2NhbGxfaWQYASABKAkSDwoHc3VjY2VzcxgCIAEoCBIVCgtyZXN1bHRfanNvbhgDIAEoDEgAEkEKEWFza191c2VyX3F1ZXN0aW9uGAogASgLMiQuYWlhZ2VudC5ycGMuQXNrVXNlclF1ZXN0aW9uUmVzcG9uc2VIABJEChJyZXF1ZXN0X3Blcm1pc3Npb24YCyABKAsyJi5haWFnZW50LnJwYy5SZXF1ZXN0UGVybWlzc2lvblJlc3BvbnNlSAASEgoFZXJyb3IYBCABKAlIAYgBAUIICgZyZXN1bHRCCAoGX2Vycm9yIlgKFlRydW5jYXRlSGlzdG9yeVJlcXVlc3QSEgoKc2Vzc2lvbl9pZBgBIAEoCRIUCgxtZXNzYWdlX3V1aWQYAiABKAkSFAoMcHJvamVjdF9wYXRoGAMgASgJIl8KFVRydW5jYXRlSGlzdG9yeVJlc3VsdBIPCgdzdWNjZXNzGAEgASgIEhcKD3JlbWFpbmluZ19saW5lcxgCIAEoBRISCgVlcnJvchgDIAEoCUgAiAEBQggKBl9lcnJvciJZCg9NY3BTZXJ2ZXJTdGF0dXMSDAoEbmFtZRgBIAEoCRIOCgZzdGF0dXMYAiABKAkSGAoLc2VydmVyX2luZm8YAyABKAlIAIgBAUIOCgxfc2VydmVyX2luZm8iQAoPTWNwU3RhdHVzUmVzdWx0Ei0KB3NlcnZlcnMYASADKAsyHC5haWFnZW50LnJwYy5NY3BTZXJ2ZXJTdGF0dXMitwEKEkNocm9tZVN0YXR1c1Jlc3VsdBIRCglpbnN0YWxsZWQYASABKAgSDwoHZW5hYmxlZBgCIAEoCBIRCgljb25uZWN0ZWQYAyABKAgSHgoRbWNwX3NlcnZlcl9zdGF0dXMYBCABKAlIAIgBARIeChFleHRlbnNpb25fdmVyc2lvbhgFIAEoCUgBiAEBQhQKEl9tY3Bfc2VydmVyX3N0YXR1c0IUChJfZXh0ZW5zaW9uX3ZlcnNpb24iKgoTUmVjb25uZWN0TWNwUmVxdWVzdBITCgtzZXJ2ZXJfbmFtZRgBIAEoCSKNAQoSUmVjb25uZWN0TWNwUmVzdWx0Eg8KB3N1Y2Nlc3MYASABKAgSEwoLc2VydmVyX25hbWUYAiABKAkSEwoGc3RhdHVzGAMgASgJSACIAQESEwoLdG9vbHNfY291bnQYBCABKAUSEgoFZXJyb3IYBSABKAlIAYgBAUIJCgdfc3RhdHVzQggKBl9lcnJvciI+ChJHZXRNY3BUb29sc1JlcXVlc3QSGAoLc2VydmVyX25hbWUYASABKAlIAIgBAUIOCgxfc2VydmVyX25hbWUiXAoLTWNwVG9vbEluZm8SDAoEbmFtZRgBIAEoCRITCgtkZXNjcmlwdGlvbhgCIAEoCRIZCgxpbnB1dF9zY2hlbWEYAyABKAlIAIgBAUIPCg1faW5wdXRfc2NoZW1hInUKEUdldE1jcFRvb2xzUmVzdWx0EhgKC3NlcnZlcl9uYW1lGAEgASgJSACIAQESJwoFdG9vbHMYAiADKAsyGC5haWFnZW50LnJwYy5NY3BUb29sSW5mbxINCgVjb3VudBgDIAEoBUIOCgxfc2VydmVyX25hbWUqTQoIUHJvdmlkZXISGAoUUFJPVklERVJfVU5TUEVDSUZJRUQQABITCg9QUk9WSURFUl9DTEFVREUQARISCg5QUk9WSURFUl9DT0RFWBACKrABCg1TZXNzaW9uU3RhdHVzEh4KGlNFU1NJT05fU1RBVFVTX1VOU1BFQ0lGSUVEEAASHAoYU0VTU0lPTl9TVEFUVVNfQ09OTkVDVEVEEAESHwobU0VTU0lPTl9TVEFUVVNfRElTQ09OTkVDVEVEEAISHgoaU0VTU0lPTl9TVEFUVVNfSU5URVJSVVBURUQQAxIgChxTRVNTSU9OX1NUQVRVU19NT0RFTF9DSEFOR0VEEAQqiAEKDUNvbnRlbnRTdGF0dXMSHgoaQ09OVEVOVF9TVEFUVVNfVU5TUEVDSUZJRUQQABIeChpDT05URU5UX1NUQVRVU19JTl9QUk9HUkVTUxABEhwKGENPTlRFTlRfU1RBVFVTX0NPTVBMRVRFRBACEhkKFUNPTlRFTlRfU1RBVFVTX0ZBSUxFRBADKrIBCg5QZXJtaXNzaW9uTW9kZRIfChtQRVJNSVNTSU9OX01PREVfVU5TUEVDSUZJRUQQABIbChdQRVJNSVNTSU9OX01PREVfREVGQVVMVBABEiYKIlBFUk1JU1NJT05fTU9ERV9CWVBBU1NfUEVSTUlTU0lPTlMQAhIgChxQRVJNSVNTSU9OX01PREVfQUNDRVBUX0VESVRTEAMSGAoUUEVSTUlTU0lPTl9NT0RFX1BMQU4QBCqOAQoLU2FuZGJveE1vZGUSHAoYU0FOREJPWF9NT0RFX1VOU1BFQ0lGSUVEEAASGgoWU0FOREJPWF9NT0RFX1JFQURfT05MWRABEiAKHFNBTkRCT1hfTU9ERV9XT1JLU1BBQ0VfV1JJVEUQAhIjCh9TQU5EQk9YX01PREVfREFOR0VSX0ZVTExfQUNDRVNTEAMqkwEKElBlcm1pc3Npb25CZWhhdmlvchIjCh9QRVJNSVNTSU9OX0JFSEFWSU9SX1VOU1BFQ0lGSUVEEAASHQoZUEVSTUlTU0lPTl9CRUhBVklPUl9BTExPVxABEhwKGFBFUk1JU1NJT05fQkVIQVZJT1JfREVOWRACEhsKF1BFUk1JU1NJT05fQkVIQVZJT1JfQVNLEAMqtwIKFFBlcm1pc3Npb25VcGRhdGVUeXBlEiYKIlBFUk1JU1NJT05fVVBEQVRFX1RZUEVfVU5TUEVDSUZJRUQQABIkCiBQRVJNSVNTSU9OX1VQREFURV9UWVBFX0FERF9SVUxFUxABEigKJFBFUk1JU1NJT05fVVBEQVRFX1RZUEVfUkVQTEFDRV9SVUxFUxACEicKI1BFUk1JU1NJT05fVVBEQVRFX1RZUEVfUkVNT1ZFX1JVTEVTEAMSIwofUEVSTUlTU0lPTl9VUERBVEVfVFlQRV9TRVRfTU9ERRAEEioKJlBFUk1JU1NJT05fVVBEQVRFX1RZUEVfQUREX0RJUkVDVE9SSUVTEAUSLQopUEVSTUlTU0lPTl9VUERBVEVfVFlQRV9SRU1PVkVfRElSRUNUT1JJRVMQBiqOAgobUGVybWlzc2lvblVwZGF0ZURlc3RpbmF0aW9uEi0KKVBFUk1JU1NJT05fVVBEQVRFX0RFU1RJTkFUSU9OX1VOU1BFQ0lGSUVEEAASLworUEVSTUlTU0lPTl9VUERBVEVfREVTVElOQVRJT05fVVNFUl9TRVRUSU5HUxABEjIKLlBFUk1JU1NJT05fVVBEQVRFX0RFU1RJTkFUSU9OX1BST0pFQ1RfU0VUVElOR1MQAhIwCixQRVJNSVNTSU9OX1VQREFURV9ERVNUSU5BVElPTl9MT0NBTF9TRVRUSU5HUxADEikKJVBFUk1JU1NJT05fVVBEQVRFX0RFU1RJTkFUSU9OX1NFU1NJT04QBCr7AQoSU2Vzc2lvbkNvbW1hbmRUeXBlEhsKF1NFU1NJT05fQ01EX1VOU1BFQ0lGSUVEEAASFgoSU0VTU0lPTl9DTURfU1dJVENIEAESFgoSU0VTU0lPTl9DTURfQ1JFQVRFEAISFQoRU0VTU0lPTl9DTURfQ0xPU0UQAxIWChJTRVNTSU9OX0NNRF9SRU5BTUUQBBIeChpTRVNTSU9OX0NNRF9UT0dHTEVfSElTVE9SWRAFEhoKFlNFU1NJT05fQ01EX1NFVF9MT0NBTEUQBhIWChJTRVNTSU9OX0NNRF9ERUxFVEUQBxIVChFTRVNTSU9OX0NNRF9SRVNFVBAIQikKFGNvbS5hc2FraWkucnBjLnByb3RvQg9BaUFnZW50UnBjUHJvdG9QAWIGcHJvdG8z"),Zi=Ho(Yi,0),Xi=Ho(Yi,2),Ji=Ho(Yi,3),Qi=Ho(Yi,4),qi=Ho(Yi,5),er=Ho(Yi,6),tr=Ho(Yi,7),nr=Ho(Yi,8),sr=Ho(Yi,11),or=Ho(Yi,12),ir=Ho(Yi,23),rr=Ho(Yi,47),ar=Ho(Yi,49),lr=Ho(Yi,51),cr=Ho(Yi,52),ur=Ho(Yi,53),dr=Ho(Yi,54),pr=Ho(Yi,58),hr=Ho(Yi,59),fr=Ho(Yi,60),mr=Ho(Yi,61),gr=Ho(Yi,64),yr=Ho(Yi,68),vr=Ho(Yi,69),br=Ho(Yi,70),kr=Ho(Yi,71),wr=Ho(Yi,73),Sr=Ho(Yi,79),Cr=Ho(Yi,80),Tr=Ho(Yi,81),Er=Ho(Yi,82),Ir=Ho(Yi,83),xr=Ho(Yi,85),Ar=Ho(Yi,87),Nr=Ho(Yi,88),Mr=Ho(Yi,89),Rr=Ho(Yi,91);var _r=(e=>(e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.CLAUDE=1]="CLAUDE",e[e.CODEX=2]="CODEX",e))(_r||{}),Or=(e=>(e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.CONNECTED=1]="CONNECTED",e[e.DISCONNECTED=2]="DISCONNECTED",e[e.INTERRUPTED=3]="INTERRUPTED",e[e.MODEL_CHANGED=4]="MODEL_CHANGED",e))(Or||{}),Dr=(e=>(e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.IN_PROGRESS=1]="IN_PROGRESS",e[e.COMPLETED=2]="COMPLETED",e[e.FAILED=3]="FAILED",e))(Dr||{}),Br=(e=>(e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.DEFAULT=1]="DEFAULT",e[e.BYPASS_PERMISSIONS=2]="BYPASS_PERMISSIONS",e[e.ACCEPT_EDITS=3]="ACCEPT_EDITS",e[e.PLAN=4]="PLAN",e))(Br||{}),Lr=(e=>(e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.READ_ONLY=1]="READ_ONLY",e[e.WORKSPACE_WRITE=2]="WORKSPACE_WRITE",e[e.DANGER_FULL_ACCESS=3]="DANGER_FULL_ACCESS",e))(Lr||{}),Fr=(e=>(e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ALLOW=1]="ALLOW",e[e.DENY=2]="DENY",e[e.ASK=3]="ASK",e))(Fr||{}),Pr=(e=>(e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ADD_RULES=1]="ADD_RULES",e[e.REPLACE_RULES=2]="REPLACE_RULES",e[e.REMOVE_RULES=3]="REMOVE_RULES",e[e.SET_MODE=4]="SET_MODE",e[e.ADD_DIRECTORIES=5]="ADD_DIRECTORIES",e[e.REMOVE_DIRECTORIES=6]="REMOVE_DIRECTORIES",e))(Pr||{}),$r=(e=>(e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.USER_SETTINGS=1]="USER_SETTINGS",e[e.PROJECT_SETTINGS=2]="PROJECT_SETTINGS",e[e.LOCAL_SETTINGS=3]="LOCAL_SETTINGS",e[e.SESSION=4]="SESSION",e))($r||{}),Ur=(e=>(e[e.SESSION_CMD_UNSPECIFIED=0]="SESSION_CMD_UNSPECIFIED",e[e.SESSION_CMD_SWITCH=1]="SESSION_CMD_SWITCH",e[e.SESSION_CMD_CREATE=2]="SESSION_CMD_CREATE",e[e.SESSION_CMD_CLOSE=3]="SESSION_CMD_CLOSE",e[e.SESSION_CMD_RENAME=4]="SESSION_CMD_RENAME",e[e.SESSION_CMD_TOGGLE_HISTORY=5]="SESSION_CMD_TOGGLE_HISTORY",e[e.SESSION_CMD_SET_LOCALE=6]="SESSION_CMD_SET_LOCALE",e[e.SESSION_CMD_DELETE=7]="SESSION_CMD_DELETE",e[e.SESSION_CMD_RESET=8]="SESSION_CMD_RESET",e))(Ur||{});const Vr={message:new Map,block:new Map,event:new Map};function Wr(e){return function(t){return Vr.message.set(e,t),t}}function Gr(e){return function(t){return Vr.block.set(e,t),t}}function zr(e){return function(t){return Vr.event.set(e,t),t}}let Hr,Kr;function jr(e){if(!e||"string"!=typeof e.type)return console.warn("[RPC] Invalid block data:",e),new Hr(e);const t=Vr.block.get(e.type);return t?new t(e):(console.warn(`[RPC] Unknown block type: ${e.type}`),new Hr(e))}class Yr{constructor(e){}}e=[Gr("text")];class Zr extends(n=Yr){constructor(e){super(e),De(this,"type","text"),De(this,"text"),this.text=e?.text??""}get isEmpty(){return!this.text||""===this.text.trim()}}_e(t=Ae(n),1,Zr=Oe(t,0,"TextBlock",e,Zr)),s=[Gr("thinking")];class Xr extends(i=Yr){constructor(e){super(e),De(this,"type","thinking"),De(this,"thinking"),De(this,"signature"),this.thinking=e?.thinking??"",this.signature=e?.signature}get isEmpty(){return!this.thinking||""===this.thinking.trim()}}_e(o=Ae(i),1,Xr=Oe(o,0,"ThinkingBlock",s,Xr)),r=[Gr("tool_use")];class Jr extends(l=Yr){constructor(e){if(super(e),De(this,"type","tool_use"),De(this,"id"),De(this,"name"),De(this,"toolType"),De(this,"input"),De(this,"status"),this.id=e?.id??"",this.name=e?.name??e?.tool_name??"",this.toolType=e?.toolType??e?.tool_type,this.status=e?.status??"in_progress",e?.input_json)try{this.input="string"==typeof e.input_json?JSON.parse(e.input_json):e.input_json}catch{this.input=e.input_json}else this.input=e?.input??{}}get isCompleted(){return"completed"===this.status}get isFailed(){return"failed"===this.status}get isInProgress(){return"in_progress"===this.status}}_e(a=Ae(l),1,Jr=Oe(a,0,"ToolUseBlock",r,Jr)),c=[Gr("tool_result")];class Qr extends(d=Yr){constructor(e){if(super(e),De(this,"type","tool_result"),De(this,"tool_use_id"),De(this,"content"),De(this,"is_error"),De(this,"agent_id"),this.tool_use_id=e?.tool_use_id??"",this.is_error=e?.is_error??!1,this.agent_id=e?.agent_id,e?.content_json)try{this.content="string"==typeof e.content_json?JSON.parse(e.content_json):e.content_json}catch{this.content=e.content_json}else this.content=e?.content}get isAgentResult(){return!!this.agent_id}}_e(u=Ae(d),1,Qr=Oe(u,0,"ToolResultBlock",c,Qr)),p=[Gr("image")];class qr extends(f=Yr){constructor(e){super(e),De(this,"type","image"),De(this,"source"),this.source={type:e?.source?.type??"base64",media_type:e?.source?.media_type??e?.source?.mediaType??"image/png",data:e?.source?.data,url:e?.source?.url}}get isBase64(){return"base64"===this.source.type}get isUrl(){return"url"===this.source.type}get dataUrl(){return this.source.url?this.source.url:this.source.data?`data:${this.source.media_type};base64,${this.source.data}`:""}}_e(h=Ae(f),1,qr=Oe(h,0,"ImageBlock",p,qr)),m=[Gr("command_execution")];class ea extends(y=Yr){constructor(e){super(e),De(this,"type","command_execution"),De(this,"command"),De(this,"output"),De(this,"exit_code"),De(this,"status"),this.command=e?.command??"",this.output=e?.output,this.exit_code=e?.exit_code,this.status=e?.status??"in_progress"}get isSuccess(){return 0===this.exit_code}get isCompleted(){return"completed"===this.status}get isFailed(){return"failed"===this.status||this.isCompleted&&0!==this.exit_code}}_e(g=Ae(y),1,ea=Oe(g,0,"CommandExecutionBlock",m,ea)),v=[Gr("file_change")];class ta extends(k=Yr){constructor(e){super(e),De(this,"type","file_change"),De(this,"status"),De(this,"changes"),this.status=e?.status??"completed",this.changes=e?.changes??[]}get fileCount(){return this.changes.length}}_e(b=Ae(k),1,ta=Oe(b,0,"FileChangeBlock",v,ta)),w=[Gr("mcp_tool_call")];class na extends(C=Yr){constructor(e){if(super(e),De(this,"type","mcp_tool_call"),De(this,"server"),De(this,"tool"),De(this,"arguments"),De(this,"result"),De(this,"status"),this.server=e?.server,this.tool=e?.tool,this.status=e?.status??"in_progress",e?.arguments_json)try{this.arguments="string"==typeof e.arguments_json?JSON.parse(e.arguments_json):e.arguments_json}catch{this.arguments=e.arguments_json}else this.arguments=e?.arguments??{};if(e?.result_json)try{this.result="string"==typeof e.result_json?JSON.parse(e.result_json):e.result_json}catch{this.result=e.result_json}else this.result=e?.result}get isCompleted(){return"completed"===this.status}get fullName(){return this.server&&this.tool?`${this.server}:${this.tool}`:this.tool??""}}_e(S=Ae(C),1,na=Oe(S,0,"McpToolCallBlock",w,na)),T=[Gr("web_search")];class sa extends(I=Yr){constructor(e){super(e),De(this,"type","web_search"),De(this,"query"),this.query=e?.query??""}}_e(E=Ae(I),1,sa=Oe(E,0,"WebSearchBlock",T,sa)),x=[Gr("todo_list")];class oa extends(N=Yr){constructor(e){super(e),De(this,"type","todo_list"),De(this,"items"),this.items=e?.items??[]}get completedCount(){return this.items.filter(e=>e.completed).length}get totalCount(){return this.items.length}get progress(){return 0===this.totalCount?0:this.completedCount/this.totalCount}}_e(A=Ae(N),1,oa=Oe(A,0,"TodoListBlock",x,oa)),M=[Gr("error")];class ia extends(_=Yr){constructor(e){super(e),De(this,"type","error"),De(this,"message"),this.message=e?.message??"Unknown error"}}_e(R=Ae(_),1,ia=Oe(R,0,"ErrorBlock",M,ia));class ra extends Yr{constructor(e){super(e),De(this,"type","unknown"),De(this,"originalType"),De(this,"raw"),this.originalType=e?.type,this.raw=e}}class aa{constructor(e){De(this,"content"),De(this,"model"),this.content=function(e){return e&&Array.isArray(e)?e.map(e=>jr(e)):[]}(e?.content),this.model=e?.model}get text(){return this.content.filter(e=>e instanceof Zr).map(e=>e.text).join("")}get hasThinking(){return this.content.some(e=>e instanceof Xr)}get toolCalls(){return this.content.filter(e=>e instanceof Jr)}}class la{constructor(e){De(this,"provider"),this.provider=e?.provider??"claude"}}O=[Wr("user")];class ca extends(B=la){constructor(e){super(e),De(this,"type","user"),De(this,"message"),De(this,"id"),De(this,"uuid"),De(this,"isReplay"),De(this,"parentToolUseId"),this.message=new aa(e?.message),this.id=e?.id,this.uuid=e?.uuid,this.isReplay=e?.isReplay,this.parentToolUseId=e?.parentToolUseId}get isLocal(){return!this.isReplay}get textContent(){return this.message.text}get isSubAgentMessage(){return!!this.parentToolUseId}}_e(D=Ae(B),1,ca=Oe(D,0,"RpcUserMessage",O,ca)),L=[Wr("assistant")];class ua extends(P=la){constructor(e){super(e),De(this,"type","assistant"),De(this,"message"),De(this,"id"),De(this,"uuid"),De(this,"parentToolUseId"),this.message=new aa(e?.message),this.id=e?.id,this.uuid=e?.uuid,this.parentToolUseId=e?.parentToolUseId}get hasThinking(){return this.message.hasThinking}get toolCalls(){return this.message.toolCalls}get textContent(){return this.message.text}get isSubAgentMessage(){return!!this.parentToolUseId}get thinkingBlocks(){return this.message.content.filter(e=>e instanceof Xr)}}_e(F=Ae(P),1,ua=Oe(F,0,"RpcAssistantMessage",L,ua)),$=[Wr("result")];class da extends(V=la){constructor(e){super(e),De(this,"type","result"),De(this,"subtype"),De(this,"duration_ms"),De(this,"duration_api_ms"),De(this,"is_error"),De(this,"num_turns"),De(this,"session_id"),De(this,"total_cost_usd"),De(this,"result"),De(this,"usage"),this.subtype=e?.subtype??"",this.duration_ms=e?.duration_ms,this.duration_api_ms=e?.duration_api_ms,this.is_error=e?.is_error??!1,this.num_turns=e?.num_turns??0,this.session_id=e?.session_id,this.total_cost_usd=e?.total_cost_usd,this.result=e?.result,this.usage=e?.usage}get isSuccess(){return!this.is_error}get durationSeconds(){return(this.duration_ms??0)/1e3}}_e(U=Ae(V),1,da=Oe(U,0,"RpcResultMessage",$,da)),W=[Wr("stream_event")];class pa extends(z=la){constructor(e){super(e),De(this,"type","stream_event"),De(this,"uuid"),De(this,"session_id"),De(this,"event"),De(this,"parentToolUseId"),this.uuid=e?.uuid??"",this.session_id=e?.session_id??"",this.event=function(e){if(!e||"string"!=typeof e.type)return console.warn("[RPC] Invalid event data:",e),new Kr(e);const t=Vr.event.get(e.type);return t?new t(e):(console.warn(`[RPC] Unknown event type: ${e.type}`),new Kr(e))}(e?.event),this.parentToolUseId=e?.parentToolUseId}get isSubAgentEvent(){return!!this.parentToolUseId}}_e(G=Ae(z),1,pa=Oe(G,0,"RpcStreamEventMessage",W,pa)),H=[Wr("error")];class ha extends(j=la){constructor(e){super(e),De(this,"type","error"),De(this,"errorMessage"),this.errorMessage=e?.message??e?.errorMessage??"Unknown error"}}_e(K=Ae(j),1,ha=Oe(K,0,"RpcErrorMessage",H,ha)),Y=[Wr("status_system")];class fa extends(X=la){constructor(e){super(e),De(this,"type","status_system"),De(this,"subtype"),De(this,"status"),De(this,"session_id"),this.subtype=e?.subtype??"",this.status=e?.status,this.session_id=e?.session_id}}_e(Z=Ae(X),1,fa=Oe(Z,0,"RpcStatusSystemMessage",Y,fa)),J=[Wr("compact_boundary")];class ma extends(q=la){constructor(e){super(e),De(this,"type","compact_boundary"),De(this,"subtype"),De(this,"session_id"),De(this,"compact_metadata"),this.subtype=e?.subtype??"",this.session_id=e?.session_id??"",this.compact_metadata=e?.compact_metadata}get isStart(){return"compacting_start"===this.subtype}get isEnd(){return"compacting_end"===this.subtype}}_e(Q=Ae(q),1,ma=Oe(Q,0,"RpcCompactBoundaryMessage",J,ma)),ee=[Wr("system_init")];class ga extends(ne=la){constructor(e){super(e),De(this,"type","system_init"),De(this,"session_id"),De(this,"cwd"),De(this,"model"),De(this,"permissionMode"),De(this,"apiKeySource"),De(this,"tools"),De(this,"mcpServers"),this.session_id=e?.session_id??"",this.cwd=e?.cwd,this.model=e?.model,this.permissionMode=e?.permissionMode,this.apiKeySource=e?.apiKeySource,this.tools=e?.tools,this.mcpServers=e?.mcpServers}}_e(te=Ae(ne),1,ga=Oe(te,0,"RpcSystemInitMessage",ee,ga));class ya extends la{constructor(e){super(e),De(this,"type","unknown"),De(this,"originalType"),De(this,"raw"),this.originalType=e?.type,this.raw=e}}class va{constructor(e){}}se=[zr("message_start")];class ba extends(ie=va){constructor(e){super(e),De(this,"type","message_start"),De(this,"message"),e?.message&&(this.message={id:e.message.id,model:e.message.model,content:e.message.content?.map(e=>jr(e))??[]})}}_e(oe=Ae(ie),1,ba=Oe(oe,0,"MessageStartEvent",se,ba)),re=[zr("content_block_start")];class ka extends(le=va){constructor(e){super(e),De(this,"type","content_block_start"),De(this,"index"),De(this,"content_block"),this.index=e?.index??0,this.content_block=jr(e?.content_block)}get isTextBlock(){return this.content_block instanceof Zr}get isThinkingBlock(){return this.content_block instanceof Xr}}_e(ae=Ae(le),1,ka=Oe(ae,0,"ContentBlockStartEvent",re,ka)),ce=[zr("content_block_delta")];class wa extends(de=va){constructor(e){super(e),De(this,"type","content_block_delta"),De(this,"index"),De(this,"delta"),this.index=e?.index??0,this.delta=e?.delta??{type:"text_delta",text:""}}get isTextDelta(){return"text_delta"===this.delta.type}get isThinkingDelta(){return"thinking_delta"===this.delta.type}get isInputJsonDelta(){return"input_json_delta"===this.delta.type}get text(){return"text_delta"===this.delta.type?this.delta.text:"thinking_delta"===this.delta.type?this.delta.thinking:""}}_e(ue=Ae(de),1,wa=Oe(ue,0,"ContentBlockDeltaEvent",ce,wa)),pe=[zr("content_block_stop")];class Sa extends(fe=va){constructor(e){super(e),De(this,"type","content_block_stop"),De(this,"index"),this.index=e?.index??0}}_e(he=Ae(fe),1,Sa=Oe(he,0,"ContentBlockStopEvent",pe,Sa)),me=[zr("message_delta")];class Ca extends(ye=va){constructor(e){super(e),De(this,"type","message_delta"),De(this,"delta"),De(this,"usage"),this.delta=e?.delta,this.usage=e?.usage}get tokenStats(){return{input:this.usage?.input_tokens??0,output:this.usage?.output_tokens??0,cached:this.usage?.cached_input_tokens??0}}}_e(ge=Ae(ye),1,Ca=Oe(ge,0,"MessageDeltaEvent",me,Ca)),ve=[zr("message_stop")];class Ta extends(ke=va){constructor(e){super(e),De(this,"type","message_stop")}}_e(be=Ae(ke),1,Ta=Oe(be,0,"MessageStopEvent",ve,Ta));class Ea extends va{constructor(e){super(e),De(this,"type","unknown"),De(this,"originalType"),De(this,"raw"),this.originalType=e?.type,this.raw=e}}Hr=ra,Kr=Ea;const Ia={encodeConnectOptions(e){if(!e)return;const t=Xn(Zi,{provider:e.provider?xa(e.provider):void 0,model:e.model,systemPrompt:e.systemPrompt,initialPrompt:e.initialPrompt,sessionId:e.sessionId,resumeSessionId:e.resumeSessionId,metadata:e.metadata||{},permissionMode:e.permissionMode?Na(e.permissionMode):void 0,dangerouslySkipPermissions:e.dangerouslySkipPermissions,allowDangerouslySkipPermissions:e.allowDangerouslySkipPermissions,includePartialMessages:e.includePartialMessages,continueConversation:e.continueConversation,thinkingEnabled:e.thinkingEnabled,baseUrl:e.baseUrl,apiKey:e.apiKey,sandboxMode:e.sandboxMode?Ra(e.sandboxMode):void 0,replayUserMessages:e.replayUserMessages});return Vi(Zi,t)},encodeQueryRequest(e){const t=Xn(lr,{message:e});return Vi(lr,t)},encodeQueryWithContentRequest(e){const t=Xn(cr,{content:e.map(Da)});return Vi(cr,t)},encodeSetModelRequest(e){const t=Xn(ur,{model:e});return Vi(ur,t)},encodeSetPermissionModeRequest(e){const t=Xn(dr,{mode:Na(e)});return Vi(dr,t)},encodeSetMaxThinkingTokensRequest(e){if(null===e)return new Uint8Array(0);const t=[];return t.push(8),(e=>{let n=e>>>0;for(;n>127;)t.push(127&n|128),n>>>=7;t.push(n)})(e),new Uint8Array(t)},decodeSetMaxThinkingTokensResult(e){let t="connected",n=null,s=0;for(;s<e.length;){const o=e[s++],i=o>>3;if(0===(7&o)){let o,r=0,a=0;do{o=e[s++],r|=(127&o)<<a,a+=7}while(128&o);1===i?t=_a(r):2===i&&(n=r)}}return{status:t,maxThinkingTokens:n}},encodeGetHistorySessionsRequest(e,t=0){const n=[],s=(e,t)=>{n.push(e),(e=>{let t=e>>>0;for(;t>127;)n.push(127&t|128),t>>>=7;n.push(t)})(t)};return s(8,e),t>0&&s(16,t),new Uint8Array(n)},encodeLoadHistoryRequest(e){const t=Xn(pr,{sessionId:e.sessionId??"",projectPath:e.projectPath??"",offset:e.offset??0,limit:e.limit??0});return Vi(pr,t)},encodeGetHistoryMetadataRequest(e){const t=Xn(hr,{sessionId:e.sessionId,projectPath:e.projectPath});return Vi(hr,t)},encodeTruncateHistoryRequest(e){const t=Xn(Er,{sessionId:e.sessionId,messageUuid:e.messageUuid,projectPath:e.projectPath});return Vi(Er,t)},decodeConnectResult(e){const t=Di(Xi,e);return{sessionId:t.sessionId,provider:Aa(t.provider),status:_a(t.status),model:t.model,capabilities:t.capabilities?{canInterrupt:t.capabilities.canInterrupt,canSwitchModel:t.capabilities.canSwitchModel,canSwitchPermissionMode:t.capabilities.canSwitchPermissionMode,supportedPermissionModes:t.capabilities.supportedPermissionModes.map(Ma),canSkipPermissions:t.capabilities.canSkipPermissions,canSendRichContent:t.capabilities.canSendRichContent,canThink:t.capabilities.canThink,canResumeSession:t.capabilities.canResumeSession,canRunInBackground:t.capabilities.canRunInBackground}:void 0,cwd:t.cwd}},decodeStatusResult:e=>({status:_a(Di(Qi,e).status)}),decodeMcpStatusResult:e=>({servers:Di(xr,e).servers.map(e=>({name:e.name,status:e.status,serverInfo:e.serverInfo||void 0}))}),encodeReconnectMcpRequest(e){const t=Xn(Ar,{serverName:e});return Vi(Ar,t)},decodeReconnectMcpResult(e){const t=Di(Nr,e);return{success:t.success,serverName:t.serverName,status:t.status||void 0,toolsCount:t.toolsCount,error:t.error||void 0}},encodeGetMcpToolsRequest(e){const t=Xn(Mr,{serverName:e});return Vi(Mr,t)},decodeGetMcpToolsResult(e){const t=Di(Rr,e);return{serverName:t.serverName||void 0,tools:t.tools.map(e=>({name:e.name,description:e.description,inputSchema:e.inputSchema||void 0})),count:t.count}},decodeSetModelResult:e=>({model:Di(qi,e).model}),decodeSetPermissionModeResult(e){const t=Di(Ji,e);return{mode:Ma(t.mode),success:t.success}},decodeHistory:e=>({messages:Di(rr,e).messages.map(Ba)}),decodeHistorySessionsResult:e=>({sessions:Di(ar,e).sessions.map(e=>({sessionId:e.sessionId,firstUserMessage:e.firstUserMessage,timestamp:Number(e.timestamp),messageCount:e.messageCount,projectPath:e.projectPath,customTitle:e.customTitle||void 0}))}),decodeHistoryMetadata(e){const t=Di(fr,e);return{totalLines:t.totalLines,sessionId:t.sessionId,projectPath:t.projectPath,customTitle:t.customTitle||void 0}},decodeHistoryResult(e){const t=Di(mr,e);return{messages:t.messages.map(Ba),offset:t.offset,count:t.count,availableCount:t.availableCount}},decodeTruncateHistoryResult(e){const t=Di(Ir,e);return{success:t.success,remainingLines:t.remainingLines,error:t.error||void 0}},decodeRpcMessage:e=>Ba(Di(ir,e))};function xa(e){switch(e){case"claude":return _r.CLAUDE;case"codex":return _r.CODEX;default:return _r.UNSPECIFIED}}function Aa(e){switch(e){case _r.CLAUDE:return"claude";case _r.CODEX:return"codex";default:return"claude"}}function Na(e){switch(e){case"default":default:return Br.DEFAULT;case"bypassPermissions":return Br.BYPASS_PERMISSIONS;case"acceptEdits":return Br.ACCEPT_EDITS;case"plan":return Br.PLAN}}function Ma(e){switch(e){case Br.DEFAULT:return"default";case Br.BYPASS_PERMISSIONS:return"bypassPermissions";case Br.ACCEPT_EDITS:return"acceptEdits";case Br.PLAN:return"plan";default:return"default"}}function Ra(e){switch(e){case"read-only":default:return Lr.READ_ONLY;case"workspace-write":return Lr.WORKSPACE_WRITE;case"danger-full-access":return Lr.DANGER_FULL_ACCESS}}function _a(e){switch(e){case Or.CONNECTED:return"connected";case Or.DISCONNECTED:return"disconnected";case Or.INTERRUPTED:return"interrupted";case Or.MODEL_CHANGED:return"model_changed";default:return"disconnected"}}function Oa(e){switch(e){case Dr.IN_PROGRESS:return"in_progress";case Dr.COMPLETED:return"completed";case Dr.FAILED:return"failed";default:return"in_progress"}}function Da(e){const t=Xn(er);switch(e.type){case"text":t.block={case:"text",value:Xn(tr,{text:e.text||""})};break;case"thinking":t.block={case:"thinking",value:Xn(nr,{thinking:e.thinking||"",signature:e.signature})};break;case"image":t.block={case:"image",value:Xn(sr,{source:Xn(or,{type:e.source?.type||"base64",mediaType:e.source?.media_type||"image/png",data:e.source?.data,url:e.source?.url})})};break;default:t.block={case:"text",value:Xn(tr,{text:""})}}return t}function Ba(e){const t=Aa(e.provider);switch(e.message?.case){case"user":return new ca({type:"user",provider:t,message:{content:e.message.value.message?.content.map(La)||[]},parentToolUseId:e.message.value.parentToolUseId,isReplay:e.message.value.isReplay,uuid:e.message.value.uuid});case"assistant":return new ua({type:"assistant",provider:t,message:{content:e.message.value.message?.content.map(La)||[]},id:e.message.value.id,parentToolUseId:e.message.value.parentToolUseId,uuid:e.message.value.uuid});case"result":return new da({type:"result",provider:t,subtype:e.message.value.subtype,duration_ms:e.message.value.durationMs?Number(e.message.value.durationMs):void 0,duration_api_ms:e.message.value.durationApiMs?Number(e.message.value.durationApiMs):void 0,is_error:e.message.value.isError,num_turns:e.message.value.numTurns,session_id:e.message.value.sessionId,total_cost_usd:e.message.value.totalCostUsd,result:e.message.value.result});case"streamEvent":return function(e,t){const n=e.event;let s;if(n&&n.event){const e=n.event;switch(e.case){case"messageStart":s=new ba({type:"message_start",message:e.value.messageInfo?{id:e.value.messageInfo.id,model:e.value.messageInfo.model,content:e.value.messageInfo.content?.map(La)||[]}:void 0});break;case"contentBlockStart":s=new ka({type:"content_block_start",index:e.value.index,content_block:La(e.value.contentBlock)});break;case"contentBlockDelta":s=new wa({type:"content_block_delta",index:e.value.index,delta:Fa(e.value.delta)});break;case"contentBlockStop":s=new Sa({type:"content_block_stop",index:e.value.index});break;case"messageDelta":s=new Ca({type:"message_delta",usage:e.value.usage?{input_tokens:e.value.usage.inputTokens,output_tokens:e.value.usage.outputTokens,cached_input_tokens:e.value.usage.cachedInputTokens,cache_creation_tokens:e.value.usage.cacheCreationTokens,cache_read_tokens:e.value.usage.cacheReadTokens}:void 0});break;case"messageStop":s=new Ta({type:"message_stop"});break;default:console.warn("[protoCodec] unknown stream_event.event.case:",e.case,e),s=new Ea({type:"unknown",originalType:e.case})}}else console.warn("[protoCodec] stream_event has no event field:",e),s=new Ea({type:"unknown"});return new pa({type:"stream_event",provider:t,uuid:e.uuid,session_id:e.sessionId,parentToolUseId:e.parentToolUseId,event:s})}(e.message.value,t);case"error":return new ha({type:"error",provider:t,message:e.message.value.errorMessage});case"statusSystem":return new fa({type:"status_system",provider:t,subtype:e.message.value.subtype,status:e.message.value.status,session_id:e.message.value.sessionId});case"compactBoundary":return new ma({type:"compact_boundary",provider:t,subtype:e.message.value.subtype,session_id:e.message.value.sessionId,compact_metadata:e.message.value.compactMetadata?{trigger:e.message.value.compactMetadata.trigger,pre_tokens:e.message.value.compactMetadata.preTokens}:void 0});case"systemInit":return new ga({type:"system_init",provider:t,session_id:e.message.value.sessionId,cwd:e.message.value.cwd,model:e.message.value.model,permissionMode:e.message.value.permissionMode,apiKeySource:e.message.value.apiKeySource,tools:e.message.value.tools,mcpServers:e.message.value.mcpServers?.map(e=>({name:e.name,status:e.status}))});default:return new ya({type:"unknown",provider:t})}}function La(e){if(!e.block)return new Zr({type:"text",text:""});switch(e.block.case){case"text":return new Zr({type:"text",text:e.block.value.text});case"thinking":return new Xr({type:"thinking",thinking:e.block.value.thinking,signature:e.block.value.signature});case"toolUse":return new Jr({type:"tool_use",id:e.block.value.id,name:e.block.value.toolName,tool_type:e.block.value.toolType,input_json:e.block.value.inputJson?(new TextDecoder).decode(e.block.value.inputJson):void 0,status:Oa(e.block.value.status)});case"toolResult":return new Qr({type:"tool_result",tool_use_id:e.block.value.toolUseId,content_json:e.block.value.contentJson?(new TextDecoder).decode(e.block.value.contentJson):void 0,is_error:e.block.value.isError,agent_id:e.block.value.agentId});case"image":return new qr({type:"image",source:{type:e.block.value.source?.type||"base64",media_type:e.block.value.source?.mediaType||"image/png",data:e.block.value.source?.data,url:e.block.value.source?.url}});case"commandExecution":return new ea({type:"command_execution",command:e.block.value.command,output:e.block.value.output,exit_code:e.block.value.exitCode,status:Oa(e.block.value.status)});case"error":return new ia({type:"error",message:e.block.value.message});default:return new ra({type:"unknown",raw:e})}}function Fa(e){if(!e?.delta)return{type:"unknown"};switch(e.delta.case){case"textDelta":return{type:"text_delta",text:e.delta.value.text};case"thinkingDelta":return{type:"thinking_delta",thinking:e.delta.value.thinking};case"inputJsonDelta":return{type:"input_json_delta",partial_json:e.delta.value.partialJson};default:return{type:"unknown"}}}function Pa(e){const t=Di(Cr,e);let n,s;if("askUserQuestion"===t.params.case)s="askUserQuestion",n=function(e){return{questions:e.questions.map(e=>({question:e.question,header:e.header,options:e.options.map(e=>({label:e.label,description:e.description})),multiSelect:e.multiSelect}))}}(t.params.value);else if("requestPermission"===t.params.case)s="requestPermission",n=function(e){let t={};if(e.inputJson.length>0)try{t=JSON.parse((new TextDecoder).decode(e.inputJson))}catch{t={}}return{toolName:e.toolName,input:t,toolUseId:e.toolUseId,permissionSuggestions:e.permissionSuggestions.map(Va)}}(t.params.value);else if("sessionCommand"===t.params.case)s="sessionCommand",n=function(e){return{type:$a(e.type),sessionId:e.sessionId,newName:e.newName,locale:e.locale}}(t.params.value);else if("themeChanged"===t.params.case)s="themeChanged",n=function(e){return{background:e.background,foreground:e.foreground,borderColor:e.borderColor,panelBackground:e.panelBackground,textFieldBackground:e.textFieldBackground,selectionBackground:e.selectionBackground,selectionForeground:e.selectionForeground,linkColor:e.linkColor,errorColor:e.errorColor,warningColor:e.warningColor,successColor:e.successColor,separatorColor:e.separatorColor,hoverBackground:e.hoverBackground,accentColor:e.accentColor,infoBackground:e.infoBackground,codeBackground:e.codeBackground,secondaryForeground:e.secondaryForeground,fontFamily:e.fontFamily,fontSize:e.fontSize,editorFontFamily:e.editorFontFamily,editorFontSize:e.editorFontSize}}(t.params.value);else if("activeFileChanged"===t.params.case)s="activeFileChanged",n=function(e){return{hasActiveFile:e.hasActiveFile,path:e.path,relativePath:e.relativePath,name:e.name,line:e.line,column:e.column,hasSelection:e.hasSelection,startLine:e.startLine,startColumn:e.startColumn,endLine:e.endLine,endColumn:e.endColumn,selectedContent:e.selectedContent}}(t.params.value);else if("settingsChanged"===t.params.case)s="settingsChanged",n=function(e){const t=e.settings,n=[{id:"off",name:"Off",tokens:0,isCustom:!1},{id:"think",name:"Think",tokens:2048,isCustom:!1},{id:"ultra",name:"Ultra",tokens:8096,isCustom:!1}];return{settings:{defaultModelId:t?.defaultModelId||"",defaultModelName:t?.defaultModelName||"",defaultBypassPermissions:t?.defaultBypassPermissions??!1,enableUserInteractionMcp:t?.enableUserInteractionMcp??!0,enableJetbrainsMcp:t?.enableJetbrainsMcp??!0,includePartialMessages:t?.includePartialMessages??!0,defaultThinkingLevel:t?.defaultThinkingLevel||"ULTRA",defaultThinkingTokens:t?.defaultThinkingTokens??8096,defaultThinkingLevelId:t?.defaultThinkingLevelId||"ultra",thinkingLevels:t?.thinkingLevels&&t.thinkingLevels.length>0?t.thinkingLevels.map(e=>({id:e.id,name:e.name,tokens:e.tokens,isCustom:e.isCustom})):n,permissionMode:t?.permissionMode||"default"}}}(t.params.value);else if("paramsJson"===t.params.case){s="paramsJson";try{n=JSON.parse((new TextDecoder).decode(t.params.value))}catch{n={}}}else s=void 0,n={};return{callId:t.callId,method:t.method,params:n,paramsCase:s}}function $a(e){switch(e){case Ur.SESSION_CMD_SWITCH:return"switch";case Ur.SESSION_CMD_CREATE:return"create";case Ur.SESSION_CMD_CLOSE:return"close";case Ur.SESSION_CMD_RENAME:return"rename";case Ur.SESSION_CMD_TOGGLE_HISTORY:return"toggleHistory";case Ur.SESSION_CMD_SET_LOCALE:return"setLocale";case Ur.SESSION_CMD_DELETE:return"delete";case Ur.SESSION_CMD_RESET:return"reset";default:return"unspecified"}}function Ua(e,t,n,s,o){const i=Xn(Tr,{callId:e,success:n,error:o});if(n&&void 0!==s)if("AskUserQuestion"===t)i.result={case:"askUserQuestion",value:Xn(vr,{answers:s.map(e=>Xn(yr,{question:e.question,header:e.header,answer:e.answer}))})};else if("RequestPermission"===t){const e=s;i.result={case:"requestPermission",value:Xn(wr,{approved:e.approved,permissionUpdates:e.permissionUpdates?.map(Wa)||[],denyReason:e.denyReason})}}else i.result={case:"resultJson",value:(new TextEncoder).encode(JSON.stringify(s))};return Vi(Tr,i)}function Va(e){return{type:Ga(e.type),rules:e.rules?.map(e=>({toolName:e.toolName,ruleContent:e.ruleContent})),behavior:e.behavior?Ha(e.behavior):void 0,mode:e.mode?Ma(e.mode):void 0,directories:e.directories,destination:e.destination?ja(e.destination):void 0}}function Wa(e){return Xn(kr,{type:za(e.type),rules:e.rules?.map(e=>Xn(br,{toolName:e.toolName,ruleContent:e.ruleContent}))||[],behavior:e.behavior?Ka(e.behavior):void 0,mode:e.mode?Na(e.mode):void 0,directories:e.directories||[],destination:e.destination?Ya(e.destination):void 0})}function Ga(e){switch(e){case Pr.ADD_RULES:return"addRules";case Pr.REPLACE_RULES:return"replaceRules";case Pr.REMOVE_RULES:return"removeRules";case Pr.SET_MODE:return"setMode";case Pr.ADD_DIRECTORIES:return"addDirectories";case Pr.REMOVE_DIRECTORIES:return"removeDirectories";default:return"addRules"}}function za(e){switch(e){case"addRules":return Pr.ADD_RULES;case"replaceRules":return Pr.REPLACE_RULES;case"removeRules":return Pr.REMOVE_RULES;case"setMode":return Pr.SET_MODE;case"addDirectories":return Pr.ADD_DIRECTORIES;case"removeDirectories":return Pr.REMOVE_DIRECTORIES;default:return Pr.UNSPECIFIED}}function Ha(e){switch(e){case Fr.ALLOW:return"allow";case Fr.DENY:return"deny";case Fr.ASK:default:return"ask"}}function Ka(e){switch(e){case"allow":return Fr.ALLOW;case"deny":return Fr.DENY;case"ask":return Fr.ASK;default:return Fr.UNSPECIFIED}}function ja(e){switch(e){case $r.USER_SETTINGS:return"userSettings";case $r.PROJECT_SETTINGS:return"projectSettings";case $r.LOCAL_SETTINGS:return"localSettings";case $r.SESSION:default:return"session"}}function Ya(e){switch(e){case"userSettings":return $r.USER_SETTINGS;case"projectSettings":return $r.PROJECT_SETTINGS;case"localSettings":return $r.LOCAL_SETTINGS;case"session":return $r.SESSION;default:return $r.UNSPECIFIED}}function Za(){if("undefined"==typeof window)return"http://localhost:8765";const e=window;return e.__serverUrl?e.__serverUrl:window.location.origin}const Xa=new class{async getHistorySessions(e=50,t=0){try{console.log(`ðŸ“‹ [HTTP] èŽ·å–åŽ†å²ä¼šè¯åˆ—è¡¨ (offset=${t}, maxResults=${e})`);const n=`${Za()}/api/history/sessions?offset=${t}&maxResults=${e}`,s=await fetch(n);if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const o=await s.json();return console.log("ðŸ“‹ [HTTP] åŽç«¯è¿”å›žçš„åŽ†å²ä¼šè¯åŽŸå§‹æ•°æ®:",JSON.stringify(o,null,2)),o.sessions||[]}catch(n){return console.warn("[aiAgentService] èŽ·å–åŽ†å²ä¼šè¯åˆ—è¡¨å¤±è´¥:",n),[]}}async loadHistory(e){console.log("ðŸ“œ [AiAgentService] åŠ è½½åŽ†å² (HTTP protobuf):",e);const t=`${Za()}/api/history/load.pb`,n=Ia.encodeLoadHistoryRequest({sessionId:e.sessionId,projectPath:e.projectPath,offset:e.offset,limit:e.limit}),s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/octet-stream"},body:n});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const o=new Uint8Array(await s.arrayBuffer());return Ia.decodeHistoryResult(o)}async loadSubagentHistory(e,t){console.log("ðŸ”„ [AiAgentService] åŠ è½½å­ä»£ç†åŽ†å²:",{agentId:e,projectPath:t});return(await this.loadHistory({sessionId:`agent-${e}`,projectPath:t})).messages}async deleteHistorySession(e){try{console.log(`ðŸ—‘ï¸ [HTTP] åˆ é™¤åŽ†å²ä¼šè¯: ${e}`);const t=`${Za()}/api/history/sessions/${encodeURIComponent(e)}`,n=await fetch(t,{method:"DELETE"});if(!n.ok){const e=await n.json().catch(()=>({}));throw new Error(e.error||`HTTP ${n.status}: ${n.statusText}`)}const s=await n.json();return console.log("ðŸ—‘ï¸ [HTTP] åˆ é™¤ç»“æžœ:",s),s}catch(t){return console.error("[aiAgentService] åˆ é™¤åŽ†å²ä¼šè¯å¤±è´¥:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}async getHistoryMetadata(e){console.log("ðŸ“Š [AiAgentService] èŽ·å–åŽ†å²å…ƒæ•°æ® (HTTP protobuf):",e);const t=`${Za()}/api/history/metadata.pb`,n=Ia.encodeGetHistoryMetadataRequest({sessionId:e.sessionId,projectPath:e.projectPath}),s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/octet-stream"},body:n});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const o=new Uint8Array(await s.arrayBuffer()),i=Ia.decodeHistoryMetadata(o);return{totalLines:i.totalLines,sessionId:i.sessionId,projectPath:i.projectPath,customTitle:i.customTitle}}async truncateHistory(e,t){if(console.log("âœ‚ï¸ [AiAgentService] æˆªæ–­åŽ†å²:",t),!e.isConnected)throw new Error("RSocket è¿žæŽ¥æœªå»ºç«‹");return await e.truncateHistory(t)}async hasIdeEnvironment(){try{const e=`${Za()}/api/`,t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"ide.hasIdeEnvironment"})});if(!t.ok)return console.warn("[aiAgentService] hasIdeEnvironment è¯·æ±‚å¤±è´¥:",t.status),!1;const n=await t.json(),s=n.data?.hasIde??!1;return console.log("ðŸ–¥ï¸ [aiAgentService] hasIdeEnvironment:",s),s}catch(e){return console.warn("[aiAgentService] hasIdeEnvironment è¯·æ±‚å¼‚å¸¸:",e),!1}}},Ja=1;function Qa(e,t){return!(e<Ja)}function qa(e,t){const n=[];return e&&n.push(`[${e}]`),n.push(t),n.join(" ")}function el(e){return{debug(t,...n){Qa(0)&&console.debug(qa(e,t),...n)},info(t,...n){Qa(1)&&console.info(qa(e,t),...n)},warn(t,...n){Qa(2)&&console.warn(qa(e,t),...n)},error(t,...n){Qa(3)&&console.error(qa(e,t),...n)}}}const tl={session:el("SessionStore"),agent:el("AiAgentService")},nl=tl.agent;function sl(e){const t=tn.Buffer.from(e,"utf-8"),n=tn.Buffer.alloc(1+t.length);return n[0]=t.length,t.copy(n,1),n}function ol(e,t){return{data:t?tn.Buffer.from(t):void 0,metadata:sl(e)}}class il{constructor(e){De(this,"rsocket",null),De(this,"options"),De(this,"serverCallHandlers",new Map),De(this,"directRouteHandlers",new Map),De(this,"disconnectHandlers",new Set),this.options={connectTimeout:3e4,keepAliveInterval:3e4,keepAliveTimeout:9e4,requestTimeout:35e3,...e}}registerHandler(e,t){return nl.info(`[RSocketClient] æ³¨å†Œ Protobuf handler: ${e}`),this.serverCallHandlers.set(e,t),()=>{this.serverCallHandlers.delete(e),nl.info(`[RSocketClient] å–æ¶ˆæ³¨å†Œ Protobuf handler: ${e}`)}}registerDirectRouteHandler(e,t){return nl.info(`[RSocketClient] æ³¨å†Œç›´æŽ¥è·¯ç”± handler: ${e}`),this.directRouteHandlers.set(e,t),()=>{this.directRouteHandlers.delete(e),nl.info(`[RSocketClient] å–æ¶ˆæ³¨å†Œç›´æŽ¥è·¯ç”± handler: ${e}`)}}onDisconnect(e){return this.disconnectHandlers.add(e),()=>{this.disconnectHandlers.delete(e)}}handleConnectionClosed(e){nl.info("[RSocketClient] è¿žæŽ¥å·²å…³é—­",e?`åŽŸå› : ${e.message}`:"(æ­£å¸¸å…³é—­)"),this.rsocket=null,this.disconnectHandlers.forEach(t=>{try{t(e)}catch(n){nl.error("[RSocketClient] æ–­å¼€å›žè°ƒæ‰§è¡Œå¤±è´¥:",n)}})}async connect(){nl.info(`[RSocketClient] è¿žæŽ¥åˆ°: ${this.options.url}`);const e=this.createResponder(),t=new Xt.RSocketConnector({setup:{keepAlive:this.options.keepAliveInterval,lifetime:this.options.keepAliveTimeout,dataMimeType:"application/x-protobuf",metadataMimeType:"message/x.rsocket.routing.v0"},transport:new Jt.WebsocketClientTransport({url:this.options.url,wsCreator:e=>new WebSocket(e)}),responder:e});try{this.rsocket=await t.connect(),nl.info("[RSocketClient] è¿žæŽ¥æˆåŠŸ"),this.rsocket.onClose(e=>{this.handleConnectionClosed(e)})}catch(n){throw nl.error("[RSocketClient] è¿žæŽ¥å¤±è´¥:",n),n}}createResponder(){return{requestResponse:(e,t)=>(this.handleServerCall(e).then(e=>{t.onNext(e,!0),t.onComplete()}).catch(e=>{t.onError(e)}),{cancel:()=>{nl.debug("[RSocketClient] æœåŠ¡ç«¯è¯·æ±‚è¢«å–æ¶ˆ")},onExtension:()=>{}}),fireAndForget:(e,t)=>(this.handleServerCall(e).then(()=>{t.onComplete()}).catch(e=>{nl.error("[RSocketClient] fireAndForget å¤„ç†å¤±è´¥:",e),t.onError(e)}),{cancel:()=>{nl.debug("[RSocketClient] fireAndForget è¯·æ±‚è¢«å–æ¶ˆ")},onExtension:()=>{}})}}async handleServerCall(e){const t=function(e){if(!e.metadata)throw new Error("Missing metadata");const t=new Uint8Array(e.metadata);if(0===t.length)throw new Error("Empty metadata");const n=t[0];return(new TextDecoder).decode(t.slice(1,1+n))}(e);nl.info(`[RSocketClient] æ”¶åˆ°æœåŠ¡ç«¯è¯·æ±‚: route=${t}`);const n=e.data?new Uint8Array(e.data):new Uint8Array;if("client.call"===t)return this.handleProtobufServerCall(n);const s=this.directRouteHandlers.get(t);if(s)return this.handleDirectRouteCall(t,n,s);throw nl.warn(`[RSocketClient] æœªæ‰¾åˆ°è·¯ç”±å¤„ç†å™¨: ${t}`),new Error(`Unsupported route: ${t}. Register a handler using registerDirectRouteHandler().`)}async handleDirectRouteCall(e,t,n){try{return nl.info(`[RSocketClient] å¤„ç†ç›´æŽ¥è·¯ç”±: ${e}`),await n(t),nl.info(`[RSocketClient] ç›´æŽ¥è·¯ç”±å¤„ç†æˆåŠŸ: ${e}`),{data:void 0}}catch(s){const t=s instanceof Error?s.message:String(s);throw nl.error(`[RSocketClient] ç›´æŽ¥è·¯ç”±å¤„ç†å¤±è´¥: ${e}, error=${t}`),s}}async handleProtobufServerCall(e){let t;try{t=Pa(e),nl.info(`[RSocketClient] Protobuf ServerCall: method=${t.method}, callId=${t.callId}`)}catch(r){throw nl.error("[RSocketClient] è§£ç  ServerCallRequest å¤±è´¥:",r),new Error("Failed to decode ServerCallRequest")}const{callId:n,method:s,params:o}=t,i=this.serverCallHandlers.get(s);if(!i){nl.warn(`[RSocketClient] Handler not found: ${s}`);const e=Ua(n,s,!1,void 0,`Handler not found: ${s}`);return{data:tn.Buffer.from(e)}}try{const e=await i(o);nl.info(`[RSocketClient] Protobuf ServerCall æˆåŠŸ: method=${s}, callId=${n}`);const t=Ua(n,s,!0,e);return{data:tn.Buffer.from(t)}}catch(r){const e=r instanceof Error?r.message:String(r);nl.error(`[RSocketClient] Protobuf ServerCall å¤±è´¥: method=${s}, error=${e}`);const t=Ua(n,s,!1,void 0,e);return{data:tn.Buffer.from(t)}}}disconnect(){this.rsocket&&(nl.info("[RSocketClient] ä¸»åŠ¨æ–­å¼€è¿žæŽ¥"),this.rsocket.close())}get isConnected(){return null!==this.rsocket}async requestResponse(e,t,n){if(!this.rsocket)throw new Error("RSocket æœªè¿žæŽ¥");const s=n??this.options.requestTimeout;return nl.debug(`[RSocketClient] â† requestResponse: ${e}`,t?`(${t.length} bytes)`:"",`timeout=${s}ms`),new Promise((n,o)=>{const i=ol(e,t);let r=!1,a=null;s>0&&(a=setTimeout(()=>{if(!r){r=!0;const t=new Error(`è¯·æ±‚è¶…æ—¶ (${s}ms): ${e}`);nl.error(`[RSocketClient] â†’ requestResponse è¶…æ—¶ (${e})`),o(t)}},s)),this.rsocket.requestResponse(i,{onError:t=>{r||(r=!0,a&&clearTimeout(a),nl.error(`[RSocketClient] â†’ requestResponse é”™è¯¯ (${e}):`,t),o(t))},onNext:(e,t)=>{if(!r){r=!0,a&&clearTimeout(a);const t=e.data?new Uint8Array(e.data):new Uint8Array;n(t)}},onComplete:()=>{},onExtension:()=>{}})})}requestStream(e,t,n){if(!this.rsocket)return n.onError(new Error("RSocket æœªè¿žæŽ¥")),()=>{};nl.debug(`[RSocketClient] â† requestStream: ${e}`,t?`(${t.length} bytes)`:"");const s=ol(e,t);let o=!1,i=0;const r=this.rsocket.requestStream(s,2147483647,{onError:t=>{o||(nl.error(`[RSocketClient] â†’ requestStream é”™è¯¯ (${e}):`,t),n.onError(t))},onNext:(e,t)=>{if(!o&&e.data){const t=new Uint8Array(e.data);i++,n.onNext(t)}},onComplete:()=>{o||(nl.debug(`[RSocketClient] â†’ requestStream å®Œæˆ (${e}), å…± ${i} æ¡æ¶ˆæ¯`),n.onComplete())},onExtension:()=>{}});return()=>{o=!0,r.cancel(),nl.debug(`[RSocketClient] requestStream å·²å–æ¶ˆ (${e})`)}}}const rl=65537,al=65540,ll=65541;function cl(e){if(e&&"object"==typeof e&&"code"in e&&"message"in e){const t=e.code,n=e.message;switch(t){case al:return`Node.js æœªæ‰¾åˆ°\n\n${n}\n\nè¯·åœ¨ Settings > Claude Code > Node.js path ä¸­é…ç½®æ­£ç¡®çš„è·¯å¾„ã€‚`;case ll:return`Claude CLI æœªæ‰¾åˆ°\n\n${n}\n\nè¯·è¿è¡Œ npm install -g @anthropic-ai/claude-code å®‰è£…ã€‚`;case rl:return`è¿žæŽ¥å·²æ–­å¼€: ${n}`;default:return n}}return String(e)}const ul=tl.agent;class dl{constructor(e){De(this,"client",null),De(this,"_isConnected",!1),De(this,"sessionId",null),De(this,"_capabilities",null),De(this,"messageHandlers",new Set),De(this,"errorHandlers",new Set),De(this,"_cancelStream",null),De(this,"wsUrl"),De(this,"pendingHandlers",new Map),De(this,"disconnectHandlers",new Set),De(this,"unsubscribeClientDisconnect",null),this.wsUrl=e?e.replace(/^http/,"ws"):function(){if("undefined"==typeof window)return"ws://localhost:8765";const e=window;if(e.__serverUrl){const t=new URL(e.__serverUrl);return`${"https:"===t.protocol?"wss:":"ws:"}//${t.host}`}const{protocol:t,host:n}=window.location;return`${"https:"===t?"wss:":"ws:"}//${n}`}(),ul.debug(`[RSocketSession] WebSocket URL: ${this.wsUrl}`)}get isConnected(){return this._isConnected}get currentSessionId(){return this.sessionId}get capabilities(){return this._capabilities}async connect(e){console.log("[RSocket] â† agent.connect å‘é€:",JSON.stringify(e,null,2)),this.client=function(e){const t=e.endsWith("/rsocket")?e:`${e}/rsocket`;return new il({url:t})}(this.wsUrl);try{await this.client.connect(),this.unsubscribeClientDisconnect=this.client.onDisconnect(e=>{this.handleConnectionLost(e)});const t=Ia.encodeConnectOptions(e),n=await this.client.requestResponse("agent.connect",t),s=Ia.decodeConnectResult(n);console.log("[RSocket] â†’ agent.connect ç»“æžœ:",JSON.stringify(s,null,2)),this.sessionId=s.sessionId,this._capabilities=s.capabilities||null,this._isConnected=!0;for(const[e,o]of this.pendingHandlers)ul.info(`[RSocketSession] æ³¨å†Œç­‰å¾…ä¸­çš„ handler: ${e}`),this.client.registerHandler(e,o);return this.pendingHandlers.clear(),ul.info(`[RSocketSession] ä¼šè¯å·²è¿žæŽ¥: ${this.sessionId}`),this.sessionId}catch(t){throw ul.error("[RSocketSession] è¿žæŽ¥å¤±è´¥:",t),this.handleError(t),t}}async sendMessage(e){if(!this._isConnected||!this.client)throw new Error("Session not connected");console.log("[RSocket] â† agent.query å‘é€:",JSON.stringify({message:e},null,2));const t=Ia.encodeQueryRequest(e);this._cancelStream=this.client.requestStream("agent.query",t,{onNext:e=>{try{const t=Ia.decodeRpcMessage(e);"stream_event"!==t.type&&console.log("[RSocket] â†’ agent.query æ¶ˆæ¯:",JSON.stringify(t,null,2)),this.notifyMessageHandlers(t)}catch(t){ul.error("[RSocketSession] è§£æžæ¶ˆæ¯å¤±è´¥:",t)}},onError:e=>{ul.error("[RSocketSession] æµé”™è¯¯:",e),this.handleError(e)},onComplete:()=>{ul.debug("[RSocketSession] æµå®Œæˆ (åè®®å±‚ä¿¡å·)"),this._cancelStream=null}})}async sendMessageWithContent(e){if(!this._isConnected||!this.client)throw new Error("Session not connected");console.log("[RSocket] â† agent.queryWithContent å‘é€:",JSON.stringify({content:e},null,2));const t=Ia.encodeQueryWithContentRequest(e);this._cancelStream=this.client.requestStream("agent.queryWithContent",t,{onNext:e=>{try{const t=Ia.decodeRpcMessage(e);"stream_event"!==t.type&&console.log("[RSocket] â†’ agent.queryWithContent æ¶ˆæ¯:",JSON.stringify(t,null,2)),this.notifyMessageHandlers(t)}catch(t){ul.error("[RSocketSession] è§£æžæ¶ˆæ¯å¤±è´¥:",t)}},onError:e=>{ul.error("[RSocketSession] æµé”™è¯¯:",e),this.handleError(e)},onComplete:()=>{ul.debug("[RSocketSession] æµå®Œæˆ"),this._cancelStream=null}})}async interrupt(){if(!this._isConnected||!this.client)throw new Error("Session not connected");ul.info("[RSocketSession] ä¸­æ–­è¯·æ±‚");try{const e=await this.client.requestResponse("agent.interrupt",void 0,3e3),t=Ia.decodeStatusResult(e);ul.info(`[RSocketSession] ä¸­æ–­è¯·æ±‚å·²ç¡®è®¤: ${t.status}`)}catch(e){ul.warn("[RSocketSession] Interrupt request failed:",e);const t=e instanceof Error?e:new Error(String(e));this.handleConnectionLost(t)}}async runInBackground(){if(!this._isConnected||!this.client)throw new Error("Session not connected");this.checkCapability("canRunInBackground","runInBackground"),ul.info("[RSocketSession] åŽå°è¿è¡Œè¯·æ±‚");try{const e=await this.client.requestResponse("agent.runInBackground"),t=Ia.decodeStatusResult(e);ul.info(`[RSocketSession] åŽå°è¿è¡Œè¯·æ±‚å·²ç¡®è®¤: ${t.status}`)}catch(e){throw ul.warn("[RSocketSession] Run in background request failed:",e),e}}async setMaxThinkingTokens(e){if(!this._isConnected||!this.client)throw new Error("Session not connected");this.checkCapability("canThink","setMaxThinkingTokens"),console.log("[RSocket] â† agent.setMaxThinkingTokens å‘é€:",JSON.stringify({maxThinkingTokens:e},null,2));try{const t=Ia.encodeSetMaxThinkingTokensRequest(e),n=await this.client.requestResponse("agent.setMaxThinkingTokens",t),s=Ia.decodeSetMaxThinkingTokensResult(n);console.log("[RSocket] â†’ agent.setMaxThinkingTokens ç»“æžœ:",JSON.stringify(s,null,2))}catch(t){throw ul.warn("[RSocketSession] Set max thinking tokens request failed:",t),t}}disconnect(){this._isConnected&&this.client&&(this.unsubscribeClientDisconnect&&(this.unsubscribeClientDisconnect(),this.unsubscribeClientDisconnect=null),this.client.disconnect(),this.client=null,this._isConnected=!1,this.sessionId=null,ul.info("[RSocketSession] å·²æ–­å¼€è¿žæŽ¥"))}async reconnectSession(e){if(!this.client?.isConnected)throw new Error("RSocket æœªè¿žæŽ¥ï¼Œæ— æ³•é‡è¿žä¼šè¯");ul.info("[RSocketSession] reconnectSession: é‡è¿žä¼šè¯"),await this.client.requestResponse("agent.disconnect"),this.sessionId=null;const t=Ia.encodeConnectOptions(e),n=await this.client.requestResponse("agent.connect",t),s=Ia.decodeConnectResult(n);return this.sessionId=s.sessionId,this._capabilities=s.capabilities||null,this._isConnected=!0,ul.info(`[RSocketSession] ä¼šè¯å·²é‡è¿ž: ${this.sessionId}`),this.sessionId}async setModel(e){if(!this._isConnected||!this.client)throw new Error("Session not connected");console.log("[RSocket] â† agent.setModel å‘é€:",JSON.stringify({model:e},null,2));const t=Ia.encodeSetModelRequest(e);await this.client.requestResponse("agent.setModel",t),console.log("[RSocket] â†’ agent.setModel ç»“æžœ: OK")}async setPermissionMode(e){if(!this._isConnected||!this.client)throw new Error("Session not connected");this.checkCapability("canSwitchPermissionMode","setPermissionMode"),console.log("[RSocket] â† agent.setPermissionMode å‘é€:",JSON.stringify({mode:e},null,2));const t=Ia.encodeSetPermissionModeRequest(e),n=await this.client.requestResponse("agent.setPermissionMode",t),s=Ia.decodeSetPermissionModeResult(n);return console.log("[RSocket] â†’ agent.setPermissionMode ç»“æžœ:",JSON.stringify(s,null,2)),s}async getHistory(){if(!this._isConnected||!this.client)throw new Error("Session not connected");console.log("[RSocket] â† agent.getHistory å‘é€");const e=await this.client.requestResponse("agent.getHistory"),t=Ia.decodeHistory(e);return console.log("[RSocket] â†’ agent.getHistory ç»“æžœ:",JSON.stringify(t,null,2)),t.messages}async truncateHistory(e){if(!this._isConnected||!this.client)throw new Error("Session not connected");console.log("[RSocket] â† agent.truncateHistory å‘é€:",JSON.stringify(e,null,2));const t=Ia.encodeTruncateHistoryRequest(e),n=await this.client.requestResponse("agent.truncateHistory",t),s=Ia.decodeTruncateHistoryResult(n);return console.log("[RSocket] â†’ agent.truncateHistory ç»“æžœ:",JSON.stringify(s,null,2)),s}async getMcpStatus(){if(!this._isConnected||!this.client)throw new Error("Session not connected");console.log("[RSocket] â† agent.getMcpStatus å‘é€");const e=await this.client.requestResponse("agent.getMcpStatus",new Uint8Array),t=Ia.decodeMcpStatusResult(e);return console.log("[RSocket] â†’ agent.getMcpStatus ç»“æžœ:",JSON.stringify(t,null,2)),t}async reconnectMcp(e){if(!this._isConnected||!this.client)throw new Error("Session not connected");console.log("[RSocket] â† agent.reconnectMcp å‘é€:",e);const t=Ia.encodeReconnectMcpRequest(e),n=await this.client.requestResponse("agent.reconnectMcp",t),s=Ia.decodeReconnectMcpResult(n);return console.log("[RSocket] â†’ agent.reconnectMcp ç»“æžœ:",JSON.stringify(s,null,2)),s}async getMcpTools(e){if(!this._isConnected||!this.client)throw new Error("Session not connected");console.log("[RSocket] â† agent.getMcpTools å‘é€:",e||"(all)");const t=Ia.encodeGetMcpToolsRequest(e),n=await this.client.requestResponse("agent.getMcpTools",t),s=Ia.decodeGetMcpToolsResult(n);return console.log("[RSocket] â†’ agent.getMcpTools ç»“æžœ:",s.count,"tools"),s}onMessage(e){return this.messageHandlers.add(e),()=>this.messageHandlers.delete(e)}onError(e){return this.errorHandlers.add(e),()=>this.errorHandlers.delete(e)}onDisconnect(e){return this.disconnectHandlers.add(e),()=>{this.disconnectHandlers.delete(e)}}register(e,t){return this.client?(ul.info(`[RSocketSession] register: ${e}`),this.client.registerHandler(e,t)):(ul.warn(`[RSocketSession] register: å®¢æˆ·ç«¯æœªè¿žæŽ¥ï¼Œhandler å°†åœ¨è¿žæŽ¥åŽç”Ÿæ•ˆ (method=${e})`),this.pendingHandlers.set(e,t),()=>{this.pendingHandlers.delete(e)})}handleConnectionLost(e){ul.warn("[RSocketSession] è¿žæŽ¥ä¸¢å¤±",e?`åŽŸå› : ${e.message}`:""),this._isConnected=!1,this._capabilities=null,this._cancelStream=null,this.client=null,this.pendingHandlers.clear(),this.unsubscribeClientDisconnect&&(this.unsubscribeClientDisconnect(),this.unsubscribeClientDisconnect=null),this.disconnectHandlers.forEach(t=>{try{t(e)}catch(n){ul.error("[RSocketSession] æ–­å¼€å›žè°ƒæ‰§è¡Œå¤±è´¥:",n)}}),this.sessionId=null}checkCapability(e,t){if(!this._capabilities)throw new Error(`${t}: èƒ½åŠ›ä¿¡æ¯æœªåŠ è½½ï¼Œè¯·å…ˆè°ƒç”¨ connect()`);if(!this._capabilities[e])throw new Error(`${t}: å½“å‰ provider ä¸æ”¯æŒæ­¤æ“ä½œ`)}notifyMessageHandlers(e){this.messageHandlers.forEach(t=>{try{t(e)}catch(n){ul.error("[RSocketSession] æ¶ˆæ¯å¤„ç†å™¨æ‰§è¡Œå¤±è´¥:",n)}})}handleError(e){if(function(e){if(e&&"object"==typeof e&&"code"in e)return e.code===al;return!1}(e)){const t=cl(e);return ul.error("[RSocketSession] Node.js æœªæ‰¾åˆ°:",t),void this.errorHandlers.forEach(n=>{try{n(Object.assign(new Error(t),{code:e.code,type:"NODE_NOT_FOUND"}))}catch(s){ul.error("[RSocketSession] é”™è¯¯å¤„ç†å™¨æ‰§è¡Œå¤±è´¥:",s)}})}if(function(e){if(e&&"object"==typeof e&&"code"in e)return e.code===ll;return!1}(e)){const t=cl(e);return ul.error("[RSocketSession] Claude CLI æœªæ‰¾åˆ°:",t),void this.errorHandlers.forEach(n=>{try{n(Object.assign(new Error(t),{code:e.code,type:"CLI_NOT_FOUND"}))}catch(s){ul.error("[RSocketSession] é”™è¯¯å¤„ç†å™¨æ‰§è¡Œå¤±è´¥:",s)}})}if(function(e){if(e&&"object"==typeof e&&"code"in e)return e.code===rl;return!1}(e))return ul.warn("[RSocketSession] æ£€æµ‹åˆ°éœ€è¦é‡è¿žçš„é”™è¯¯ï¼Œè§¦å‘æ–­å¼€æµç¨‹:",e.message),void this.handleConnectionLost(e);this.errorHandlers.forEach(t=>{try{t(e)}catch(n){ul.error("[RSocketSession] é”™è¯¯å¤„ç†å™¨æ‰§è¡Œå¤±è´¥:",n)}})}}var pl=(e=>(e.RUNNING="RUNNING",e.SUCCESS="SUCCESS",e.FAILED="FAILED",e))(pl||{}),hl=(e=>(e.DISCONNECTED="DISCONNECTED",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.ERROR="ERROR",e))(hl||{});function fl(e){return"userMessage"===e.displayType}const ml="claude",gl="codex";function yl(e){return"codex"===e.type}const vl={type:"claude",modelId:"claude-sonnet-4-5-20251101",permissionMode:"default",skipPermissions:!1,maxTurns:10,thinkingEnabled:!0,thinkingTokenBudget:8096,includePartialMessages:!0},bl={type:"codex",modelId:"gpt-5.1-codex-max",modelProvider:"openai",permissionMode:"default",skipPermissions:!1,maxTurns:10,reasoningEffort:"medium",reasoningSummary:"auto",sandboxMode:"workspace-write"};const kl={OFF:{id:"off",label:"Off",tokens:0},LOW:{id:"low",label:"Low (1K)",tokens:1024},MEDIUM:{id:"medium",label:"Medium (4K)",tokens:4096},HIGH:{id:"high",label:"High (8K)",tokens:8096},VERY_HIGH:{id:"very_high",label:"Very High (16K)",tokens:16384},ULTRA:{id:"ultra",label:"Ultra (32K)",tokens:32768}};const wl={OFF:{id:null,label:"Off",description:"Disable reasoning"},MINIMAL:{id:"minimal",label:"Minimal",description:"Very brief reasoning"},LOW:{id:"low",label:"Low",description:"Quick reasoning"},MEDIUM:{id:"medium",label:"Medium",description:"Balanced reasoning (default)"},HIGH:{id:"high",label:"High",description:"Detailed reasoning"},XHIGH:{id:"xhigh",label:"Extra High",description:"Most thorough reasoning"}};function Sl(){return Object.values(wl)}const Cl={AUTO:{id:"auto",label:"Auto",description:"Automatic summary"},CONCISE:{id:"concise",label:"Concise",description:"Brief summary"},DETAILED:{id:"detailed",label:"Detailed",description:"Full summary"},NONE:{id:"none",label:"None",description:"No summary"}};function Tl(e){return"claude"===e.type}function El(e){return"codex"===e.type}class Il{constructor(e,t){De(this,"eventCallbacks",new Set),De(this,"statusCallbacks",new Set),De(this,"state"),this.state={connectionStatus:"disconnected",sessionId:null,isGenerating:!1,lastError:null,backendType:e,config:t}}isConnected(){return"connected"===this.state.connectionStatus}async runInBackground(){}getState(){return{...this.state}}getBackendType(){return this.state.backendType}getSessionId(){return this.state.sessionId}onEvent(e){return this.eventCallbacks.add(e),()=>{this.eventCallbacks.delete(e)}}onConnectionStatusChange(e){return this.statusCallbacks.add(e),()=>{this.statusCallbacks.delete(e)}}emitEvent(e){for(const n of this.eventCallbacks)try{n(e)}catch(t){console.error("[BackendSession] Error in event callback:",t)}}setConnectionStatus(e){if(this.state.connectionStatus!==e){this.state.connectionStatus=e;for(const n of this.statusCallbacks)try{n(e)}catch(t){console.error("[BackendSession] Error in status callback:",t)}}}setGenerating(e){this.state.isGenerating=e}setSessionId(e){this.state.sessionId=e}setError(e){this.state.lastError=e}}const xl={type:"claude",displayName:"Claude",supportsThinking:!0,thinkingConfigType:"token_budget",supportsSubAgents:!1,supportsMcp:!0,supportsSandbox:!1,supportsPromptCaching:!0,exposesTokenUsage:!0,supportedTools:["read","write","edit","bash","mcp"],availableModels:[{id:"claude-sonnet-4-5-20251101",displayName:"Claude Sonnet 4.5",isDefault:!0,supportsThinking:!0,description:"Latest Claude Sonnet with extended thinking"},{id:"claude-opus-4-5-20251101",displayName:"Claude Opus 4.5",supportsThinking:!0,description:"Most capable Claude model"},{id:"claude-3-5-sonnet-20241022",displayName:"Claude 3.5 Sonnet",supportsThinking:!1,description:"Previous generation Claude"}]};const Al=class e extends Il{constructor(e){if(super("codex",e),De(this,"rpcIdCounter",1),De(this,"pendingRequests",new Map),De(this,"pendingApprovals",new Map),De(this,"backendUrl",null),De(this,"currentThreadId",null),De(this,"currentTurnId",null),De(this,"eventPollingInterval",null),!yl(e))throw new Error("CodexSession requires CodexBackendConfig")}async connect(e){this.setConnectionStatus("connecting");try{this.backendUrl=await this.getBackendUrl(),await this.sendRequest("initialize",{capabilities:{experimental_raw_events:!1}}),e.continueConversation&&e.resumeSessionId?await this.resumeThread(e.resumeSessionId,e.projectPath):await this.startThread(e.projectPath),this.setConnectionStatus("connected"),this.startEventPolling()}catch(t){throw this.setConnectionStatus("error"),this.setError(t instanceof Error?t.message:String(t)),t}}disconnect(){"disconnected"!==this.state.connectionStatus&&(this.stopEventPolling(),this.setConnectionStatus("disconnected"),this.setSessionId(null),this.currentThreadId=null,this.currentTurnId=null)}sendMessage(e){if(!this.isConnected()||!this.currentThreadId)throw new Error("Not connected to Codex session");if(this.state.isGenerating)throw new Error("Already generating a response");this.setGenerating(!0),this.startTurn(e).catch(e=>{this.setGenerating(!1),this.emitEvent({type:"error",sessionId:this.currentThreadId,timestamp:Date.now(),code:"TURN_START_FAILED",message:e instanceof Error?e.message:String(e)})})}async interrupt(){if(this.currentThreadId&&this.currentTurnId)try{await this.sendRequest("turn/interrupt",{threadId:this.currentThreadId,turnId:this.currentTurnId})}catch(e){throw console.error("[CodexSession] Failed to interrupt:",e),e}}respondToApproval(e){const t=Number(e.requestId),n=this.pendingApprovals.get(t);n?(n.resolve(e.approved?"Approved":"Declined"),this.pendingApprovals.delete(t)):console.warn("[CodexSession] No pending approval for requestId:",t)}async updateConfig(e){this.state.config={...this.state.config,...e},console.warn("[CodexSession] Config updated, reconnection may be needed")}async updateThinkingConfig(e){if(!yl(this.state.config))return;const t=this.mapThinkingToEffort(e);this.state.config={...this.state.config,reasoningEffort:t}}getCapabilities(){return e.CAPABILITIES}async loadHistory(e){try{const t=(await this.sendRequest("thread/list",{})).threads||[],n=e.sessionId?t.filter(t=>t.id===e.sessionId):t,s=e.offset||0,o=e.limit||50,i=s<0?Math.max(0,n.length+s):s;return{messages:n.slice(i,i+o),hasMore:i+o<n.length,totalCount:n.length}}catch(t){return console.error("[CodexSession] Failed to load history:",t),{messages:[],hasMore:!1,totalCount:0}}}async startThread(e){const t=this.state.config,n=(await this.sendRequest("thread/start",{model:t.modelId,modelProvider:t.modelProvider,cwd:e||process.cwd(),approvalPolicy:this.mapPermissionModeToApprovalPolicy(t.permissionMode),sandbox:t.sandboxMode,baseInstructions:t.systemPrompt||void 0,modelReasoningEffort:t.reasoningEffort||void 0})).thread;this.currentThreadId=n.id,this.setSessionId(n.id)}async resumeThread(e,t){const n=(await this.sendRequest("thread/resume",{threadId:e,cwd:t||process.cwd()})).thread;this.currentThreadId=n.id,this.setSessionId(n.id)}async startTurn(e){if(!this.currentThreadId)throw new Error("No active thread");const t=this.state.config,n=await this.sendRequest("turn/start",{threadId:this.currentThreadId,input:this.convertMessageToInput(e),effort:e.thinkingConfig?this.mapThinkingToEffort(e.thinkingConfig):t.reasoningEffort||void 0,summary:t.reasoningSummary||"auto"});this.currentTurnId=n.turnId}async getBackendUrl(){const e=await fetch("/api/codex/endpoint");return(await e.json()).url}async sendRequest(e,t){if(!this.backendUrl)throw new Error("Backend URL not set");const n=this.rpcIdCounter++,s={id:n,method:e,params:t};return new Promise((e,t)=>{this.pendingRequests.set(n,{resolve:e,reject:t}),fetch(`${this.backendUrl}/rpc`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(e=>e.json()).then(e=>{this.handleRpcResponse(e)}).catch(e=>{const t=this.pendingRequests.get(n);t&&(t.reject(e),this.pendingRequests.delete(n))}),setTimeout(()=>{const e=this.pendingRequests.get(n);e&&(e.reject(new Error("Request timeout")),this.pendingRequests.delete(n))},3e4)})}handleRpcResponse(e){const t=this.pendingRequests.get(e.id);t?(this.pendingRequests.delete(e.id),e.error?t.reject(new Error(`RPC Error ${e.error.code}: ${e.error.message}`)):t.resolve(e.result)):console.warn("[CodexSession] Unexpected RPC response:",e.id)}startEventPolling(){this.eventPollingInterval||(this.eventPollingInterval=window.setInterval(()=>{this.pollEvents()},100))}stopEventPolling(){this.eventPollingInterval&&(window.clearInterval(this.eventPollingInterval),this.eventPollingInterval=null)}async pollEvents(){if(this.backendUrl)try{const e=await fetch(`${this.backendUrl}/events`),t=await e.json();for(const n of t)"id"in n?this.handleServerRequest(n):this.handleNotification(n)}catch(e){console.error("[CodexSession] Event polling error:",e)}}handleNotification(e){const{method:t,params:n}=e,s=this.currentThreadId||"unknown",o=Date.now();switch(t){case"item/agentMessage/delta":this.emitEvent({type:"text_delta",sessionId:s,timestamp:o,itemId:n.itemId,text:n.textDelta});break;case"item/reasoning/summaryTextDelta":this.emitEvent({type:"thinking_delta",sessionId:s,timestamp:o,itemId:n.itemId,text:n.textDelta});break;case"item/started":{const e=n.item;"commandExecution"===e.type?this.emitEvent({type:"tool_started",sessionId:s,timestamp:o,itemId:e.id,toolType:"bash",toolName:"commandExecution",parameters:n}):"fileChange"===e.type?this.emitEvent({type:"tool_started",sessionId:s,timestamp:o,itemId:e.id,toolType:"edit",toolName:"fileChange",parameters:n}):"mcpToolCall"===e.type&&this.emitEvent({type:"tool_started",sessionId:s,timestamp:o,itemId:e.id,toolType:"mcp",toolName:"mcpToolCall",parameters:n});break}case"item/commandExecution/outputDelta":case"item/fileChange/outputDelta":this.emitEvent({type:"tool_output",sessionId:s,timestamp:o,itemId:n.itemId,output:n.outputDelta});break;case"item/completed":{const e=n.item;this.emitEvent({type:"tool_completed",sessionId:s,timestamp:o,itemId:e.id,success:"Completed"===e.status||"Applied"===e.status,result:n});break}case"turn/completed":this.setGenerating(!1),this.emitEvent({type:"turn_completed",sessionId:s,timestamp:o,turnId:n.turnId,status:this.mapTurnStatus(n.status)}),this.currentTurnId=null;break;case"error":this.emitEvent({type:"error",sessionId:s,timestamp:o,code:n.code,message:n.message,details:n.details});break;default:console.log("[CodexSession] Unhandled notification:",t)}}handleServerRequest(e){const{id:t,method:n,params:s}=e;switch(n){case"item/commandExecution/requestApproval":this.handleCommandApprovalRequest(t,s);break;case"item/fileChange/requestApproval":this.handleFileChangeApprovalRequest(t,s);break;default:console.warn("[CodexSession] Unhandled server request:",n),this.sendApprovalResponse(t,"Declined")}}handleCommandApprovalRequest(e,t){this.emitEvent({type:"approval_request",sessionId:this.currentThreadId||"unknown",timestamp:Date.now(),requestId:String(e),approvalType:"command",details:t}),new Promise((t,n)=>{this.pendingApprovals.set(e,{resolve:t,reject:n}),setTimeout(()=>{this.pendingApprovals.has(e)&&(this.pendingApprovals.delete(e),n(new Error("Approval timeout")))},3e5)}).then(t=>{this.sendApprovalResponse(e,t)}).catch(t=>{console.error("[CodexSession] Approval error:",t),this.sendApprovalResponse(e,"Declined")})}handleFileChangeApprovalRequest(e,t){this.emitEvent({type:"approval_request",sessionId:this.currentThreadId||"unknown",timestamp:Date.now(),requestId:String(e),approvalType:"file_change",details:t}),new Promise((t,n)=>{this.pendingApprovals.set(e,{resolve:t,reject:n}),setTimeout(()=>{this.pendingApprovals.has(e)&&(this.pendingApprovals.delete(e),n(new Error("Approval timeout")))},3e5)}).then(t=>{this.sendApprovalResponse(e,t)}).catch(t=>{console.error("[CodexSession] Approval error:",t),this.sendApprovalResponse(e,"Declined")})}async sendApprovalResponse(e,t){if(!this.backendUrl)return;const n={id:e,result:{decision:t}};try{await fetch(`${this.backendUrl}/rpc`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch(s){console.error("[CodexSession] Failed to send approval response:",s)}}convertMessageToInput(e){const t=[];for(const n of e.contents)if("text"===n.type)t.push({type:"text",text:n.text});else if("image"===n.type)t.push({type:"image",data:n.data,mimeType:n.mimeType});else if("file"===n.type){const e=n.content?`File: ${n.path}\n\`\`\`\n${n.content}\n\`\`\``:`File: ${n.path}`;t.push({type:"text",text:e})}if(e.contexts)for(const n of e.contexts){const e=n.content?`Context: ${n.path}\n\`\`\`\n${n.content}\n\`\`\``:`Context: ${n.path}`;t.push({type:"text",text:e})}return t}mapPermissionModeToApprovalPolicy(e){return"bypass"===e?"never":"on-request"}mapThinkingToEffort(e){if("codex"===e.type)return e.effort;if("claude"===e.type){if(!e.enabled)return null;const t=e.tokenBudget||8096;return t<2048?"minimal":t<8096?"low":t<16e3?"medium":t<32e3?"high":"xhigh"}return null}mapTurnStatus(e){switch(e){case"Completed":default:return"completed";case"Cancelled":return"interrupted";case"Error":return"error"}}};De(Al,"CAPABILITIES",{type:"codex",displayName:"OpenAI Codex",supportsThinking:!0,thinkingConfigType:"effort_level",supportsSubAgents:!1,supportsMcp:!0,supportsSandbox:!0,sandboxModes:["read-only","workspace-write","full-access"],supportsPromptCaching:!0,exposesTokenUsage:!1,supportedTools:["bash","write","edit","mcp"],availableModels:[{id:"gpt-5.1-codex-max",displayName:"GPT-5.1 Codex Max",isDefault:!0,supportsThinking:!1},{id:"o3",displayName:"O3",supportsThinking:!0,description:"Advanced reasoning model"},{id:"gpt-4o",displayName:"GPT-4o",supportsThinking:!1}]});let Nl=Al;const Ml={claude:class extends Il{constructor(e,t){if(super("claude",e),De(this,"rsocket",null),De(this,"config"),De(this,"wsUrl"),De(this,"currentTurnItems",new Map),De(this,"currentApprovalRequest",null),!function(e){return"claude"===e.type}(e))throw new Error("ClaudeSession requires ClaudeBackendConfig");this.config=e,this.wsUrl=t}async connect(e){this.setConnectionStatus("connecting");try{this.rsocket=new dl(this.wsUrl),this.rsocket.onMessage(this.handleRpcMessage.bind(this)),this.rsocket.onError(this.handleRpcError.bind(this)),this.rsocket.onDisconnect(this.handleRpcDisconnect.bind(this));const t=this.buildConnectOptions(e),n=await this.rsocket.connect(t);this.setSessionId(n),this.setConnectionStatus("connected"),this.setError(null)}catch(t){const e=t instanceof Error?t.message:String(t);throw this.setError(e),this.setConnectionStatus("error"),t}}disconnect(){this.rsocket&&(this.rsocket.disconnect(),this.rsocket=null),this.setConnectionStatus("disconnected"),this.setSessionId(null),this.currentTurnItems.clear(),this.currentApprovalRequest=null}sendMessage(e){if(!this.rsocket?.isConnected)throw new Error("Not connected to Claude backend");this.setGenerating(!0);const t=this.convertMessageContent(e.contents);e.thinkingConfig&&this.updateThinkingConfig(e.thinkingConfig).catch(e=>{console.error("[ClaudeSession] Failed to update thinking config:",e)}),1===t.length&&"text"===t[0].type?this.rsocket.sendMessage(t[0].text):this.rsocket.sendMessageWithContent(t)}async interrupt(){if(!this.rsocket?.isConnected)throw new Error("Not connected to Claude backend");await this.rsocket.interrupt(),this.setGenerating(!1)}async runInBackground(){if(!this.rsocket?.isConnected)throw new Error("Not connected to Claude backend");await this.rsocket.runInBackground(),this.setGenerating(!1)}respondToApproval(e){this.currentApprovalRequest===e.requestId&&console.warn("[ClaudeSession] Approval response not yet implemented:",e)}async updateConfig(e){if(!this.rsocket?.isConnected)throw new Error("Not connected to Claude backend");e.modelId&&e.modelId!==this.config.modelId&&(await this.rsocket.setModel(e.modelId),this.config.modelId=e.modelId),e.permissionMode&&e.permissionMode!==this.config.permissionMode&&(await this.rsocket.setPermissionMode(e.permissionMode),this.config.permissionMode=e.permissionMode);const t=e;if(void 0!==t.thinkingEnabled||void 0!==t.thinkingTokenBudget){const e=t.thinkingEnabled??this.config.thinkingEnabled,n=t.thinkingTokenBudget??this.config.thinkingTokenBudget;await this.rsocket.setMaxThinkingTokens(e?n:0),this.config.thinkingEnabled=e,this.config.thinkingTokenBudget=n}Object.assign(this.config,e),this.state.config=this.config}async updateThinkingConfig(e){if(!this.rsocket?.isConnected)throw new Error("Not connected to Claude backend");if("claude"===e.type){const t=e.enabled?e.tokenBudget||8096:0;await this.rsocket.setMaxThinkingTokens(t),this.config.thinkingEnabled=e.enabled,this.config.thinkingTokenBudget=t}else{const t={minimal:1024,low:4096,medium:8096,high:16384,xhigh:32768},n=e.effort,s=n?t[n]||8096:0;await this.rsocket.setMaxThinkingTokens(s),this.config.thinkingEnabled=null!==n,this.config.thinkingTokenBudget=s}}getCapabilities(){return xl}async loadHistory(e){if(!this.rsocket?.isConnected)throw new Error("Not connected to Claude backend");const t=await this.rsocket.getHistory();return{messages:t,hasMore:!1,totalCount:t.length}}buildConnectOptions(e){return{provider:"claude",model:this.config.modelId,systemPrompt:this.config.systemPrompt||void 0,permissionMode:this.config.permissionMode,dangerouslySkipPermissions:this.config.skipPermissions,includePartialMessages:this.config.includePartialMessages,continueConversation:e.continueConversation,resumeSessionId:e.resumeSessionId,thinkingEnabled:this.config.thinkingEnabled,metadata:e.projectPath?{projectPath:e.projectPath}:void 0}}convertMessageContent(e){return e.map(e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":return{type:"image",source:{type:"base64",media_type:e.mimeType||"image/png",data:e.data}};case"file":return{type:"text",text:`[File: ${e.path}${e.startLine?`:${e.startLine}`:""}]${e.content?`\n${e.content}`:""}`};default:throw new Error(`Unsupported content type: ${e.type}`)}})}handleRpcMessage(e){const t=this.getSessionId()||"unknown",n=Date.now();switch(e.type){case"stream_event":this.handleStreamEvent(e,t,n);break;case"result":this.handleResultMessage(e,t,n);break;case"assistant":case"user":case"status_system":break;case"error":this.emitEvent({type:"error",sessionId:t,timestamp:n,code:"BACKEND_ERROR",message:e.message});break;default:console.warn("[ClaudeSession] Unknown message type:",e.type)}}handleStreamEvent(e,t,n){const s=e.event;switch(s.type){case"content_block_start":{const e=s.content_block;if("tool_use"===e.type){const s=e;this.currentTurnItems.set(s.id,"tool"),this.emitEvent({type:"tool_started",sessionId:t,timestamp:n,itemId:s.id,toolType:s.toolType,toolName:s.toolName,parameters:s.input})}break}case"content_block_delta":{const e=s.delta,o=`item-${s.index}`;"text_delta"===e.type?(this.currentTurnItems.set(o,"text"),this.emitEvent({type:"text_delta",sessionId:t,timestamp:n,itemId:o,text:e.text})):"thinking_delta"===e.type?(this.currentTurnItems.set(o,"thinking"),this.emitEvent({type:"thinking_delta",sessionId:t,timestamp:n,itemId:o,text:e.thinking})):e.type;break}case"content_block_stop":case"message_delta":case"message_start":break;case"message_stop":this.setGenerating(!1),this.emitEvent({type:"turn_completed",sessionId:t,timestamp:n,turnId:e.uuid,status:"completed"}),this.currentTurnItems.clear();break;default:console.warn("[ClaudeSession] Unknown stream event type:",s.type)}}handleResultMessage(e,t,n){const s=e.is_error?"error":"completed";this.setGenerating(!1),this.emitEvent({type:"turn_completed",sessionId:t,timestamp:n,turnId:e.session_id||t,status:s}),e.is_error&&this.emitEvent({type:"error",sessionId:t,timestamp:n,code:e.subtype||"UNKNOWN_ERROR",message:e.result||"Unknown error"}),this.currentTurnItems.clear()}handleRpcError(e){const t=e.message||String(e);this.setError(t);const n=this.getSessionId()||"unknown";this.emitEvent({type:"error",sessionId:n,timestamp:Date.now(),code:e.code||"CONNECTION_ERROR",message:t})}handleRpcDisconnect(e){if(this.setConnectionStatus("disconnected"),e){const t=e.message||String(e);this.setError(t);const n=this.getSessionId()||"unknown";this.emitEvent({type:"error",sessionId:n,timestamp:Date.now(),code:"DISCONNECTED",message:`Connection lost: ${t}`})}}},codex:Nl};async function Rl(e){if(!Ml[e])return console.warn(`[BackendFactory] No session implementation registered for ${e}`),!1;try{if("claude"===e){const e=Za(),t=await fetch(`${e}/api/health`,{method:"GET",signal:AbortSignal.timeout(3e3)});if(!t.ok)return console.warn("[BackendFactory] Claude backend health check failed:",t.status),!1;return"ok"===(await t.json()).status}if("codex"===e){const e=Za(),t=await fetch(`${e}/api/codex/health`,{method:"GET",signal:AbortSignal.timeout(3e3)});if(!t.ok)return console.warn("[BackendFactory] Codex backend health check failed:",t.status),!1;return"ok"===(await t.json()).status}}catch(t){return console.warn(`[BackendFactory] Backend availability check failed for ${e}:`,t),!1}return!1}function _l(){return Object.keys(Ml).filter(e=>null!==Ml[e])}const Ol=["claude","codex"];async function Dl(e=!0){if(!e){const e=_l();return e.length>0?e[0]:"claude"}for(const t of Ol)if(await Rl(t))return t;return console.warn("[BackendFactory] No backends available, using fallback"),Ol[0]}class Bl extends Error{constructor(e,t,n){super(e),this.backendType=t,this.cause=n,this.name="BackendFactoryError"}}function Ll(e,t){const n=Ml[e];if(!n)throw new Bl(`Backend type "${e}" is not registered. Available backends: ${_l().join(", ")}`,e);try{const s=t||function(e){return"claude"===e?{...vl}:{...bl}}(e),o=new n(s);return console.log(`[BackendFactory] Created ${e} session`),o}catch(s){throw new Bl(`Failed to create ${e} session: ${s instanceof Error?s.message:String(s)}`,e,s)}}const Fl={createSession:Ll,createAndConnectSession:async function(e,t){const n=Ll(e,t.config);try{return await n.connect(t),n}catch(s){throw n.disconnect(),new Bl(`Failed to connect ${e} session: ${s instanceof Error?s.message:String(s)}`,e,s)}},createDefaultSession:async function(e,t=!0){return Ll(await Dl(t),e)},registerSessionImplementation:function(e,t){Ml[e]=t},getRegisteredBackendTypes:_l,isBackendAvailable:Rl,getAvailableBackendTypes:async function(){return(await Promise.all(["claude","codex"].map(async e=>({type:e,available:await Rl(e)})))).filter(e=>e.available).map(e=>e.type)},getDefaultBackendType:Dl,getDefaultBackendTypeSync:function(){const e=_l();if(e.length>0){for(const t of Ol)if(e.includes(t))return t;return e[0]}return Ol[0]}},Pl=[{id:"claude-opus-4-5-20251101",displayName:"Claude Opus 4.5",description:"Most capable model for complex tasks",supportsThinking:!0,isDefault:!1},{id:"claude-sonnet-4-5-20251101",displayName:"Claude Sonnet 4.5",description:"Balanced performance and cost",supportsThinking:!0,isDefault:!0},{id:"claude-haiku-4-5-20251101",displayName:"Claude Haiku 4.5",description:"Fast and efficient for simple tasks",supportsThinking:!0,isDefault:!1}],$l=[{id:"gpt-5.1-codex-max",displayName:"GPT-5.1 Codex Max",description:"Most capable Codex model",supportsThinking:!0,isDefault:!0},{id:"o3",displayName:"o3",description:"Advanced reasoning model",supportsThinking:!0,isDefault:!1},{id:"gpt-4o",displayName:"GPT-4o",description:"Balanced multimodal model",supportsThinking:!1,isDefault:!1},{id:"gpt-4o-mini",displayName:"GPT-4o Mini",description:"Fast and efficient",supportsThinking:!1,isDefault:!1}],Ul={claude:{type:"claude",displayName:"Claude",supportsThinking:!0,thinkingConfigType:"token_budget",supportsSubAgents:!0,supportsMcp:!0,supportsSandbox:!1,supportsPromptCaching:!0,exposesTokenUsage:!0,supportedTools:["Read","Write","Edit","MultiEdit","Bash","Task","Glob","Grep","LS","TodoRead","TodoWrite","WebFetch","WebSearch","NotebookRead","NotebookEdit"],availableModels:Pl},codex:{type:"codex",displayName:"OpenAI Codex",supportsThinking:!0,thinkingConfigType:"effort_level",supportsSubAgents:!1,supportsMcp:!0,supportsSandbox:!0,sandboxModes:["read-only","workspace-write","full-access"],supportsPromptCaching:!1,exposesTokenUsage:!1,supportedTools:["CommandExecution","FileChange","McpToolCall","WebSearch","ImageView"],availableModels:$l}};function Vl(e){return Ul[e]}function Wl(){return Object.keys(Ul)}function Gl(e){return Vl(e).displayName}function zl(e){switch(e.type){case"text":return{type:"text",text:e.text};case"thinking":return{type:"thinking",thinking:e.thinking,signature:e.signature};case"tool_use":return function(e){const t=e.toolName??e.name??"";return{type:"tool_use",id:e.id,toolName:t,toolType:e.toolType,input:e.input,status:e.status}}(e);case"tool_result":return{type:"tool_result",tool_use_id:e.tool_use_id,content:e.content,is_error:e.is_error,agent_id:e.agent_id};case"image":return{type:"image",source:{...e.source,type:e.source.type}};case"command_execution":return{type:"command_execution",command:e.command,output:e.output,exitCode:e.exitCode,status:e.status};case"file_change":return{type:"file_change",changes:e.changes,status:e.status};case"mcp_tool_call":return{type:"mcp_tool_call",server:e.server,tool:e.tool,arguments:e.arguments,result:e.result,status:e.status};case"web_search":return{type:"web_search",query:e.query};case"todo_list":return{type:"todo_list",items:e.items};case"error":return{type:"error",message:e.message};case"unknown":return{type:"error",message:`Unknown content type: ${e.originalType}`};default:return null}}function Hl(e){const t=(e.message?.content??[]).map(zl).filter(e=>!!e);if(0===t.length)return null;const n="user"===e.type?e.isReplay:void 0,s=e.id??e.uuid??"",o=e.parentToolUseId;return{id:s,uuid:e.uuid,role:e.type,timestamp:Date.now(),content:t,isReplay:n,parentToolUseId:o}}const Kl={READ:"CLAUDE_READ",WRITE:"CLAUDE_WRITE",EDIT:"CLAUDE_EDIT",MULTI_EDIT:"CLAUDE_MULTI_EDIT",BASH:"CLAUDE_BASH",BASH_OUTPUT:"CLAUDE_BASH_OUTPUT",KILL_SHELL:"CLAUDE_KILL_SHELL",GREP:"CLAUDE_GREP",GLOB:"CLAUDE_GLOB",TODO_WRITE:"CLAUDE_TODO_WRITE",WEB_SEARCH:"CLAUDE_WEB_SEARCH",WEB_FETCH:"CLAUDE_WEB_FETCH",TASK:"CLAUDE_TASK",ASK_USER_QUESTION:"CLAUDE_ASK_USER_QUESTION",NOTEBOOK_EDIT:"CLAUDE_NOTEBOOK_EDIT",EXIT_PLAN_MODE:"CLAUDE_EXIT_PLAN_MODE",ENTER_PLAN_MODE:"CLAUDE_ENTER_PLAN_MODE",SKILL:"CLAUDE_SKILL",SLASH_COMMAND:"CLAUDE_SLASH_COMMAND",LIST_MCP_RESOURCES:"CLAUDE_LIST_MCP_RESOURCES",READ_MCP_RESOURCE:"CLAUDE_READ_MCP_RESOURCE"},jl="MCP",Yl="UNKNOWN",Zl={Read:Kl.READ,Write:Kl.WRITE,Edit:Kl.EDIT,MultiEdit:Kl.MULTI_EDIT,Bash:Kl.BASH,BashOutput:Kl.BASH_OUTPUT,KillShell:Kl.KILL_SHELL,Grep:Kl.GREP,Glob:Kl.GLOB,TodoWrite:Kl.TODO_WRITE,WebSearch:Kl.WEB_SEARCH,WebFetch:Kl.WEB_FETCH,Task:Kl.TASK,AskUserQuestion:Kl.ASK_USER_QUESTION,NotebookEdit:Kl.NOTEBOOK_EDIT,ExitPlanMode:Kl.EXIT_PLAN_MODE,EnterPlanMode:Kl.ENTER_PLAN_MODE,Skill:Kl.SKILL,SlashCommand:Kl.SLASH_COMMAND,ListMcpResourcesTool:Kl.LIST_MCP_RESOURCES,ReadMcpResourceTool:Kl.READ_MCP_RESOURCE};function Xl(e){return!!e&&"tool_use"===e.type&&"string"==typeof e.id}function Jl(e){return!!e&&"text"===e.type&&"string"==typeof e.text}function Ql(e){const t=e.match(/<current-open-file\s+([^>]+)\/>/);if(!t)return null;const n=t[1],s=e=>{const t=n.match(new RegExp(`${e}="([^"]*)"`,"i"));return t?t[1]:void 0},o=s("path");if(!o)return null;const i={path:o},r=s("line"),a=s("column");r&&(i.line=parseInt(r,10)),a&&(i.column=parseInt(a,10));const l=s("start-line"),c=s("start-column"),u=s("end-line"),d=s("end-column");l&&(i.startLine=parseInt(l,10)),c&&(i.startColumn=parseInt(c,10)),u&&(i.endLine=parseInt(u,10)),d&&(i.endColumn=parseInt(d,10));const p=s("selected-content");return p&&(i.selectedContent=p.replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")),i}function ql(e){return/<current-open-file\s+[^>]+\/>/.test(e)}function ec(e){return e.replace(/<current-open-file\s+[^>]+\/>\s*/g,"").trim()}const tc=new DOMParser;function nc(e){const t=e.trim();if(!t.startsWith("<"))return null;const n=t.match(/^<\/(\w[\w-]*)>$/);if(n)return{tagName:n[1],attributes:{},isEndTag:!0,isSelfClosing:!1};let s=t;const o=t.endsWith("/>");if(!o&&t.endsWith(">")&&!t.includes("</")){const e=t.match(/^<(\w[\w-]*)/);if(e){const n=e[1];s=t.slice(0,-1)+`></${n}>`}}try{const e=tc.parseFromString(s,"text/xml");if(e.querySelector("parsererror"))return null;const t=e.documentElement;if(!t)return null;const n={};for(const s of t.attributes)n[s.name]=s.value;return{tagName:t.tagName,attributes:n,isEndTag:!1,isSelfClosing:o,textContent:t.textContent||void 0}}catch{return null}}function sc(e){const t=nc(e);if(!t)return null;if("system-reminder"!==t.tagName)return null;if(t.isEndTag)return null;const n=t.attributes.type;if(!n)return null;switch(n){case"open-file":{const e=t.attributes.path;return e?{type:"open-file",path:e,fileType:t.attributes["file-type"],diffTitle:t.attributes["diff-title"]}:null}case"select-lines":{const e=t.attributes.path,n=t.attributes.start,s=t.attributes.end;return e&&n&&s?{type:"select-lines",path:e,start:parseInt(n,10),end:parseInt(s,10),startColumn:t.attributes["start-column"]?parseInt(t.attributes["start-column"],10):void 0,endColumn:t.attributes["end-column"]?parseInt(t.attributes["end-column"],10):void 0,content:t.textContent}:null}case"attachment-start":return{type:"attachment-start"};case"attachment-end":return{type:"attachment-end"};default:return null}}function oc(e){const t=nc(e);return!!t&&"system-reminder"===t.tagName}function ic(e){const t=function(e){let t=!1;for(let c=e.length-1;c>=0;c--){const n=e[c];if("text"===n.type&&"text"in n){if(oc(n.text.trim())){t=!0;break}}}if(!t)return null;const n=[],s=[],o=[];let i,r,a=!1,l=e.length-1;for(;l>=0;){const t=e[l];if("tool_result"!==t.type&&"tool_use"!==t.type){if("text"===t.type&&"text"in t){const e=t.text.trim(),s=sc(e);if(s){switch(s.type){case"attachment-end":a=!0;break;case"attachment-start":a=!1;break;case"open-file":i=s;break;case"select-lines":r=s}l--;continue}if(a){const t=e.match(/^@file:\/\/(.+)$/);if(t){const e=t[1];n.unshift({type:"file",uri:`file://${e}`,path:e,displayType:"TAG"})}else e&&n.unshift({type:"web",uri:e,url:e,displayType:"TAG"});l--;continue}e&&o.unshift({type:"text",text:e})}else if("image"===t.type){const e=t;a?s.unshift(e):o.unshift(t)}l--}else l--}return{contexts:n,contextImages:s,userContent:o,openFile:i,selectedLines:r}}(e);return t||function(e){const t=[],n=[],s=[];let o,i=!1;for(const r of e)if("tool_result"!==r.type&&"tool_use"!==r.type)if("text"===r.type){let e=r.text;if(ql(e)){const t=Ql(e);t&&(o=t),e=ec(e)}if(!e.trim())continue;const n=e.match(/^@file:\/\/(.+)$/);if(n&&!i){const e=n[1];t.push({type:"file",uri:`file://${e}`,path:e,displayType:"TAG"})}else i=!0,s.push({type:"text",text:e})}else if("image"===r.type){const e=r;i?s.push(r):n.push(e)}return{contexts:t,contextImages:n,userContent:s,currentOpenFile:o}}(e)}function rc(e){const t=[],n=[...e.contexts??[]];if(e.text.trim()&&t.push({type:"text",text:e.text.trim()}),n.length>0){t.push({type:"text",text:'<system-reminder type="attachment-start"/>'});for(const e of n)if("file"===e.type){const n=e.fullPath||e.path||e.uri?.replace(/^file:\/\//,"");if(n){const e=n.startsWith("file://")?n:`file://${n}`;t.push({type:"text",text:`@${e}`})}}else if("image"===e.type){const n=e.mimeType||"image/png";if(e.base64Data)t.push({type:"image",source:{type:"base64",media_type:n,data:e.base64Data}});else if(e.uri){const s=e.uri.startsWith("image://")?e.uri.slice(8):e.uri;t.push({type:"image",source:{type:"url",media_type:n,url:s}})}}else if("web"===e.type&&(e.url||e.uri)){const n=e.url||e.uri;n&&t.push({type:"text",text:n})}t.push({type:"text",text:'<system-reminder type="attachment-end"/>'})}return t}function ac(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function lc(e){if(!e)return[];const t=e,n=t.fileType||"text",s=[];let o=`<system-reminder type="open-file" path="${t.relativePath}"`;if("text"!==n&&(o+=` file-type="${n}"`),"diff"===n&&t.diffTitle&&(o+=` diff-title="${ac(t.diffTitle)}"`),o+="/>",s.push({type:"text",text:o}),t.hasSelection&&t.startLine&&t.endLine){let e=`<system-reminder type="select-lines" path="${t.relativePath}" start="${t.startLine}" end="${t.endLine}"`;t.startColumn&&(e+=` start-column="${t.startColumn}"`),t.endColumn&&(e+=` end-column="${t.endColumn}"`),t.selectedContent?e+=`>${ac(t.selectedContent)}</system-reminder>`:e+="/>",s.push({type:"text",text:e})}return"diff"===n&&(void 0!==t.diffOldContent&&null!==t.diffOldContent&&s.push({type:"text",text:`<diff-old-content><![CDATA[${t.diffOldContent}]]></diff-old-content>`}),void 0!==t.diffNewContent&&null!==t.diffNewContent&&s.push({type:"text",text:`<diff-new-content><![CDATA[${t.diffNewContent}]]></diff-new-content>`})),s}function cc(e){const t=new Set;if("assistant"!==e.role)return t;const n=e.content.filter(Xl);return 0===n.length||e.content.forEach((e,s)=>{if(!Jl(e))return;const o=function(e){const t=e.indexOf("{"),n=e.lastIndexOf("}");if(-1===t||-1===n||n<=t)return null;const s=e.slice(t,n+1);try{return JSON.parse(s)}catch{return null}}(e.text);o&&n.some(e=>!e.input||0===Object.keys(e.input).length)&&(n.forEach(e=>{e.input&&0!==Object.keys(e.input).length||(e.input=o)}),t.add(s))}),t}function uc(e,t){const n=t.get(e.id);if(n)return e.input&&Object.keys(e.input).length>0&&(n.input=e.input),n;const s=e.toolType||((o=e.toolName).startsWith("mcp__")?jl:Zl[o]||Yl);var o;const i=Date.now(),r={id:e.id,displayType:"toolCall",toolName:e.toolName,toolType:s,status:pl.RUNNING,startTime:i,timestamp:i,input:e.input||{}},a=Ve({...r});return"Task"===e.toolName&&(a.agentName=e.input?.subagent_type||e.input?.model),t.set(e.id,a),a}function dc(e,t){e.status=t.is_error?pl.FAILED:pl.SUCCESS,e.endTime=Date.now(),e.result=t,"Task"===e.toolName&&t.agent_id&&(e.agentId=t.agent_id)}function pc(e,t){const n=[];if("user"===e.role){if(function(e){return"user"===e.role&&!0===e.isCompactSummary}(e)){const t={displayType:"compactSummary",id:e.id,content:e.content,isReplay:e.isReplay,preTokens:e.compactMetadata?.preTokens,trigger:e.compactMetadata?.trigger,timestamp:e.timestamp};return n.push(t),n}if(function(e){return"user"===e.role&&!0===e.isReplay}(e)){const s=e.content.filter(e=>"tool_result"===e.type);for(const e of s){const n=t.get(e.tool_use_id);n&&dc(n,e)}if(e.content.every(e=>"tool_result"===e.type||"tool_use"===e.type)&&s.length>0)return n;const o=e.content.find(e=>"text"===e.type);if(o?.text){const t=function(e){const t=e.match(/<local-command-stdout>([\s\S]*?)<\/local-command-stdout>/);if(t)return{type:"stdout",content:t[1].trim()};const n=e.match(/<local-command-stderr>([\s\S]*?)<\/local-command-stderr>/);return n?{type:"stderr",content:n[1].trim()}:null}(o.text);if(t){const s={displayType:"localCommandOutput",id:e.id,command:t.content,outputType:t.type,timestamp:e.timestamp};return n.push(s),n}}const i=ic(e.content),r=[...i.contexts];for(const t of i.contextImages)"base64"===t.source.type&&r.push({type:"image",uri:`image://context-${e.id}-${r.length}`,displayType:"TAG",mimeType:t.source.media_type,base64Data:t.source.data});if(i.userContent.length>0||r.length>0||i.currentOpenFile||i.openFile){const t={displayType:"userMessage",id:e.id,uuid:e.uuid,contexts:r.length>0?r:void 0,content:i.userContent,timestamp:e.timestamp,isReplay:!0,style:"hint",currentOpenFile:i.currentOpenFile,openFile:i.openFile,selectedLines:i.selectedLines};n.push(t)}return n}const s=ic(e.content),o=[...s.contexts];for(const t of s.contextImages)"base64"===t.source.type&&o.push({type:"image",uri:`image://context-${e.id}-${o.length}`,displayType:"TAG",mimeType:t.source.media_type,base64Data:t.source.data});if(s.userContent.length>0||o.length>0||s.currentOpenFile||s.openFile){const t={displayType:"userMessage",id:e.id,uuid:e.uuid,contexts:o.length>0?o:void 0,content:s.userContent,timestamp:e.timestamp,currentOpenFile:s.currentOpenFile,openFile:s.openFile,selectedLines:s.selectedLines};n.push(t)}const i=e.content.filter(e=>"tool_result"===e.type);for(const e of i){const n=t.get(e.tool_use_id);n&&dc(n,e)}}else if("assistant"===e.role){const s=cc(e),o=[];e.content.forEach((e,t)=>{Jl(e)&&e.text.trim()&&o.push(t)});const i=o.length>0?o[o.length-1]:-1;for(let r=0;r<e.content.length;r++){const o=e.content[r];if(Jl(o)&&o.text.trim()){if(s.has(r))continue;const t=r===i;let a;if(t&&e.tokenUsage){const t=e.tokenUsage;a={requestDuration:0,inputTokens:t.inputTokens||t.input_tokens,outputTokens:t.outputTokens||t.output_tokens}}const l={displayType:"assistantText",id:`${e.id}-text-${r}`,content:o.text,timestamp:e.timestamp,isLastInMessage:t,stats:a,isStreaming:!0===e.isStreaming};n.push(l)}else if("thinking"===o.type){const t=o;if(void 0!==t.thinking){const s={displayType:"thinking",id:`${e.id}-thinking-${r}`,content:t.thinking,signature:t.signature,timestamp:e.timestamp};n.push(s)}}else if(Xl(o)){const e=uc(o,t);n.push(e)}}}else if("system"===e.role){const t=e.content.filter(e=>"text"===e.type);if(t.length>0){const s={displayType:"systemMessage",id:e.id,content:t.map(e=>e.text).join("\n"),level:"info",timestamp:e.timestamp};n.push(s)}}return n}const hc=tl.session;const fc=tl.session;const mc=tl.session;function gc(e,t){t=t||{};this._capacity=t.capacity,this._head=0,this._tail=0,Array.isArray(e)?this._fromArray(e):(this._capacityMask=3,this._list=new Array(4))}gc.prototype.peekAt=function(e){var t=e;if(t===(0|t)){var n=this.size();if(!(t>=n||t<-n))return t<0&&(t+=n),t=this._head+t&this._capacityMask,this._list[t]}},gc.prototype.get=function(e){return this.peekAt(e)},gc.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},gc.prototype.peekFront=function(){return this.peek()},gc.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(gc.prototype,"length",{get:function(){return this.size()}}),gc.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},gc.prototype.unshift=function(e){if(0===arguments.length)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},gc.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}},gc.prototype.push=function(e){if(0===arguments.length)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},gc.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),n}},gc.prototype.removeOne=function(e){var t=e;if(t===(0|t)&&this._head!==this._tail){var n=this.size(),s=this._list.length;if(!(t>=n||t<-n)){t<0&&(t+=n),t=this._head+t&this._capacityMask;var o,i=this._list[t];if(e<n/2){for(o=e;o>0;o--)this._list[t]=this._list[t=t-1+s&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+s&this._capacityMask}else{for(o=n-1-e;o>0;o--)this._list[t]=this._list[t=t+1+s&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+s&this._capacityMask}return i}}},gc.prototype.remove=function(e,t){var n,s=e,o=t;if(s===(0|s)&&this._head!==this._tail){var i=this.size(),r=this._list.length;if(!(s>=i||s<-i||t<1)){if(s<0&&(s+=i),1===t||!t)return(n=new Array(1))[0]=this.removeOne(s),n;if(0===s&&s+t>=i)return n=this.toArray(),this.clear(),n;var a;for(s+t>i&&(t=i-s),n=new Array(t),a=0;a<t;a++)n[a]=this._list[this._head+s+a&this._capacityMask];if(s=this._head+s&this._capacityMask,e+t===i){for(this._tail=this._tail-t+r&this._capacityMask,a=t;a>0;a--)this._list[s=s+1+r&this._capacityMask]=void 0;return n}if(0===e){for(this._head=this._head+t+r&this._capacityMask,a=t-1;a>0;a--)this._list[s=s+1+r&this._capacityMask]=void 0;return n}if(s<i/2){for(this._head=this._head+e+t+r&this._capacityMask,a=e;a>0;a--)this.unshift(this._list[s=s-1+r&this._capacityMask]);for(s=this._head-1+r&this._capacityMask;o>0;)this._list[s=s-1+r&this._capacityMask]=void 0,o--;e<0&&(this._tail=s)}else{for(this._tail=s,s=s+t+r&this._capacityMask,a=i-(t+e);a>0;a--)this.push(this._list[s++]);for(s=this._tail;o>0;)this._list[s=s+1+r&this._capacityMask]=void 0,o--}return this._head<2&&this._tail>1e4&&this._tail<=r>>>2&&this._shrinkArray(),n}}},gc.prototype.splice=function(e,t){var n=e;if(n===(0|n)){var s=this.size();if(n<0&&(n+=s),!(n>s)){if(arguments.length>2){var o,i,r,a=arguments.length,l=this._list.length,c=2;if(!s||n<s/2){for(i=new Array(n),o=0;o<n;o++)i[o]=this._list[this._head+o&this._capacityMask];for(0===t?(r=[],n>0&&(this._head=this._head+n+l&this._capacityMask)):(r=this.remove(n,t),this._head=this._head+n+l&this._capacityMask);a>c;)this.unshift(arguments[--a]);for(o=n;o>0;o--)this.unshift(i[o-1])}else{var u=(i=new Array(s-(n+t))).length;for(o=0;o<u;o++)i[o]=this._list[this._head+n+t+o&this._capacityMask];for(0===t?(r=[],n!=s&&(this._tail=this._head+n+l&this._capacityMask)):(r=this.remove(n,t),this._tail=this._tail-u+l&this._capacityMask);c<a;)this.push(arguments[c++]);for(o=0;o<u;o++)this.push(i[o])}return r}return this.remove(n,t)}}},gc.prototype.clear=function(){this._list=new Array(this._list.length),this._head=0,this._tail=0},gc.prototype.isEmpty=function(){return this._head===this._tail},gc.prototype.toArray=function(){return this._copyArray(!1)},gc.prototype._fromArray=function(e){var t=e.length,n=this._nextPowerOf2(t);this._list=new Array(n),this._capacityMask=n-1,this._tail=t;for(var s=0;s<t;s++)this._list[s]=e[s]},gc.prototype._copyArray=function(e,t){var n=this._list,s=n.length,o=this.length;if((t|=o)==o&&this._head<this._tail)return this._list.slice(this._head,this._tail);var i,r=new Array(t),a=0;if(e||this._head>this._tail){for(i=this._head;i<s;i++)r[a++]=n[i];for(i=0;i<this._tail;i++)r[a++]=n[i]}else for(i=this._head;i<this._tail;i++)r[a++]=n[i];return r},gc.prototype._growArray=function(){if(0!=this._head){var e=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=e}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1},gc.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},gc.prototype._nextPowerOf2=function(e){var t=1<<Math.log(e)/Math.log(2)+1;return Math.max(t,4)};const yc=Qt(gc);class vc{constructor(e){De(this,"queue"),De(this,"windowSize"),De(this,"dedupe"),De(this,"keySelector"),De(this,"keySet"),this.windowSize=e.windowSize,this.dedupe=e.dedupe??!1,this.keySelector=e.keySelector,this.queue=new yc,this.keySet=this.dedupe?new Set:void 0}clear(){this.queue=new yc,this.keySet&&this.keySet.clear()}pushBatch(e){for(const t of e)this.shouldSkip(t)||(this.queue.push(t),this.maybeAddKey(t));this.trimIfNeeded()}prependBatch(e){for(let t=e.length-1;t>=0;t-=1){const n=e[t];this.shouldSkip(n)||(this.queue.unshift(n),this.maybeAddKey(n))}this.trimIfNeededFromHead()}getWindow(e=this.windowSize){const t=Math.min(e,this.queue.length);return t===this.queue.length?this.queue.toArray():this.queue.toArray().slice(this.queue.length-t)}size(){return this.queue.length}shouldSkip(e){if(!this.keySet||!this.keySelector)return!1;const t=this.keySelector(e);return void 0!==t&&this.keySet.has(t)}maybeAddKey(e){if(!this.keySet||!this.keySelector)return;const t=this.keySelector(e);void 0!==t&&this.keySet.add(t)}trimIfNeeded(){for(;this.queue.length>this.windowSize;){const e=this.queue.shift();this.removeKey(e)}}trimIfNeededFromHead(){for(;this.queue.length>this.windowSize;){const e=this.queue.pop();this.removeKey(e)}}removeKey(e){if(!e||!this.keySet||!this.keySelector)return;const t=this.keySelector(e);void 0!==t&&this.keySet.delete(t)}}const bc=1e3,kc=200,wc=tl.session;function Sc(e,t){const n=Ve([]),s=Ve([]),o=Number.MAX_SAFE_INTEGER,i=new vc({windowSize:o,dedupe:!0,keySelector:e=>e?.id}),r=new Map,a=new Map;function l(){const e=i.getWindow(1e3);s.splice(0,s.length,...e)}function c(e){0!==e.length&&(i.pushBatch(e),l())}function u(e){0!==e.length&&(i.prependBatch(e),l())}function d(t,n){if(!n||0===n.length)return;const s=n.filter(e=>"userMessage"!==e.displayType);if(0===s.length)return;const o=e.pendingToolCalls.get(t);if(!o){const e=r.get(t)??[];return e.push(...s),void r.set(t,e)}o.subagentMessages||(o.subagentMessages=[]),o.subagentMessages.push(...s)}function p(t,n){const s=e.pendingToolCalls.get(t);if(s&&s.subagentMessages)return s.subagentMessages.find(e=>e.id===n)}function h(e,t,n,s){const o=p(e,t);if(o&&"thinking"===o.displayType)return o.content=n,void(s&&(o.signature=s));d(e,[{displayType:"thinking",id:t,content:n,signature:s,timestamp:Date.now()}])}const f=Ge([]),m=Ge(!1);let g=null;const y=Ge(null);let v=null,b=null;const k=We(()=>n.length),w=We(()=>s.length),S=We(()=>f.value.length),C=We(()=>n.length>0);function T(t){const s=t.contexts.length>0?rc({text:"",contexts:t.contexts}):[],o=lc(t.ideContext),i=[...s,...t.contents,...o],r=[...t.contents,...s,...o];wc.debug("[useSessionMessages] addMessageToUI:",{contexts:t.contexts.length,contents:t.contents.length,ideContext:!!t.ideContext,uiContent:i.length,merged:r.length});const a={id:`user-${Date.now()}`,role:"user",timestamp:Date.now(),content:i};n.push(a);return c(pc(a,e.pendingToolCalls)),wc.debug("[useSessionMessages] ç”¨æˆ·æ¶ˆæ¯å·²æ·»åŠ :",a.id),{userMessage:a,mergedContent:r}}function E(){const e=t.getCurrentTracker(),s=e?.currentStreamingMessageId;if(s){const e=[...n].reverse().find(e=>e.id===s&&"assistant"===e.role);if(e)return e}for(let t=n.length-1;t>=0;t--){const e=n[t];if("assistant"===e.role&&e.isStreaming)return e}return null}function I(){const s=E();if(s)return s;const o=t.getCurrentTracker(),i={id:o?.currentStreamingMessageId||`assistant-${Date.now()}`,role:"assistant",timestamp:Date.now(),content:[],isStreaming:!0};n.push(i);return c(pc(i,e.pendingToolCalls)),i}function x(e,t){0!==t.length&&(0!==e.content.length?t.forEach((t,n)=>{const s=e.content[n];s?"text"===s.type&&"text"===t.type&&""===s.text.trim()?s.text=t.text:"thinking"===s.type&&"thinking"===t.type&&""===(s.thinking||"")&&(s.thinking=t.thinking,s.signature=s.signature??t.signature):e.content[n]=t}):e.content=[...t])}function A(e){_([e])}function N(){l()}function M(){f.value=[],wc.info("[useSessionMessages] æ¸…ç©ºæ¶ˆæ¯é˜Ÿåˆ—")}function R(){n.splice(0,n.length),i.clear(),s.splice(0,s.length),wc.debug("[useSessionMessages] æ¶ˆæ¯å·²æ¸…ç©º")}function _(t){if(0===t.length)return;const s=t.flatMap(t=>pc(t,e.pendingToolCalls));s.forEach(e=>{fl(e)&&(e.style="hint")}),c(s),n.push(...t)}return{messages:n,displayItems:s,messageQueue:f,isGenerating:m,lastError:y,messageCount:k,displayItemCount:w,queueLength:S,hasMessages:C,setBeforeProcessQueueFn:function(e){v=e},setProcessQueueFn:function(e){b=e},appendMessagesBatch:_,prependMessagesBatch:function(t){if(0===t.length)return;const s=t.flatMap(t=>pc(t,e.pendingToolCalls));s.forEach(e=>{fl(e)&&(e.style="hint")}),u(s);for(let e=t.length-1;e>=0;e-=1)n.unshift(t[e])},handleStreamEvent:function(o){if(o.parentToolUseId)return void function(t){const n=t.parentToolUseId,s=t.event;if(!s)return;switch(s.type){case"message_start":{const t=s.message?.id||`subagent-${Date.now()}`,o=Date.now();a.set(n,{messageId:t,content:[],timestamp:o});(s.message?.content??[]).map(zl).filter(e=>!!e).forEach((s,i)=>{if("text"===s.type){d(n,[{displayType:"assistantText",id:`${t}-text-${i}`,content:s.text||"",timestamp:o,isStreaming:!0}])}else if("thinking"===s.type){d(n,[{displayType:"thinking",id:`${t}-thinking-${i}`,content:s.thinking||"",signature:s.signature,timestamp:o}])}else if("tool_use"===s.type&&s.id){const t=uc(s,e.pendingToolCalls);d(n,[t])}});break}case"content_block_start":{const t=a.get(n);if(!t)break;const o=s.index,i=zl(s.content_block);if(!i)break;for(;t.content.length<o;)t.content.push({type:"text",text:""});if(t.content[o]=i,"text"===i.type){const e=`${t.messageId}-text-${o}`;d(n,[{displayType:"assistantText",id:e,content:"",timestamp:t.timestamp,isStreaming:!0}])}else if("thinking"===i.type){const e=`${t.messageId}-thinking-${o}`;d(n,[{displayType:"thinking",id:e,content:"",signature:i.signature,timestamp:t.timestamp}])}else if("tool_use"===i.type&&i.id){const t=uc(i,e.pendingToolCalls);d(n,[t])}break}case"content_block_delta":{const t=a.get(n);if(!t)break;const o=s.index,i=s.delta,r=t.content[o];if(!r)break;if("text_delta"===i.type&&"text"===r.type){r.text=r.text+(i.text||"");const e=`${t.messageId}-text-${o}`;!function(e,t,n){const s=p(e,t);if(s&&"assistantText"===s.displayType)return void(s.content=n);d(e,[{displayType:"assistantText",id:t,content:n,timestamp:Date.now(),isStreaming:!0}])}(n,e,r.text||"")}else if("thinking_delta"===i.type&&"thinking"===r.type){r.thinking=r.thinking+(i.thinking||"");const e=`${t.messageId}-thinking-${o}`;h(n,e,r.thinking||"",r.signature)}else if("signature_delta"===i.type&&"thinking"===r.type){r.signature=i.signature||r.signature;const e=`${t.messageId}-thinking-${o}`;h(n,e,r.thinking||"",r.signature)}else if("input_json_delta"===i.type&&"tool_use"===r.type){const t=e.appendJsonDelta(r.id,i.partial_json||"");try{r.input=JSON.parse(t)}catch{}}break}case"content_block_stop":a.get(n)?.content.forEach(t=>{if("tool_use"===t.type){const n=e.parseAndApplyAccumulatedJson(t.id);n&&(t.input=n)}});break;case"message_stop":a.delete(n)}}(o);const i=o.event;if(!i)return void wc.warn("[useSessionMessages] æ— æ•ˆçš„ event æ•°æ®:",o);const l=i.type;wc.debug(`[useSessionMessages] å¤„ç†äº‹ä»¶: ${l}`);const u="message_start"===l&&i.message?.usage?i.message.usage:"message_delta"===l&&i.usage?i.usage:null;if(u){const e=u;t.addTokenUsage(e.input_tokens??e.inputTokens??0,e.output_tokens??e.outputTokens??0,e.cache_read_tokens??e.cacheReadTokens??0)}switch(l){case"message_start":!function(e){const s=(e.message?.content??[]).map(zl).filter(e=>!!e),o=E(),i=o?.id,r=e.message?.id||i||`assistant-${Date.now()}`;if(wc.debug("[message_start]",{messageId:r,previousId:i,hasExistingStreaming:!!o,initialContentLength:s.length}),o&&i&&i!==r){o.isStreaming=!1;const e={id:r,role:"assistant",timestamp:Date.now(),content:[],isStreaming:!0};n.push(e),t.setStreamingMessageId(r),s.length>0&&x(e,s)}else{const e=I();e.id!==r&&(t.setStreamingMessageId(r),e.id=r),e.isStreaming=!0,s.length>0&&x(e,s)}m.value=!0}(i);break;case"message_stop":!function(){const e=E();e&&(e.isStreaming=!1)}();break;case"content_block_start":!function(t){const n=I(),o=zl(t.content_block),i=t.index;if(o){for(;n.content.length<i;)n.content.push({type:"text",text:""});if(n.content.length===i?n.content.push(o):n.content[i]=o,"text"===o.type){const e=`${n.id}-text-${i}`;s.find(t=>t.id===e)||c([{displayType:"assistantText",id:e,content:"",timestamp:n.timestamp,isLastInMessage:!1,stats:void 0}])}else if("thinking"===o.type){const e=`${n.id}-thinking-${i}`;s.find(t=>t.id===e)||c([{displayType:"thinking",id:e,content:"",signature:o.signature,timestamp:n.timestamp}])}else if("tool_use"===o.type&&o.id){e.registerToolCall(o);if(!s.find(e=>"toolCall"===e.displayType&&e.id===o.id)){const t=uc(o,e.pendingToolCalls);"Task"!==o.toolName&&"Task"!==o.name||(t.agentName=o.input?.subagent_type||o.input?.model,function(e,t){const n=r.get(e);n&&n.length>0&&(t.subagentMessages=(t.subagentMessages||[]).concat(n),r.delete(e))}(o.id,t)),c([t])}}}}(i);break;case"content_block_delta":!function(n){const o=I(),i=n.index,r=n.delta;if(i>=0&&i<o.content.length&&r){const n=o.content[i];switch(r.type){case"text_delta":"text"===n.type&&(n.text+=r.text,function(e,t,n){const o=`${e.id}-text-${t}`,i=s.find(e=>e.id===o&&"assistantText"===e.displayType);if(i)return void(i.content=n);const r={displayType:"assistantText",id:o,content:n,timestamp:e.timestamp,isLastInMessage:!1,stats:void 0,isStreaming:!0};c([r])}(o,i,n.text),t.incrementContentVersion());break;case"thinking_delta":"thinking"===n.type&&(n.thinking+=r.thinking,function(e,t,n){const o=`${e.id}-thinking-${t}`,i=s.find(e=>e.id===o&&"thinking"===e.displayType);if(i)return void(i.content=n);const r={displayType:"thinking",id:o,content:n,timestamp:e.timestamp};c([r])}(o,i,n.thinking),t.incrementContentVersion());break;case"input_json_delta":if("tool_use"===n.type){const t=e.appendJsonDelta(n.id,r.partial_json);try{n.input=JSON.parse(t)}catch{}}break;default:if("signature_delta"===r.type&&"thinking"===n.type){const e=r;if(e.signature){n.signature=e.signature;const t=s.find(e=>e.id===`${o.id}-thinking-${i}`&&"thinking"===e.displayType);t&&(t.signature=e.signature,N())}}}}}(i);break;case"content_block_stop":!function(t){const n=E();if(n&&t.index>=0&&t.index<n.content.length){const o=n.content[t.index];if("tool_use"===o.type){const t=o;wc.debug("[content_block_stop] (tool_use):",{id:t.id,toolName:t.toolName,hasInput:!!t.input});const n=s.find(e=>e.id===t.id&&"toolCall"===e.displayType);if(n)n.input=t.input||n.input;else{c([uc(t,e.pendingToolCalls)])}e.updateToolInput(t.id,t.input||{}),N()}}}(i)}},handleResultMessage:function(e){wc.debug("[useSessionMessages] æ”¶åˆ° result æ¶ˆæ¯");const n=t.getCurrentTracker();let o=0,i=0;const r=e.usage;r&&(o=r.input_tokens||0,i=r.output_tokens||0),n&&0===n.inputTokens&&0===n.outputTokens&&r&&(t.addTokenUsage(o,i,r.cache_read_input_tokens||0),wc.debug("[useSessionMessages] éžæµå¼æ¨¡å¼ï¼Œä»Ž RpcResultMessage ç´¯åŠ  usage"));const a=e.duration_ms||(n?Date.now()-n.requestStartTime:0);if(wc.debug(`[useSessionMessages] ç»Ÿè®¡ä¿¡æ¯ duration=${a}ms, tokens=${o}/${i}`),n?.lastUserMessageId){const e=s.findIndex(e=>fl(e)&&e.id===n.lastUserMessageId);if(-1!==e){const t=s[e];t.requestStats={requestDuration:a,inputTokens:o,outputTokens:i},t.isStreaming=!1,N()}}const l=E();l&&(l.isStreaming=!1,wc.debug("[useSessionMessages] ç»“æŸæµå¼ assistant æ¶ˆæ¯"));const u="interrupted"===e.subtype||"error_during_execution"===e.subtype;if(u)if(wc.info("[useSessionMessages] ðŸ›‘ æ”¶åˆ°æ‰“æ–­ä¿¡å·ï¼Œsubtype:",e.subtype,"é˜Ÿåˆ—é•¿åº¦:",f.value.length),m.value=!1,wc.info("[useSessionMessages] ðŸ›‘ isGenerating å·²è®¾ä¸º false"),t.cancelRequestTracking(),"error_during_execution"===e.subtype)for(let t=s.length-1;t>=0;t--){const e=s[t];if(fl(e)&&!e.parentToolUseId){e.style="error",wc.info("[useSessionMessages] ðŸ›‘ æ ‡è®°ç”¨æˆ·æ¶ˆæ¯ style: error",e.id);break}}else if("interrupted"===e.subtype)for(let t=s.length-1;t>=0;t--){const e=s[t];if(fl(e)&&!e.parentToolUseId){const t=e,n=t.content?.find(e=>"text"===e.type);if(n?.text?.includes("[Request interrupted by user]")){e.style="error",wc.info("[useSessionMessages] ðŸ›‘ æ ‡è®°æ‰“æ–­æç¤ºæ¶ˆæ¯ style: error",e.id);break}}}if(!u&&e.is_error&&e.result){y.value=e.result,wc.warn(`[useSessionMessages] åŽç«¯è¿”å›žé”™è¯¯: ${e.result}`);for(let e=s.length-1;e>=0;e--){const t=s[e];if(fl(t)&&!t.parentToolUseId){t.style="error",wc.info("[useSessionMessages] ðŸ›‘ æ ‡è®°ç”¨æˆ·æ¶ˆæ¯ style: error (is_error=true)",t.id);break}}c([{id:`error-${Date.now()}`,displayType:"errorResult",timestamp:Date.now(),message:e.result}])}u||(m.value=!1,t.finishRequestTracking(!e.is_error),wc.debug("[useSessionMessages] è¯·æ±‚å®Œæˆ")),!e.is_error||u?async function(){if(wc.info("[useSessionMessages] ðŸ“‹ handleQueueAfterResult è°ƒç”¨ï¼ŒinterruptMode:",g,"é˜Ÿåˆ—é•¿åº¦:",f.value.length),"clear"===g)return wc.info("[useSessionMessages] ðŸ“‹ æ‰“æ–­æ¨¡å¼ä¸º clearï¼Œæ¸…ç©ºé˜Ÿåˆ—"),f.value=[],void(g=null);if(g=null,0===f.value.length)return void wc.info("[useSessionMessages] ðŸ“‹ é˜Ÿåˆ—ä¸ºç©ºï¼Œè·³è¿‡");if(v)try{await v()}catch(e){console.error("[useSessionMessages] beforeProcessQueueFn æ‰§è¡Œå¤±è´¥:",e)}b&&await b()}():wc.info("[useSessionMessages] ðŸ“‹ is_error=true ä¸”éžæ‰“æ–­ï¼Œä¸è‡ªåŠ¨å‘é€é˜Ÿåˆ—æ¶ˆæ¯")},handleNormalMessage:function(o){if(wc.debug("[useSessionMessages] handleNormalMessage:",{role:o.role,id:o.id,contentLength:o.content.length,parentToolUseId:o.parentToolUseId}),!o.id){const e="assistant"===o.role?t.getCurrentTracker()?.currentStreamingMessageId:null;o.id=e||`${o.role}-${Date.now()}-${crypto.randomUUID().substring(0,8)}`}const i=o.parentToolUseId;if(i){return void d(i,pc(o,e.pendingToolCalls))}if("assistant"===o.role){const e=E();return e&&e.id===o.id?(wc.debug("[useSessionMessages] åŒæ­¥å®Œæ•´æ¶ˆæ¯ä¸­çš„ signature åˆ° displayItem"),void function(e){if("assistant"!==e.role)return;let t=!1;e.content.forEach((n,o)=>{if("thinking"===n.type){const i=`${e.id}-thinking-${o}`,r=s.find(e=>e.id===i&&"thinking"===e.displayType);r&&!r.signature&&(r.signature=n.signature||"complete",t=!0,wc.debug(`[useSessionMessages] åŒæ­¥ signature åˆ° thinking displayItem: ${i}`))}}),t&&N()}(o)):(wc.debug("[useSessionMessages] æ·»åŠ æ–° assistant æ¶ˆæ¯"),void A(o))}if("user"===o.role){const t=o.content.some(e=>"tool_result"===e.type),i=o.content.some(e=>"tool_use"===e.type),r=o.content.some(e=>"text"===e.type);if(!0===o.isCompactSummary)return wc.info("[useSessionMessages] æ·»åŠ åŽ‹ç¼©æ‘˜è¦æ¶ˆæ¯"),void A(o);if(t)return void function(t){const n=t.filter(e=>"tool_result"===e.type);let s=!1;for(const o of n){e.updateToolResult(o.tool_use_id,o)&&(s=!0)}s&&N()}(o.content);if(i&&!r)return void wc.debug("[useSessionMessages] å¿½ç•¥çº¯ tool_use çš„ user æ¶ˆæ¯");if(n.find(e=>e.id===o.id))return void wc.debug("[useSessionMessages] å¿½ç•¥é‡å¤çš„ user æ¶ˆæ¯:",o.id);if(o.uuid&&r){const e=[...n].reverse().find(e=>"user"===e.role&&!e.uuid);if(e){wc.info("[useSessionMessages] æ›´æ–°æœ¬åœ°ç”¨æˆ·æ¶ˆæ¯çš„ uuid:",o.uuid),e.uuid=o.uuid;const t=s.find(t=>fl(t)&&t.id===e.id);return void(t&&(t.uuid=o.uuid))}}A(o);const a=s.find(e=>fl(e)&&e.id===o.id);a&&(a.style="hint")}},addMessageToUI:T,addToQueue:function(e){const t=e.contexts.length>0?rc({text:"",contexts:e.contexts}):[],n=lc(e.ideContext),s=[...t,...e.contents,...n],o=[...e.contents,...t,...n],i=`user-${Date.now()}`;wc.info(`[useSessionMessages] æ¶ˆæ¯åŠ å…¥é˜Ÿåˆ—ï¼ˆä¸æ·»åŠ åˆ° UIï¼‰: ${i}`),f.value.push({id:i,contexts:e.contexts,contents:e.contents,ideContext:e.ideContext,uiContent:s,mergedContent:o,createdAt:Date.now()})},popNextQueuedMessage:function(){if(0===f.value.length)return null;const e=f.value.shift();if(!e)return null;if(wc.info(`[useSessionMessages] ä»Žé˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯: ${e.id}`),s.find(t=>fl(t)&&t.id===e.id))return{userMessage:{id:e.id,role:"user",timestamp:e.createdAt,content:e.uiContent||e.mergedContent},mergedContent:e.mergedContent,originalMessage:{contexts:e.contexts,contents:e.contents}};{const{userMessage:t,mergedContent:n}=T({contexts:e.contexts,contents:e.contents});return{userMessage:t,mergedContent:n,originalMessage:{contexts:e.contexts,contents:e.contents}}}},startGenerating:function(e){const n=`assistant-${Date.now()}`;t.startRequestTracking(e),t.setStreamingMessageId(n),wc.info("[useSessionMessages] ðŸ“¤ startGeneratingï¼Œç”¨æˆ·æ¶ˆæ¯ ID:",e),m.value=!0,wc.info("[useSessionMessages] âœ… isGenerating å·²è®¾ç½®ä¸º true");const o=s.findIndex(t=>fl(t)&&t.id===e);if(-1!==o){s[o].isStreaming=!0,N()}return n},stopGenerating:function(){m.value=!1,t.cancelRequestTracking(),wc.info("[useSessionMessages] isGenerating å·²è®¾ç½®ä¸º false")},editQueueMessage:function(e){const t=f.value.findIndex(t=>t.id===e);if(-1===t)return null;const[n]=f.value.splice(t,1);return n},removeFromQueue:function(e){const t=f.value.findIndex(t=>t.id===e);return-1!==t&&(f.value.splice(t,1),!0)},clearQueue:M,prependToQueue:function(e){const t=e.contexts.length>0?rc({text:"",contexts:e.contexts}):[],n=lc(e.ideContext),s=[...t,...e.contents,...n],o=[...e.contents,...t,...n],i=`user-${Date.now()}`;wc.info(`[useSessionMessages] æ¶ˆæ¯æ’å…¥é˜Ÿåˆ—æœ€å‰é¢: ${i}`),f.value.unshift({id:i,contexts:e.contexts,contents:e.contents,ideContext:e.ideContext,uiContent:s,mergedContent:o,createdAt:Date.now()})},setInterruptMode:function(e){g=e,wc.info(`[useSessionMessages] è®¾ç½®æ‰“æ–­æ¨¡å¼: ${e}`)},findStreamingAssistantMessage:E,clearMessages:R,reset:function(){R(),M(),m.value=!1,y.value=null,wc.debug("[useSessionMessages] çŠ¶æ€å·²é‡ç½®")},addErrorMessage:function(e){c([{id:`error-${Date.now()}`,displayType:"errorResult",timestamp:Date.now(),message:e}]),N()},truncateMessages:function(e,t){wc.info(`[useSessionMessages] æ›´æ–°å¹¶æˆªæ–­æ¶ˆæ¯: uuid=${e}`);const o=s.findIndex(t=>fl(t)&&t.uuid===e);if(-1===o)return wc.warn(`[useSessionMessages] æœªæ‰¾åˆ° uuid=${e} çš„æ¶ˆæ¯`),null;const r=s[o];r.content=t.contents,r.contexts=t.contexts,r.uuid=void 0,r.requestStats=void 0;const a=[...(t.contexts?.length??0)>0?rc({text:"",contexts:t.contexts}):[],...t.contents],l=n.findIndex(e=>e.id===r.id);let c;-1!==l?(n[l].content=a,c=n[l],n.splice(l+1),wc.info(`[useSessionMessages] ä»Ž messages index=${l+1} å¼€å§‹æˆªæ–­`)):(c={id:r.id,role:"user",timestamp:Date.now(),content:a},wc.warn("[useSessionMessages] æœªæ‰¾åˆ°å¯¹åº”çš„ messageï¼Œåˆ›å»ºæ–°çš„"));const u=s.slice(0,o+1);return i.clear(),u.length>0&&i.pushBatch(u),s.splice(0,s.length,...u),wc.info(`[useSessionMessages] æˆªæ–­å®Œæˆ: displayItems å‰©ä½™ ${s.length} ä¸ª, messages å‰©ä½™ ${n.length} ä¸ª`),{userMessage:c,mergedContent:a}},pushDisplayItems:c,prependDisplayItems:u,refreshDisplayWindow:l}}class Cc{constructor(){De(this,"listeners",new Map),De(this,"isReady",!1),De(this,"mode","browser"),this.setupEventListener(),this.init()}getBaseUrl(){if("undefined"==typeof window)return"";const e=window;return e.__serverUrl?e.__serverUrl:(e.__IDEA_MODE__,window.location.origin)}detectMode(){if("undefined"==typeof window)return"browser";return window.__IDEA_MODE__?"ide":"browser"}refreshMode(){return this.mode=this.detectMode(),this.mode}async init(){"undefined"!=typeof window&&(this.refreshMode(),this.isReady=!0,console.log("ðŸŒ Bridge Mode: HTTP"),console.log("ðŸ”— Server URL:",this.getBaseUrl()))}setupEventListener(){if("undefined"==typeof window)return;window.addEventListener("ide-event",e=>{const t=e,{type:n,data:s}=t.detail;this.dispatchEvent({type:n,data:s})})}dispatchEvent(e){const t=this.listeners.get(e.type);t&&t.forEach(t=>{try{t(e.data)}catch(n){console.error(`Error in event handler for ${e.type}:`,n)}})}async waitForReady(){if(!this.isReady)return new Promise(e=>{const t=setInterval(()=>{this.isReady&&(clearInterval(t),e())},100);setTimeout(()=>{clearInterval(t),console.warn("âš ï¸ Bridge ready timeout"),e()},5e3)})}async query(e,t){await this.waitForReady();try{const n=await fetch(`${this.getBaseUrl()}/api/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:e,data:t})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return await n.json()}catch(n){return console.error(`HTTP query failed for ${e}:`,n),{success:!1,error:n instanceof Error?n.message:"Unknown error"}}}getServerUrl(){return this.getBaseUrl()}getMode(){return this.refreshMode()}isInIde(){return"ide"===this.refreshMode()}isInBrowser(){return"browser"===this.refreshMode()}checkReady(){return this.isReady}getServerPort(){try{return new URL(this.getBaseUrl()).port||"80"}catch{return"8765"}}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){this.listeners.get(e)?.delete(t)}}let Tc=null;function Ec(){return Tc||(Tc=new Cc),Tc}const Ic=(e,t)=>Ec().query(e,t),xc=()=>Ec().getMode(),Ac=()=>Ec().waitForReady();const Nc={openFile:async function(e,t){return Ec().query("ide.openFile",{filePath:e,...t})},showDiff:async function(e){return Ec().query("ide.showDiff",e)},searchFiles:async function(e,t){return Ec().query("ide.searchFiles",{query:e,maxResults:t||20})},getFileContent:async function(e,t,n){return Ec().query("ide.getFileContent",{filePath:e,lineStart:t,lineEnd:n})},getLocale:async function(){return Ec().query("ide.getLocale")},setLocale:async function(e){return Ec().query("ide.setLocale",e)},detectNode:async function(){return Ec().query("node.detect")},openUrl:async function(e){return Ec().isInIde()?Ec().query("ide.openUrl",{url:e}):(window.open(e,"_blank"),{success:!0})}},Mc=$i("ChNqZXRicmFpbnNfYXBpLnByb3RvEhRjb20uYXNha2lpLnJwYy5wcm90byI7ChVKZXRCcmFpbnNDYXBhYmlsaXRpZXMSEQoJc3VwcG9ydGVkGAEgASgIEg8KB3ZlcnNpb24YAiABKAkikAQKDUlkZVRoZW1lUHJvdG8SEgoKYmFja2dyb3VuZBgBIAEoCRISCgpmb3JlZ3JvdW5kGAIgASgJEhQKDGJvcmRlcl9jb2xvchgDIAEoCRIYChBwYW5lbF9iYWNrZ3JvdW5kGAQgASgJEh0KFXRleHRfZmllbGRfYmFja2dyb3VuZBgFIAEoCRIcChRzZWxlY3Rpb25fYmFja2dyb3VuZBgGIAEoCRIcChRzZWxlY3Rpb25fZm9yZWdyb3VuZBgHIAEoCRISCgpsaW5rX2NvbG9yGAggASgJEhMKC2Vycm9yX2NvbG9yGAkgASgJEhUKDXdhcm5pbmdfY29sb3IYCiABKAkSFQoNc3VjY2Vzc19jb2xvchgLIAEoCRIXCg9zZXBhcmF0b3JfY29sb3IYDCABKAkSGAoQaG92ZXJfYmFja2dyb3VuZBgNIAEoCRIUCgxhY2NlbnRfY29sb3IYDiABKAkSFwoPaW5mb19iYWNrZ3JvdW5kGA8gASgJEhcKD2NvZGVfYmFja2dyb3VuZBgQIAEoCRIcChRzZWNvbmRhcnlfZm9yZWdyb3VuZBgRIAEoCRITCgtmb250X2ZhbWlseRgSIAEoCRIRCglmb250X3NpemUYEyABKAUSGgoSZWRpdG9yX2ZvbnRfZmFtaWx5GBQgASgJEhgKEGVkaXRvcl9mb250X3NpemUYFSABKAUivQEKGEpldEJyYWluc09wZW5GaWxlUmVxdWVzdBIRCglmaWxlX3BhdGgYASABKAkSEQoEbGluZRgCIAEoBUgAiAEBEhMKBmNvbHVtbhgDIAEoBUgBiAEBEhkKDHN0YXJ0X29mZnNldBgEIAEoBUgCiAEBEhcKCmVuZF9vZmZzZXQYBSABKAVIA4gBAUIHCgVfbGluZUIJCgdfY29sdW1uQg8KDV9zdGFydF9vZmZzZXRCDQoLX2VuZF9vZmZzZXQidQoYSmV0QnJhaW5zU2hvd0RpZmZSZXF1ZXN0EhEKCWZpbGVfcGF0aBgBIAEoCRITCgtvbGRfY29udGVudBgCIAEoCRITCgtuZXdfY29udGVudBgDIAEoCRISCgV0aXRsZRgEIAEoCUgAiAEBQggKBl90aXRsZSJVChZKZXRCcmFpbnNFZGl0T3BlcmF0aW9uEhIKCm9sZF9zdHJpbmcYASABKAkSEgoKbmV3X3N0cmluZxgCIAEoCRITCgtyZXBsYWNlX2FsbBgDIAEoCCKlAQohSmV0QnJhaW5zU2hvd011bHRpRWRpdERpZmZSZXF1ZXN0EhEKCWZpbGVfcGF0aBgBIAEoCRI7CgVlZGl0cxgCIAMoCzIsLmNvbS5hc2FraWkucnBjLnByb3RvLkpldEJyYWluc0VkaXRPcGVyYXRpb24SHAoPY3VycmVudF9jb250ZW50GAMgASgJSACIAQFCEgoQX2N1cnJlbnRfY29udGVudCKPAQofSmV0QnJhaW5zU2hvd0VkaXRQcmV2aWV3UmVxdWVzdBIRCglmaWxlX3BhdGgYASABKAkSOwoFZWRpdHMYAiADKAsyLC5jb20uYXNha2lpLnJwYy5wcm90by5KZXRCcmFpbnNFZGl0T3BlcmF0aW9uEhIKBXRpdGxlGAMgASgJSACIAQFCCAoGX3RpdGxlIk0KHEpldEJyYWluc1Nob3dNYXJrZG93blJlcXVlc3QSDwoHY29udGVudBgBIAEoCRISCgV0aXRsZRgCIAEoCUgAiAEBQggKBl90aXRsZSKgAQoXSmV0QnJhaW5zU2Vzc2lvblN1bW1hcnkSCgoCaWQYASABKAkSDQoFdGl0bGUYAiABKAkSFwoKc2Vzc2lvbl9pZBgDIAEoCUgAiAEBEhUKDWlzX2dlbmVyYXRpbmcYBCABKAgSFAoMaXNfY29ubmVjdGVkGAUgASgIEhUKDWlzX2Nvbm5lY3RpbmcYBiABKAhCDQoLX3Nlc3Npb25faWQijgEKFUpldEJyYWluc1Nlc3Npb25TdGF0ZRI/CghzZXNzaW9ucxgBIAMoCzItLmNvbS5hc2FraWkucnBjLnByb3RvLkpldEJyYWluc1Nlc3Npb25TdW1tYXJ5Eh4KEWFjdGl2ZV9zZXNzaW9uX2lkGAIgASgJSACIAQFCFAoSX2FjdGl2ZV9zZXNzaW9uX2lkIsYBChdKZXRCcmFpbnNTZXNzaW9uQ29tbWFuZBI/CgR0eXBlGAEgASgOMjEuY29tLmFzYWtpaS5ycGMucHJvdG8uSmV0QnJhaW5zU2Vzc2lvbkNvbW1hbmRUeXBlEhcKCnNlc3Npb25faWQYAiABKAlIAIgBARIVCghuZXdfbmFtZRgDIAEoCUgBiAEBEhMKBmxvY2FsZRgEIAEoCUgCiAEBQg0KC19zZXNzaW9uX2lkQgsKCV9uZXdfbmFtZUIJCgdfbG9jYWxlIksKGkpldEJyYWluc09wZXJhdGlvblJlc3BvbnNlEg8KB3N1Y2Nlc3MYASABKAgSEgoFZXJyb3IYAiABKAlIAIgBAUIICgZfZXJyb3IiGgoYSmV0QnJhaW5zR2V0VGhlbWVSZXF1ZXN0Ik8KGUpldEJyYWluc0dldFRoZW1lUmVzcG9uc2USMgoFdGhlbWUYASABKAsyIy5jb20uYXNha2lpLnJwYy5wcm90by5JZGVUaGVtZVByb3RvIiAKHkpldEJyYWluc0dldFByb2plY3RQYXRoUmVxdWVzdCI3Ch9KZXRCcmFpbnNHZXRQcm9qZWN0UGF0aFJlc3BvbnNlEhQKDHByb2plY3RfcGF0aBgBIAEoCSIbChlKZXRCcmFpbnNHZXRMb2NhbGVSZXF1ZXN0IiwKGkpldEJyYWluc0dldExvY2FsZVJlc3BvbnNlEg4KBmxvY2FsZRgBIAEoCSIrChlKZXRCcmFpbnNTZXRMb2NhbGVSZXF1ZXN0Eg4KBmxvY2FsZRgBIAEoCSqoAgobSmV0QnJhaW5zU2Vzc2lvbkNvbW1hbmRUeXBlEh8KG1NFU1NJT05fQ09NTUFORF9VTlNQRUNJRklFRBAAEhoKFlNFU1NJT05fQ09NTUFORF9TV0lUQ0gQARIaChZTRVNTSU9OX0NPTU1BTkRfQ1JFQVRFEAISGQoVU0VTU0lPTl9DT01NQU5EX0NMT1NFEAMSGgoWU0VTU0lPTl9DT01NQU5EX1JFTkFNRRAEEiIKHlNFU1NJT05fQ09NTUFORF9UT0dHTEVfSElTVE9SWRAFEh4KGlNFU1NJT05fQ09NTUFORF9TRVRfTE9DQUxFEAYSGgoWU0VTU0lPTl9DT01NQU5EX0RFTEVURRAHEhkKFVNFU1NJT05fQ09NTUFORF9SRVNFVBAIQisKFGNvbS5hc2FraWkucnBjLnByb3RvQhFKZXRCcmFpbnNBcGlQcm90b1ABYgZwcm90bzM"),Rc=Ho(Mc,2),_c=Ho(Mc,3),Oc=Ho(Mc,4),Dc=Ho(Mc,5),Bc=Ho(Mc,6),Lc=Ho(Mc,7),Fc=Ho(Mc,8),Pc=Ho(Mc,9),$c=Ho(Mc,11),Uc=Ho(Mc,13),Vc=Ho(Mc,15),Wc=Ho(Mc,17),Gc=Ho(Mc,18);function zc(e){const t=Di($c,e);return{success:t.success,error:t.error||void 0}}function Hc(e){switch(e){case"switch":return"switch";case"create":return"create";case"close":return"close";case"rename":return"rename";case"toggleHistory":return"toggleHistory";case"setLocale":return"setLocale";case"delete":return"delete";case"reset":return"reset";default:return console.warn(`[JetBrainsRSocket] Unknown session command type: ${e}`),e}}const Kc=new class{constructor(){De(this,"client",null),De(this,"themeChangeHandlers",[]),De(this,"sessionCommandHandlers",[]),De(this,"settingsChangeHandlers",[]),De(this,"activeFileChangeHandlers",[]),De(this,"connected",!1)}async connect(){if(this.connected)return!0;try{const e=Za().replace(/^http/,"ws")+"/jetbrains-rsocket";return this.client=new il({url:e}),this.client.registerHandler("onThemeChanged",async e=>{console.log("[JetBrainsRSocket] æ”¶åˆ°ä¸»é¢˜å˜åŒ–æŽ¨é€ (Protobuf)");const t={background:e.background,foreground:e.foreground,borderColor:e.borderColor,panelBackground:e.panelBackground,textFieldBackground:e.textFieldBackground,selectionBackground:e.selectionBackground,selectionForeground:e.selectionForeground,linkColor:e.linkColor,errorColor:e.errorColor,warningColor:e.warningColor,successColor:e.successColor,separatorColor:e.separatorColor,hoverBackground:e.hoverBackground,accentColor:e.accentColor,infoBackground:e.infoBackground,codeBackground:e.codeBackground,secondaryForeground:e.secondaryForeground,fontFamily:e.fontFamily,fontSize:e.fontSize,editorFontFamily:e.editorFontFamily,editorFontSize:e.editorFontSize};return this.themeChangeHandlers.forEach(e=>e(t)),{}}),this.client.registerHandler("onSessionCommand",async e=>{console.log("[JetBrainsRSocket] æ”¶åˆ°ä¼šè¯å‘½ä»¤æŽ¨é€ (Protobuf)");const t={type:Hc(e.type),sessionId:e.sessionId,newName:e.newName,locale:e.locale};return console.log("[JetBrainsRSocket] ä¼šè¯å‘½ä»¤:",t),this.sessionCommandHandlers.forEach(e=>e(t)),{}}),this.client.registerHandler("onSettingsChanged",async e=>{console.log("[JetBrainsRSocket] æ”¶åˆ°è®¾ç½®å˜æ›´æŽ¨é€ (Protobuf)");const t=e.settings||e,n={defaultModelId:t.defaultModelId||"",defaultModelName:t.defaultModelName||"",defaultBypassPermissions:t.defaultBypassPermissions??!1,enableUserInteractionMcp:t.enableUserInteractionMcp??!0,enableJetbrainsMcp:t.enableJetbrainsMcp??!0,includePartialMessages:t.includePartialMessages??!0,defaultThinkingLevel:t.defaultThinkingLevel||"ULTRA",defaultThinkingTokens:t.defaultThinkingTokens??8096,defaultThinkingLevelId:t.defaultThinkingLevelId||"ultra",thinkingLevels:t.thinkingLevels||[{id:"off",name:"Off",tokens:0,isCustom:!1},{id:"think",name:"Think",tokens:2048,isCustom:!1},{id:"ultra",name:"Ultra",tokens:8096,isCustom:!1}],permissionMode:t.permissionMode||"default"};return console.log("[JetBrainsRSocket] è®¾ç½®å˜æ›´:",n),this.settingsChangeHandlers.forEach(e=>e(n)),{}}),this.client.registerHandler("onActiveFileChanged",async e=>{console.log("[JetBrainsRSocket] æ”¶åˆ°æ´»è·ƒæ–‡ä»¶å˜æ›´æŽ¨é€ (Protobuf)");let t=null;return e.hasActiveFile?(t={path:e.path||"",relativePath:e.relativePath||"",name:e.name||"",line:e.line||void 0,column:e.column||void 0,hasSelection:e.hasSelection||!1,startLine:e.startLine||void 0,startColumn:e.startColumn||void 0,endLine:e.endLine||void 0,endColumn:e.endColumn||void 0,selectedContent:e.selectedContent||void 0},console.log("[JetBrainsRSocket] æ´»è·ƒæ–‡ä»¶:",t.relativePath,t.hasSelection?`(selection: ${t.startLine}:${t.startColumn} - ${t.endLine}:${t.endColumn}, content: ${t.selectedContent?.substring(0,50)}...)`:"")):console.log("[JetBrainsRSocket] æ— æ´»è·ƒæ–‡ä»¶"),this.activeFileChangeHandlers.forEach(e=>e(t)),{}}),await this.client.connect(),this.connected=!0,console.log("[JetBrainsRSocket] Connected"),!0}catch(e){return console.error("[JetBrainsRSocket] Connection failed:",e),!1}}disconnect(){this.client&&(this.client.disconnect(),this.client=null,this.connected=!1,console.log("[JetBrainsRSocket] Disconnected"))}isConnected(){return this.connected}async openFile(e){if(!this.client)return!1;try{const t=function(e){const t=Xn(Rc,{filePath:e.filePath,line:e.line,column:e.column,startOffset:e.startOffset,endOffset:e.endOffset});return Vi(Rc,t)}(e),n=zc(await this.client.requestResponse("jetbrains.openFile",t));return n.success&&console.log("[JetBrainsRSocket] Opened file:",e.filePath),n.success}catch(t){return console.error("[JetBrainsRSocket] Failed to open file:",t),!1}}async showDiff(e){if(!this.client)return!1;try{const t=function(e){const t=Xn(_c,{filePath:e.filePath,oldContent:e.oldContent,newContent:e.newContent,title:e.title});return Vi(_c,t)}(e),n=zc(await this.client.requestResponse("jetbrains.showDiff",t));return n.success&&console.log("[JetBrainsRSocket] Showing diff for:",e.filePath),n.success}catch(t){return console.error("[JetBrainsRSocket] Failed to show diff:",t),!1}}async showMultiEditDiff(e){if(!this.client)return!1;try{const t=function(e){const t=Xn(Dc,{filePath:e.filePath,edits:e.edits.map(e=>Xn(Oc,{oldString:e.oldString,newString:e.newString,replaceAll:e.replaceAll})),currentContent:e.currentContent});return Vi(Dc,t)}(e),n=zc(await this.client.requestResponse("jetbrains.showMultiEditDiff",t));return n.success&&console.log("[JetBrainsRSocket] Showing multi-edit diff for:",e.filePath),n.success}catch(t){return console.error("[JetBrainsRSocket] Failed to show multi-edit diff:",t),!1}}async showEditPreviewDiff(e){if(!this.client)return!1;try{const t=function(e){const t=Xn(Bc,{filePath:e.filePath,edits:e.edits.map(e=>Xn(Oc,{oldString:e.oldString,newString:e.newString,replaceAll:e.replaceAll})),title:e.title});return Vi(Bc,t)}(e),n=zc(await this.client.requestResponse("jetbrains.showEditPreviewDiff",t));return n.success&&console.log("[JetBrainsRSocket] Showing edit preview diff for:",e.filePath),n.success}catch(t){return console.error("[JetBrainsRSocket] Failed to show edit preview diff:",t),!1}}async showMarkdown(e){if(!this.client)return!1;try{const t=function(e){const t=Xn(Lc,{content:e.content,title:e.title});return Vi(Lc,t)}(e),n=zc(await this.client.requestResponse("jetbrains.showMarkdown",t));return n.success&&console.log("[JetBrainsRSocket] Showing markdown:",e.title||"Plan Preview"),n.success}catch(t){return console.error("[JetBrainsRSocket] Failed to show markdown:",t),!1}}async getTheme(){if(!this.client)return null;try{return function(e){const t=Di(Uc,e);if(!t.theme)return null;const n=t.theme;return{background:n.background,foreground:n.foreground,borderColor:n.borderColor,panelBackground:n.panelBackground,textFieldBackground:n.textFieldBackground,selectionBackground:n.selectionBackground,selectionForeground:n.selectionForeground,linkColor:n.linkColor,errorColor:n.errorColor,warningColor:n.warningColor,successColor:n.successColor,separatorColor:n.separatorColor,hoverBackground:n.hoverBackground,accentColor:n.accentColor,infoBackground:n.infoBackground,codeBackground:n.codeBackground,secondaryForeground:n.secondaryForeground,fontFamily:n.fontFamily,fontSize:n.fontSize,editorFontFamily:n.editorFontFamily,editorFontSize:n.editorFontSize}}(await this.client.requestResponse("jetbrains.getTheme",new Uint8Array))}catch(e){return console.error("[JetBrainsRSocket] Failed to get theme:",e),null}}async getSettings(){if(!this.client)return null;try{return function(e){const t=[{id:"off",name:"Off",tokens:0,isCustom:!1},{id:"think",name:"Think",tokens:2048,isCustom:!1},{id:"ultra",name:"Ultra",tokens:8096,isCustom:!1}],n=Di(gr,e).settings;return n?{defaultModelId:n.defaultModelId||"",defaultModelName:n.defaultModelName||"",defaultBypassPermissions:n.defaultBypassPermissions,enableUserInteractionMcp:n.enableUserInteractionMcp,enableJetbrainsMcp:n.enableJetbrainsMcp,includePartialMessages:n.includePartialMessages,defaultThinkingLevel:n.defaultThinkingLevel||"ULTRA",defaultThinkingTokens:n.defaultThinkingTokens||8096,defaultThinkingLevelId:n.defaultThinkingLevelId||"ultra",thinkingLevels:n.thinkingLevels.length>0?n.thinkingLevels.map(e=>({id:e.id,name:e.name,tokens:e.tokens,isCustom:e.isCustom})):t,permissionMode:n.permissionMode||"default"}:{defaultModelId:"",defaultModelName:"",defaultBypassPermissions:!1,enableUserInteractionMcp:!0,enableJetbrainsMcp:!0,includePartialMessages:!0,defaultThinkingLevel:"ULTRA",defaultThinkingTokens:8096,defaultThinkingLevelId:"ultra",thinkingLevels:t,permissionMode:"default"}}(await this.client.requestResponse("jetbrains.getSettings",new Uint8Array))}catch(e){return console.error("[JetBrainsRSocket] Failed to get settings:",e),null}}async getLocale(){if(!this.client)return"en-US";try{const e=await this.client.requestResponse("jetbrains.getLocale",new Uint8Array);return Di(Wc,e).locale||"en-US"}catch(e){return console.error("[JetBrainsRSocket] Failed to get locale:",e),"en-US"}}async setLocale(e){if(!this.client)return!1;try{const t=function(e){const t=Xn(Gc,{locale:e});return Vi(Gc,t)}(e),n=await this.client.requestResponse("jetbrains.setLocale",t);return zc(n).success}catch(t){return console.error("[JetBrainsRSocket] Failed to set locale:",t),!1}}async getProjectPath(){if(!this.client)return null;try{const e=await this.client.requestResponse("jetbrains.getProjectPath",new Uint8Array);return Di(Vc,e).projectPath||""}catch(e){return console.error("[JetBrainsRSocket] Failed to get project path:",e),null}}async getActiveFile(){if(!this.client)return null;try{return function(e){const t=Di(Sr,e);return t.hasActiveFile?{path:t.path||"",relativePath:t.relativePath||"",name:t.name||"",line:t.line||void 0,column:t.column||void 0,hasSelection:t.hasSelection,startLine:t.startLine||void 0,startColumn:t.startColumn||void 0,endLine:t.endLine||void 0,endColumn:t.endColumn||void 0,selectedContent:t.selectedContent||void 0}:null}(await this.client.requestResponse("jetbrains.getActiveFile",new Uint8Array))}catch(e){return console.error("[JetBrainsRSocket] Failed to get active file:",e),null}}async reportSessionState(e){if(!this.client)return!1;try{const t=function(e){const t=Xn(Pc,{sessions:e.sessions.map(e=>Xn(Fc,{id:e.id,title:e.title,sessionId:e.sessionId||void 0,isGenerating:e.isGenerating,isConnected:e.isConnected,isConnecting:e.isConnecting})),activeSessionId:e.activeSessionId||void 0});return Vi(Pc,t)}(e),n=zc(await this.client.requestResponse("jetbrains.reportSessionState",t));return n.success&&console.log("[JetBrainsRSocket] Reported session state:",e.sessions.length,"sessions"),n.success}catch(t){return console.error("[JetBrainsRSocket] Failed to report session state:",t),!1}}onThemeChange(e){return this.themeChangeHandlers.push(e),()=>{const t=this.themeChangeHandlers.indexOf(e);t>=0&&this.themeChangeHandlers.splice(t,1)}}onSessionCommand(e){return this.sessionCommandHandlers.push(e),()=>{const t=this.sessionCommandHandlers.indexOf(e);t>=0&&this.sessionCommandHandlers.splice(t,1)}}onSettingsChange(e){return this.settingsChangeHandlers.push(e),()=>{const t=this.settingsChangeHandlers.indexOf(e);t>=0&&this.settingsChangeHandlers.splice(t,1)}}onActiveFileChange(e){return this.activeFileChangeHandlers.push(e),()=>{const t=this.activeFileChangeHandlers.indexOf(e);t>=0&&this.activeFileChangeHandlers.splice(t,1)}}},jc={defaultBackendType:"claude",permissionMode:"default",skipPermissions:!1,includePartialMessages:!0,maxTurns:null,claudeConfig:{...vl,permissionMode:"default",skipPermissions:!1,maxTurns:null},codexConfig:{...bl,permissionMode:"default",skipPermissions:!1,maxTurns:null},claudeModel:"claude-sonnet-4-5-20251101",claudeThinkingEnabled:!0,claudeThinkingTokens:8096,codexModel:"gpt-5.1-codex-max",codexReasoningEffort:"medium",codexReasoningSummary:"auto",codexSandboxMode:"workspace-write"},Yc=ze("settings",()=>{const e=Ge({...jc}),t=Ge(null),n=Ge(!1),s=Ge(!1);let o=null;const i=Ge(Pl),r=Ge($l);function a(t){return"claude"===t?e.value.claudeModel:e.value.codexModel}function l(t,n){"claude"===t?e.value.claudeModel=n:e.value.codexModel=n,console.log(`ðŸŽ¯ [${t}] æ¨¡åž‹å·²æ›´æ–°:`,n)}function c(t){return"claude"===t?function(e=!0,t=8096){return{type:"claude",enabled:e,tokenBudget:t}}(e.value.claudeThinkingEnabled,e.value.claudeThinkingTokens):function(e="medium",t="auto"){return{type:"codex",effort:e,summary:t}}(e.value.codexReasoningEffort,e.value.codexReasoningSummary)}const u=We(()=>e.value.codexSandboxMode),d=We(()=>e.value.defaultBackendType),p=We(()=>a(e.value.defaultBackendType)),h=We(()=>c(e.value.defaultBackendType));async function f(){try{console.log("ðŸ“¦ Loading available models from backend...");const t=await Ic("models.getAvailable");if(t.success&&t.data){const{claudeModels:n,codexModels:s,defaultBackendType:o,defaultClaudeModelId:a,defaultCodexModelId:l}=t.data;i.value=n,r.value=s,console.log("âœ… Available models loaded:",{claude:n.length,codex:s.length,defaultBackend:o,defaultClaude:a,defaultCodex:l});const c=e.value.claudeModel;!n.some(e=>e.id===c)&&c&&(console.log("âš ï¸ Current Claude model not found, switching to default:",a),e.value.claudeModel=a);const u=e.value.codexModel;return!s.some(e=>e.id===u)&&u&&(console.log("âš ï¸ Current Codex model not found, switching to default:",l),e.value.codexModel=l),!0}return console.warn("âš ï¸ Failed to load available models"),!1}catch(t){return console.error("âŒ Error loading available models:",t),!1}}function m(t){const n={};if(t.defaultBackendType&&(n.defaultBackendType=t.defaultBackendType,console.log("ðŸ”„ [IdeSettings] é»˜è®¤åŽç«¯ç±»åž‹:",t.defaultBackendType)),t.claudeDefaultModelId){const e=i.value.find(e=>e.id===t.claudeDefaultModelId);e?(n.claudeModel=e.id,console.log("ðŸŽ¯ [IdeSettings] Claude é»˜è®¤æ¨¡åž‹:",e.displayName,`(${e.id})`)):console.warn("âš ï¸ [IdeSettings] æœªçŸ¥çš„ Claude æ¨¡åž‹ ID:",t.claudeDefaultModelId)}else if(t.defaultModelId){const e=i.value.find(e=>e.id===t.defaultModelId);e&&(n.claudeModel=e.id,console.log("ðŸŽ¯ [IdeSettings] Claude é»˜è®¤æ¨¡åž‹ (å…¼å®¹):",e.displayName))}const s=t.claudeThinkingLevelId||t.defaultThinkingLevelId||"ultra",o=t.claudeThinkingTokens??t.defaultThinkingTokens??8096;if(n.claudeThinkingEnabled="off"!==s&&o>0,n.claudeThinkingTokens=o,console.log("ðŸ§  [IdeSettings] Claude æ€è€ƒé…ç½®:",{levelId:s,tokens:o,enabled:n.claudeThinkingEnabled,levels:t.claudeThinkingLevels}),t.codexDefaultModelId){const e=r.value.find(e=>e.id===t.codexDefaultModelId);e?(n.codexModel=e.id,console.log("ðŸŽ¯ [IdeSettings] Codex é»˜è®¤æ¨¡åž‹:",e.displayName,`(${e.id})`)):console.warn("âš ï¸ [IdeSettings] æœªçŸ¥çš„ Codex æ¨¡åž‹ ID:",t.codexDefaultModelId)}t.codexReasoningEffort&&(n.codexReasoningEffort=t.codexReasoningEffort,console.log("ðŸ§  [IdeSettings] Codex æŽ¨ç†åŠªåŠ›çº§åˆ«:",t.codexReasoningEffort)),t.codexSandboxMode&&(n.codexSandboxMode=t.codexSandboxMode,console.log("ðŸ“¦ [IdeSettings] Codex æ²™ç›’æ¨¡å¼:",t.codexSandboxMode)),void 0!==t.codexApiKey&&(n.codexApiKey=t.codexApiKey,console.log("ðŸ”‘ [IdeSettings] Codex API Key å·²é…ç½®"));const a=t.defaultBypassPermissions??!1;n.skipPermissions=a,console.log("ðŸ”“ [IdeSettings] ByPass æƒé™è®¾ç½®:",a),void 0!==t.includePartialMessages&&(n.includePartialMessages=t.includePartialMessages,console.log("ðŸ“¡ [IdeSettings] Include Partial Messages:",t.includePartialMessages)),t.permissionMode&&(n.permissionMode=t.permissionMode,console.log("ðŸ”’ [IdeSettings] æƒé™æ¨¡å¼:",t.permissionMode)),Object.keys(n).length>0&&(e.value={...e.value,...n},console.log("âœ… [IdeSettings] å·²åº”ç”¨ IDE é»˜è®¤è®¾ç½®:",n))}async function g(e){console.log("ðŸ“¥ [IdeSettings] æ”¶åˆ°è®¾ç½®å˜æ›´æŽ¨é€:",e),t.value=e,await f(),m(e)}function y(t){return e.value={...e.value,...t},console.log("ðŸ’¾ Settings saved locally:",t),!0}return{settings:e,ideSettings:t,loading:n,showPanel:s,claudeModels:i,codexModels:r,codexSandboxMode:u,currentBackendType:d,currentModel:p,currentThinkingConfig:h,getModelsForBackend:function(e){return"claude"===e?i.value:r.value},getCurrentModelForBackend:a,setModelForBackend:l,getThinkingConfigForBackend:c,setThinkingConfigForBackend:function(t,n){"claude"===n.type?(e.value.claudeThinkingEnabled=n.enabled,e.value.claudeThinkingTokens=n.tokenBudget,console.log("ðŸ§  [Claude] æ€è€ƒé…ç½®å·²æ›´æ–°:",{enabled:n.enabled,tokens:n.tokenBudget})):(e.value.codexReasoningEffort=n.effort,e.value.codexReasoningSummary=n.summary,console.log("ðŸ§  [Codex] æŽ¨ç†é…ç½®å·²æ›´æ–°:",{effort:n.effort,summary:n.summary}))},setCodexSandboxMode:function(t){e.value.codexSandboxMode=t,console.log("ðŸ“¦ [Codex] æ²™ç›’æ¨¡å¼å·²æ›´æ–°:",t)},setCodexApiKey:function(t){e.value.codexApiKey=t,console.log("ðŸ”‘ [Codex] API Key å·²æ›´æ–°")},loadSettings:async function(){n.value=!0;try{console.log("âš™ï¸ Loading settings...");const n=await Ic("settings.get");n.success&&n.data?.settings?(e.value=(t=n.data.settings,{...jc,...t,claudeModel:t.claudeModel||t.model||jc.claudeModel,claudeThinkingEnabled:t.claudeThinkingEnabled??t.thinkingEnabled??!0,claudeThinkingTokens:t.claudeThinkingTokens??t.maxThinkingTokens??8096,codexModel:t.codexModel||jc.codexModel,codexReasoningEffort:t.codexReasoningEffort||jc.codexReasoningEffort,codexReasoningSummary:t.codexReasoningSummary||jc.codexReasoningSummary,codexSandboxMode:t.codexSandboxMode||jc.codexSandboxMode,defaultBackendType:t.defaultBackendType||"claude",permissionMode:t.permissionMode||jc.permissionMode,skipPermissions:t.skipPermissions??jc.skipPermissions,includePartialMessages:t.includePartialMessages??jc.includePartialMessages,maxTurns:t.maxTurns??jc.maxTurns}),console.log("âœ… Settings loaded:",e.value)):console.warn("âš ï¸ Failed to load settings, using defaults")}catch(s){console.error("âŒ Error loading settings:",s)}finally{n.value=!1}var t},loadIdeSettings:async function(){try{console.log("âš™ï¸ Loading IDE settings from JetBrains...");const[e,n]=await Promise.all([Kc.getSettings(),f()]);e?(t.value=e,console.log("âœ… IDE settings loaded:",e),m(e)):console.warn("âš ï¸ Failed to load IDE settings")}catch(e){console.error("âŒ Error loading IDE settings:",e)}},loadAvailableModels:f,loadDefaultSettings:async function(){try{console.log("âš™ï¸ Loading default settings from HTTP API...");const t=await Ic("settings.getDefault");if(t.success&&t.data){const n=t.data,s={};if(n.defaultBackendType&&(s.defaultBackendType=n.defaultBackendType),n.claudeDefaultModelId){const e=i.value.find(e=>e.id===n.claudeDefaultModelId);e&&(s.claudeModel=e.id,console.log("ðŸŽ¯ [DefaultSettings] Claude é»˜è®¤æ¨¡åž‹:",e.displayName,`(${e.id})`))}else if(n.defaultModelId){const e=i.value.find(e=>e.id===n.defaultModelId);e&&(s.claudeModel=e.id,console.log("ðŸŽ¯ [DefaultSettings] Claude é»˜è®¤æ¨¡åž‹ (å…¼å®¹):",e.displayName))}const o=n.claudeDefaultThinkingLevel||n.defaultThinkingLevel||"HIGH",a=n.claudeDefaultThinkingTokens??n.defaultThinkingTokens??8192;if(s.claudeThinkingEnabled="OFF"!==o&&a>0,s.claudeThinkingTokens=a,console.log("ðŸ§  [DefaultSettings] Claude æ€è€ƒé…ç½®:",{level:o,tokens:a,enabled:s.claudeThinkingEnabled}),n.codexDefaultModelId){const e=r.value.find(e=>e.id===n.codexDefaultModelId);e&&(s.codexModel=e.id,console.log("ðŸŽ¯ [DefaultSettings] Codex é»˜è®¤æ¨¡åž‹:",e.displayName,`(${e.id})`))}n.codexReasoningEffort&&(s.codexReasoningEffort=n.codexReasoningEffort,console.log("ðŸ§  [DefaultSettings] Codex æŽ¨ç†åŠªåŠ›çº§åˆ«:",n.codexReasoningEffort)),n.codexSandboxMode&&(s.codexSandboxMode=n.codexSandboxMode,console.log("ðŸ“¦ [DefaultSettings] Codex æ²™ç›’æ¨¡å¼:",n.codexSandboxMode)),s.skipPermissions=n.defaultBypassPermissions??!1,console.log("ðŸ”“ [DefaultSettings] ByPass æƒé™è®¾ç½®:",s.skipPermissions),void 0!==n.includePartialMessages&&(s.includePartialMessages=n.includePartialMessages,console.log("ðŸ“¡ [DefaultSettings] Include Partial Messages:",n.includePartialMessages)),Object.keys(s).length>0&&(e.value={...e.value,...s},console.log("âœ… [DefaultSettings] å·²åº”ç”¨é»˜è®¤è®¾ç½®:",s))}else console.warn("âš ï¸ Failed to load default settings from HTTP API")}catch(t){console.error("âŒ Error loading default settings:",t)}},initIdeSettingsListener:function(){o&&o(),o=Kc.onSettingsChange(g),console.log("ðŸ‘‚ [IdeSettings] å·²æ³¨å†Œè®¾ç½®å˜æ›´ç›‘å¬å™¨")},cleanupIdeSettingsListener:function(){o&&(o(),o=null,console.log("ðŸ§¹ [IdeSettings] å·²ç§»é™¤è®¾ç½®å˜æ›´ç›‘å¬å™¨"))},saveSettings:y,updateDefaultBackendType:async function(e){return await y({defaultBackendType:e})},updateModel:async function(t){return l(e.value.defaultBackendType,t),!0},updatePermissionMode:async function(e){return await y({permissionMode:e})},updateMaxTurns:async function(e){return await y({maxTurns:e})},updateThinkingEnabled:async function(t){return"claude"===e.value.defaultBackendType?await y({claudeThinkingEnabled:t}):await y({codexReasoningEffort:t?"medium":null})},resetToDefaults:async function(){return await y(jc)},loadBackendSettings:function(){e.value.claudeConfig={...e.value.claudeConfig,type:ml,modelId:e.value.claudeModel,thinkingEnabled:e.value.claudeThinkingEnabled,thinkingTokenBudget:e.value.claudeThinkingTokens,permissionMode:e.value.permissionMode,skipPermissions:e.value.skipPermissions,includePartialMessages:e.value.includePartialMessages,maxTurns:e.value.maxTurns},e.value.codexConfig={...e.value.codexConfig,type:gl,modelId:e.value.codexModel,reasoningEffort:e.value.codexReasoningEffort,reasoningSummary:e.value.codexReasoningSummary,sandboxMode:e.value.codexSandboxMode,permissionMode:e.value.permissionMode,skipPermissions:e.value.skipPermissions,maxTurns:e.value.maxTurns},console.log("âœ… [BackendSettings] åŽç«¯é…ç½®å·²åŒæ­¥:",{claude:e.value.claudeConfig,codex:e.value.codexConfig})},updateClaudeConfig:async function(t){return e.value.claudeConfig={...e.value.claudeConfig,...t,type:ml},void 0!==t.modelId&&(e.value.claudeModel=t.modelId),void 0!==t.thinkingEnabled&&(e.value.claudeThinkingEnabled=t.thinkingEnabled),void 0!==t.thinkingTokenBudget&&(e.value.claudeThinkingTokens=t.thinkingTokenBudget),void 0!==t.permissionMode&&(e.value.permissionMode=t.permissionMode),void 0!==t.skipPermissions&&(e.value.skipPermissions=t.skipPermissions),void 0!==t.includePartialMessages&&(e.value.includePartialMessages=t.includePartialMessages),void 0!==t.maxTurns&&(e.value.maxTurns=t.maxTurns),console.log("âœ… [ClaudeConfig] Claude é…ç½®å·²æ›´æ–°:",e.value.claudeConfig),!0},updateCodexConfig:async function(t){return e.value.codexConfig={...e.value.codexConfig,...t,type:gl},void 0!==t.modelId&&(e.value.codexModel=t.modelId),void 0!==t.reasoningEffort&&(e.value.codexReasoningEffort=t.reasoningEffort),void 0!==t.reasoningSummary&&(e.value.codexReasoningSummary=t.reasoningSummary),void 0!==t.sandboxMode&&(e.value.codexSandboxMode=t.sandboxMode),void 0!==t.permissionMode&&(e.value.permissionMode=t.permissionMode),void 0!==t.skipPermissions&&(e.value.skipPermissions=t.skipPermissions),void 0!==t.maxTurns&&(e.value.maxTurns=t.maxTurns),console.log("âœ… [CodexConfig] Codex é…ç½®å·²æ›´æ–°:",e.value.codexConfig),!0},getBackendConfig:function(t){return t===ml?e.value.claudeConfig:e.value.codexConfig},openPanel:function(){s.value=!0},closePanel:function(){s.value=!1},togglePanel:function(){s.value=!s.value}}}),Zc=tl.session,Xc={mode:"follow",anchor:null,newMessageCount:0};function Jc(e=0){const t=function(){const e=Ve(new Map),t=Ve(new Map),n=Ve(new Map),s=We(()=>Array.from(e.values()).filter(e=>e.status===pl.RUNNING)),o=We(()=>s.value.length>0),i=We(()=>e.size);function r(t,n){const s=e.get(t);return s?(s.input=n,hc.debug(`[useSessionTools] æ›´æ–°å·¥å…·è¾“å…¥: ${t}`),!0):(hc.warn(`[useSessionTools] æ›´æ–°è¾“å…¥å¤±è´¥ï¼šå·¥å…·è°ƒç”¨ ${t} ä¸å­˜åœ¨`),!1)}return{pendingToolCalls:e,toolCallsMap:t,toolInputJsonAccumulator:n,runningToolCalls:s,hasRunningToolCalls:o,totalToolCalls:i,registerToolCall:function(s){if(e.has(s.id))return hc.debug(`[useSessionTools] å·¥å…·è°ƒç”¨ ${s.id} å·²å­˜åœ¨ï¼Œè·³è¿‡æ³¨å†Œ`),e.get(s.id)||null;const o=uc(s,e);return e.set(s.id,o),t.set(s.id,{id:s.id,name:s.toolName,status:"running",startTime:Date.now()}),n.set(s.id,""),hc.debug(`[useSessionTools] æ³¨å†Œå·¥å…·è°ƒç”¨: ${s.id} (${s.toolName})`),o},updateToolResult:function(n,s){const o=e.get(n);if(!o)return hc.warn(`[useSessionTools] æ›´æ–°ç»“æžœå¤±è´¥ï¼šå·¥å…·è°ƒç”¨ ${n} ä¸å­˜åœ¨`),!1;const i="is_error"in s&&s.is_error;o.status=i?pl.FAILED:pl.SUCCESS,o.endTime=Date.now(),o.result=s;const r=t.get(n);return r&&(r.status=i?"failed":"success",r.result=s,r.endTime=Date.now()),hc.debug(`[useSessionTools] æ›´æ–°å·¥å…·ç»“æžœ: ${n}, çŠ¶æ€: ${o.status}`),!0},updateToolInput:r,appendJsonDelta:function(e,t){const s=(n.get(e)||"")+t;return n.set(e,s),s},getAccumulatedJson:function(e){return n.get(e)||""},parseAndApplyAccumulatedJson:function(e){const t=n.get(e);if(!t)return null;try{const n=JSON.parse(t);return r(e,n),n}catch(s){return hc.warn(`[useSessionTools] JSON è§£æžå¤±è´¥: ${e}, error:`,s),null}},getToolStatus:function(t){const n=e.get(t);return n?.status??null},getToolResult:function(t){const n=e.get(t);return n?.result},getToolCall:function(t){return e.get(t)},hasToolCall:function(t){return e.has(t)},cleanupCompletedToolCalls:function(s){let o=0;const i=Date.now(),r=s||3e5;for(const[a,l]of e)l.status!==pl.RUNNING&&l.endTime&&i-l.endTime>r&&(e.delete(a),t.delete(a),n.delete(a),o++);return o>0&&hc.debug(`[useSessionTools] æ¸…ç†äº† ${o} ä¸ªå·²å®Œæˆçš„å·¥å…·è°ƒç”¨`),o},reset:function(){e.clear(),t.clear(),n.clear(),hc.debug("[useSessionTools] çŠ¶æ€å·²é‡ç½®")}}}(),n=function(){const e=Ge(null),t=Ve({totalRequests:0,totalInputTokens:0,totalOutputTokens:0,totalDuration:0,successfulRequests:0,failedRequests:0}),n=Ge({inputTokens:0,outputTokens:0,cachedInputTokens:0,cacheCreationTokens:0,cacheReadTokens:0}),s=Ge(0),o=We(()=>null!==e.value),i=We(()=>e.value?Date.now()-e.value.requestStartTime:0),r=We(()=>0===t.totalRequests?0:Math.round(t.totalDuration/t.totalRequests)),a=We(()=>t.totalInputTokens+t.totalOutputTokens);function l(n=!0){if(!e.value)return null;const s=Date.now()-e.value.requestStartTime,o={requestDuration:s,inputTokens:e.value.inputTokens,outputTokens:e.value.outputTokens};return t.totalDuration+=s,n?t.successfulRequests++:t.failedRequests++,fc.debug(`[useSessionStats] è¯·æ±‚å®Œæˆ: duration=${s}ms, tokens=${o.inputTokens}+${o.outputTokens}`),o}function c(){t.totalRequests=0,t.totalInputTokens=0,t.totalOutputTokens=0,t.totalDuration=0,t.successfulRequests=0,t.failedRequests=0,n.value={inputTokens:0,outputTokens:0,cachedInputTokens:0,cacheCreationTokens:0,cacheReadTokens:0},fc.debug("[useSessionStats] ç´¯è®¡ç»Ÿè®¡å·²é‡ç½®")}return{requestTracker:e,cumulativeStats:t,streamingContentVersion:s,hasActiveRequest:o,currentRequestDuration:i,averageRequestDuration:r,totalTokens:a,startRequestTracking:function(n){e.value={lastUserMessageId:n,requestStartTime:Date.now(),inputTokens:0,outputTokens:0,currentStreamingMessageId:null},t.totalRequests++,fc.debug(`[useSessionStats] å¼€å§‹è¿½è¸ªè¯·æ±‚: ${n}`)},setStreamingMessageId:function(t){e.value&&(e.value.currentStreamingMessageId=t)},addTokenUsage:function(s,o,i=0){e.value&&(e.value.inputTokens+=s,e.value.outputTokens+=o),t.totalInputTokens+=s,t.totalOutputTokens+=o,n.value={inputTokens:s,outputTokens:o,cachedInputTokens:i,cacheCreationTokens:0,cacheReadTokens:i},fc.debug(`[useSessionStats] æ·»åŠ  Token ä½¿ç”¨: input=${s}, output=${o}, cacheRead=${i}`)},incrementContentVersion:function(){s.value++},getRequestStats:l,finishRequestTracking:function(t=!0){const n=l(t);return e.value=null,n},cancelRequestTracking:function(){if(e.value){t.failedRequests++;const n=Date.now()-e.value.requestStartTime;t.totalDuration+=n,fc.debug(`[useSessionStats] è¯·æ±‚å–æ¶ˆ: duration=${n}ms`)}e.value=null},getCurrentTracker:function(){return e.value?{...e.value}:null},getCumulativeStats:function(){return{...t}},getLastMessageUsage:function(){return{...n.value}},resetCumulativeStats:c,reset:function(){e.value=null,c(),fc.debug("[useSessionStats] æ‰€æœ‰çŠ¶æ€å·²é‡ç½®")}}}(),s=function(){const e=Ve(new Map),t=Ve(new Map),n=Ve([]),s=Ve([]),o=We(()=>e.size>0),i=We(()=>t.size>0),r=We(()=>Array.from(e.values())),a=We(()=>Array.from(t.values()));function l(t,n){const s=e.get(t);return!!s&&(s.reject(new Error(n||"Permission request cancelled")),e.delete(t),mc.info(`[useSessionPermissions] æƒé™è¯·æ±‚ ${t} å·²å–æ¶ˆ: ${n}`),!0)}function c(e,n){const s=t.get(e);return!!s&&(s.reject(new Error(n||"Question cancelled")),t.delete(e),mc.info(`[useSessionPermissions] é—®é¢˜ ${e} å·²å–æ¶ˆ: ${n}`),!0)}function u(e){const t=n.findIndex(t=>t.toolName===e.toolName&&t.ruleContent===e.ruleContent);t>=0?(n[t]=e,mc.debug(`[useSessionPermissions] æ›´æ–°æƒé™è§„åˆ™: ${e.toolName}`)):(n.push(e),mc.debug(`[useSessionPermissions] æ·»åŠ æƒé™è§„åˆ™: ${e.toolName}`))}function d(e,t){const s=n.length,o=n.filter(n=>t?!(n.toolName===e&&n.ruleContent===t):n.toolName!==e);n.splice(0,n.length,...o);const i=s-n.length;return mc.debug(`[useSessionPermissions] ç§»é™¤äº† ${i} æ¡æƒé™è§„åˆ™`),i}function p(e){s.includes(e)||(s.push(e),mc.debug(`[useSessionPermissions] æ·»åŠ å…è®¸ç›®å½•: ${e}`))}function h(e){const t=s.indexOf(e);return t>=0&&(s.splice(t,1),mc.debug(`[useSessionPermissions] ç§»é™¤å…è®¸ç›®å½•: ${e}`),!0)}function f(e){for(const t of e)if(!t.destination||"session"===t.destination)switch(t.type){case"addRules":if(t.rules&&t.behavior)for(const e of t.rules)u({toolName:e.toolName,ruleContent:e.ruleContent,behavior:t.behavior});break;case"removeRules":if(t.rules)for(const e of t.rules)d(e.toolName,e.ruleContent);break;case"addDirectories":if(t.directories)for(const e of t.directories)p(e);break;case"removeDirectories":if(t.directories)for(const e of t.directories)h(e)}}function m(t){const n=e.size;for(const[s]of e)l(s,t);return n}function g(e){const n=t.size;for(const[s]of t)c(s,e);return n}return{pendingPermissions:e,pendingQuestions:t,permissionRules:n,permissionDirectories:s,hasPendingPermissions:o,hasPendingQuestions:i,pendingPermissionList:r,pendingQuestionList:a,addPermissionRequest:function(t){const n={...t,createdAt:Date.now()};e.set(t.id,n),mc.info(`[useSessionPermissions] æ·»åŠ æƒé™è¯·æ±‚: ${t.id} (${t.toolName})`)},respondPermission:function(t,n){const s=e.get(t);return s?(n.approved&&n.permissionUpdates&&f(n.permissionUpdates),s.resolve(n),e.delete(t),mc.info(`[useSessionPermissions] æƒé™è¯·æ±‚ ${t} å·²å“åº”: approved=${n.approved}`),!0):(mc.warn(`[useSessionPermissions] æƒé™è¯·æ±‚ ${t} ä¸å­˜åœ¨`),!1)},cancelPermission:l,getPermissionForToolCall:function(t){for(const n of e.values())if(n.matchedToolCallId===t)return n},addUserQuestion:function(e){const n={...e,createdAt:Date.now()};t.set(e.id,n),mc.info(`[useSessionPermissions] æ·»åŠ ç”¨æˆ·é—®é¢˜: ${e.id}`)},answerQuestion:function(e,n){const s=t.get(e);if(!s)return mc.warn(`[useSessionPermissions] é—®é¢˜ ${e} ä¸å­˜åœ¨`),!1;const o=[];for(const t of s.questions){const e=n[t.header||t.question]??n[t.question]??(t.header?n[t.header]:void 0);e&&e.trim()&&o.push({question:t.question,header:t.header,answer:e.trim()})}return 0===o.length?(mc.warn(`[useSessionPermissions] é—®é¢˜ ${e} æ²¡æœ‰æœ‰æ•ˆç­”æ¡ˆï¼Œå¿½ç•¥æäº¤`),!1):(s.resolve(o),t.delete(e),mc.info(`[useSessionPermissions] é—®é¢˜ ${e} å·²å›žç­”`),!0)},cancelQuestion:c,addSessionPermissionRule:u,removeSessionPermissionRule:d,checkSessionPermission:function(e,t){for(const s of n)if(s.toolName===e){if(!s.ruleContent)return s.behavior;if(JSON.stringify(t||{}).includes(s.ruleContent))return s.behavior}return"ask"},getSessionPermissionRules:function(){return[...n]},addPermissionDirectory:p,removePermissionDirectory:h,isPathAllowed:function(e){return s.some(t=>e.startsWith(t))},applyPermissionUpdates:f,cancelAllPermissions:m,cancelAllQuestions:g,reset:function(){m("Session reset"),g("Session reset"),n.splice(0,n.length),s.splice(0,s.length),mc.debug("[useSessionPermissions] çŠ¶æ€å·²é‡ç½®")}}}(),o=Sc(t,n),i=`tab-${Date.now()}-${Math.random().toString(36).substring(2,8)}`,r=Ge(null),a=Ge(null),l=Ge("æ–°ä¼šè¯"),c=Date.now(),u=Ge(c),d=Ge(c),p=Ge(e),h=He(null),f=Ve({status:hl.DISCONNECTED,capabilities:null,lastError:null}),m=Ge([]),g=Ge("claude"),y=Ge(null),v=Ge(null),b=Ge(null),k=Ge(8096),w=Ge("default"),S=Ge(!1),C=Ge(null),T=Ge({}),E=Ge({});function I(){T.value={model:b.value||void 0,thinkingLevel:k.value,permissionMode:w.value}}const x=Ve({inputText:"",contexts:[],scrollState:{...Xc},activeFileDismissed:!1}),A=Ge(!1),N=Ge(null),M=Ge(null),R=Ge(null),_=We(()=>C.value?.resumeSessionId??null),O=Ve({loading:!1,total:0,loadedStart:0,loadedCount:0,hasMore:!1,lastOffset:0,lastLimit:bc});function D(e=null){O.loadedCount=o.messageCount.value;const t=O.loadedStart+O.loadedCount;O.total=null!==e?e:Math.max(O.total,t),O.hasMore=O.loadedStart>0&&O.total>0}const B=We(()=>f.status===hl.CONNECTED),L=We(()=>f.status===hl.CONNECTING),F=We(()=>f.status===hl.ERROR),P=We(()=>o.isGenerating.value),$=We(()=>({tabId:i,sessionId:r.value,name:l.value,createdAt:c,updatedAt:u.value,lastActiveAt:d.value,order:p.value}));function U(e){if("stream_event"===e.type||"stream"===e.type){const t=e.data;if(t){if("status_system"===t.type)return Zc.info("[normalizeRpcMessage] è¯†åˆ«åˆ°åµŒå¥—çš„ status_system æ¶ˆæ¯"),{kind:"status_system",data:t};if("compact_boundary"===t.type)return Zc.info("[normalizeRpcMessage] è¯†åˆ«åˆ°åµŒå¥—çš„ compact_boundary æ¶ˆæ¯"),{kind:"compact_boundary",data:t};if("user"===t.type||"assistant"===t.type){const e=Hl(t);if(e)return{kind:"message",data:e}}}return{kind:"stream_event",data:e}}if(function(e){return"result"===e.type}(e))return{kind:"result",data:e};if(function(e){return"status_system"===e.type}(e))return{kind:"status_system",data:e};if(function(e){return"compact_boundary"===e.type}(e))return{kind:"compact_boundary",data:e};if(function(e){return"system_init"===e.type}(e))return Zc.info("[normalizeRpcMessage] è¯†åˆ«åˆ° system_init æ¶ˆæ¯, sessionId:",e.session_id),{kind:"system_init",data:e};if(function(e){return"assistant"===e.type}(e)||function(e){return"user"===e.type}(e)){const t=Hl(e);return t?{kind:"message",data:t}:null}return Zc.warn("[normalizeRpcMessage] æœªè¯†åˆ«çš„æ¶ˆæ¯ç±»åž‹:",e.type,e),null}function V(e){const t=U(e);if(t){if("status_system"===t.kind)return"compacting"===(n=t.data).status?(Zc.info(`[Tab ${i}] åŽ‹ç¼©å¼€å§‹`),A.value=!0):n.status||(Zc.info(`[Tab ${i}] åŽ‹ç¼©ç»“æŸ`),A.value=!1),void oe();var n;if("compact_boundary"===t.kind)return function(e){Zc.info(`[Tab ${i}] ðŸ“¦ æ”¶åˆ°åŽ‹ç¼©è¾¹ç•Œæ¶ˆæ¯`,e.compact_metadata),N.value=e.compact_metadata||null,M.value=e.compact_metadata||null,Zc.info(`[Tab ${i}] ðŸ“¦ pendingCompactMetadata å·²è®¾ç½®:`,M.value)}(t.data),void oe();if("system_init"===t.kind)return function(e){e.session_id&&e.session_id!==r.value&&(Zc.info(`[Tab ${i}] ðŸ“¦ system_init æ›´æ–° sessionId: ${r.value} -> ${e.session_id}`),r.value=e.session_id);e.model&&e.model!==b.value&&(Zc.info(`[Tab ${i}] ðŸ“¦ system_init æ¨¡åž‹: ${e.model}`),b.value=e.model);e.mcpServers&&(m.value=e.mcpServers.map(e=>({name:e.name,status:e.status})),Zc.info(`[Tab ${i}] ðŸ“¦ system_init MCP servers: ${m.value.length}`),console.log("ðŸ”Œ MCP Servers:",JSON.stringify(e.mcpServers,null,2)));Zc.debug(`[Tab ${i}] ðŸ“¦ system_init: cwd=${e.cwd}, permissionMode=${e.permissionMode}, tools=${e.tools?.length||0}`)}(t.data),void oe();switch(t.kind){case"stream_event":o.handleStreamEvent(t.data);break;case"result":if(R.value){const e=t.data;"success"===e.subtype?(ie(R.value),Zc.info(`[Tab ${i}] âœ… /rename æˆåŠŸï¼Œå·²æ›´æ–°æ ‡é¢˜: ${R.value}`),R.value=null):(e.is_error||"interrupted"===e.subtype)&&(R.value=null)}o.handleResultMessage(t.data);break;case"message":Zc.info(`[Tab ${i}] å¤„ç† message: role=${t.data.role}, isReplay=${t.data.isReplay}, pendingCompact=${!!M.value}`),M.value&&"user"===t.data.role&&!0!==t.data.isReplay&&(t.data.isCompactSummary=!0,t.data.compactMetadata={trigger:M.value.trigger,preTokens:M.value.pre_tokens},Zc.info(`[Tab ${i}] âœ… æ ‡è®°æ¶ˆæ¯ä¸ºåŽ‹ç¼©æ‘˜è¦`,t.data.compactMetadata),M.value=null),function(e){if("assistant"!==e.role)return;const t=e.content;if(!Array.isArray(t))return;for(const n of t)if("tool_use"===n.type){const e=n.toolName||n.name;if("EnterPlanMode"===e||"enter-plan-mode"===e)return Zc.info(`[Tab ${i}] æ£€æµ‹åˆ° EnterPlanModeï¼ˆå®Œæ•´æ¶ˆæ¯ï¼‰ï¼Œè‡ªåŠ¨åˆ‡æ¢æƒé™æ¨¡å¼ä¸º plan`),void(w.value="plan")}}(t.data),o.handleNormalMessage(t.data)}"message"===t.kind&&D(),oe()}}let W=0,G=null;async function z(e={}){const t={...C.value||{},...e};if(f.status!==hl.CONNECTING){h.value&&(Zc.info(`[Tab ${i}] æ–­å¼€æ—§è¿žæŽ¥: ${r.value}`),h.value.disconnect(),h.value=null,r.value=null),f.status=hl.CONNECTING,f.lastError=null;try{const e=new dl;e.onMessage(V),e.onDisconnect(t=>{h.value===e&&function(e){Zc.warn(`[Tab ${i}] ä¼šè¯è¢«åŠ¨æ–­å¼€`,e?.message);const t=r.value;if(f.status=hl.DISCONNECTED,f.lastError=e?.message||"è¿žæŽ¥å·²æ–­å¼€",h.value=null,r.value=null,o.isGenerating.value&&o.stopGenerating(),s.cancelAllPermissions("è¿žæŽ¥æ–­å¼€"),s.cancelAllQuestions("è¿žæŽ¥æ–­å¼€"),o.addErrorMessage("è¿žæŽ¥å·²æ–­å¼€ï¼Œæ­£åœ¨è‡ªåŠ¨é‡è¿žï¼Œè¯·ç¨åŽé‡æ–°å‘é€æ¶ˆæ¯"),C.value){const e=t||C.value.resumeSessionId;C.value={...C.value,resumeSessionId:e},Zc.info(`[Tab ${i}] å·²æ›´æ–° initialConnectOptions.resumeSessionId=${e}`)}C.value&&(Zc.info(`[Tab ${i}] è§¦å‘è‡ªåŠ¨é‡è¿žï¼ŒresumeSessionId=${C.value.resumeSessionId}`),H(C.value))}(t)});const l=Yc(),c={includePartialMessages:l.settings.includePartialMessages??!0,allowDangerouslySkipPermissions:!0,model:b.value||void 0,thinkingEnabled:k.value>0,permissionMode:w.value,dangerouslySkipPermissions:l.settings.skipPermissions,continueConversation:t.continueConversation,resumeSessionId:t.resumeSessionId,replayUserMessages:!0},u=await e.connect(c);if(k.value>0)try{await e.setMaxThinkingTokens(k.value),Zc.info(`[Tab ${i}] æ€è€ƒçº§åˆ«å·²è®¾ç½®: ${k.value}`)}catch(n){Zc.warn(`[Tab ${i}] è®¾ç½®æ€è€ƒçº§åˆ«å¤±è´¥:`,n)}h.value=e,r.value=u,f.capabilities=e.capabilities,f.status=hl.CONNECTED,f.lastError=null,W=0,o.setBeforeProcessQueueFn(async()=>{Zc.debug(`[Tab ${i}] å¤„ç†é˜Ÿåˆ—å‰ï¼Œåº”ç”¨ pending settings`),await async function(){0!==Object.keys(E.value).length&&(Zc.info(`[Tab ${i}] åº”ç”¨å¾…å¤„ç†è®¾ç½®:`,E.value),void 0!==E.value.model&&await Q(E.value.model),void 0!==E.value.permissionMode&&await q(E.value.permissionMode),void 0!==E.value.thinkingLevel&&await ee(E.value.thinkingLevel),E.value={},I())}()}),o.setProcessQueueFn(async()=>{Zc.debug(`[Tab ${i}] å¤„ç†é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€æ¡æ¶ˆæ¯`),await J()}),function(){if(!h.value)return;h.value.register("AskUserQuestion",async e=>(Zc.info(`[Tab ${i}] æ”¶åˆ° AskUserQuestion è¯·æ±‚: ${e.questions?.length||0} ä¸ªé—®é¢˜`),new Promise((t,n)=>{const o={id:`question-${Date.now()}`,sessionId:r.value,questions:e.questions||[],resolve:e=>{t(e)},reject:n};s.addUserQuestion(o)}))),h.value.register("RequestPermission",async e=>{const t=e.toolName||"Unknown",n=e.toolUseId,o=e.input||{},a=e.permissionSuggestions;return Zc.info(`[Tab ${i}] æ”¶åˆ°æƒé™è¯·æ±‚: ${t}`),S.value&&"ExitPlanMode"!==t?(Zc.info(`[Tab ${i}] Bypass æ¨¡å¼ï¼Œè‡ªåŠ¨æ‰¹å‡†: ${t}`),{approved:!0}):new Promise((e,i)=>{const l={id:`permission-${Date.now()}`,sessionId:r.value,toolName:t,input:o,matchedToolCallId:n,permissionSuggestions:a,resolve:t=>{e(t)},reject:i};s.addPermissionRequest(l)})}),Zc.debug(`[Tab ${i}] RPC å¤„ç†å™¨å·²æ³¨å†Œ`)}(),I(),E.value={};try{const e=await Ic("ide.getProjectPath",{});e.success&&e.data?.projectPath&&(a.value=e.data.projectPath,Zc.info(`[Tab ${i}] é¡¹ç›®è·¯å¾„: ${a.value}`))}catch(n){Zc.warn(`[Tab ${i}] èŽ·å–é¡¹ç›®è·¯å¾„å¤±è´¥:`,n)}Zc.info(`[Tab ${i}] è¿žæŽ¥æˆåŠŸ: sessionId=${u}`),J()}catch(l){f.status=hl.ERROR,f.lastError=l instanceof Error?l.message:String(l),Zc.error(`[Tab ${i}] è¿žæŽ¥å¤±è´¥:`,l),H(e)}}else Zc.warn(`[Tab ${i}] æ­£åœ¨è¿žæŽ¥ä¸­ï¼Œè¯·å‹¿é‡å¤è¿žæŽ¥`)}function H(e){if(W>=3)return void Zc.warn(`[Tab ${i}] å·²è¾¾åˆ°æœ€å¤§é‡è¿žæ¬¡æ•° (3)ï¼Œåœæ­¢é‡è¿ž`);G&&clearTimeout(G),W++;const t=2e3*W;Zc.info(`[Tab ${i}] å°†åœ¨ ${t}ms åŽå°è¯•ç¬¬ ${W} æ¬¡é‡è¿ž`),G=setTimeout(async()=>{G=null,f.status=hl.DISCONNECTED,await z(e)},t)}async function K(){G&&(clearTimeout(G),G=null),W=0,h.value&&(h.value.disconnect(),h.value=null),r.value=null,f.status=hl.DISCONNECTED,s.cancelAllPermissions("Tab disconnected"),s.cancelAllQuestions("Tab disconnected"),Zc.info(`[Tab ${i}] å·²æ–­å¼€è¿žæŽ¥`)}async function j(e,t){if(O.loading)return;if(!t?.__skipProbe&&0===O.loadedCount&&void 0===e.offset&&void 0===e.limit&&void 0===t?.mode){const t=await async function(e){try{return(await Xa.getHistoryMetadata(e)).totalLines}catch(t){return Zc.warn(`[Tab ${i}] èŽ·å–åŽ†å²å…ƒæ•°æ®å¤±è´¥:`,t),null}}(e),n=null!==t&&t>bc?t-bc:0;return j({...e,offset:n,limit:bc},{mode:"append",__skipProbe:!0})}const n=e.offset??O.lastOffset??0,s=e.limit??bc,r=t?.mode??"append";O.loading=!0;try{const t=await Xa.loadHistory({...e,offset:n,limit:s});Zc.info(`[Tab ${i}] ðŸ“œ åŽ†å²åŠ è½½å®Œæˆ: offset=${n}, count=${t.count}, availableCount=${t.availableCount}, mode=${r}`);const a=[];for(const e of t.messages){const t=U(e);t&&"message"===t.kind?a.push(t.data):t&&t.kind}a.length>0?(Zc.info(`[Tab ${i}] ðŸ“œ å‡†å¤‡æ’å…¥ ${a.length} æ¡æ¶ˆæ¯åˆ° UI (${r})`),"prepend"===r?o.prependMessagesBatch(a):o.appendMessagesBatch(a),Zc.info(`[Tab ${i}] ðŸ“œ âœ… ${a.length} æ¡æ¶ˆæ¯å·²æˆåŠŸæ·»åŠ åˆ° displayItems`)):Zc.warn(`[Tab ${i}] ðŸ“œ âš ï¸ ç¼“å†²åŒºä¸ºç©ºï¼Œæ²¡æœ‰æ¶ˆæ¯å¯åŠ è½½`),function(e,t,n=null){const s=t??0;let i=e;e<0&&null!==n&&s>0&&(i=Math.max(0,n-s)),0===O.loadedCount&&0===o.messageCount.value?O.loadedStart=i:O.loadedStart=0===O.loadedCount?i:Math.min(O.loadedStart,i),O.lastOffset=e,O.lastLimit=t||O.lastLimit,D(n),0===s&&0===O.total&&null!==n&&(O.total=n)}(n,a.length,t.availableCount)}catch(a){throw Zc.error(`[Tab ${i}] åŽ†å²åŠ è½½å¤±è´¥:`,a),a}finally{O.loading=!1}}async function Y(){if(f.status!==hl.CONNECTED){if(f.status===hl.CONNECTING)return Zc.info(`[Tab ${i}] æ­£åœ¨è¿žæŽ¥ä¸­ï¼Œç­‰å¾…è¿žæŽ¥å®Œæˆ...`),void(await new Promise((e,t)=>{const n=()=>{f.status===hl.CONNECTED?e():f.status===hl.ERROR||f.status===hl.DISCONNECTED?t(new Error(f.lastError||"è¿žæŽ¥å¤±è´¥")):setTimeout(n,100)};n()}));Zc.info(`[Tab ${i}] è¿žæŽ¥æœªå»ºç«‹ï¼Œå¼€å§‹è¿žæŽ¥ (backendType=${g.value})...`),"codex"===g.value?await te(C.value||{}):await z(C.value||{})}else Zc.debug(`[Tab ${i}] è¿žæŽ¥å·²å°±ç»ªï¼Œæ— éœ€é‡è¿ž`)}async function Z(e,t){t?.isSlashCommand&&(Zc.info(`[Tab ${i}] æ£€æµ‹åˆ°æ–œæ å‘½ä»¤ï¼Œå¿½ç•¥ contexts å’Œ ideContext`),e={...e,contexts:[],ideContext:null});const n=e.contents.find(e=>"text"===e.type);if(n?.text){const e=n.text.match(/^\/rename\s+(.+)$/);e&&(R.value=e[1].trim(),Zc.info(`[Tab ${i}] æ£€æµ‹åˆ° /rename å‘½ä»¤ï¼Œå¾…ç¡®è®¤åç§°: ${R.value}`))}if(0===o.messages.length&&n?.text){const e=n.text.trim();if(!e.startsWith("/")){const t=30,n=e.length>t?e.slice(0,t)+"...":e;ie(n),Zc.info(`[Tab ${i}] è‡ªåŠ¨è®¾ç½®æ ‡é¢˜: ${n}`)}}if(f.status!==hl.CONNECTED)return Zc.info(`[Tab ${i}] è¿žæŽ¥æœªå°±ç»ªï¼ˆ${f.status}ï¼‰ï¼Œæ¶ˆæ¯å…¥å¾…åŠžé˜Ÿåˆ—`),o.addToQueue(e),void(f.status!==hl.CONNECTING&&await Y());if(o.isGenerating.value)return Zc.info(`[Tab ${i}] æ­£åœ¨ç”Ÿæˆä¸­ï¼Œæ¶ˆæ¯åªåŠ å…¥é˜Ÿåˆ—`),void o.addToQueue(e);Zc.info(`[Tab ${i}] æ¶ˆæ¯ä¸åœ¨é˜Ÿåˆ—ä¸­ï¼Œç›´æŽ¥å¤„ç†`);const{userMessage:s,mergedContent:r}=o.addMessageToUI(e);oe(),await X(s,r,e)}async function X(e,t,n){try{if(Zc.info(`[Tab ${i}] ç¡®ä¿è¿žæŽ¥å°±ç»ª (backendType=${g.value})...`),await Y(),o.startGenerating(e.id),Zc.info(`[Tab ${i}] å¼€å§‹å‘é€æ¶ˆæ¯åˆ°åŽç«¯ (backendType=${g.value})...`),"codex"===g.value){if(!v.value)throw new Error("Codex ä¼šè¯æœªè¿žæŽ¥");const e={contents:t.map(e=>"text"===e.type?{type:"text",text:e.text}:"image"===e.type?{type:"image",data:e.source?.data||"",mimeType:e.source?.media_type}:{type:"text",text:JSON.stringify(e)}),contexts:n.contexts?.map(e=>({type:"file",path:e.path,content:e.content}))};v.value.sendMessage(e),Zc.info(`[Tab ${i}] Codex æ¶ˆæ¯å‘é€å®Œæˆ`)}else{if(!h.value)throw new Error("Claude ä¼šè¯æœªè¿žæŽ¥");await h.value.sendMessageWithContent(t),Zc.info(`[Tab ${i}] Claude æ¶ˆæ¯å‘é€å®Œæˆ`)}}catch(s){Zc.error(`[Tab ${i}] âŒ å‘é€æ¶ˆæ¯å¤±è´¥:`,s),o.stopGenerating(),o.addToQueue(n)}}async function J(){const e=o.popNextQueuedMessage();e&&(Zc.info(`[Tab ${i}] å¤„ç†é˜Ÿåˆ—æ¶ˆæ¯: ${e.userMessage.id}`),await X(e.userMessage,e.mergedContent,e.originalMessage))}async function Q(e){h.value?(await h.value.setModel(e),b.value=e,Zc.info(`[Tab ${i}] æ¨¡åž‹å·²è®¾ç½®: ${e}`)):b.value=e}async function q(e){h.value?(await h.value.setPermissionMode(e),w.value=e,Zc.info(`[Tab ${i}] æƒé™æ¨¡å¼å·²è®¾ç½®: ${e}`)):w.value=e}async function ee(e){if(!h.value)return void(k.value=e);const t=0===e?0:e;await h.value.setMaxThinkingTokens(t),k.value=e,Zc.info(`[Tab ${i}] æ€è€ƒçº§åˆ«å·²è®¾ç½®: ${e}`)}async function te(e={}){const t={...C.value||{},...e};if(f.status!==hl.CONNECTING){v.value&&(Zc.info(`[Tab ${i}] æ–­å¼€æ—§çš„åŽç«¯ä¼šè¯`),v.value.disconnect(),v.value=null),f.status=hl.CONNECTING,f.lastError=null;try{const e=Yc().getBackendConfig(g.value);if(!e)throw new Error(`æ— æ³•èŽ·å– ${g.value} åŽç«¯é…ç½®`);const n=Fl.createSession(g.value,e);n.onEvent(ne),n.onConnectionStatusChange(se);const s={config:e,continueConversation:t.continueConversation,resumeSessionId:t.resumeSessionId,projectPath:a.value||void 0};await n.connect(s),v.value=n,y.value=e,r.value=n.getSessionId(),f.status=hl.CONNECTED,f.lastError=null,Zc.info(`[Tab ${i}] BackendSession è¿žæŽ¥æˆåŠŸ: ${g.value}, sessionId=${r.value}`),W=0,I(),E.value={}}catch(n){throw f.status=hl.ERROR,f.lastError=n instanceof Error?n.message:String(n),Zc.error(`[Tab ${i}] BackendSession è¿žæŽ¥å¤±è´¥:`,n),n}}else Zc.warn(`[Tab ${i}] æ­£åœ¨è¿žæŽ¥ä¸­ï¼Œè¯·å‹¿é‡å¤è¿žæŽ¥`)}function ne(e){switch(e.type){case"text_delta":o.handleStreamEvent({type:"stream_event",uuid:e.itemId,event:{type:"content_block_delta",index:0,delta:{type:"text_delta",text:e.text}}});break;case"thinking_delta":o.handleStreamEvent({type:"stream_event",uuid:e.itemId,event:{type:"content_block_delta",index:0,delta:{type:"thinking_delta",thinking:e.text}}});break;case"tool_started":Zc.info(`[Tab ${i}] å·¥å…·å¼€å§‹: ${e.toolName}`);break;case"tool_completed":Zc.info(`[Tab ${i}] å·¥å…·å®Œæˆ: ${e.itemId}, success=${e.success}`);break;case"turn_completed":o.stopGenerating(),Zc.info(`[Tab ${i}] è½®æ¬¡å®Œæˆ: ${e.turnId}, status=${e.status}`),J();break;case"approval_request":Zc.info(`[Tab ${i}] æ”¶åˆ°å®¡æ‰¹è¯·æ±‚: ${e.approvalType}`),"codex"===g.value&&function(e){const t={id:e.requestId,sessionId:r.value,toolName:"command"===e.approvalType?"CommandExecution":"FileChange",input:e.details,resolve:t=>{v.value&&v.value.respondToApproval({requestId:e.requestId,approved:t.approved,reason:t.reason})},reject:e=>{Zc.error(`[Tab ${i}] å®¡æ‰¹è¯·æ±‚è¢«æ‹’ç»:`,e)}};s.addPermissionRequest(t)}(e);break;case"error":Zc.error(`[Tab ${i}] åŽç«¯é”™è¯¯: ${e.code} - ${e.message}`),o.addErrorMessage(`åŽç«¯é”™è¯¯: ${e.message}`)}oe()}function se(e){switch(e){case"connected":f.status=hl.CONNECTED;break;case"connecting":f.status=hl.CONNECTING;break;case"disconnected":f.status=hl.DISCONNECTED;break;case"error":f.status=hl.ERROR}Zc.info(`[Tab ${i}] åŽç«¯è¿žæŽ¥çŠ¶æ€: ${e}`)}function oe(){const e=Date.now();u.value=e,d.value=e}function ie(e){l.value=e,oe()}return{tabId:i,sessionId:r,projectPath:a,name:l,order:p,updatedAt:u,lastActiveAt:d,connectionState:f,get connectionStatus(){return f.status},get capabilities(){return f.capabilities},get lastError(){return f.lastError},modelId:b,thinkingLevel:k,permissionMode:w,skipPermissions:S,resumeFromSessionId:_,mcpServers:m,backendType:g,backendConfig:y,backendSession:v,uiState:x,isCompacting:A,compactMetadata:N,isConnected:B,isConnecting:L,hasError:F,isGenerating:P,tabInfo:$,tools:t,stats:n,permissions:s,messages:o.messages,displayItems:o.displayItems,messageQueue:o.messageQueue,setInitialConnectOptions:function(e){C.value={...e},e.model&&(b.value=e.model),void 0!==e.thinkingLevel&&(k.value=e.thinkingLevel),e.permissionMode&&(w.value=e.permissionMode),void 0!==e.skipPermissions&&(S.value=e.skipPermissions)},connect:z,disconnect:K,reconnect:async function(e){if(h.value){f.status=hl.CONNECTING,f.lastError=null,e?.model&&(b.value=e.model),void 0!==e?.thinkingLevel&&(k.value=e.thinkingLevel),e?.permissionMode&&(w.value=e.permissionMode),void 0!==e?.skipPermissions&&(S.value=e.skipPermissions);try{const n=Yc(),s={includePartialMessages:n.settings.includePartialMessages??!0,allowDangerouslySkipPermissions:!0,model:b.value||void 0,thinkingEnabled:k.value>0,permissionMode:w.value,dangerouslySkipPermissions:n.settings.skipPermissions,continueConversation:e?.continueConversation,resumeSessionId:e?.resumeSessionId},o=await h.value.reconnectSession(s);if(k.value>0)try{await h.value.setMaxThinkingTokens(k.value),Zc.info(`[Tab ${i}] é‡è¿žåŽæ€è€ƒçº§åˆ«å·²è®¾ç½®: ${k.value}`)}catch(t){Zc.warn(`[Tab ${i}] é‡è¿žåŽè®¾ç½®æ€è€ƒçº§åˆ«å¤±è´¥:`,t)}r.value=o,f.capabilities=h.value.capabilities,f.status=hl.CONNECTED,f.lastError=null,I(),E.value={},Zc.info(`[Tab ${i}] é‡è¿žæˆåŠŸ: sessionId=${o}`),J()}catch(n){f.status=hl.ERROR,f.lastError=n instanceof Error?n.message:String(n),Zc.error(`[Tab ${i}] é‡è¿žå¤±è´¥:`,n),o.addErrorMessage(`è¿žæŽ¥å¤±è´¥: ${f.lastError}`)}}else await z(e||{model:b.value||void 0,thinkingLevel:k.value,permissionMode:w.value,skipPermissions:S.value})},sendMessage:Z,sendTextMessage:async function(e){await Z({contexts:[],contents:[{type:"text",text:e}]})},sendTextMessageDirect:async function(e){if(!h.value)throw new Error("ä¼šè¯æœªè¿žæŽ¥");await h.value.sendMessage(e),Zc.info(`[Tab ${i}] ç›´æŽ¥å‘é€æ–‡æœ¬æ¶ˆæ¯: ${e}`)},forceSendMessage:async function(e,t){if(t?.isSlashCommand&&(Zc.info(`[Tab ${i}] æ£€æµ‹åˆ°æ–œæ å‘½ä»¤ï¼Œå¿½ç•¥ contexts å’Œ ideContext`),e={...e,contexts:[],ideContext:null}),o.isGenerating.value)return Zc.info(`[Tab ${i}] å¼ºåˆ¶å‘é€ï¼šæ‰“æ–­å½“å‰ç”Ÿæˆï¼Œæ¶ˆæ¯æ’é˜Ÿ`),o.setInterruptMode("keep"),o.prependToQueue(e),void(h.value&&await h.value.interrupt());Zc.info(`[Tab ${i}] å¼ºåˆ¶å‘é€ï¼šç›´æŽ¥å¤„ç†æ¶ˆæ¯`);const{userMessage:n,mergedContent:s}=o.addMessageToUI(e);oe(),await X(n,s,e)},interrupt:async function(){if(!h.value)throw new Error("ä¼šè¯æœªè¿žæŽ¥");o.setInterruptMode("clear");try{await h.value.interrupt(),Zc.info(`[Tab ${i}] ä¸­æ–­è¯·æ±‚å·²å‘é€`)}catch(e){Zc.error(`[Tab ${i}] ä¸­æ–­è¯·æ±‚å¤±è´¥:`,e)}finally{o.isGenerating.value&&(Zc.warn(`[Tab ${i}] ä¸­æ–­è¿”å›žåŽ isGenerating ä»ä¸º trueï¼Œæ‰‹åŠ¨æ¸…ç†`),o.stopGenerating(),o.clearQueue())}},runInBackground:async function(){if(!h.value)throw new Error("ä¼šè¯æœªè¿žæŽ¥");if(o.isGenerating.value)try{await h.value.runInBackground(),Zc.info(`[Tab ${i}] åŽå°è¿è¡Œè¯·æ±‚å·²å‘é€`)}catch(e){throw Zc.error(`[Tab ${i}] åŽå°è¿è¡Œè¯·æ±‚å¤±è´¥:`,e),e}else Zc.warn(`[Tab ${i}] æ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæ— æ³•åˆ‡æ¢åˆ°åŽå°`)},editAndResendMessage:async function(e,t,n){Zc.info(`[Tab ${i}] ðŸ”„ ç¼–è¾‘é‡å‘: uuid=${e}`);const s=r.value;if(!s)throw new Error("ä¼šè¯æœªè¿žæŽ¥ï¼Œæ— æ³•ç¼–è¾‘é‡å‘");try{if(o.isGenerating.value&&(Zc.info(`[Tab ${i}] æ­£åœ¨ç”Ÿæˆä¸­ï¼Œå…ˆæ‰“æ–­`),o.setInterruptMode("clear"),h.value&&await h.value.interrupt(),o.stopGenerating()),Zc.info(`[Tab ${i}] è°ƒç”¨åŽç«¯ truncateHistory API`),!h.value)throw new Error("ä¼šè¯æœªè¿žæŽ¥");const r=await Xa.truncateHistory(h.value,{sessionId:s,messageUuid:e,projectPath:n});if(!r.success)throw new Error(r.error||"æˆªæ–­åŽ†å²å¤±è´¥");Zc.info(`[Tab ${i}] âœ… åŽç«¯åŽ†å²æˆªæ–­æˆåŠŸ: remainingLines=${r.remainingLines}`);const a=o.truncateMessages(e,{contexts:t.contexts,contents:t.contents});a||Zc.warn(`[Tab ${i}] å‰ç«¯æˆªæ–­å¤±è´¥ï¼Œä½†åŽç«¯å·²æˆªæ–­ï¼Œç»§ç»­é‡å‘`),Zc.info(`[Tab ${i}] æ–­å¼€å½“å‰è¿žæŽ¥`),await K(),Zc.info(`[Tab ${i}] é‡è¿žä¼šè¯: resumeSessionId=${s}`),await z({...C.value,resumeSessionId:s}),Zc.info(`[Tab ${i}] å‘é€ç¼–è¾‘åŽçš„æ¶ˆæ¯`),a?await X(a.userMessage,a.mergedContent,t):await Z(t),Zc.info(`[Tab ${i}] âœ… ç¼–è¾‘é‡å‘å®Œæˆ`)}catch(a){throw Zc.error(`[Tab ${i}] âŒ ç¼–è¾‘é‡å‘å¤±è´¥:`,a),o.addErrorMessage(`ç¼–è¾‘é‡å‘å¤±è´¥: ${a instanceof Error?a.message:String(a)}`),a}},editQueueMessage:o.editQueueMessage,removeFromQueue:o.removeFromQueue,clearQueue:o.clearQueue,setModel:Q,setPermissionMode:q,setThinkingLevel:ee,setLocalPermissionMode:function(e){w.value=e,Zc.info(`[Tab ${i}] æœ¬åœ°æƒé™æ¨¡å¼å·²æ›´æ–°: ${e}`)},updateSettings:async function(e){if(!r.value||f.status!==hl.CONNECTED)return void 0!==e.model&&(b.value=e.model),void 0!==e.permissionMode&&(w.value=e.permissionMode),void 0!==e.thinkingLevel&&(k.value=e.thinkingLevel),void 0!==e.skipPermissions&&(S.value=e.skipPermissions),void Zc.info(`[Tab ${i}] æœªè¿žæŽ¥ï¼Œä»…æ›´æ–°æœ¬åœ°è®¾ç½®`);Zc.info(`[Tab ${i}] é€šè¿‡ RPC æ›´æ–°è®¾ç½®: `,e),void 0!==e.model&&await Q(e.model),void 0!==e.permissionMode&&await q(e.permissionMode),void 0!==e.thinkingLevel&&await ee(e.thinkingLevel),void 0!==e.skipPermissions&&(S.value=e.skipPermissions)},setPendingSetting:function(e,t){if("skipPermissions"!==e)switch(E.value={...E.value,[e]:t},e){case"model":b.value=t;break;case"thinkingLevel":k.value=t;break;case"permissionMode":w.value=t}else S.value=t},pendingSettings:E,lastAppliedSettings:T,historyState:O,touch:oe,rename:ie,setOrder:function(e){p.value=e},saveUiState:function(e){void 0!==e.inputText&&(x.inputText=e.inputText),void 0!==e.contexts&&(x.contexts=e.contexts),void 0!==e.scrollState&&Object.assign(x.scrollState,e.scrollState)},reset:function(){t.reset(),n.reset(),s.reset(),o.reset(),O.loading=!1,O.total=0,O.loadedStart=0,O.loadedCount=0,O.hasMore=!1,O.lastOffset=0,O.lastLimit=bc,Object.assign(x.scrollState,Xc),f.lastError=null,Zc.debug(`[Tab ${i}] å·²é‡ç½®`)},loadHistory:j,loadMoreHistory:async function(){if(O.loading)return;if(!O.hasMore)return;const e=Math.max(0,O.loadedStart-50),t=O.loadedStart-e||50;await j({sessionId:r.value??void 0,offset:e,limit:t},{mode:"prepend"})},setBackendType:async function(e){g.value!==e?(Zc.info(`[Tab ${i}] åˆ‡æ¢åŽç«¯ç±»åž‹: ${g.value} -> ${e}`),h.value&&(Zc.info(`[Tab ${i}] æ–­å¼€ RSocket è¿žæŽ¥`),h.value.disconnect(),h.value=null,r.value=null),v.value&&(Zc.info(`[Tab ${i}] æ–­å¼€ BackendSession è¿žæŽ¥`),v.value.disconnect(),v.value=null),f.status=hl.DISCONNECTED,f.lastError=null,g.value=e,Zc.info(`[Tab ${i}] åŽç«¯ç±»åž‹å·²åˆ‡æ¢: ${e}`)):Zc.debug(`[Tab ${i}] åŽç«¯ç±»åž‹æœªå˜åŒ–: ${e}`)},connectWithBackend:te,sendMessageWithBackend:async function(e){if(!v.value)throw new Error("åŽç«¯ä¼šè¯æœªè¿žæŽ¥");const t={contents:e.contents.map(e=>"text"===e.type?{type:"text",text:e.text}:"image"===e.type?{type:"image",data:e.source?.data||"",mimeType:e.source?.media_type}:{type:"text",text:JSON.stringify(e)}),contexts:e.contexts?.map(e=>({type:"file",path:e.path,content:e.content}))};o.startGenerating(`msg-${Date.now()}`),v.value.sendMessage(t)},getBackendCapabilities:function(){return Vl(g.value)},isFeatureSupported:function(e){return function(e,t){const n=Vl(e);switch(t){case"thinking":return n.supportsThinking;case"sub_agents":return n.supportsSubAgents;case"mcp":return n.supportsMcp;case"sandbox":return n.supportsSandbox;case"prompt_caching":return n.supportsPromptCaching;case"token_usage":return n.exposesTokenUsage;case"token_budget_thinking":return n.supportsThinking&&"token_budget"===n.thinkingConfigType;case"effort_level_thinking":return n.supportsThinking&&"effort_level"===n.thinkingConfigType;default:return!1}}(g.value,e)},getThinkingConfig:function(){return y.value?"claude"===y.value.type?{type:"claude",enabled:y.value.thinkingEnabled,tokenBudget:y.value.thinkingTokenBudget}:{type:"codex",effort:y.value.reasoningEffort,summary:y.value.reasoningSummary}:null},setThinkingConfig:async function(e){if(v.value)try{await v.value.updateThinkingConfig(e),Zc.info(`[Tab ${i}] æ€è€ƒé…ç½®å·²æ›´æ–°:`,e)}catch(t){throw Zc.error(`[Tab ${i}] è®¾ç½®æ€è€ƒé…ç½®å¤±è´¥:`,t),t}else Zc.warn(`[Tab ${i}] åŽç«¯ä¼šè¯æœªè¿žæŽ¥ï¼Œæ— æ³•è®¾ç½®æ€è€ƒé…ç½®`)},get session(){return h.value},get backendSessionInstance(){return v.value}}}var Qc=(e=>(e.OPUS_45="OPUS_45",e.SONNET_45="SONNET_45",e.HAIKU_45="HAIKU_45",e))(Qc||{});const qc={OPUS_45:{modelId:"claude-opus-4-5-20251101",displayName:"Opus 4.5",thinkingMode:"optional",defaultThinkingEnabled:!0,description:"Most powerful model for complex tasks"},SONNET_45:{modelId:"claude-sonnet-4-5-20250929",displayName:"Sonnet 4.5",thinkingMode:"optional",defaultThinkingEnabled:!0,description:"Balanced performance and cost"},HAIKU_45:{modelId:"claude-haiku-4-5-20251001",displayName:"Haiku 4.5",thinkingMode:"optional",defaultThinkingEnabled:!1,description:"Fast responses for simple tasks"}},eu=Ge([{id:"OPUS_45",displayName:"Opus 4.5",modelId:"claude-opus-4-5-20250929",isBuiltIn:!0},{id:"SONNET_45",displayName:"Sonnet 4.5",modelId:"claude-sonnet-4-5-20250929",isBuiltIn:!0},{id:"HAIKU_45",displayName:"Haiku 4.5",modelId:"claude-haiku-4-5-20250929",isBuiltIn:!0}]),tu=Ge("OPUS_45");function nu(){return eu.value}function su(e){return eu.value.find(t=>t.id===e)}function ou(e){if(e in Qc)return qc[e];const t=su(e);return{modelId:t?.modelId??e,displayName:t?.displayName??e,thinkingMode:"optional",defaultThinkingEnabled:!0,description:t?.isBuiltIn?void 0:"Custom model"}}const iu=tl.session;function ru(){return{modelId:ou(tu.value).modelId,thinkingLevel:8096,permissionMode:"default",skipPermissions:!1}}function au(e,t){const n=t.settings;return"claude"===e?{model:n.claudeModel||"claude-sonnet-4-5-20251101",thinkingLevel:n.claudeThinkingTokens??8096,permissionMode:n.permissionMode,skipPermissions:n.skipPermissions}:{model:n.codexModel||"gpt-5.1-codex-max",thinkingLevel:void 0,reasoningEffort:n.codexReasoningEffort||"medium",permissionMode:n.permissionMode,skipPermissions:n.skipPermissions,sandboxMode:n.codexSandboxMode||"workspace-write"}}const lu=ze("session",()=>{const e=He([]),t=He(null),n=Ge(hl.DISCONNECTED),s=Ge("claude"),o=Ge(0),i=Ge(!1),r=new Set;const a=We(()=>t.value?.tabId??null),l=We(()=>t.value?.sessionId.value??null),c=We(()=>[...e.value].sort((e,t)=>e.order.value-t.order.value)),u=We(()=>e.value.length),d=We(()=>e.value.length>0),p=We(()=>n.value),h=We(()=>t.value?.isGenerating.value??!1),f=We(()=>t.value?.historyState.loading??!1),m=We(()=>t.value?.historyState.hasMore??!1),g=We(()=>t.value?.historyState??null),y=We(()=>(o.value,t.value?.displayItems??[]));Ke(()=>t.value?.displayItems.length,()=>{o.value++},{immediate:!0});const v=Yc(),{settings:b}=je(v);Ke(()=>b.value.skipPermissions,e=>{t.value&&void 0!==e&&(t.value.setPendingSetting("skipPermissions",e),iu.info(`[SessionStore] åŒæ­¥ skipPermissions åˆ°å½“å‰ä¼šè¯: ${e}`))});const k=We(()=>t.value?.messages??[]),w=We(()=>t.value?{modelId:t.value.modelId.value,thinkingEnabled:t.value.thinkingEnabled.value,permissionMode:t.value.permissionMode.value,skipPermissions:t.value.skipPermissions.value}:null),S=We(()=>t.value?.connectionState.lastError??null);const C=We(()=>s.value),T=We(()=>t.value?Vl(t.value.backendType.value):null);async function E(s,o){const i=Jc((e.value.length>0?Math.max(...e.value.map(e=>e.order.value)):-1)+1),r=o?.backendType||v.settings.defaultBackendType||"claude";i.setBackendType(r);const a=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});i.name.value=s||gn.global.t("session.defaultName",{time:a}),e.value=[...e.value,i],t.value=i,n.value=hl.DISCONNECTED,iu.info(`[SessionStore] åˆ›å»º Tab: ${i.tabId}, åŽç«¯: ${r}`);const l=o||au(r,v);return iu.info("[SessionStore] æ–° Tab ä½¿ç”¨è®¾ç½®:",l),i.setInitialConnectOptions(l),n.value=i.connectionState.status,i}async function I(o){const i="string"==typeof o?e.value.find(e=>e.tabId===o):o;if(!i)return void iu.warn(`[SessionStore] Tab ä¸å­˜åœ¨: ${o}`);const a=t.value?.tabId;a&&a!==i.tabId&&r.forEach(e=>{try{e(a)}catch(t){iu.error("[SessionStore] beforeTabSwitch callback error:",t)}}),t.value=i,n.value=i.connectionState.status,s.value=i.backendType.value,i.touch(),iu.debug(`[SessionStore] åˆ‡æ¢åˆ° Tab: ${i.tabId}`)}async function x(s){const o="string"==typeof s?e.value.find(e=>e.tabId===s):s;if(!o)return iu.warn(`[SessionStore] Tab ä¸å­˜åœ¨: ${s}`),!1;let i=null;if(t.value===o){const t=[...e.value].sort((e,t)=>e.order.value-t.order.value),n=t.findIndex(e=>e===o);n>0?i=t[n-1]:t.length>1&&(i=t[n+1])}return o.disconnect(),e.value=e.value.filter(e=>e!==o),t.value===o&&(t.value=i,i&&(n.value=i.connectionState.status)),iu.info(`[SessionStore] å…³é—­ Tab: ${o.tabId}`),!0}const A=We(()=>t.value?.messageQueue.value??[]);return{tabs:e,currentTab:t,currentTabId:a,currentSessionId:l,activeTabs:c,tabCount:u,hasTabs:d,loading:i,currentConnectionStatus:p,currentIsGenerating:h,currentIsLoadingHistory:f,currentHasMoreHistory:m,currentHistoryState:g,currentDisplayItems:y,currentMessages:k,currentSessionSettings:w,currentLastError:S,clearCurrentError:function(){t.value&&(t.value.connectionState.lastError=null)},notifyDisplayItemsChanged:function(){o.value++},currentBackendType:C,currentBackendCapabilities:T,switchTabBackend:async function(n,o){const i="string"==typeof n?e.value.find(e=>e.tabId===n):n;if(!i)throw new Error("Tab not found");await i.setBackendType(o),t.value?.tabId===i.tabId&&(s.value=o);const r=au(o,v);i.setInitialConnectOptions(r),iu.info(`[SessionStore] Tab ${i.tabId} åŽç«¯å·²åˆ‡æ¢ä¸º ${o}`)},canSwitchBackend:function(t){return void 0!==("string"==typeof t?e.value.find(e=>e.tabId===t):t)},getAvailableBackends:function(){return Wl()},createTab:E,createSession:async function(e){return E(e)},startNewSession:async function(e){return E(e)},resumeSession:async function(n,s,o,i,r){if(!n)return null;if(1===e.value.length){const n=e.value[0];null===n.sessionId.value&&n.connectionState.status!==hl.CONNECTED&&n.connectionState.status!==hl.CONNECTING&&0===n.messages.length&&0===n.displayItems.length&&(e.value=[],t.value=null)}const a=e.value.find(e=>e.sessionId.value===n);if(a)return t.value=a,a;const l=r||((c=n)?c.startsWith("thread_")?"codex":"claude":null)||"claude";var c;iu.info(`[SessionStore] æ¢å¤ä¼šè¯ ${n}ï¼ŒåŽç«¯ç±»åž‹: ${l}`);const u=n.slice(-8)||n,d=await E(s||`åŽ†å²ä¼šè¯ ${u}`,{continueConversation:!0,resumeSessionId:n,backendType:l});d.sessionId.value=n,o&&(d.projectPath.value=o);const p=d.loadHistory({sessionId:n,projectPath:o,offset:-1,limit:100}).catch(e=>{iu.warn(`[SessionStore] åŠ è½½åŽ†å²å¤±è´¥: ${n}`,e)});return d.__historyPromise=p,!s&&o&&Xa.getHistoryMetadata({sessionId:n,projectPath:o}).then(e=>{e.customTitle&&(d.rename(e.customTitle),iu.info(`[SessionStore] ä½¿ç”¨ customTitle ä½œä¸º tab åç§°: ${e.customTitle}`))}).catch(e=>{iu.warn(`[SessionStore] èŽ·å– customTitle å¤±è´¥: ${n}`,e)}),d},switchTab:I,switchSession:async function(e){await I(e)},closeTab:x,deleteSession:async function(e){return x(e)},updateTabOrder:function(t){t.forEach((t,n)=>{const s=e.value.find(e=>e.tabId===t);s&&s.setOrder(n)}),iu.debug("[SessionStore] æ›´æ–° Tab æŽ’åº")},renameSession:async function(t,n){const s=e.value.find(e=>e.tabId===t||e.sessionId.value===t);return!!s&&(s.rename(n),!0)},resetCurrentTab:async function(){const e=t.value;if(!e)return void iu.warn("[SessionStore] æ²¡æœ‰å½“å‰ Tabï¼Œæ— æ³•é‡ç½®");e.disconnect(),e.reset(),e.sessionId.value=null;const s=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});e.name.value=gn.global.t("session.defaultName",{time:s}),ru();const o=au(e.backendType.value,v);e.setInitialConnectOptions(o),n.value=e.connectionState.status,iu.info(`[SessionStore] å·²é‡ç½®å½“å‰ Tab: ${e.tabId}`)},sendMessage:async function(e){if(!t.value)throw new Error("å½“å‰æ²¡æœ‰æ´»è·ƒçš„ä¼šè¯");t.value.sendTextMessage(e)},enqueueMessage:function(e){t.value?t.value.sendMessage(e):console.error("[SessionStore] enqueueMessage: æ²¡æœ‰æ´»è·ƒä¼šè¯")},interrupt:async function(){if(!t.value)throw new Error("å½“å‰æ²¡æœ‰æ´»è·ƒçš„ä¼šè¯");await t.value.interrupt()},runInBackground:async function(){if(!t.value)throw new Error("å½“å‰æ²¡æœ‰æ´»è·ƒçš„ä¼šè¯");await t.value.runInBackground()},setModel:async function(e){if(!t.value)throw new Error("å½“å‰æ²¡æœ‰æ´»è·ƒçš„ä¼šè¯");await t.value.setModel(e)},setPermissionMode:async function(e){if(!t.value)throw new Error("å½“å‰æ²¡æœ‰æ´»è·ƒçš„ä¼šè¯");await t.value.setPermissionMode(e)},setLocalPermissionMode:function(e){t.value?t.value.setLocalPermissionMode(e):console.warn("å½“å‰æ²¡æœ‰æ´»è·ƒçš„ä¼šè¯ï¼Œæ— æ³•è®¾ç½®æœ¬åœ°æƒé™æ¨¡å¼")},updateCurrentSessionSettings:function(e){t.value&&(void 0!==e.modelId&&(t.value.modelId.value=e.modelId),void 0!==e.thinkingEnabled&&(t.value.thinkingEnabled.value=e.thinkingEnabled),void 0!==e.permissionMode&&(t.value.permissionMode.value=e.permissionMode),void 0!==e.skipPermissions&&(t.value.skipPermissions.value=e.skipPermissions))},getCurrentPendingQuestions:function(){return t.value?.permissions.pendingQuestionList.value??[]},answerQuestion:function(e,n){return t.value?.permissions.answerQuestion(e,n)??!1},cancelQuestion:function(e){return t.value?.permissions.cancelQuestion(e)??!1},getCurrentPendingPermissions:function(){return t.value?.permissions.pendingPermissionList.value??[]},getPermissionForToolCall:function(e){return t.value?.permissions.getPermissionForToolCall(e)},respondPermission:function(e,n){return t.value?.permissions.respondPermission(e,n)??!1},cancelPermission:function(e){return t.value?.permissions.cancelPermission(e)??!1},startRequestTracking:function(e,n,s){t.value?.stats.startRequestTracking(n),s&&t.value?.stats.setStreamingMessageId(s)},addTokenUsage:function(e,n,s){t.value?.stats.addTokenUsage(n,s)},getRequestStats:function(e){return t.value?.stats.getCurrentTracker()},messageQueue:A,editQueueMessage:function(e){return t.value?.editQueueMessage(e)??null},removeFromQueue:function(e){return t.value?.removeFromQueue(e)??!1},clearQueue:function(){t.value?.clearQueue()},loadMoreHistory:async function(){t.value&&await t.value.loadMoreHistory()},switchToBrowseMode:function(){if(!t.value)return;const e=t.value.uiState.scrollState;"follow"===e.mode&&t.value.saveUiState({scrollState:{...e,mode:"browse",newMessageCount:0}})},switchToFollowMode:function(){t.value&&t.value.saveUiState({scrollState:{mode:"follow",anchor:null,newMessageCount:0}})},registerBeforeTabSwitch:function(e){r.add(e)},unregisterBeforeTabSwitch:function(e){r.delete(e)}}});function cu(){const{t:e,locale:t}=Ye();return{t:e,locale:t,hasKey:t=>e(t)!==t,isChinese:We(()=>"zh-CN"===t.value),isEnglish:We(()=>"en-US"===t.value),isKorean:We(()=>"ko-KR"===t.value),isJapanese:We(()=>"ja-JP"===t.value)}}const uu=Ge("browser"),du=Ge(!1);function pu(){return{isInIde:We(()=>"ide"===uu.value),isInBrowser:We(()=>"browser"===uu.value),environmentReady:du,detectEnvironment:async function(){du.value||(await Ac(),uu.value=xc(),du.value=!0,console.log(`ðŸ” [useEnvironment] çŽ¯å¢ƒæ£€æµ‹å®Œæˆ: ${uu.value}`))}}}const hu=new class{async init(){console.log("ðŸŒ Locale initialized from localStorage/browser:",this.getLocale())}getLocale(){return vn()}async setLocale(e){yn(e),console.log("ðŸŒ Locale changed to:",e)}getElementPlusLocale(){return{"zh-CN":"zh-cn","en-US":"en","ko-KR":"ko","ja-JP":"ja"}[this.getLocale()]||"en"}isChinese(){return"zh-CN"===this.getLocale()}isEnglish(){return"en-US"===this.getLocale()}isKorean(){return"ko-KR"===this.getLocale()}isJapanese(){return"ja-JP"===this.getLocale()}getSupportedLocales(){return[{value:"zh-CN",label:"ç®€ä½“ä¸­æ–‡"},{value:"en-US",label:"English"},{value:"ko-KR",label:"í•œêµ­ì–´"},{value:"ja-JP",label:"æ—¥æœ¬èªž"}]}};var fu=(e=>(e.INFO="info",e.SUCCESS="success",e.WARNING="warning",e.ERROR="error",e))(fu||{});const mu={info:"â„¹ï¸",success:"âœ…",warning:"âš ï¸",error:"âŒ"},gu={duration:3e3},yu=ze("toast",()=>{const e=Ge([]);function t(t,s={}){const{type:o=fu.INFO,duration:i=gu.duration}=s,r={id:`toast-${Date.now()}-${crypto.randomUUID().substring(0,9)}`,type:o,message:t,duration:i,timestamp:Date.now()};return e.value.length>=5&&e.value.shift(),e.value.push(r),i>0&&setTimeout(()=>{n(r.id)},i),r.id}function n(t){const n=e.value.findIndex(e=>e.id===t);-1!==n&&e.value.splice(n,1)}return{toasts:e,addToast:t,removeToast:n,clearAll:function(){e.value=[]},info:function(e,n){return t(e,{type:fu.INFO,duration:n})},success:function(e,n){return t(e,{type:fu.SUCCESS,duration:n})},warning:function(e,n){return t(e,{type:fu.WARNING,duration:n})},error:function(e,n){return t(e,{type:fu.ERROR,duration:n??5e3})}}}),vu=new Set;let bu=0,ku=null,wu=null,Su=null;function Cu(e){vu.forEach(t=>{try{t(e)}catch(n){console.error("[IDE Bridge] Host command handler failed:",n)}})}function Tu(e){const t={type:"switch"===e.type?"switchSession":"create"===e.type?"createSession":"close"===e.type?"closeSession":"rename"===e.type?"renameSession":"toggleHistory"===e.type?"toggleHistory":"setLocale"===e.type?"setLocale":"delete"===e.type?"deleteSession":"reset"===e.type?"resetSession":e.type,payload:{sessionId:e.sessionId,newName:e.newName,locale:e.locale}};console.log("[IDE Bridge] Received session command:",t),Cu(t)}function Eu(e){!async function(e){if(!Kc.isConnected())return console.log("[IDE Bridge] RSocket not connected, skipping state report"),!1;try{return await Kc.reportSessionState(e)}catch(t){return console.warn("[IDE Bridge] Failed to report session state:",t),!1}}(e)}function Iu(e){const t=e.activeTabs;return Array.isArray(t)?t:Array.isArray(t?.value)?t.value:[]}function xu(e){Su=Kc.onSessionCommand(Tu);ku=Ke(()=>function(e){const t=Iu(e).map(e=>{const t="object"==typeof e.tabId?e.tabId?.value:e.tabId,n="object"==typeof e.name?e.name?.value:e.name,s="object"==typeof e.sessionId?e.sessionId?.value:e.sessionId,o="object"==typeof e.isGenerating?e.isGenerating?.value:e.isGenerating,i="object"==typeof e.connectionState?.status?e.connectionState?.status?.value:e.connectionState?.status;return{id:String(t||""),title:String(n||`ä¼šè¯ ${String(t||"").slice(-6)}`),sessionId:s?String(s):null,isGenerating:Boolean(o),isConnected:i===hl.CONNECTED,isConnecting:i===hl.CONNECTING}}),n=e.currentTabId??null;return{sessions:t,activeSessionId:n?String(n):null}}(e),e=>{console.log("[IDE Bridge] ðŸ”„ Session state changed:",e.sessions.length,"sessions"),Eu(e)},{deep:!0,immediate:!0})}function Au(e){var t;return bu+=1,"undefined"!=typeof window&&(window.__CLAUDE_IDE_BRIDGE__=window.__CLAUDE_IDE_BRIDGE__||{},window.__CLAUDE_IDE_BRIDGE__.onHostCommand=e=>{Cu(e)}),1===bu&&(xu(e),t=e,wu||(wu=async e=>{try{switch(e.type){case"switchSession":{const n=e.payload?.sessionId;if(n){const e=Iu(t).find(e=>e.tabId===n||e.sessionId?.value===n||e.sessionId===n);e?(console.log("[IDE Bridge] Switching to existing tab:",e.tabId),await t.switchTab(e.tabId)):(console.log("[IDE Bridge] Resuming history session:",n),await t.resumeSession(n)||console.warn("[IDE Bridge] Failed to resume session:",n))}break}case"createSession":{const e=await t.createTab();console.log("[IDE Bridge] Created new tab:",e.tabId);break}case"resetSession":{const e=t.currentTabId;if(e){const n=Iu(t).find(t=>t.tabId===e);n&&"function"==typeof n.reset?(await n.reset(),console.log("[IDE Bridge] Reset current tab:",e)):console.warn("[IDE Bridge] Current tab does not support reset")}break}case"closeSession":{const n=e.payload?.sessionId;if(n){if(Iu(t).length<=1){console.warn("[IDE Bridge] Cannot close the last tab");break}await t.closeTab(n)}break}case"deleteSession":{const n=e.payload?.sessionId;if(n){const e=Iu(t),s=e.find(e=>("object"==typeof e.sessionId?e.sessionId?.value:e.sessionId)===n);if(s){if(e.length<=1){console.warn("[IDE Bridge] Cannot delete the last tab, resetting instead");break}await t.closeTab(s.tabId),console.log(`[IDE Bridge] Deleted session ${n}`)}else console.log(`[IDE Bridge] Session ${n} not loaded as tab, nothing to close`)}break}case"renameSession":{const n=e.payload?.sessionId,s=e.payload?.newName;if(n&&s){const e=Iu(t).find(e=>e.tabId===n);if(e){"function"==typeof e.rename?e.rename(s):e.name&&"object"==typeof e.name&&"value"in e.name&&(e.name.value=s);const t=yu();e.session?.isConnected&&"function"==typeof e.sendTextMessageDirect?e.sendTextMessageDirect(`/rename ${s}`).then(()=>{t.success(`Rename success: "${s}"`)}).catch(e=>{console.error("[IDE Bridge] å‘é€ /rename å‘½ä»¤å¤±è´¥:",e),t.error("Rename failed")}):t.success(`Rename success: "${s}"`),console.log(`[IDE Bridge] Renamed session ${n} to "${s}"`)}}break}case"setLocale":{const t=e.payload?.locale;if(t){const e=hu.getLocale();t!==e?(console.log(`[IDE Bridge] Locale changed: ${e} -> ${t}`),await hu.setLocale(t),window.location.reload()):console.log(`[IDE Bridge] Locale unchanged: ${t}`)}break}}}catch(n){console.error(`[IDE Bridge] Failed to process host command ${e.type}:`,n)}},vu.add(wu))),()=>{bu=Math.max(bu-1,0),0===bu&&(ku?.(),ku=null,wu&&(vu.delete(wu),wu=null),Su?.(),Su=null)}}var Nu=(e=>(e.USER="USER",e.ASSISTANT="ASSISTANT",e.SYSTEM="SYSTEM",e.ERROR="ERROR",e))(Nu||{}),Mu=(e=>(e.SENDING="SENDING",e.STREAMING="STREAMING",e.COMPLETE="COMPLETE",e.FAILED="FAILED",e))(Mu||{}),Ru=(e=>(e.DEFAULT="DEFAULT",e.OPUS="OPUS",e.SONNET="SONNET",e.OPUS_PLAN="OPUS_PLAN",e))(Ru||{});function _u(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>t[e])}const Ou={class:"image-preview-modal"},Du={class:"image-wrapper"},Bu=["src","alt"],Lu=Ze({__name:"ImagePreviewModal",props:{visible:{type:Boolean},imageSrc:{},imageAlt:{}},emits:["close"],setup(e,{emit:t}){const n=e,s=t;function o(){s("close")}function i(e){"Escape"===e.key&&o()}return Ke(()=>n.visible,e=>{e?document.addEventListener("keydown",i):document.removeEventListener("keydown",i)},{immediate:!0}),Xe(()=>{document.removeEventListener("keydown",i)}),(t,n)=>(st(),Je(nt,{to:"body"},[e.visible&&e.imageSrc?(st(),Qe("div",{key:0,class:"image-preview-overlay",onClick:et(o,["self"])},[tt("div",Ou,[tt("button",{class:"close-button",type:"button",title:"Close",onClick:o}," âœ• "),tt("div",Du,[tt("img",{src:e.imageSrc,alt:e.imageAlt||"Preview image",class:"preview-image"},null,8,Bu)])])])):qe("",!0)]))}}),Fu={key:0,class:"popup-search"},Pu=["placeholder"],$u={class:"file-list"},Uu={key:0,class:"indexing-notice"},Vu=["onClick","onMouseenter"],Wu={class:"file-icon"},Gu={class:"file-name"},zu={class:"file-path"},Hu={key:0,class:"no-results"},Ku={key:1,class:"file-path-bar"},ju=(e,t)=>{const n=e.__vccOpts||e;for(const[s,o]of t)n[s]=o;return n},Yu=ju(Ze({__name:"FileSelectPopup",props:{visible:{type:Boolean},files:{},anchorElement:{},showSearchInput:{type:Boolean},placeholder:{},isIndexing:{type:Boolean}},emits:["select","dismiss","search"],setup(e,{emit:t}){const n=e,s=t,o=Ge(null),i=Ge(null),r=Ge(0),a=Ge(""),l=We(()=>!!n.visible&&(!!n.showSearchInput||(!!n.isIndexing||n.files.length>0))),c=We(()=>r.value>=0&&r.value<n.files.length?n.files[r.value]:null),u=We(()=>{if(!n.anchorElement)return{display:"none"};const e=n.anchorElement.getBoundingClientRect();return{position:"fixed",left:`${e.left}px`,bottom:window.innerHeight-e.top+8+"px",zIndex:1e4}});function d(e){s("select",e),r.value=0,a.value=""}function p(){s("search",a.value),r.value=0}function h(e){if(n.visible)switch(e.key){case"ArrowDown":e.preventDefault(),n.files.length>0&&(r.value=Math.min(r.value+1,n.files.length-1));break;case"ArrowUp":e.preventDefault(),n.files.length>0&&(r.value=Math.max(r.value-1,0));break;case"Enter":e.preventDefault(),r.value>=0&&r.value<n.files.length&&d(n.files[r.value]);break;case"Escape":e.preventDefault(),s("dismiss")}}function f(e){n.visible&&(n.showSearchInput||h(e))}function m(e){if(!n.visible)return;const t=e.target;o.value&&!o.value.contains(t)&&s("dismiss")}return Ke(()=>n.visible,e=>{e&&(r.value=0,a.value="",n.showSearchInput&&pt(()=>{i.value?.focus()}))}),Ke(()=>n.files,()=>{r.value=0}),ot(()=>{document.addEventListener("keydown",f),document.addEventListener("mousedown",m)}),Xe(()=>{document.removeEventListener("keydown",f),document.removeEventListener("mousedown",m)}),(t,n)=>(st(),Je(nt,{to:"body"},[l.value?(st(),Qe("div",{key:0,ref_key:"popupRef",ref:o,class:"file-select-popup",style:it(u.value),onMousedown:n[1]||(n[1]=et(()=>{},["prevent"]))},[e.showSearchInput?(st(),Qe("div",Fu,[rt(tt("input",{ref_key:"searchInputRef",ref:i,"onUpdate:modelValue":n[0]||(n[0]=e=>a.value=e),type:"text",class:"search-input",placeholder:e.placeholder,onInput:p,onKeydown:h},null,40,Pu),[[at,a.value]])])):qe("",!0),tt("div",$u,[e.isIndexing?(st(),Qe("div",Uu,[...n[2]||(n[2]=[tt("span",{class:"indexing-icon"},"â³",-1),tt("span",null,"Indexing in progress...",-1)])])):(st(),Qe(lt,{key:1},[(st(!0),Qe(lt,null,ct(e.files,(e,t)=>{return st(),Qe("div",{key:e.absolutePath||e.relativePath,class:dt(["file-item",{selected:t===r.value}]),onClick:t=>d(e),onMouseenter:e=>r.value=t},[tt("span",Wu,ut(e.isDirectory?"ðŸ“":(n=e.fileType,{ts:"ðŸ“˜",js:"ðŸ“’",vue:"ðŸ’š",kt:"ðŸŸ£",java:"â˜•",py:"ðŸ",md:"ðŸ“",json:"ðŸ“‹",yaml:"ðŸ“‹",yml:"ðŸ“‹",xml:"ðŸ“‹",html:"ðŸŒ",css:"ðŸŽ¨",scss:"ðŸŽ¨",less:"ðŸŽ¨",gradle:"ðŸ˜",kts:"ðŸ˜"}[n?.toLowerCase()]||"ðŸ“„")),1),tt("span",Gu,ut(e.name),1),tt("span",zu,ut(e.relativePath),1)],42,Vu);var n}),128)),0===e.files.length&&e.showSearchInput?(st(),Qe("div",Hu," No results ")):qe("",!0)],64))]),e.files.length>0&&c.value?(st(),Qe("div",Ku,ut(c.value.absolutePath||c.value.relativePath),1)):qe("",!0)],36)):qe("",!0)]))}}),[["__scopeId","data-v-c462dbf0"]]),Zu=Ze({__name:"AtSymbolFilePopup",props:{visible:{type:Boolean},files:{},anchorElement:{},atPosition:{},isIndexing:{type:Boolean}},emits:["select","dismiss"],setup(e,{emit:t}){const n=t;function s(e){n("select",e)}function o(){n("dismiss")}return(t,n)=>(st(),Je(Yu,{visible:e.visible,files:e.files,"anchor-element":e.anchorElement,"show-search-input":!1,"is-indexing":e.isIndexing,onSelect:s,onDismiss:o},null,8,["visible","files","anchor-element","is-indexing"]))}}),Xu={class:"command-list"},Ju=["onClick","onMouseenter"],Qu={class:"command-name"},qu={class:"command-desc"},ed={key:0,class:"no-results"},td=ju(Ze({__name:"SlashCommandPopup",props:{visible:{type:Boolean},query:{},anchorElement:{}},emits:["select","dismiss"],setup(e,{emit:t}){const n=e,s=t,{t:o}=cu(),i=Ge(),r=Ge(0),a=We(()=>[{name:"/compact",description:o("slashCommand.compact")},{name:"/context",description:o("slashCommand.context")},{name:"/rename",description:o("slashCommand.rename")}]),l=We(()=>{const e=n.query.toLowerCase();return e?a.value.filter(t=>t.name.slice(1).toLowerCase().startsWith(e)):a.value}),c=We(()=>{if(!n.anchorElement)return{display:"none"};const e=n.anchorElement.getBoundingClientRect();return{position:"fixed",left:`${e.left}px`,bottom:window.innerHeight-e.top+8+"px",minWidth:"280px",maxWidth:"360px"}});function u(e){s("select",e)}function d(e){if(n.visible)switch(e.key){case"ArrowUp":e.preventDefault(),e.stopPropagation(),r.value=Math.max(0,r.value-1);break;case"ArrowDown":e.preventDefault(),e.stopPropagation(),r.value=Math.min(l.value.length-1,r.value+1);break;case"Enter":case"Tab":e.preventDefault(),e.stopPropagation(),l.value.length>0&&u(l.value[r.value]);break;case"Escape":e.preventDefault(),e.stopPropagation(),s("dismiss")}}function p(e){n.visible&&i.value&&!i.value.contains(e.target)&&s("dismiss")}return Ke(()=>n.visible,e=>{e&&(r.value=0)}),Ke(()=>n.query,()=>{r.value=0}),ot(()=>{document.addEventListener("keydown",d,!0),document.addEventListener("click",p)}),Xe(()=>{document.removeEventListener("keydown",d,!0),document.removeEventListener("click",p)}),(t,n)=>e.visible?(st(),Qe("div",{key:0,ref_key:"popupRef",ref:i,class:"slash-command-popup",style:it(c.value)},[tt("div",Xu,[(st(!0),Qe(lt,null,ct(l.value,(e,t)=>(st(),Qe("div",{key:e.name,class:dt(["command-item",{selected:r.value===t}]),onClick:t=>u(e),onMouseenter:e=>r.value=t},[tt("span",Qu,ut(e.name),1),tt("span",qu,ut(e.description),1)],42,Ju))),128))]),0===l.value.length?(st(),Qe("div",ed,ut(ht(o)("chat.noMatchingCommands")),1)):qe("",!0)],4)):qe("",!0)}}),[["__scopeId","data-v-7351c64b"]]),nd=["title"],sd={class:"usage-text"},od=ju(Ze({__name:"ContextUsageIndicator",props:{sessionTokenUsage:{default:null}},setup(e){const t=e,n=We(()=>t.sessionTokenUsage?t.sessionTokenUsage.inputTokens:0),s=We(()=>function(e){if(e>=1e6)return`${(e/1e6).toFixed(1)}M`;if(e>=1e3)return`${(e/1e3).toFixed(1)}K`;return String(e)}(n.value)),o=We(()=>`ä¸Šä¸‹æ–‡: ${n.value.toLocaleString()} tokens`);return(e,t)=>(st(),Qe("div",{class:"context-usage-indicator",title:o.value},[tt("span",sd,ut(s.value),1)],8,nd))}}),[["__scopeId","data-v-3e590c89"]]);function id(e){this.content=e}function rd(e,t,n){for(let s=0;;s++){if(s==e.childCount||s==t.childCount)return e.childCount==t.childCount?null:n;let o=e.child(s),i=t.child(s);if(o!=i){if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(let e=0;o.text[e]==i.text[e];e++)n++;return n}if(o.content.size||i.content.size){let e=rd(o.content,i.content,n+1);if(null!=e)return e}n+=o.nodeSize}else n+=o.nodeSize}}function ad(e,t,n,s){for(let o=e.childCount,i=t.childCount;;){if(0==o||0==i)return o==i?null:{a:n,b:s};let r=e.child(--o),a=t.child(--i),l=r.nodeSize;if(r!=a){if(!r.sameMarkup(a))return{a:n,b:s};if(r.isText&&r.text!=a.text){let e=0,t=Math.min(r.text.length,a.text.length);for(;e<t&&r.text[r.text.length-e-1]==a.text[a.text.length-e-1];)e++,n--,s--;return{a:n,b:s}}if(r.content.size||a.content.size){let e=ad(r.content,a.content,n-1,s-1);if(e)return e}n-=l,s-=l}else n-=l,s-=l}}id.prototype={constructor:id,find:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t;return-1},get:function(e){var t=this.find(e);return-1==t?void 0:this.content[t+1]},update:function(e,t,n){var s=n&&n!=e?this.remove(n):this,o=s.find(e),i=s.content.slice();return-1==o?i.push(n||e,t):(i[o+1]=t,n&&(i[o]=n)),new id(i)},remove:function(e){var t=this.find(e);if(-1==t)return this;var n=this.content.slice();return n.splice(t,2),new id(n)},addToStart:function(e,t){return new id([e,t].concat(this.remove(e).content))},addToEnd:function(e,t){var n=this.remove(e).content.slice();return n.push(e,t),new id(n)},addBefore:function(e,t,n){var s=this.remove(t),o=s.content.slice(),i=s.find(e);return o.splice(-1==i?o.length:i,0,t,n),new id(o)},forEach:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])},prepend:function(e){return(e=id.from(e)).size?new id(e.content.concat(this.subtract(e).content)):this},append:function(e){return(e=id.from(e)).size?new id(this.subtract(e).content.concat(e.content)):this},subtract:function(e){var t=this;e=id.from(e);for(var n=0;n<e.content.length;n+=2)t=t.remove(e.content[n]);return t},toObject:function(){var e={};return this.forEach(function(t,n){e[t]=n}),e},get size(){return this.content.length>>1}},id.from=function(e){if(e instanceof id)return e;var t=[];if(e)for(var n in e)t.push(n,e[n]);return new id(t)};class ld{constructor(e,t){if(this.content=e,this.size=t||0,null==t)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,s=0,o){for(let i=0,r=0;r<t;i++){let a=this.content[i],l=r+a.nodeSize;if(l>e&&!1!==n(a,s+r,o||null,i)&&a.content.size){let o=r+1;a.nodesBetween(Math.max(0,e-o),Math.min(a.content.size,t-o),n,s+o)}r=l}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,s){let o="",i=!0;return this.nodesBetween(e,t,(r,a)=>{let l=r.isText?r.text.slice(Math.max(e,a)-a,t-a):r.isLeaf?s?"function"==typeof s?s(r):s:r.type.spec.leafText?r.type.spec.leafText(r):"":"";r.isBlock&&(r.isLeaf&&l||r.isTextblock)&&n&&(i?i=!1:o+=n),o+=l},0),o}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,s=this.content.slice(),o=0;for(t.isText&&t.sameMarkup(n)&&(s[s.length-1]=t.withText(t.text+n.text),o=1);o<e.content.length;o++)s.push(e.content[o]);return new ld(s,this.size+e.size)}cut(e,t=this.size){if(0==e&&t==this.size)return this;let n=[],s=0;if(t>e)for(let o=0,i=0;i<t;o++){let r=this.content[o],a=i+r.nodeSize;a>e&&((i<e||a>t)&&(r=r.isText?r.cut(Math.max(0,e-i),Math.min(r.text.length,t-i)):r.cut(Math.max(0,e-i-1),Math.min(r.content.size,t-i-1))),n.push(r),s+=r.nodeSize),i=a}return new ld(n,s)}cutByIndex(e,t){return e==t?ld.empty:0==e&&t==this.content.length?this:new ld(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let s=this.content.slice(),o=this.size+t.nodeSize-n.nodeSize;return s[e]=t,new ld(s,o)}addToStart(e){return new ld([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new ld(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let s=this.content[t];e(s,n,t),n+=s.nodeSize}}findDiffStart(e,t=0){return rd(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return ad(this,e,t,n)}findIndex(e){if(0==e)return ud(0,e);if(e==this.size)return ud(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,n=0;;t++){let s=n+this.child(t).nodeSize;if(s>=e)return s==e?ud(t+1,s):ud(t,n);n=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return ld.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new ld(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return ld.empty;let t,n=0;for(let s=0;s<e.length;s++){let o=e[s];n+=o.nodeSize,s&&o.isText&&e[s-1].sameMarkup(o)?(t||(t=e.slice(0,s)),t[t.length-1]=o.withText(t[t.length-1].text+o.text)):t&&t.push(o)}return new ld(t||e,n)}static from(e){if(!e)return ld.empty;if(e instanceof ld)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new ld([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}ld.empty=new ld([],0);const cd={index:0,offset:0};function ud(e,t){return cd.index=e,cd.offset=t,cd}function dd(e,t){if(e===t)return!0;if(!e||"object"!=typeof e||!t||"object"!=typeof t)return!1;let n=Array.isArray(e);if(Array.isArray(t)!=n)return!1;if(n){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!dd(e[n],t[n]))return!1}else{for(let n in e)if(!(n in t)||!dd(e[n],t[n]))return!1;for(let n in t)if(!(n in e))return!1}return!0}let pd=class e{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let s=0;s<e.length;s++){let o=e[s];if(this.eq(o))return e;if(this.type.excludes(o.type))t||(t=e.slice(0,s));else{if(o.type.excludes(this.type))return e;!n&&o.type.rank>this.type.rank&&(t||(t=e.slice(0,s)),t.push(this),n=!0),t&&t.push(o)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&dd(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let s=n.create(t.attrs);return n.checkAttrs(s.attrs),s}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&0==t.length)return e.none;if(t instanceof e)return[t];let n=t.slice();return n.sort((e,t)=>e.type.rank-t.type.rank),n}};pd.none=[];class hd extends Error{}class fd{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=gd(this.content,e+this.openStart,t);return n&&new fd(n,this.openStart,this.openEnd)}removeBetween(e,t){return new fd(md(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return fd.empty;let n=t.openStart||0,s=t.openEnd||0;if("number"!=typeof n||"number"!=typeof s)throw new RangeError("Invalid input for Slice.fromJSON");return new fd(ld.fromJSON(e,t.content),n,s)}static maxOpen(e,t=!0){let n=0,s=0;for(let o=e.firstChild;o&&!o.isLeaf&&(t||!o.type.spec.isolating);o=o.firstChild)n++;for(let o=e.lastChild;o&&!o.isLeaf&&(t||!o.type.spec.isolating);o=o.lastChild)s++;return new fd(e,n,s)}}function md(e,t,n){let{index:s,offset:o}=e.findIndex(t),i=e.maybeChild(s),{index:r,offset:a}=e.findIndex(n);if(o==t||i.isText){if(a!=n&&!e.child(r).isText)throw new RangeError("Removing non-flat range");return e.cut(0,t).append(e.cut(n))}if(s!=r)throw new RangeError("Removing non-flat range");return e.replaceChild(s,i.copy(md(i.content,t-o-1,n-o-1)))}function gd(e,t,n,s){let{index:o,offset:i}=e.findIndex(t),r=e.maybeChild(o);if(i==t||r.isText)return s&&!s.canReplace(o,o,n)?null:e.cut(0,t).append(n).append(e.cut(t));let a=gd(r.content,t-i-1,n,r);return a&&e.replaceChild(o,r.copy(a))}function yd(e,t,n){if(n.openStart>e.depth)throw new hd("Inserted content deeper than insertion position");if(e.depth-n.openStart!=t.depth-n.openEnd)throw new hd("Inconsistent open depths");return vd(e,t,n,0)}function vd(e,t,n,s){let o=e.index(s),i=e.node(s);if(o==t.index(s)&&s<e.depth-n.openStart){let r=vd(e,t,n,s+1);return i.copy(i.content.replaceChild(o,r))}if(n.content.size){if(n.openStart||n.openEnd||e.depth!=s||t.depth!=s){let{start:o,end:r}=function(e,t){let n=t.depth-e.openStart,s=t.node(n).copy(e.content);for(let o=n-1;o>=0;o--)s=t.node(o).copy(ld.from(s));return{start:s.resolveNoCache(e.openStart+n),end:s.resolveNoCache(s.content.size-e.openEnd-n)}}(n,e);return Cd(i,Td(e,o,r,t,s))}{let s=e.parent,o=s.content;return Cd(s,o.cut(0,e.parentOffset).append(n.content).append(o.cut(t.parentOffset)))}}return Cd(i,Ed(e,t,s))}function bd(e,t){if(!t.type.compatibleContent(e.type))throw new hd("Cannot join "+t.type.name+" onto "+e.type.name)}function kd(e,t,n){let s=e.node(n);return bd(s,t.node(n)),s}function wd(e,t){let n=t.length-1;n>=0&&e.isText&&e.sameMarkup(t[n])?t[n]=e.withText(t[n].text+e.text):t.push(e)}function Sd(e,t,n,s){let o=(t||e).node(n),i=0,r=t?t.index(n):o.childCount;e&&(i=e.index(n),e.depth>n?i++:e.textOffset&&(wd(e.nodeAfter,s),i++));for(let a=i;a<r;a++)wd(o.child(a),s);t&&t.depth==n&&t.textOffset&&wd(t.nodeBefore,s)}function Cd(e,t){return e.type.checkContent(t),e.copy(t)}function Td(e,t,n,s,o){let i=e.depth>o&&kd(e,t,o+1),r=s.depth>o&&kd(n,s,o+1),a=[];return Sd(null,e,o,a),i&&r&&t.index(o)==n.index(o)?(bd(i,r),wd(Cd(i,Td(e,t,n,s,o+1)),a)):(i&&wd(Cd(i,Ed(e,t,o+1)),a),Sd(t,n,o,a),r&&wd(Cd(r,Ed(n,s,o+1)),a)),Sd(s,null,o,a),new ld(a)}function Ed(e,t,n){let s=[];if(Sd(null,e,n,s),e.depth>n){wd(Cd(kd(e,t,n+1),Ed(e,t,n+1)),s)}return Sd(t,null,n,s),new ld(s)}fd.empty=new fd(ld.empty,0,0);class Id{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return null==e?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[3*this.resolveDepth(e)]}index(e){return this.path[3*this.resolveDepth(e)+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e!=this.depth||this.textOffset?1:0)}start(e){return 0==(e=this.resolveDepth(e))?0:this.path[3*e-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(!(e=this.resolveDepth(e)))throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]}after(e){if(!(e=this.resolveDepth(e)))throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]+this.path[3*e].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],s=e.child(t);return n?e.child(t).cut(n):s}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):0==e?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[3*t],s=0==t?0:this.path[3*t-1]+1;for(let o=0;o<e;o++)s+=n.child(o).nodeSize;return s}marks(){let e=this.parent,t=this.index();if(0==e.content.size)return pd.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),s=e.maybeChild(t);if(!n){let e=n;n=s,s=e}let o=n.marks;for(var i=0;i<o.length;i++)!1!==o[i].type.spec.inclusive||s&&o[i].isInSet(s.marks)||(o=o[i--].removeFromSet(o));return o}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,s=e.parent.maybeChild(e.index());for(var o=0;o<n.length;o++)!1!==n[o].type.spec.inclusive||s&&n[o].isInSet(s.marks)||(n=n[o--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new Md(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],s=0,o=t;for(let i=e;;){let{index:e,offset:t}=i.content.findIndex(o),r=o-t;if(n.push(i,e,s+t),!r)break;if(i=i.child(e),i.isText)break;o=r-1,s+=t+1}return new Id(t,n,o)}static resolveCached(e,t){let n=Nd.get(e);if(n)for(let o=0;o<n.elts.length;o++){let e=n.elts[o];if(e.pos==t)return e}else Nd.set(e,n=new xd);let s=n.elts[n.i]=Id.resolve(e,t);return n.i=(n.i+1)%Ad,s}}class xd{constructor(){this.elts=[],this.i=0}}const Ad=12,Nd=new WeakMap;class Md{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const Rd=Object.create(null);let _d=class e{constructor(e,t,n,s=pd.none){this.type=e,this.attrs=t,this.marks=s,this.content=n||ld.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,s=0){this.content.nodesBetween(e,t,n,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,s){return this.content.textBetween(e,t,n,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&dd(this.attrs,t||e.defaultAttrs||Rd)&&pd.sameSet(this.marks,n||pd.none)}copy(t=null){return t==this.content?this:new e(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new e(this.type,this.attrs,this.content,t)}cut(e,t=this.content.size){return 0==e&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return fd.empty;let s=this.resolve(e),o=this.resolve(t),i=n?0:s.sharedDepth(t),r=s.start(i),a=s.node(i).content.cut(s.pos-r,o.pos-r);return new fd(a,s.depth-i,o.depth-i)}replace(e,t,n){return yd(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:s}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(s==e||t.isText)return t;e-=s+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(0==e)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let s=this.content.child(t-1);return{node:s,index:t-1,offset:n-s.nodeSize}}resolve(e){return Id.resolveCached(this,e)}resolveNoCache(e){return Id.resolve(this,e)}rangeHasMark(e,t,n){let s=!1;return t>e&&this.nodesBetween(e,t,e=>(n.isInSet(e.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),Dd(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=ld.empty,s=0,o=n.childCount){let i=this.contentMatchAt(e).matchFragment(n,s,o),r=i&&i.matchFragment(this.content,t);if(!r||!r.validEnd)return!1;for(let a=s;a<o;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0}canReplaceWith(e,t,n,s){if(s&&!this.type.allowsMarks(s))return!1;let o=this.contentMatchAt(e).matchType(n),i=o&&o.matchFragment(this.content,t);return!!i&&i.validEnd}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=pd.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!pd.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(e=>e.type.name)}`);this.content.forEach(e=>e.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(e=>e.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if("text"==t.type){if("string"!=typeof t.text)throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let s=ld.fromJSON(e,t.content),o=e.nodeType(t.type).create(t.attrs,s,n);return o.type.checkAttrs(o.attrs),o}};_d.prototype.text=void 0;class Od extends _d{constructor(e,t,n,s){if(super(e,t,null,s),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Dd(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Od(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Od(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return 0==e&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function Dd(e,t){for(let n=e.length-1;n>=0;n--)t=e[n].type.name+"("+t+")";return t}class Bd{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new Ld(e,t);if(null==n.next)return Bd.empty;let s=Fd(n);n.next&&n.err("Unexpected trailing text");let o=function(e){let t=Object.create(null);return n(Gd(e,0));function n(s){let o=[];s.forEach(t=>{e[t].forEach(({term:t,to:n})=>{if(!t)return;let s;for(let e=0;e<o.length;e++)o[e][0]==t&&(s=o[e][1]);Gd(e,n).forEach(e=>{s||o.push([t,s=[]]),-1==s.indexOf(e)&&s.push(e)})})});let i=t[s.join(",")]=new Bd(s.indexOf(e.length-1)>-1);for(let e=0;e<o.length;e++){let s=o[e][1].sort(Wd);i.next.push({type:o[e][0],next:t[s.join(",")]||n(s)})}return i}}(function(e){let t=[[]];return o(i(e,0),n()),t;function n(){return t.push([])-1}function s(e,n,s){let o={term:s,to:n};return t[e].push(o),o}function o(e,t){e.forEach(e=>e.to=t)}function i(e,t){if("choice"==e.type)return e.exprs.reduce((e,n)=>e.concat(i(n,t)),[]);if("seq"!=e.type){if("star"==e.type){let r=n();return s(t,r),o(i(e.expr,r),r),[s(r)]}if("plus"==e.type){let r=n();return o(i(e.expr,t),r),o(i(e.expr,r),r),[s(r)]}if("opt"==e.type)return[s(t)].concat(i(e.expr,t));if("range"==e.type){let r=t;for(let t=0;t<e.min;t++){let t=n();o(i(e.expr,r),t),r=t}if(-1==e.max)o(i(e.expr,r),r);else for(let t=e.min;t<e.max;t++){let t=n();s(r,t),o(i(e.expr,r),t),r=t}return[s(r)]}if("name"==e.type)return[s(t,void 0,e.value)];throw new Error("Unknown expr type")}for(let s=0;;s++){let r=i(e.exprs[s],t);if(s==e.exprs.length-1)return r;o(r,t=n())}}}(s));return function(e,t){for(let n=0,s=[e];n<s.length;n++){let e=s[n],o=!e.validEnd,i=[];for(let t=0;t<e.next.length;t++){let{type:n,next:r}=e.next[t];i.push(n.name),!o||n.isText||n.hasRequiredAttrs()||(o=!1),-1==s.indexOf(r)&&s.push(r)}o&&t.err("Only non-generatable nodes ("+i.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(o,n),o}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let s=this;for(let o=t;s&&o<n;o++)s=s.matchType(e.child(o).type);return s}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!t.isText&&!t.hasRequiredAttrs())return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let s=[this];return function o(i,r){let a=i.matchFragment(e,n);if(a&&(!t||a.validEnd))return ld.from(r.map(e=>e.createAndFill()));for(let e=0;e<i.next.length;e++){let{type:t,next:n}=i.next[e];if(!t.isText&&!t.hasRequiredAttrs()&&-1==s.indexOf(n)){s.push(n);let e=o(n,r.concat(t));if(e)return e}}return null}(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let s=n.shift(),o=s.match;if(o.matchType(e)){let e=[];for(let t=s;t.type;t=t.via)e.push(t.type);return e.reverse()}for(let e=0;e<o.next.length;e++){let{type:i,next:r}=o.next[e];i.isLeaf||i.hasRequiredAttrs()||i.name in t||s.type&&!r.validEnd||(n.push({match:i.contentMatch,type:i,via:s}),t[i.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];return function t(n){e.push(n);for(let s=0;s<n.next.length;s++)-1==e.indexOf(n.next[s].next)&&t(n.next[s].next)}(this),e.map((t,n)=>{let s=n+(t.validEnd?"*":" ")+" ";for(let o=0;o<t.next.length;o++)s+=(o?", ":"")+t.next[o].type.name+"->"+e.indexOf(t.next[o].next);return s}).join("\n")}}Bd.empty=new Bd(!0);class Ld{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function Fd(e){let t=[];do{t.push(Pd(e))}while(e.eat("|"));return 1==t.length?t[0]:{type:"choice",exprs:t}}function Pd(e){let t=[];do{t.push($d(e))}while(e.next&&")"!=e.next&&"|"!=e.next);return 1==t.length?t[0]:{type:"seq",exprs:t}}function $d(e){let t=function(e){if(e.eat("(")){let t=Fd(e);return e.eat(")")||e.err("Missing closing paren"),t}if(!/\W/.test(e.next)){let t=function(e,t){let n=e.nodeTypes,s=n[t];if(s)return[s];let o=[];for(let i in n){let e=n[i];e.isInGroup(t)&&o.push(e)}0==o.length&&e.err("No node type or group '"+t+"' found");return o}(e,e.next).map(t=>(null==e.inline?e.inline=t.isInline:e.inline!=t.isInline&&e.err("Mixing inline and block content"),{type:"name",value:t}));return e.pos++,1==t.length?t[0]:{type:"choice",exprs:t}}e.err("Unexpected token '"+e.next+"'")}(e);for(;;)if(e.eat("+"))t={type:"plus",expr:t};else if(e.eat("*"))t={type:"star",expr:t};else if(e.eat("?"))t={type:"opt",expr:t};else{if(!e.eat("{"))break;t=Vd(e,t)}return t}function Ud(e){/\D/.test(e.next)&&e.err("Expected number, got '"+e.next+"'");let t=Number(e.next);return e.pos++,t}function Vd(e,t){let n=Ud(e),s=n;return e.eat(",")&&(s="}"!=e.next?Ud(e):-1),e.eat("}")||e.err("Unclosed braced range"),{type:"range",min:n,max:s,expr:t}}function Wd(e,t){return t-e}function Gd(e,t){let n=[];return function t(s){let o=e[s];if(1==o.length&&!o[0].term)return t(o[0].to);n.push(s);for(let e=0;e<o.length;e++){let{term:s,to:i}=o[e];s||-1!=n.indexOf(i)||t(i)}}(t),n.sort(Wd)}function zd(e){let t=Object.create(null);for(let n in e){let s=e[n];if(!s.hasDefault)return null;t[n]=s.default}return t}function Hd(e,t){let n=Object.create(null);for(let s in e){let o=t&&t[s];if(void 0===o){let t=e[s];if(!t.hasDefault)throw new RangeError("No value supplied for attribute "+s);o=t.default}n[s]=o}return n}function Kd(e,t,n,s){for(let o in t)if(!(o in e))throw new RangeError(`Unsupported attribute ${o} for ${n} of type ${o}`);for(let o in e){let n=e[o];n.validate&&n.validate(t[o])}}function jd(e,t){let n=Object.create(null);if(t)for(let s in t)n[s]=new Zd(e,s,t[s]);return n}let Yd=class e{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=jd(e,n.attrs),this.defaultAttrs=zd(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==e),this.isText="text"==e}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Bd.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:Hd(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new _d(this,this.computeAttrs(e),ld.from(t),pd.setFrom(n))}createChecked(e=null,t,n){return t=ld.from(t),this.checkContent(t),new _d(this,this.computeAttrs(e),t,pd.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),(t=ld.from(t)).size){let e=this.contentMatch.fillBefore(t);if(!e)return null;t=e.append(t)}let s=this.contentMatch.matchFragment(t),o=s&&s.fillBefore(ld.empty,!0);return o?new _d(this,e,t.append(o),pd.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Kd(this.attrs,e,"node",this.name)}allowsMarkType(e){return null==this.markSet||this.markSet.indexOf(e)>-1}allowsMarks(e){if(null==this.markSet)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(null==this.markSet)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:pd.none:e}static compile(t,n){let s=Object.create(null);t.forEach((t,o)=>s[t]=new e(t,n,o));let o=n.spec.topNode||"doc";if(!s[o])throw new RangeError("Schema is missing its top node type ('"+o+"')");if(!s.text)throw new RangeError("Every schema needs a 'text' type");for(let e in s.text.attrs)throw new RangeError("The text node type should not have attributes");return s}};class Zd{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate="string"==typeof n.validate?function(e,t,n){let s=n.split("|");return n=>{let o=null===n?"null":typeof n;if(s.indexOf(o)<0)throw new RangeError(`Expected value of type ${s} for attribute ${t} on type ${e}, got ${o}`)}}(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}}class Xd{constructor(e,t,n,s){this.name=e,this.rank=t,this.schema=n,this.spec=s,this.attrs=jd(e,s.attrs),this.excluded=null;let o=zd(this.attrs);this.instance=o?new pd(this,o):null}create(e=null){return!e&&this.instance?this.instance:new pd(this,Hd(this.attrs,e))}static compile(e,t){let n=Object.create(null),s=0;return e.forEach((e,o)=>n[e]=new Xd(e,s++,t,o)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){Kd(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class Jd{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let s in e)t[s]=e[s];t.nodes=id.from(e.nodes),t.marks=id.from(e.marks||{}),this.nodes=Yd.compile(this.spec.nodes,this),this.marks=Xd.compile(this.spec.marks,this);let n=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let e=this.nodes[s],t=e.spec.content||"",o=e.spec.marks;if(e.contentMatch=n[t]||(n[t]=Bd.parse(t,this.nodes)),e.inlineContent=e.contentMatch.inlineContent,e.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!e.isInline||!e.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=e}e.markSet="_"==o?null:o?Qd(this,o.split(" ")):""!=o&&e.inlineContent?null:[]}for(let s in this.marks){let e=this.marks[s],t=e.spec.excludes;e.excluded=null==t?[e]:""==t?[]:Qd(this,t.split(" "))}this.nodeFromJSON=e=>_d.fromJSON(this,e),this.markFromJSON=e=>pd.fromJSON(this,e),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,s){if("string"==typeof e)e=this.nodeType(e);else{if(!(e instanceof Yd))throw new RangeError("Invalid node type: "+e);if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}return e.createChecked(t,n,s)}text(e,t){let n=this.nodes.text;return new Od(n,n.defaultAttrs,e,pd.setFrom(t))}mark(e,t){return"string"==typeof e&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function Qd(e,t){let n=[];for(let s=0;s<t.length;s++){let o=t[s],i=e.marks[o],r=i;if(i)n.push(i);else for(let t in e.marks){let s=e.marks[t];("_"==o||s.spec.group&&s.spec.group.split(" ").indexOf(o)>-1)&&n.push(r=s)}if(!r)throw new SyntaxError("Unknown mark type: '"+t[s]+"'")}return n}let qd=class e{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(e=>{if(function(e){return null!=e.tag}(e))this.tags.push(e);else if(function(e){return null!=e.style}(e)){let t=/[^=]*/.exec(e.style)[0];n.indexOf(t)<0&&n.push(t),this.styles.push(e)}}),this.normalizeLists=!this.tags.some(t=>{if(!/^(ul|ol)\b/.test(t.tag)||!t.node)return!1;let n=e.nodes[t.node];return n.contentMatch.matchType(n)})}parse(e,t={}){let n=new ip(this,t,!1);return n.addAll(e,pd.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new ip(this,t,!0);return n.addAll(e,pd.none,t.from,t.to),fd.maxOpen(n.finish())}matchTag(e,t,n){for(let s=n?this.tags.indexOf(n)+1:0;s<this.tags.length;s++){let n=this.tags[s];if(rp(e,n.tag)&&(void 0===n.namespace||e.namespaceURI==n.namespace)&&(!n.context||t.matchesContext(n.context))){if(n.getAttrs){let t=n.getAttrs(e);if(!1===t)continue;n.attrs=t||void 0}return n}}}matchStyle(e,t,n,s){for(let o=s?this.styles.indexOf(s)+1:0;o<this.styles.length;o++){let s=this.styles[o],i=s.style;if(!(0!=i.indexOf(e)||s.context&&!n.matchesContext(s.context)||i.length>e.length&&(61!=i.charCodeAt(e.length)||i.slice(e.length+1)!=t))){if(s.getAttrs){let e=s.getAttrs(t);if(!1===e)continue;s.attrs=e||void 0}return s}}}static schemaRules(e){let t=[];function n(e){let n=null==e.priority?50:e.priority,s=0;for(;s<t.length;s++){let e=t[s];if((null==e.priority?50:e.priority)<n)break}t.splice(s,0,e)}for(let s in e.marks){let t=e.marks[s].spec.parseDOM;t&&t.forEach(e=>{n(e=ap(e)),e.mark||e.ignore||e.clearMark||(e.mark=s)})}for(let s in e.nodes){let t=e.nodes[s].spec.parseDOM;t&&t.forEach(e=>{n(e=ap(e)),e.node||e.ignore||e.mark||(e.node=s)})}return t}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new e(t,e.schemaRules(t)))}};const ep={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},tp={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},np={ol:!0,ul:!0};function sp(e,t,n){return null!=t?(t?1:0)|("full"===t?2:0):e&&"pre"==e.whitespace?3:-5&n}class op{constructor(e,t,n,s,o,i){this.type=e,this.attrs=t,this.marks=n,this.solid=s,this.options=i,this.content=[],this.activeMarks=pd.none,this.match=o||(4&i?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(ld.from(e));if(!t){let t,n=this.type.contentMatch;return(t=n.findWrapping(e.type))?(this.match=n,t):null}this.match=this.type.contentMatch.matchFragment(t)}return this.match.findWrapping(e.type)}finish(e){if(!(1&this.options)){let e,t=this.content[this.content.length-1];if(t&&t.isText&&(e=/[ \t\r\n\u000c]+$/.exec(t.text))){let n=t;t.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length))}}let t=ld.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(ld.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!ep.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class ip{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let s,o=t.topNode,i=sp(null,t.preserveWhitespace,0)|(n?4:0);s=o?new op(o.type,o.attrs,pd.none,!0,t.topMatch||o.type.contentMatch,i):new op(n?null:e.schema.topNodeType,null,pd.none,!0,null,i),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){3==e.nodeType?this.addTextNode(e,t):1==e.nodeType&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,s=this.top,o=2&s.options?"full":this.localPreserveWS||(1&s.options)>0,{schema:i}=this.parser;if("full"===o||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(o)if("full"===o)n=n.replace(/\r\n?/g,"\n");else if(i.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(i.linebreakReplacement.create())){let e=n.split(/\r?\n|\r/);for(let n=0;n<e.length;n++)n&&this.insertNode(i.linebreakReplacement.create(),t,!0),e[n]&&this.insertNode(i.text(e[n]),t,!/\S/.test(e[n]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let t=s.content[s.content.length-1],o=e.previousSibling;(!t||o&&"BR"==o.nodeName||t.isText&&/[ \t\r\n\u000c]$/.test(t.text))&&(n=n.slice(1))}n&&this.insertNode(i.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let s=this.localPreserveWS,o=this.top;("PRE"==e.tagName||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let i,r=e.nodeName.toLowerCase();np.hasOwnProperty(r)&&this.parser.normalizeLists&&function(e){for(let t=e.firstChild,n=null;t;t=t.nextSibling){let e=1==t.nodeType?t.nodeName.toLowerCase():null;e&&np.hasOwnProperty(e)&&n?(n.appendChild(t),t=n):"li"==e?n=t:e&&(n=null)}}(e);let a=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(i=this.parser.matchTag(e,this,n));e:if(a?a.ignore:tp.hasOwnProperty(r))this.findInside(e),this.ignoreFallback(e,t);else if(!a||a.skip||a.closeParent){a&&a.closeParent?this.open=Math.max(0,this.open-1):a&&a.skip.nodeType&&(e=a.skip);let n,s=this.needsBlock;if(ep.hasOwnProperty(r))o.content.length&&o.content[0].isInline&&this.open&&(this.open--,o=this.top),n=!0,o.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let i=a&&a.skip?t:this.readStyles(e,t);i&&this.addAll(e,i),n&&this.sync(o),this.needsBlock=s}else{let n=this.readStyles(e,t);n&&this.addElementByRule(e,a,n,!1===a.consuming?i:void 0)}this.localPreserveWS=s}leafFallback(e,t){"BR"==e.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode("\n"),t)}ignoreFallback(e,t){"BR"!=e.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let e=this.parser.matchedStyles[s],o=n.getPropertyValue(e);if(o)for(let n;;){let s=this.parser.matchStyle(e,o,this,n);if(!s)break;if(s.ignore)return null;if(t=s.clearMark?t.filter(e=>!s.clearMark(e)):t.concat(this.parser.schema.marks[s.mark].create(s.attrs)),!1!==s.consuming)break;n=s}}return t}addElementByRule(e,t,n,s){let o,i;if(t.node)if(i=this.parser.schema.nodes[t.node],i.isLeaf)this.insertNode(i.create(t.attrs),n,"BR"==e.nodeName)||this.leafFallback(e,n);else{let e=this.enter(i,t.attrs||null,n,t.preserveWhitespace);e&&(o=!0,n=e)}else{let e=this.parser.schema.marks[t.mark];n=n.concat(e.create(t.attrs))}let r=this.top;if(i&&i.isLeaf)this.findInside(e);else if(s)this.addElement(e,n,s);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(e=>this.insertNode(e,n,!1));else{let s=e;"string"==typeof t.contentElement?s=e.querySelector(t.contentElement):"function"==typeof t.contentElement?s=t.contentElement(e):t.contentElement&&(s=t.contentElement),this.findAround(e,s,!0),this.addAll(s,n),this.findAround(e,s,!1)}o&&this.sync(r)&&this.open--}addAll(e,t,n,s){let o=n||0;for(let i=n?e.childNodes[n]:e.firstChild,r=null==s?null:e.childNodes[s];i!=r;i=i.nextSibling,++o)this.findAtPoint(e,o),this.addDOM(i,t);this.findAtPoint(e,o)}findPlace(e,t,n){let s,o;for(let i=this.open,r=0;i>=0;i--){let t=this.nodes[i],a=t.findWrapping(e);if(a&&(!s||s.length>a.length+r)&&(s=a,o=t,!a.length))break;if(t.solid){if(n)break;r+=2}}if(!s)return null;this.sync(o);for(let i=0;i<s.length;i++)t=this.enterInner(s[i],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let e=this.textblockFromContext();e&&(t=this.enterInner(e,null,t))}let s=this.findPlace(e,t,n);if(s){this.closeExtra();let t=this.top;t.match&&(t.match=t.match.matchType(e.type));let n=pd.none;for(let o of s.concat(e.marks))(t.type?t.type.allowsMarkType(o.type):lp(o.type,e.type))&&(n=o.addToSet(n));return t.content.push(e.mark(n)),!0}return!1}enter(e,t,n,s){let o=this.findPlace(e.create(t),n,!1);return o&&(o=this.enterInner(e,t,n,!0,s)),o}enterInner(e,t,n,s=!1,o){this.closeExtra();let i=this.top;i.match=i.match&&i.match.matchType(e);let r=sp(e,o,i.options);4&i.options&&0==i.content.length&&(r|=4);let a=pd.none;return n=n.filter(t=>!(i.type?i.type.allowsMarkType(t.type):lp(t.type,e))||(a=t.addToSet(a),!1)),this.nodes.push(new op(e,t,a,s,null,r)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!(!this.isOpen&&!this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=1)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let t=n.length-1;t>=0;t--)e+=n[t].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)null==this.find[t].pos&&1==e.nodeType&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let s=0;s<this.find.length;s++)if(null==this.find[s].pos&&1==e.nodeType&&e.contains(this.find[s].node)){t.compareDocumentPosition(this.find[s].node)&(n?2:4)&&(this.find[s].pos=this.currentPos)}}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,s=!(this.isOpen||n&&n.parent.type!=this.nodes[0].type),o=-(n?n.depth+1:0)+(s?0:1),i=(e,r)=>{for(;e>=0;e--){let a=t[e];if(""==a){if(e==t.length-1||0==e)continue;for(;r>=o;r--)if(i(e-1,r))return!0;return!1}{let e=r>0||0==r&&s?this.nodes[r].type:n&&r>=o?n.node(r-o).type:null;if(!e||e.name!=a&&!e.isInGroup(a))return!1;r--}}return!0};return i(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let e=this.parser.schema.nodes[t];if(e.isTextblock&&e.defaultAttrs)return e}}}function rp(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function ap(e){let t={};for(let n in e)t[n]=e[n];return t}function lp(e,t){let n=t.schema.nodes;for(let s in n){let o=n[s];if(!o.allowsMarkType(e))continue;let i=[],r=e=>{i.push(e);for(let n=0;n<e.edgeCount;n++){let{type:s,next:o}=e.edge(n);if(s==t)return!0;if(i.indexOf(o)<0&&r(o))return!0}};if(r(o.contentMatch))return!0}}class cp{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||(n=dp(t).createDocumentFragment());let s=n,o=[];return e.forEach(e=>{if(o.length||e.marks.length){let n=0,i=0;for(;n<o.length&&i<e.marks.length;){let t=e.marks[i];if(this.marks[t.type.name]){if(!t.eq(o[n][0])||!1===t.type.spec.spanning)break;n++,i++}else i++}for(;n<o.length;)s=o.pop()[1];for(;i<e.marks.length;){let n=e.marks[i++],r=this.serializeMark(n,e.isInline,t);r&&(o.push([n,s]),s.appendChild(r.dom),s=r.contentDOM||r.dom)}}s.appendChild(this.serializeNodeInner(e,t))}),n}serializeNodeInner(e,t){let{dom:n,contentDOM:s}=fp(dp(t),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,s)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let s=e.marks.length-1;s>=0;s--){let o=this.serializeMark(e.marks[s],e.isInline,t);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n}serializeMark(e,t,n={}){let s=this.marks[e.type.name];return s&&fp(dp(n),s(e,t),null,e.attrs)}static renderSpec(e,t,n=null,s){return fp(e,t,n,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new cp(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=up(e.nodes);return t.text||(t.text=e=>e.text),t}static marksFromSchema(e){return up(e.marks)}}function up(e){let t={};for(let n in e){let s=e[n].spec.toDOM;s&&(t[n]=s)}return t}function dp(e){return e.document||window.document}const pp=new WeakMap;function hp(e){let t=pp.get(e);return void 0===t&&pp.set(e,t=function(e){let t=null;function n(e){if(e&&"object"==typeof e)if(Array.isArray(e))if("string"==typeof e[0])t||(t=[]),t.push(e);else for(let t=0;t<e.length;t++)n(e[t]);else for(let t in e)n(e[t])}return n(e),t}(e)),t}function fp(e,t,n,s){if("string"==typeof t)return{dom:e.createTextNode(t)};if(null!=t.nodeType)return{dom:t};if(t.dom&&null!=t.dom.nodeType)return t;let o,i=t[0];if("string"!=typeof i)throw new RangeError("Invalid array passed to renderSpec");if(s&&(o=hp(s))&&o.indexOf(t)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let r,a=i.indexOf(" ");a>0&&(n=i.slice(0,a),i=i.slice(a+1));let l=n?e.createElementNS(n,i):e.createElement(i),c=t[1],u=1;if(c&&"object"==typeof c&&null==c.nodeType&&!Array.isArray(c)){u=2;for(let e in c)if(null!=c[e]){let t=e.indexOf(" ");t>0?l.setAttributeNS(e.slice(0,t),e.slice(t+1),c[e]):"style"==e&&l.style?l.style.cssText=c[e]:l.setAttribute(e,c[e])}}for(let d=u;d<t.length;d++){let o=t[d];if(0===o){if(d<t.length-1||d>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}{let{dom:t,contentDOM:i}=fp(e,o,n,s);if(l.appendChild(t),i){if(r)throw new RangeError("Multiple content holes");r=i}}}return{dom:l,contentDOM:r}}const mp=Math.pow(2,16);function gp(e,t){return e+t*mp}function yp(e){return 65535&e}class vp{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class bp{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&bp.empty)return bp.empty}recover(e){let t=0,n=yp(e);if(!this.inverted)for(let s=0;s<n;s++)t+=this.ranges[3*s+2]-this.ranges[3*s+1];return this.ranges[3*n]+t+function(e){return(e-(65535&e))/mp}(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let s=0,o=this.inverted?2:1,i=this.inverted?1:2;for(let r=0;r<this.ranges.length;r+=3){let a=this.ranges[r]-(this.inverted?s:0);if(a>e)break;let l=this.ranges[r+o],c=this.ranges[r+i],u=a+l;if(e<=u){let o=a+s+((l?e==a?-1:e==u?1:t:t)<0?0:c);if(n)return o;let i=e==(t<0?a:u)?null:gp(r/3,e-a),d=e==a?2:e==u?1:4;return(t<0?e!=a:e!=u)&&(d|=8),new vp(o,d,i)}s+=c-l}return n?e+s:new vp(e+s,0,null)}touches(e,t){let n=0,s=yp(t),o=this.inverted?2:1,i=this.inverted?1:2;for(let r=0;r<this.ranges.length;r+=3){let t=this.ranges[r]-(this.inverted?n:0);if(t>e)break;let a=this.ranges[r+o];if(e<=t+a&&r==3*s)return!0;n+=this.ranges[r+i]-a}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let s=0,o=0;s<this.ranges.length;s+=3){let i=this.ranges[s],r=i-(this.inverted?o:0),a=i+(this.inverted?0:o),l=this.ranges[s+t],c=this.ranges[s+n];e(r,r+l,a,a+c),o+=c-l}}invert(){return new bp(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return 0==e?bp.empty:new bp(e<0?[0,-e,0]:[0,0,e])}}bp.empty=new bp([]);class kp{constructor(e,t,n=0,s=(e?e.length:0)){this.mirror=t,this.from=n,this.to=s,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new kp(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),null!=t&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let s=e.getMirror(t);this.appendMap(e._maps[t],null!=s&&s<t?n+s:void 0)}}getMirror(e){if(this.mirror)for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let s=e.getMirror(t);this.appendMap(e._maps[t].invert(),null!=s&&s>t?n-s-1:void 0)}}invert(){let e=new kp;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let s=0;for(let o=this.from;o<this.to;o++){let n=this._maps[o].mapResult(e,t);if(null!=n.recover){let t=this.getMirror(o);if(null!=t&&t>o&&t<this.to){o=t,e=this._maps[t].recover(n.recover);continue}}s|=n.delInfo,e=n.pos}return n?e:new vp(e,s,null)}}const wp=Object.create(null);class Sp{getMap(){return bp.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=wp[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in wp)throw new RangeError("Duplicate use of step JSON ID "+e);return wp[e]=t,t.prototype.jsonID=e,t}}class Cp{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new Cp(e,null)}static fail(e){return new Cp(null,e)}static fromReplace(e,t,n,s){try{return Cp.ok(e.replace(t,n,s))}catch(o){if(o instanceof hd)return Cp.fail(o.message);throw o}}}function Tp(e,t,n){let s=[];for(let o=0;o<e.childCount;o++){let i=e.child(o);i.content.size&&(i=i.copy(Tp(i.content,t,i))),i.isInline&&(i=t(i,n,o)),s.push(i)}return ld.fromArray(s)}class Ep extends Sp{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),s=n.node(n.sharedDepth(this.to)),o=new fd(Tp(t.content,(e,t)=>e.isAtom&&t.type.allowsMarkType(this.mark.type)?e.mark(this.mark.addToSet(e.marks)):e,s),t.openStart,t.openEnd);return Cp.fromReplace(e,this.from,this.to,o)}invert(){return new Ip(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new Ep(t.pos,n.pos,this.mark)}merge(e){return e instanceof Ep&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ep(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Ep(t.from,t.to,e.markFromJSON(t.mark))}}Sp.jsonID("addMark",Ep);class Ip extends Sp{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new fd(Tp(t.content,e=>e.mark(this.mark.removeFromSet(e.marks)),e),t.openStart,t.openEnd);return Cp.fromReplace(e,this.from,this.to,n)}invert(){return new Ep(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new Ip(t.pos,n.pos,this.mark)}merge(e){return e instanceof Ip&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ip(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Ip(t.from,t.to,e.markFromJSON(t.mark))}}Sp.jsonID("removeMark",Ip);class xp extends Sp{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Cp.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return Cp.fromReplace(e,this.pos,this.pos+1,new fd(ld.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let e=this.mark.addToSet(t.marks);if(e.length==t.marks.length){for(let n=0;n<t.marks.length;n++)if(!t.marks[n].isInSet(e))return new xp(this.pos,t.marks[n]);return new xp(this.pos,this.mark)}}return new Ap(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new xp(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new xp(t.pos,e.markFromJSON(t.mark))}}Sp.jsonID("addNodeMark",xp);class Ap extends Sp{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return Cp.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return Cp.fromReplace(e,this.pos,this.pos+1,new fd(ld.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return t&&this.mark.isInSet(t.marks)?new xp(this.pos,this.mark):this}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Ap(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Ap(t.pos,e.markFromJSON(t.mark))}}Sp.jsonID("removeNodeMark",Ap);class Np extends Sp{constructor(e,t,n,s=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=s}apply(e){return this.structure&&Rp(e,this.from,this.to)?Cp.fail("Structure replace would overwrite content"):Cp.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new bp([this.from,this.to-this.from,this.slice.size])}invert(e){return new Np(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new Np(t.pos,Math.max(t.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof Np)||e.structure||this.structure)return null;if(this.from+this.slice.size!=e.from||this.slice.openEnd||e.slice.openStart){if(e.to!=this.from||this.slice.openStart||e.slice.openEnd)return null;{let t=this.slice.size+e.slice.size==0?fd.empty:new fd(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Np(e.from,this.to,t,this.structure)}}{let t=this.slice.size+e.slice.size==0?fd.empty:new fd(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Np(this.from,this.to+(e.to-e.from),t,this.structure)}}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Np(t.from,t.to,fd.fromJSON(e,t.slice),!!t.structure)}}Sp.jsonID("replace",Np);class Mp extends Sp{constructor(e,t,n,s,o,i,r=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=s,this.slice=o,this.insert=i,this.structure=r}apply(e){if(this.structure&&(Rp(e,this.from,this.gapFrom)||Rp(e,this.gapTo,this.to)))return Cp.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return Cp.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?Cp.fromReplace(e,this.from,this.to,n):Cp.fail("Content does not fit in gap")}getMap(){return new bp([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new Mp(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),s=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),o=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||s<t.pos||o>n.pos?null:new Mp(t.pos,n.pos,s,o,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to||"number"!=typeof t.gapFrom||"number"!=typeof t.gapTo||"number"!=typeof t.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Mp(t.from,t.to,t.gapFrom,t.gapTo,fd.fromJSON(e,t.slice),t.insert,!!t.structure)}}function Rp(e,t,n){let s=e.resolve(t),o=n-t,i=s.depth;for(;o>0&&i>0&&s.indexAfter(i)==s.node(i).childCount;)i--,o--;if(o>0){let e=s.node(i).maybeChild(s.indexAfter(i));for(;o>0;){if(!e||e.isLeaf)return!0;e=e.firstChild,o--}}return!1}function _p(e,t,n,s=n.contentMatch,o=!0){let i=e.doc.nodeAt(t),r=[],a=t+1;for(let l=0;l<i.childCount;l++){let t=i.child(l),c=a+t.nodeSize,u=s.matchType(t.type);if(u){s=u;for(let s=0;s<t.marks.length;s++)n.allowsMarkType(t.marks[s].type)||e.step(new Ip(a,c,t.marks[s]));if(o&&t.isText&&"pre"!=n.whitespace){let e,s,o=/\r?\n|\r/g;for(;e=o.exec(t.text);)s||(s=new fd(ld.from(n.schema.text(" ",n.allowedMarks(t.marks))),0,0)),r.push(new Np(a+e.index,a+e.index+e[0].length,s))}}else r.push(new Np(a,c,fd.empty));a=c}if(!s.validEnd){let t=s.fillBefore(ld.empty,!0);e.replace(a,a,new fd(t,0,0))}for(let l=r.length-1;l>=0;l--)e.step(r[l])}function Op(e,t,n){return(0==t||e.canReplace(t,e.childCount))&&(n==e.childCount||e.canReplace(0,n))}function Dp(e){let t=e.parent.content.cutByIndex(e.startIndex,e.endIndex);for(let n=e.depth,s=0,o=0;;--n){let i=e.$from.node(n),r=e.$from.index(n)+s,a=e.$to.indexAfter(n)-o;if(n<e.depth&&i.canReplace(r,a,t))return n;if(0==n||i.type.spec.isolating||!Op(i,r,a))break;r&&(s=1),a<i.childCount&&(o=1)}return null}function Bp(e,t,n=null,s=e){let o=function(e,t){let{parent:n,startIndex:s,endIndex:o}=e,i=n.contentMatchAt(s).findWrapping(t);if(!i)return null;let r=i.length?i[0]:t;return n.canReplaceWith(s,o,r)?i:null}(e,t),i=o&&function(e,t){let{parent:n,startIndex:s,endIndex:o}=e,i=n.child(s),r=t.contentMatch.findWrapping(i.type);if(!r)return null;let a=(r.length?r[r.length-1]:t).contentMatch;for(let l=s;a&&l<o;l++)a=a.matchType(n.child(l).type);return a&&a.validEnd?r:null}(s,t);return i?o.map(Lp).concat({type:t,attrs:n}).concat(i.map(Lp)):null}function Lp(e){return{type:e,attrs:null}}function Fp(e,t,n,s){t.forEach((o,i)=>{if(o.isText){let r,a=/\r?\n|\r/g;for(;r=a.exec(o.text);){let o=e.mapping.slice(s).map(n+1+i+r.index);e.replaceWith(o,o+1,t.type.schema.linebreakReplacement.create())}}})}function Pp(e,t,n,s){t.forEach((o,i)=>{if(o.type==o.type.schema.linebreakReplacement){let o=e.mapping.slice(s).map(n+1+i);e.replaceWith(o,o+1,t.type.schema.text("\n"))}})}function $p(e,t,n=1,s){let o=e.resolve(t),i=o.depth-n,r=s&&s[s.length-1]||o.parent;if(i<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!r.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(let c=o.depth-1,u=n-2;c>i;c--,u--){let e=o.node(c),t=o.index(c);if(e.type.spec.isolating)return!1;let n=e.content.cutByIndex(t,e.childCount),i=s&&s[u+1];i&&(n=n.replaceChild(0,i.type.create(i.attrs)));let r=s&&s[u]||e;if(!e.canReplace(t+1,e.childCount)||!r.type.validContent(n))return!1}let a=o.indexAfter(i),l=s&&s[0];return o.node(i).canReplaceWith(a,a,l?l.type:o.node(i+1).type)}function Up(e,t){let n=e.resolve(t),s=n.index();return Vp(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(s,s+1)}function Vp(e,t){return!(!e||!t||e.isLeaf||!function(e,t){t.content.size||e.type.compatibleContent(t.type);let n=e.contentMatchAt(e.childCount),{linebreakReplacement:s}=e.type.schema;for(let o=0;o<t.childCount;o++){let i=t.child(o),r=i.type==s?e.type.schema.nodes.text:i.type;if(n=n.matchType(r),!n)return!1;if(!e.type.allowsMarks(i.marks))return!1}return n.validEnd}(e,t))}function Wp(e,t,n=-1){let s=e.resolve(t);for(let o=s.depth;;o--){let e,i,r=s.index(o);if(o==s.depth?(e=s.nodeBefore,i=s.nodeAfter):n>0?(e=s.node(o+1),r++,i=s.node(o).maybeChild(r)):(e=s.node(o).maybeChild(r-1),i=s.node(o+1)),e&&!e.isTextblock&&Vp(e,i)&&s.node(o).canReplace(r,r+1))return t;if(0==o)break;t=n<0?s.before(o):s.after(o)}}function Gp(e,t,n){let s=e.resolve(t);if(!n.content.size)return t;let o=n.content;for(let i=0;i<n.openStart;i++)o=o.firstChild.content;for(let i=1;i<=(0==n.openStart&&n.size?2:1);i++)for(let e=s.depth;e>=0;e--){let t=e==s.depth?0:s.pos<=(s.start(e+1)+s.end(e+1))/2?-1:1,n=s.index(e)+(t>0?1:0),r=s.node(e),a=!1;if(1==i)a=r.canReplace(n,n,o);else{let e=r.contentMatchAt(n).findWrapping(o.firstChild.type);a=e&&r.canReplaceWith(n,n,e[0])}if(a)return 0==t?s.pos:t<0?s.before(e+1):s.after(e+1)}return null}function zp(e,t,n=t,s=fd.empty){if(t==n&&!s.size)return null;let o=e.resolve(t),i=e.resolve(n);return Hp(o,i,s)?new Np(t,n,s):new Kp(o,i,s).fit()}function Hp(e,t,n){return!n.openStart&&!n.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),n.content)}Sp.jsonID("replaceAround",Mp);class Kp{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=ld.empty;for(let s=0;s<=e.depth;s++){let t=e.node(s);this.frontier.push({type:t.type,match:t.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=ld.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,s=this.close(e<0?this.$to:n.doc.resolve(e));if(!s)return null;let o=this.placed,i=n.depth,r=s.depth;for(;i&&r&&1==o.childCount;)o=o.firstChild.content,i--,r--;let a=new fd(o,i,r);return e>-1?new Mp(n.pos,e,this.$to.pos,this.$to.end(),a,t):a.size||n.pos!=this.$to.pos?new Np(n.pos,s.pos,a):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,s=this.unplaced.openEnd;n<e;n++){let o=t.firstChild;if(t.childCount>1&&(s=0),o.type.spec.isolating&&s<=n){e=n;break}t=o.content}for(let t=1;t<=2;t++)for(let n=1==t?e:this.unplaced.openStart;n>=0;n--){let e,s=null;n?(s=Zp(this.unplaced.content,n-1).firstChild,e=s.content):e=this.unplaced.content;let o=e.firstChild;for(let i=this.depth;i>=0;i--){let e,{type:r,match:a}=this.frontier[i],l=null;if(1==t&&(o?a.matchType(o.type)||(l=a.fillBefore(ld.from(o),!1)):s&&r.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:i,parent:s,inject:l};if(2==t&&o&&(e=a.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:i,parent:s,wrap:e};if(s&&a.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,s=Zp(e,t);return!(!s.childCount||s.firstChild.isLeaf)&&(this.unplaced=new fd(e,t+1,Math.max(n,s.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,s=Zp(e,t);if(s.childCount<=1&&t>0){let o=e.size-t<=t+s.size;this.unplaced=new fd(jp(e,t-1,1),t-1,o?t-1:n)}else this.unplaced=new fd(jp(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:s,wrap:o}){for(;this.depth>t;)this.closeFrontierNode();if(o)for(let f=0;f<o.length;f++)this.openFrontierNode(o[f]);let i=this.unplaced,r=n?n.content:i.content,a=i.openStart-e,l=0,c=[],{match:u,type:d}=this.frontier[t];if(s){for(let e=0;e<s.childCount;e++)c.push(s.child(e));u=u.matchFragment(s)}let p=r.size+e-(i.content.size-i.openEnd);for(;l<r.childCount;){let e=r.child(l),t=u.matchType(e.type);if(!t)break;l++,(l>1||0==a||e.content.size)&&(u=t,c.push(Xp(e.mark(d.allowedMarks(e.marks)),1==l?a:0,l==r.childCount?p:-1)))}let h=l==r.childCount;h||(p=-1),this.placed=Yp(this.placed,t,ld.from(c)),this.frontier[t].match=u,h&&p<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let f=0,m=r;f<p;f++){let e=m.lastChild;this.frontier.push({type:e.type,match:e.contentMatchAt(e.childCount)}),m=e.content}this.unplaced=h?0==e?fd.empty:new fd(jp(i.content,e-1,1),e-1,p<0?i.openEnd:e-1):new fd(jp(i.content,e,l),i.openStart,i.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e,t=this.frontier[this.depth];if(!t.type.isTextblock||!Jp(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:n}=this.$to,s=this.$to.after(n);for(;n>1&&s==this.$to.end(--n);)++s;return s}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:s}=this.frontier[t],o=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),i=Jp(e,t,s,n,o);if(i){for(let n=t-1;n>=0;n--){let{match:t,type:s}=this.frontier[n],o=Jp(e,n,s,t,!0);if(!o||o.childCount)continue e}return{depth:t,fit:i,move:o?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Yp(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let t=e.node(n),s=t.type.contentMatch.fillBefore(t.content,!0,e.index(n));this.openFrontierNode(t.type,t.attrs,s)}return e}openFrontierNode(e,t=null,n){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=Yp(this.placed,this.depth,ld.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(ld.empty,!0);e.childCount&&(this.placed=Yp(this.placed,this.frontier.length,e))}}function jp(e,t,n){return 0==t?e.cutByIndex(n,e.childCount):e.replaceChild(0,e.firstChild.copy(jp(e.firstChild.content,t-1,n)))}function Yp(e,t,n){return 0==t?e.append(n):e.replaceChild(e.childCount-1,e.lastChild.copy(Yp(e.lastChild.content,t-1,n)))}function Zp(e,t){for(let n=0;n<t;n++)e=e.firstChild.content;return e}function Xp(e,t,n){if(t<=0)return e;let s=e.content;return t>1&&(s=s.replaceChild(0,Xp(s.firstChild,t-1,1==s.childCount?n-1:0))),t>0&&(s=e.type.contentMatch.fillBefore(s).append(s),n<=0&&(s=s.append(e.type.contentMatch.matchFragment(s).fillBefore(ld.empty,!0)))),e.copy(s)}function Jp(e,t,n,s,o){let i=e.node(t),r=o?e.indexAfter(t):e.index(t);if(r==i.childCount&&!n.compatibleContent(i.type))return null;let a=s.fillBefore(i.content,!0,r);return a&&!function(e,t,n){for(let s=n;s<t.childCount;s++)if(!e.allowsMarks(t.child(s).marks))return!0;return!1}(n,i.content,r)?a:null}function Qp(e){return e.spec.defining||e.spec.definingForContent}function qp(e,t,n,s,o){if(t<n){let o=e.firstChild;e=e.replaceChild(0,o.copy(qp(o.content,t+1,n,s,o)))}if(t>s){let t=o.contentMatchAt(0),n=t.fillBefore(e).append(e);e=n.append(t.matchFragment(n).fillBefore(ld.empty,!0))}return e}function eh(e,t){let n=[];for(let s=Math.min(e.depth,t.depth);s>=0;s--){let o=e.start(s);if(o<e.pos-(e.depth-s)||t.end(s)>t.pos+(t.depth-s)||e.node(s).type.spec.isolating||t.node(s).type.spec.isolating)break;(o==t.start(s)||s==e.depth&&s==t.depth&&e.parent.inlineContent&&t.parent.inlineContent&&s&&t.start(s-1)==o-1)&&n.push(s)}return n}class th extends Sp{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return Cp.fail("No node at attribute step's position");let n=Object.create(null);for(let o in t.attrs)n[o]=t.attrs[o];n[this.attr]=this.value;let s=t.type.create(n,null,t.marks);return Cp.fromReplace(e,this.pos,this.pos+1,new fd(ld.from(s),0,t.isLeaf?0:1))}getMap(){return bp.empty}invert(e){return new th(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new th(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if("number"!=typeof t.pos||"string"!=typeof t.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new th(t.pos,t.attr,t.value)}}Sp.jsonID("attr",th);class nh extends Sp{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let s in e.attrs)t[s]=e.attrs[s];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return Cp.ok(n)}getMap(){return bp.empty}invert(e){return new nh(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if("string"!=typeof t.attr)throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new nh(t.attr,t.value)}}Sp.jsonID("docAttr",nh);let sh=class extends Error{};sh=function e(t){let n=Error.call(this,t);return n.__proto__=e.prototype,n},(sh.prototype=Object.create(Error.prototype)).constructor=sh,sh.prototype.name="TransformError";class oh{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new kp}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new sh(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=fd.empty){let s=zp(this.doc,e,t,n);return s&&this.step(s),this}replaceWith(e,t,n){return this.replace(e,t,new fd(ld.from(n),0,0))}delete(e,t){return this.replace(e,t,fd.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return function(e,t,n,s){if(!s.size)return e.deleteRange(t,n);let o=e.doc.resolve(t),i=e.doc.resolve(n);if(Hp(o,i,s))return e.step(new Np(t,n,s));let r=eh(o,i);0==r[r.length-1]&&r.pop();let a=-(o.depth+1);r.unshift(a);for(let p=o.depth,h=o.pos-1;p>0;p--,h--){let e=o.node(p).type.spec;if(e.defining||e.definingAsContext||e.isolating)break;r.indexOf(p)>-1?a=p:o.before(p)==h&&r.splice(1,0,-p)}let l=r.indexOf(a),c=[],u=s.openStart;for(let p=s.content,h=0;;h++){let e=p.firstChild;if(c.push(e),h==s.openStart)break;p=e.content}for(let p=u-1;p>=0;p--){let e=c[p],t=Qp(e.type);if(t&&!e.sameMarkup(o.node(Math.abs(a)-1)))u=p;else if(t||!e.type.isTextblock)break}for(let p=s.openStart;p>=0;p--){let t=(p+u+1)%(s.openStart+1),a=c[t];if(a)for(let c=0;c<r.length;c++){let u=r[(c+l)%r.length],d=!0;u<0&&(d=!1,u=-u);let p=o.node(u-1),h=o.index(u-1);if(p.canReplaceWith(h,h,a.type,a.marks))return e.replace(o.before(u),d?i.after(u):n,new fd(qp(s.content,0,s.openStart,t),t,s.openEnd))}}let d=e.steps.length;for(let p=r.length-1;p>=0&&(e.replace(t,n,s),!(e.steps.length>d));p--){let e=r[p];e<0||(t=o.before(e),n=i.after(e))}}(this,e,t,n),this}replaceRangeWith(e,t,n){return function(e,t,n,s){if(!s.isInline&&t==n&&e.doc.resolve(t).parent.content.size){let o=function(e,t,n){let s=e.resolve(t);if(s.parent.canReplaceWith(s.index(),s.index(),n))return t;if(0==s.parentOffset)for(let o=s.depth-1;o>=0;o--){let e=s.index(o);if(s.node(o).canReplaceWith(e,e,n))return s.before(o+1);if(e>0)return null}if(s.parentOffset==s.parent.content.size)for(let o=s.depth-1;o>=0;o--){let e=s.indexAfter(o);if(s.node(o).canReplaceWith(e,e,n))return s.after(o+1);if(e<s.node(o).childCount)return null}return null}(e.doc,t,s.type);null!=o&&(t=n=o)}e.replaceRange(t,n,new fd(ld.from(s),0,0))}(this,e,t,n),this}deleteRange(e,t){return function(e,t,n){let s=e.doc.resolve(t),o=e.doc.resolve(n),i=eh(s,o);for(let r=0;r<i.length;r++){let t=i[r],n=r==i.length-1;if(n&&0==t||s.node(t).type.contentMatch.validEnd)return e.delete(s.start(t),o.end(t));if(t>0&&(n||s.node(t-1).canReplace(s.index(t-1),o.indexAfter(t-1))))return e.delete(s.before(t),o.after(t))}for(let r=1;r<=s.depth&&r<=o.depth;r++)if(t-s.start(r)==s.depth-r&&n>s.end(r)&&o.end(r)-n!=o.depth-r&&s.start(r-1)==o.start(r-1)&&s.node(r-1).canReplace(s.index(r-1),o.index(r-1)))return e.delete(s.before(r),n);e.delete(t,n)}(this,e,t),this}lift(e,t){return function(e,t,n){let{$from:s,$to:o,depth:i}=t,r=s.before(i+1),a=o.after(i+1),l=r,c=a,u=ld.empty,d=0;for(let f=i,m=!1;f>n;f--)m||s.index(f)>0?(m=!0,u=ld.from(s.node(f).copy(u)),d++):l--;let p=ld.empty,h=0;for(let f=i,m=!1;f>n;f--)m||o.after(f+1)<o.end(f)?(m=!0,p=ld.from(o.node(f).copy(p)),h++):c++;e.step(new Mp(l,c,r,a,new fd(u.append(p),d,h),u.size-d,!0))}(this,e,t),this}join(e,t=1){return function(e,t,n){let s=null,{linebreakReplacement:o}=e.doc.type.schema,i=e.doc.resolve(t-n),r=i.node().type;if(o&&r.inlineContent){let e="pre"==r.whitespace,t=!!r.contentMatch.matchType(o);e&&!t?s=!1:!e&&t&&(s=!0)}let a=e.steps.length;if(!1===s){let s=e.doc.resolve(t+n);Pp(e,s.node(),s.before(),a)}r.inlineContent&&_p(e,t+n-1,r,i.node().contentMatchAt(i.index()),null==s);let l=e.mapping.slice(a),c=l.map(t-n);if(e.step(new Np(c,l.map(t+n,-1),fd.empty,!0)),!0===s){let t=e.doc.resolve(c);Fp(e,t.node(),t.before(),e.steps.length)}}(this,e,t),this}wrap(e,t){return function(e,t,n){let s=ld.empty;for(let r=n.length-1;r>=0;r--){if(s.size){let e=n[r].type.contentMatch.matchFragment(s);if(!e||!e.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}s=ld.from(n[r].type.create(n[r].attrs,s))}let o=t.start,i=t.end;e.step(new Mp(o,i,o,i,new fd(s,0,0),n.length,!0))}(this,e,t),this}setBlockType(e,t=e,n,s=null){return function(e,t,n,s,o){if(!s.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=e.steps.length;e.doc.nodesBetween(t,n,(t,n)=>{let r="function"==typeof o?o(t):o;if(t.isTextblock&&!t.hasMarkup(s,r)&&function(e,t,n){let s=e.resolve(t),o=s.index();return s.parent.canReplaceWith(o,o+1,n)}(e.doc,e.mapping.slice(i).map(n),s)){let o=null;if(s.schema.linebreakReplacement){let e="pre"==s.whitespace,t=!!s.contentMatch.matchType(s.schema.linebreakReplacement);e&&!t?o=!1:!e&&t&&(o=!0)}!1===o&&Pp(e,t,n,i),_p(e,e.mapping.slice(i).map(n,1),s,void 0,null===o);let a=e.mapping.slice(i),l=a.map(n,1),c=a.map(n+t.nodeSize,1);return e.step(new Mp(l,c,l+1,c-1,new fd(ld.from(s.create(r,null,t.marks)),0,0),1,!0)),!0===o&&Fp(e,t,n,i),!1}})}(this,e,t,n,s),this}setNodeMarkup(e,t,n=null,s){return function(e,t,n,s,o){let i=e.doc.nodeAt(t);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let r=n.create(s,null,o||i.marks);if(i.isLeaf)return e.replaceWith(t,t+i.nodeSize,r);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);e.step(new Mp(t,t+i.nodeSize,t+1,t+i.nodeSize-1,new fd(ld.from(r),0,0),1,!0))}(this,e,t,n,s),this}setNodeAttribute(e,t,n){return this.step(new th(e,t,n)),this}setDocAttribute(e,t){return this.step(new nh(e,t)),this}addNodeMark(e,t){return this.step(new xp(e,t)),this}removeNodeMark(e,t){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t instanceof pd)t.isInSet(n.marks)&&this.step(new Ap(e,t));else{let s,o=n.marks,i=[];for(;s=t.isInSet(o);)i.push(new Ap(e,s)),o=s.removeFromSet(o);for(let e=i.length-1;e>=0;e--)this.step(i[e])}return this}split(e,t=1,n){return function(e,t,n=1,s){let o=e.doc.resolve(t),i=ld.empty,r=ld.empty;for(let a=o.depth,l=o.depth-n,c=n-1;a>l;a--,c--){i=ld.from(o.node(a).copy(i));let e=s&&s[c];r=ld.from(e?e.type.create(e.attrs,r):o.node(a).copy(r))}e.step(new Np(t,t,new fd(i.append(r),n,n),!0))}(this,e,t,n),this}addMark(e,t,n){return function(e,t,n,s){let o,i,r=[],a=[];e.doc.nodesBetween(t,n,(e,l,c)=>{if(!e.isInline)return;let u=e.marks;if(!s.isInSet(u)&&c.type.allowsMarkType(s.type)){let c=Math.max(l,t),d=Math.min(l+e.nodeSize,n),p=s.addToSet(u);for(let e=0;e<u.length;e++)u[e].isInSet(p)||(o&&o.to==c&&o.mark.eq(u[e])?o.to=d:r.push(o=new Ip(c,d,u[e])));i&&i.to==c?i.to=d:a.push(i=new Ep(c,d,s))}}),r.forEach(t=>e.step(t)),a.forEach(t=>e.step(t))}(this,e,t,n),this}removeMark(e,t,n){return function(e,t,n,s){let o=[],i=0;e.doc.nodesBetween(t,n,(e,r)=>{if(!e.isInline)return;i++;let a=null;if(s instanceof Xd){let t,n=e.marks;for(;t=s.isInSet(n);)(a||(a=[])).push(t),n=t.removeFromSet(n)}else s?s.isInSet(e.marks)&&(a=[s]):a=e.marks;if(a&&a.length){let s=Math.min(r+e.nodeSize,n);for(let e=0;e<a.length;e++){let n,l=a[e];for(let e=0;e<o.length;e++){let t=o[e];t.step==i-1&&l.eq(o[e].style)&&(n=t)}n?(n.to=s,n.step=i):o.push({style:l,from:Math.max(r,t),to:s,step:i})}}}),o.forEach(t=>e.step(new Ip(t.from,t.to,t.style)))}(this,e,t,n),this}clearIncompatible(e,t,n){return _p(this,e,t,n),this}}const ih=Object.create(null);class rh{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new ah(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=fd.empty){let n=t.content.lastChild,s=null;for(let r=0;r<t.openEnd;r++)s=n,n=n.lastChild;let o=e.steps.length,i=this.ranges;for(let r=0;r<i.length;r++){let{$from:a,$to:l}=i[r],c=e.mapping.slice(o);e.replaceRange(c.map(a.pos),c.map(l.pos),r?fd.empty:t),0==r&&yh(e,o,(n?n.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,s=this.ranges;for(let o=0;o<s.length;o++){let{$from:i,$to:r}=s[o],a=e.mapping.slice(n),l=a.map(i.pos),c=a.map(r.pos);o?e.deleteRange(l,c):(e.replaceRangeWith(l,c,t),yh(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let s=e.parent.inlineContent?new uh(e):gh(e.node(0),e.parent,e.pos,e.index(),t,n);if(s)return s;for(let o=e.depth-1;o>=0;o--){let s=t<0?gh(e.node(0),e.node(o),e.before(o+1),e.index(o),t,n):gh(e.node(0),e.node(o),e.after(o+1),e.index(o)+1,t,n);if(s)return s}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new fh(e.node(0))}static atStart(e){return gh(e,e,0,0,1)||new fh(e)}static atEnd(e){return gh(e,e,e.content.size,e.childCount,-1)||new fh(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=ih[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in ih)throw new RangeError("Duplicate use of selection JSON ID "+e);return ih[e]=t,t.prototype.jsonID=e,t}getBookmark(){return uh.between(this.$anchor,this.$head).getBookmark()}}rh.prototype.visible=!0;class ah{constructor(e,t){this.$from=e,this.$to=t}}let lh=!1;function ch(e){lh||e.parent.inlineContent||(lh=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+e.parent.type.name+")"))}class uh extends rh{constructor(e,t=e){ch(e),ch(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return rh.near(n);let s=e.resolve(t.map(this.anchor));return new uh(s.parent.inlineContent?s:n,n)}replace(e,t=fd.empty){if(super.replace(e,t),t==fd.empty){let t=this.$from.marksAcross(this.$to);t&&e.ensureMarks(t)}}eq(e){return e instanceof uh&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new dh(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if("number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new uh(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let s=e.resolve(t);return new this(s,n==t?s:e.resolve(n))}static between(e,t,n){let s=e.pos-t.pos;if(n&&!s||(n=s>=0?1:-1),!t.parent.inlineContent){let e=rh.findFrom(t,n,!0)||rh.findFrom(t,-n,!0);if(!e)return rh.near(t,n);t=e.$head}return e.parent.inlineContent||(0==s||(e=(rh.findFrom(e,-n,!0)||rh.findFrom(e,n,!0)).$anchor).pos<t.pos!=s<0)&&(e=t),new uh(e,t)}}rh.jsonID("text",uh);class dh{constructor(e,t){this.anchor=e,this.head=t}map(e){return new dh(e.map(this.anchor),e.map(this.head))}resolve(e){return uh.between(e.resolve(this.anchor),e.resolve(this.head))}}class ph extends rh{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:s}=t.mapResult(this.anchor),o=e.resolve(s);return n?rh.near(o):new ph(o)}content(){return new fd(ld.from(this.node),0,0)}eq(e){return e instanceof ph&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new hh(this.anchor)}static fromJSON(e,t){if("number"!=typeof t.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new ph(e.resolve(t.anchor))}static create(e,t){return new ph(e.resolve(t))}static isSelectable(e){return!e.isText&&!1!==e.type.spec.selectable}}ph.prototype.visible=!1,rh.jsonID("node",ph);class hh{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new dh(n,n):new hh(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&ph.isSelectable(n)?new ph(t):rh.near(t)}}class fh extends rh{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=fd.empty){if(t==fd.empty){e.delete(0,e.doc.content.size);let t=rh.atStart(e.doc);t.eq(e.selection)||e.setSelection(t)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new fh(e)}map(e){return new fh(e)}eq(e){return e instanceof fh}getBookmark(){return mh}}rh.jsonID("all",fh);const mh={map(){return this},resolve:e=>new fh(e)};function gh(e,t,n,s,o,i=!1){if(t.inlineContent)return uh.create(e,n);for(let r=s-(o>0?0:1);o>0?r<t.childCount:r>=0;r+=o){let s=t.child(r);if(s.isAtom){if(!i&&ph.isSelectable(s))return ph.create(e,n-(o<0?s.nodeSize:0))}else{let t=gh(e,s,n+o,o<0?s.childCount:0,o,i);if(t)return t}n+=s.nodeSize*o}return null}function yh(e,t,n){let s=e.steps.length-1;if(s<t)return;let o,i=e.steps[s];(i instanceof Np||i instanceof Mp)&&(e.mapping.maps[s].forEach((e,t,n,s)=>{null==o&&(o=s)}),e.setSelection(rh.near(e.doc.resolve(o),n)))}class vh extends oh{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=-3&this.updated|1,this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=2,this}ensureMarks(e){return pd.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(e,t){super.addStep(e,t),this.updated=-3&this.updated,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let n=this.selection;return t&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||pd.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,n){let s=this.doc.type.schema;if(null==t)return e?this.replaceSelectionWith(s.text(e),!0):this.deleteSelection();{if(null==n&&(n=t),!e)return this.deleteRange(t,n);let o=this.storedMarks;if(!o){let e=this.doc.resolve(t);o=n==t?e.marks():e.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(t,n,s.text(e,o)),this.selection.empty||this.selection.to!=t+e.length||this.setSelection(rh.near(this.selection.$to)),this}}setMeta(e,t){return this.meta["string"==typeof e?e:e.key]=t,this}getMeta(e){return this.meta["string"==typeof e?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function bh(e,t){return t&&e?e.bind(t):e}class kh{constructor(e,t,n){this.name=e,this.init=bh(t.init,n),this.apply=bh(t.apply,n)}}const wh=[new kh("doc",{init:e=>e.doc||e.schema.topNodeType.createAndFill(),apply:e=>e.doc}),new kh("selection",{init:(e,t)=>e.selection||rh.atStart(t.doc),apply:e=>e.selection}),new kh("storedMarks",{init:e=>e.storedMarks||null,apply:(e,t,n,s)=>s.selection.$cursor?e.storedMarks:null}),new kh("scrollToSelection",{init:()=>0,apply:(e,t)=>e.scrolledIntoView?t+1:t})];class Sh{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=wh.slice(),t&&t.forEach(e=>{if(this.pluginsByKey[e.key])throw new RangeError("Adding different instances of a keyed plugin ("+e.key+")");this.plugins.push(e),this.pluginsByKey[e.key]=e,e.spec.state&&this.fields.push(new kh(e.key,e.spec.state,e))})}}class Ch{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=t){let t=this.config.plugins[n];if(t.spec.filterTransaction&&!t.spec.filterTransaction.call(t,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],n=this.applyInner(e),s=null;for(;;){let o=!1;for(let i=0;i<this.config.plugins.length;i++){let r=this.config.plugins[i];if(r.spec.appendTransaction){let a=s?s[i].n:0,l=s?s[i].state:this,c=a<t.length&&r.spec.appendTransaction.call(r,a?t.slice(a):t,l,n);if(c&&n.filterTransaction(c,i)){if(c.setMeta("appendedTransaction",e),!s){s=[];for(let e=0;e<this.config.plugins.length;e++)s.push(e<i?{state:n,n:t.length}:{state:this,n:0})}t.push(c),n=n.applyInner(c),o=!0}s&&(s[i]={state:n,n:t.length})}}if(!o)return{state:n,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new Ch(this.config),n=this.config.fields;for(let s=0;s<n.length;s++){let o=n[s];t[o.name]=o.apply(e,this[o.name],this,t)}return t}get tr(){return new vh(this)}static create(e){let t=new Sh(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new Ch(t);for(let s=0;s<t.fields.length;s++)n[t.fields[s].name]=t.fields[s].init(e,n);return n}reconfigure(e){let t=new Sh(this.schema,e.plugins),n=t.fields,s=new Ch(t);for(let o=0;o<n.length;o++){let t=n[o].name;s[t]=this.hasOwnProperty(t)?this[t]:n[o].init(e,s)}return s}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(e=>e.toJSON())),e&&"object"==typeof e)for(let n in e){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=e[n],o=s.spec.state;o&&o.toJSON&&(t[n]=o.toJSON.call(s,this[s.key]))}return t}static fromJSON(e,t,n){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new Sh(e.schema,e.plugins),o=new Ch(s);return s.fields.forEach(s=>{if("doc"==s.name)o.doc=_d.fromJSON(e.schema,t.doc);else if("selection"==s.name)o.selection=rh.fromJSON(o.doc,t.selection);else if("storedMarks"==s.name)t.storedMarks&&(o.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let i in n){let r=n[i],a=r.spec.state;if(r.key==s.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(t,i))return void(o[s.name]=a.fromJSON.call(r,e,t[i],o))}o[s.name]=s.init(e,o)}}),o}}function Th(e,t,n){for(let s in e){let o=e[s];o instanceof Function?o=o.bind(t):"handleDOMEvents"==s&&(o=Th(o,t,{})),n[s]=o}return n}class Eh{constructor(e){this.spec=e,this.props={},e.props&&Th(e.props,this,this.props),this.key=e.key?e.key.key:xh("plugin")}getState(e){return e[this.key]}}const Ih=Object.create(null);function xh(e){return e in Ih?e+"$"+ ++Ih[e]:(Ih[e]=0,e+"$")}class Ah{constructor(e="key"){this.key=xh(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Nh=(e,t)=>!e.selection.empty&&(t&&t(e.tr.deleteSelection().scrollIntoView()),!0);function Mh(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("backward",e):n.parentOffset>0)?null:n}const Rh=(e,t,n)=>{let s=Mh(e,n);if(!s)return!1;let o=Bh(s);if(!o){let n=s.blockRange(),o=n&&Dp(n);return null!=o&&(t&&t(e.tr.lift(n,o).scrollIntoView()),!0)}let i=o.nodeBefore;if(Hh(e,o,t,-1))return!0;if(0==s.parent.content.size&&(Oh(i,"end")||ph.isSelectable(i)))for(let r=s.depth;;r--){let n=zp(e.doc,s.before(r),s.after(r),fd.empty);if(n&&n.slice.size<n.to-n.from){if(t){let s=e.tr.step(n);s.setSelection(Oh(i,"end")?rh.findFrom(s.doc.resolve(s.mapping.map(o.pos,-1)),-1):ph.create(s.doc,o.pos-i.nodeSize)),t(s.scrollIntoView())}return!0}if(1==r||s.node(r-1).childCount>1)break}return!(!i.isAtom||o.depth!=s.depth-1)&&(t&&t(e.tr.delete(o.pos-i.nodeSize,o.pos).scrollIntoView()),!0)};function _h(e,t,n){let s=t.nodeBefore,o=t.pos-1;for(;!s.isTextblock;o--){if(s.type.spec.isolating)return!1;let e=s.lastChild;if(!e)return!1;s=e}let i=t.nodeAfter,r=t.pos+1;for(;!i.isTextblock;r++){if(i.type.spec.isolating)return!1;let e=i.firstChild;if(!e)return!1;i=e}let a=zp(e.doc,o,r,fd.empty);if(!a||a.from!=o||a instanceof Np&&a.slice.size>=r-o)return!1;if(n){let t=e.tr.step(a);t.setSelection(uh.create(t.doc,o)),n(t.scrollIntoView())}return!0}function Oh(e,t,n=!1){for(let s=e;s;s="start"==t?s.firstChild:s.lastChild){if(s.isTextblock)return!0;if(n&&1!=s.childCount)return!1}return!1}const Dh=(e,t,n)=>{let{$head:s,empty:o}=e.selection,i=s;if(!o)return!1;if(s.parent.isTextblock){if(n?!n.endOfTextblock("backward",e):s.parentOffset>0)return!1;i=Bh(s)}let r=i&&i.nodeBefore;return!(!r||!ph.isSelectable(r))&&(t&&t(e.tr.setSelection(ph.create(e.doc,i.pos-r.nodeSize)).scrollIntoView()),!0)};function Bh(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}function Lh(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("forward",e):n.parentOffset<n.parent.content.size)?null:n}const Fh=(e,t,n)=>{let s=Lh(e,n);if(!s)return!1;let o=$h(s);if(!o)return!1;let i=o.nodeAfter;if(Hh(e,o,t,1))return!0;if(0==s.parent.content.size&&(Oh(i,"start")||ph.isSelectable(i))){let n=zp(e.doc,s.before(),s.after(),fd.empty);if(n&&n.slice.size<n.to-n.from){if(t){let s=e.tr.step(n);s.setSelection(Oh(i,"start")?rh.findFrom(s.doc.resolve(s.mapping.map(o.pos)),1):ph.create(s.doc,s.mapping.map(o.pos))),t(s.scrollIntoView())}return!0}}return!(!i.isAtom||o.depth!=s.depth-1)&&(t&&t(e.tr.delete(o.pos,o.pos+i.nodeSize).scrollIntoView()),!0)},Ph=(e,t,n)=>{let{$head:s,empty:o}=e.selection,i=s;if(!o)return!1;if(s.parent.isTextblock){if(n?!n.endOfTextblock("forward",e):s.parentOffset<s.parent.content.size)return!1;i=$h(s)}let r=i&&i.nodeAfter;return!(!r||!ph.isSelectable(r))&&(t&&t(e.tr.setSelection(ph.create(e.doc,i.pos)).scrollIntoView()),!0)};function $h(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}const Uh=(e,t)=>{let{$head:n,$anchor:s}=e.selection;return!(!n.parent.type.spec.code||!n.sameParent(s))&&(t&&t(e.tr.insertText("\n").scrollIntoView()),!0)};function Vh(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const Wh=(e,t)=>{let n=e.selection,{$from:s,$to:o}=n;if(n instanceof fh||s.parent.inlineContent||o.parent.inlineContent)return!1;let i=Vh(o.parent.contentMatchAt(o.indexAfter()));if(!i||!i.isTextblock)return!1;if(t){let n=(!s.parentOffset&&o.index()<o.parent.childCount?s:o).pos,r=e.tr.insert(n,i.createAndFill());r.setSelection(uh.create(r.doc,n+1)),t(r.scrollIntoView())}return!0},Gh=(e,t)=>{let{$cursor:n}=e.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let s=n.before();if($p(e.doc,s))return t&&t(e.tr.split(s).scrollIntoView()),!0}let s=n.blockRange(),o=s&&Dp(s);return null!=o&&(t&&t(e.tr.lift(s,o).scrollIntoView()),!0)};const zh=(e,t)=>{let{$from:n,$to:s}=e.selection;if(e.selection instanceof ph&&e.selection.node.isBlock)return!(!n.parentOffset||!$p(e.doc,n.pos)||(t&&t(e.tr.split(n.pos).scrollIntoView()),0));if(!n.depth)return!1;let o,i,r=[],a=!1,l=!1;for(let p=n.depth;;p--){if(n.node(p).isBlock){a=n.end(p)==n.pos+(n.depth-p),l=n.start(p)==n.pos-(n.depth-p),i=Vh(n.node(p-1).contentMatchAt(n.indexAfter(p-1))),r.unshift(a&&i?{type:i}:null),o=p;break}if(1==p)return!1;r.unshift(null)}let c=e.tr;(e.selection instanceof uh||e.selection instanceof fh)&&c.deleteSelection();let u=c.mapping.map(n.pos),d=$p(c.doc,u,r.length,r);if(d||(r[0]=i?{type:i}:null,d=$p(c.doc,u,r.length,r)),!d)return!1;if(c.split(u,r.length,r),!a&&l&&n.node(o).type!=i){let e=c.mapping.map(n.before(o)),t=c.doc.resolve(e);i&&n.node(o-1).canReplaceWith(t.index(),t.index()+1,i)&&c.setNodeMarkup(c.mapping.map(n.before(o)),i)}return t&&t(c.scrollIntoView()),!0};function Hh(e,t,n,s){let o,i,r=t.nodeBefore,a=t.nodeAfter,l=r.type.spec.isolating||a.type.spec.isolating;if(!l&&function(e,t,n){let s=t.nodeBefore,o=t.nodeAfter,i=t.index();return!(!(s&&o&&s.type.compatibleContent(o.type))||(!s.content.size&&t.parent.canReplace(i-1,i)?(n&&n(e.tr.delete(t.pos-s.nodeSize,t.pos).scrollIntoView()),0):!t.parent.canReplace(i,i+1)||!o.isTextblock&&!Up(e.doc,t.pos)||(n&&n(e.tr.join(t.pos).scrollIntoView()),0)))}(e,t,n))return!0;let c=!l&&t.parent.canReplace(t.index(),t.index()+1);if(c&&(o=(i=r.contentMatchAt(r.childCount)).findWrapping(a.type))&&i.matchType(o[0]||a.type).validEnd){if(n){let s=t.pos+a.nodeSize,i=ld.empty;for(let e=o.length-1;e>=0;e--)i=ld.from(o[e].create(null,i));i=ld.from(r.copy(i));let l=e.tr.step(new Mp(t.pos-1,s,t.pos,s,new fd(i,1,0),o.length,!0)),c=l.doc.resolve(s+2*o.length);c.nodeAfter&&c.nodeAfter.type==r.type&&Up(l.doc,c.pos)&&l.join(c.pos),n(l.scrollIntoView())}return!0}let u=a.type.spec.isolating||s>0&&l?null:rh.findFrom(t,1),d=u&&u.$from.blockRange(u.$to),p=d&&Dp(d);if(null!=p&&p>=t.depth)return n&&n(e.tr.lift(d,p).scrollIntoView()),!0;if(c&&Oh(a,"start",!0)&&Oh(r,"end")){let s=r,o=[];for(;o.push(s),!s.isTextblock;)s=s.lastChild;let i=a,l=1;for(;!i.isTextblock;i=i.firstChild)l++;if(s.canReplace(s.childCount,s.childCount,i.content)){if(n){let s=ld.empty;for(let e=o.length-1;e>=0;e--)s=ld.from(o[e].copy(s));n(e.tr.step(new Mp(t.pos-o.length,t.pos+a.nodeSize,t.pos+l,t.pos+a.nodeSize-l,new fd(s,o.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function Kh(e){return function(t,n){let s=t.selection,o=e<0?s.$from:s.$to,i=o.depth;for(;o.node(i).isInline;){if(!i)return!1;i--}return!!o.node(i).isTextblock&&(n&&n(t.tr.setSelection(uh.create(t.doc,e<0?o.start(i):o.end(i)))),!0)}}const jh=Kh(-1),Yh=Kh(1);function Zh(e,t=null){return function(n,s){let o=!1;for(let i=0;i<n.selection.ranges.length&&!o;i++){let{$from:{pos:s},$to:{pos:r}}=n.selection.ranges[i];n.doc.nodesBetween(s,r,(s,i)=>{if(o)return!1;if(s.isTextblock&&!s.hasMarkup(e,t))if(s.type==e)o=!0;else{let t=n.doc.resolve(i),s=t.index();o=t.parent.canReplaceWith(s,s+1,e)}})}if(!o)return!1;if(s){let o=n.tr;for(let s=0;s<n.selection.ranges.length;s++){let{$from:{pos:i},$to:{pos:r}}=n.selection.ranges[s];o.setBlockType(i,r,e,t)}s(o.scrollIntoView())}return!0}}function Xh(...e){return function(t,n,s){for(let o=0;o<e.length;o++)if(e[o](t,n,s))return!0;return!1}}function Jh(e,t=null){return function(n,s){let{$from:o,$to:i}=n.selection,r=o.blockRange(i);if(!r)return!1;let a=s?n.tr:null;return!!function(e,t,n,s=null){let o=!1,i=t,r=t.$from.doc;if(t.depth>=2&&t.$from.node(t.depth-1).type.compatibleContent(n)&&0==t.startIndex){if(0==t.$from.index(t.depth-1))return!1;let e=r.resolve(t.start-2);i=new Md(e,e,t.depth),t.endIndex<t.parent.childCount&&(t=new Md(t.$from,r.resolve(t.$to.end(t.depth)),t.depth)),o=!0}let a=Bp(i,n,s,t);if(!a)return!1;e&&function(e,t,n,s,o){let i=ld.empty;for(let u=n.length-1;u>=0;u--)i=ld.from(n[u].type.create(n[u].attrs,i));e.step(new Mp(t.start-(s?2:0),t.end,t.start,t.end,new fd(i,0,0),n.length,!0));let r=0;for(let u=0;u<n.length;u++)n[u].type==o&&(r=u+1);let a=n.length-r,l=t.start+n.length-(s?2:0),c=t.parent;for(let u=t.startIndex,d=t.endIndex,p=!0;u<d;u++,p=!1)!p&&$p(e.doc,l,a)&&(e.split(l,a),l+=2*a),l+=c.child(u).nodeSize}(e,t,a,o,n);return!0}(a,r,e,t)&&(s&&s(a.scrollIntoView()),!0)}}function Qh(e){return function(t,n){let{$from:s,$to:o}=t.selection,i=s.blockRange(o,t=>t.childCount>0&&t.firstChild.type==e);return!!i&&(!n||(s.node(i.depth-1).type==e?function(e,t,n,s){let o=e.tr,i=s.end,r=s.$to.end(s.depth);i<r&&(o.step(new Mp(i-1,r,i,r,new fd(ld.from(n.create(null,s.parent.copy())),1,0),1,!0)),s=new Md(o.doc.resolve(s.$from.pos),o.doc.resolve(r),s.depth));const a=Dp(s);if(null==a)return!1;o.lift(s,a);let l=o.doc.resolve(o.mapping.map(i,-1)-1);Up(o.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&o.join(l.pos);return t(o.scrollIntoView()),!0}(t,n,e,i):function(e,t,n){let s=e.tr,o=n.parent;for(let h=n.end,f=n.endIndex-1,m=n.startIndex;f>m;f--)h-=o.child(f).nodeSize,s.delete(h-1,h+1);let i=s.doc.resolve(n.start),r=i.nodeAfter;if(s.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let a=0==n.startIndex,l=n.endIndex==o.childCount,c=i.node(-1),u=i.index(-1);if(!c.canReplace(u+(a?0:1),u+1,r.content.append(l?ld.empty:ld.from(o))))return!1;let d=i.pos,p=d+r.nodeSize;return s.step(new Mp(d-(a?1:0),p+(l?1:0),d+1,p-1,new fd((a?ld.empty:ld.from(o.copy(ld.empty))).append(l?ld.empty:ld.from(o.copy(ld.empty))),a?0:1,l?0:1),a?0:1)),t(s.scrollIntoView()),!0}(t,n,i)))}}Xh(Nh,Rh,Dh),Xh(Nh,Fh,Ph),Xh(Uh,Wh,Gh,zh),"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"undefined"!=typeof os&&os.platform&&os.platform();const qh=function(e){for(var t=0;;t++)if(!(e=e.previousSibling))return t},ef=function(e){let t=e.assignedSlot||e.parentNode;return t&&11==t.nodeType?t.host:t};let tf=null;const nf=function(e,t,n){let s=tf||(tf=document.createRange());return s.setEnd(e,null==n?e.nodeValue.length:n),s.setStart(e,t||0),s},sf=function(e,t,n,s){return n&&(rf(e,t,n,s,-1)||rf(e,t,n,s,1))},of=/^(img|br|input|textarea|hr)$/i;function rf(e,t,n,s,o){for(var i;;){if(e==n&&t==s)return!0;if(t==(o<0?0:af(e))){let n=e.parentNode;if(!n||1!=n.nodeType||lf(e)||of.test(e.nodeName)||"false"==e.contentEditable)return!1;t=qh(e)+(o<0?0:1),e=n}else{if(1!=e.nodeType)return!1;{let n=e.childNodes[t+(o<0?-1:0)];if(1==n.nodeType&&"false"==n.contentEditable){if(!(null===(i=n.pmViewDesc)||void 0===i?void 0:i.ignoreForSelection))return!1;t+=o}else e=n,t=o<0?af(e):0}}}}function af(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function lf(e){let t;for(let n=e;n&&!(t=n.pmViewDesc);n=n.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==e||t.contentDOM==e)}const cf=function(e){return e.focusNode&&sf(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)};function uf(e,t){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=e,n.key=n.code=t,n}const df="undefined"!=typeof navigator?navigator:null,pf="undefined"!=typeof document?document:null,hf=df&&df.userAgent||"",ff=/Edge\/(\d+)/.exec(hf),mf=/MSIE \d/.exec(hf),gf=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(hf),yf=!!(mf||gf||ff),vf=mf?document.documentMode:gf?+gf[1]:ff?+ff[1]:0,bf=!yf&&/gecko\/(\d+)/i.test(hf);bf&&(/Firefox\/(\d+)/.exec(hf)||[0,0])[1];const kf=!yf&&/Chrome\/(\d+)/.exec(hf),wf=!!kf,Sf=kf?+kf[1]:0,Cf=!yf&&!!df&&/Apple Computer/.test(df.vendor),Tf=Cf&&(/Mobile\/\w+/.test(hf)||!!df&&df.maxTouchPoints>2),Ef=Tf||!!df&&/Mac/.test(df.platform),If=!!df&&/Win/.test(df.platform),xf=/Android \d/.test(hf),Af=!!pf&&"webkitFontSmoothing"in pf.documentElement.style,Nf=Af?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Mf(e){let t=e.defaultView&&e.defaultView.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}function Rf(e,t){return"number"==typeof e?e:e[t]}function _f(e){let t=e.getBoundingClientRect(),n=t.width/e.offsetWidth||1,s=t.height/e.offsetHeight||1;return{left:t.left,right:t.left+e.clientWidth*n,top:t.top,bottom:t.top+e.clientHeight*s}}function Of(e,t,n){let s=e.someProp("scrollThreshold")||0,o=e.someProp("scrollMargin")||5,i=e.dom.ownerDocument;for(let r=n||e.dom;r;){if(1!=r.nodeType){r=ef(r);continue}let e=r,n=e==i.body,a=n?Mf(i):_f(e),l=0,c=0;if(t.top<a.top+Rf(s,"top")?c=-(a.top-t.top+Rf(o,"top")):t.bottom>a.bottom-Rf(s,"bottom")&&(c=t.bottom-t.top>a.bottom-a.top?t.top+Rf(o,"top")-a.top:t.bottom-a.bottom+Rf(o,"bottom")),t.left<a.left+Rf(s,"left")?l=-(a.left-t.left+Rf(o,"left")):t.right>a.right-Rf(s,"right")&&(l=t.right-a.right+Rf(o,"right")),l||c)if(n)i.defaultView.scrollBy(l,c);else{let n=e.scrollLeft,s=e.scrollTop;c&&(e.scrollTop+=c),l&&(e.scrollLeft+=l);let o=e.scrollLeft-n,i=e.scrollTop-s;t={left:t.left-o,top:t.top-i,right:t.right-o,bottom:t.bottom-i}}let u=n?"fixed":getComputedStyle(r).position;if(/^(fixed|sticky)$/.test(u))break;r="absolute"==u?r.offsetParent:ef(r)}}function Df(e){let t=[],n=e.ownerDocument;for(let s=e;s&&(t.push({dom:s,top:s.scrollTop,left:s.scrollLeft}),e!=n);s=ef(s));return t}function Bf(e,t){for(let n=0;n<e.length;n++){let{dom:s,top:o,left:i}=e[n];s.scrollTop!=o+t&&(s.scrollTop=o+t),s.scrollLeft!=i&&(s.scrollLeft=i)}}let Lf=null;function Ff(e,t){let n,s,o,i,r=2e8,a=0,l=t.top,c=t.top;for(let u=e.firstChild,d=0;u;u=u.nextSibling,d++){let e;if(1==u.nodeType)e=u.getClientRects();else{if(3!=u.nodeType)continue;e=nf(u).getClientRects()}for(let p=0;p<e.length;p++){let h=e[p];if(h.top<=l&&h.bottom>=c){l=Math.max(h.bottom,l),c=Math.min(h.top,c);let e=h.left>t.left?h.left-t.left:h.right<t.left?t.left-h.right:0;if(e<r){n=u,r=e,s=e&&3==n.nodeType?{left:h.right<t.left?h.right:h.left,top:t.top}:t,1==u.nodeType&&e&&(a=d+(t.left>=(h.left+h.right)/2?1:0));continue}}else h.top>t.top&&!o&&h.left<=t.left&&h.right>=t.left&&(o=u,i={left:Math.max(h.left,Math.min(h.right,t.left)),top:h.top});!n&&(t.left>=h.right&&t.top>=h.top||t.left>=h.left&&t.top>=h.bottom)&&(a=d+1)}}return!n&&o&&(n=o,s=i,r=0),n&&3==n.nodeType?function(e,t){let n,s=e.nodeValue.length,o=document.createRange();for(let i=0;i<s;i++){o.setEnd(e,i+1),o.setStart(e,i);let s=Wf(o,1);if(s.top!=s.bottom&&Pf(t,s)){n={node:e,offset:i+(t.left>=(s.left+s.right)/2?1:0)};break}}return o.detach(),n||{node:e,offset:0}}(n,s):!n||r&&1==n.nodeType?{node:e,offset:a}:Ff(n,s)}function Pf(e,t){return e.left>=t.left-1&&e.left<=t.right+1&&e.top>=t.top-1&&e.top<=t.bottom+1}function $f(e,t,n){let s=e.childNodes.length;if(s&&n.top<n.bottom)for(let o=Math.max(0,Math.min(s-1,Math.floor(s*(t.top-n.top)/(n.bottom-n.top))-2)),i=o;;){let n=e.childNodes[i];if(1==n.nodeType){let e=n.getClientRects();for(let s=0;s<e.length;s++){let o=e[s];if(Pf(t,o))return $f(n,t,o)}}if((i=(i+1)%s)==o)break}return e}function Uf(e,t){let n,s=e.dom.ownerDocument,o=0,i=function(e,t,n){if(e.caretPositionFromPoint)try{let s=e.caretPositionFromPoint(t,n);if(s)return{node:s.offsetNode,offset:Math.min(af(s.offsetNode),s.offset)}}catch(s){}if(e.caretRangeFromPoint){let s=e.caretRangeFromPoint(t,n);if(s)return{node:s.startContainer,offset:Math.min(af(s.startContainer),s.startOffset)}}}(s,t.left,t.top);i&&({node:n,offset:o}=i);let r,a=(e.root.elementFromPoint?e.root:s).elementFromPoint(t.left,t.top);if(!a||!e.dom.contains(1!=a.nodeType?a.parentNode:a)){let n=e.dom.getBoundingClientRect();if(!Pf(t,n))return null;if(a=$f(e.dom,t,n),!a)return null}if(Cf)for(let c=a;n&&c;c=ef(c))c.draggable&&(n=void 0);if(a=function(e,t){let n=e.parentNode;return n&&/^li$/i.test(n.nodeName)&&t.left<e.getBoundingClientRect().left?n:e}(a,t),n){if(bf&&1==n.nodeType&&(o=Math.min(o,n.childNodes.length),o<n.childNodes.length)){let e,s=n.childNodes[o];"IMG"==s.nodeName&&(e=s.getBoundingClientRect()).right<=t.left&&e.bottom>t.top&&o++}let s;Af&&o&&1==n.nodeType&&1==(s=n.childNodes[o-1]).nodeType&&"false"==s.contentEditable&&s.getBoundingClientRect().top>=t.top&&o--,n==e.dom&&o==n.childNodes.length-1&&1==n.lastChild.nodeType&&t.top>n.lastChild.getBoundingClientRect().bottom?r=e.state.doc.content.size:0!=o&&1==n.nodeType&&"BR"==n.childNodes[o-1].nodeName||(r=function(e,t,n,s){let o=-1;for(let i=t,r=!1;i!=e.dom;){let t,n=e.docView.nearestDesc(i,!0);if(!n)return null;if(1==n.dom.nodeType&&(n.node.isBlock&&n.parent||!n.contentDOM)&&((t=n.dom.getBoundingClientRect()).width||t.height)&&(n.node.isBlock&&n.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(n.dom.nodeName)&&(!r&&t.left>s.left||t.top>s.top?o=n.posBefore:(!r&&t.right<s.left||t.bottom<s.top)&&(o=n.posAfter),r=!0),!n.contentDOM&&o<0&&!n.node.isText))return(n.node.isBlock?s.top<(t.top+t.bottom)/2:s.left<(t.left+t.right)/2)?n.posBefore:n.posAfter;i=n.dom.parentNode}return o>-1?o:e.docView.posFromDOM(t,n,-1)}(e,n,o,t))}null==r&&(r=function(e,t,n){let{node:s,offset:o}=Ff(t,n),i=-1;if(1==s.nodeType&&!s.firstChild){let e=s.getBoundingClientRect();i=e.left!=e.right&&n.left>(e.left+e.right)/2?1:-1}return e.docView.posFromDOM(s,o,i)}(e,a,t));let l=e.docView.nearestDesc(a,!0);return{pos:r,inside:l?l.posAtStart-l.border:-1}}function Vf(e){return e.top<e.bottom||e.left<e.right}function Wf(e,t){let n=e.getClientRects();if(n.length){let e=n[t<0?0:n.length-1];if(Vf(e))return e}return Array.prototype.find.call(n,Vf)||e.getBoundingClientRect()}const Gf=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function zf(e,t,n){let{node:s,offset:o,atom:i}=e.docView.domFromPos(t,n<0?-1:1),r=Af||bf;if(3==s.nodeType){if(!r||!Gf.test(s.nodeValue)&&(n<0?o:o!=s.nodeValue.length)){let e=o,t=o,i=n<0?1:-1;return n<0&&!o?(t++,i=-1):n>=0&&o==s.nodeValue.length?(e--,i=1):n<0?e--:t++,Hf(Wf(nf(s,e,t),i),i<0)}{let e=Wf(nf(s,o,o),n);if(bf&&o&&/\s/.test(s.nodeValue[o-1])&&o<s.nodeValue.length){let t=Wf(nf(s,o-1,o-1),-1);if(t.top==e.top){let n=Wf(nf(s,o,o+1),-1);if(n.top!=e.top)return Hf(n,n.left<t.left)}}return e}}if(!e.state.doc.resolve(t-(i||0)).parent.inlineContent){if(null==i&&o&&(n<0||o==af(s))){let e=s.childNodes[o-1];if(1==e.nodeType)return Kf(e.getBoundingClientRect(),!1)}if(null==i&&o<af(s)){let e=s.childNodes[o];if(1==e.nodeType)return Kf(e.getBoundingClientRect(),!0)}return Kf(s.getBoundingClientRect(),n>=0)}if(null==i&&o&&(n<0||o==af(s))){let e=s.childNodes[o-1],t=3==e.nodeType?nf(e,af(e)-(r?0:1)):1!=e.nodeType||"BR"==e.nodeName&&e.nextSibling?null:e;if(t)return Hf(Wf(t,1),!1)}if(null==i&&o<af(s)){let e=s.childNodes[o];for(;e.pmViewDesc&&e.pmViewDesc.ignoreForCoords;)e=e.nextSibling;let t=e?3==e.nodeType?nf(e,0,r?0:1):1==e.nodeType?e:null:null;if(t)return Hf(Wf(t,-1),!0)}return Hf(Wf(3==s.nodeType?nf(s):s,-n),n>=0)}function Hf(e,t){if(0==e.width)return e;let n=t?e.left:e.right;return{top:e.top,bottom:e.bottom,left:n,right:n}}function Kf(e,t){if(0==e.height)return e;let n=t?e.top:e.bottom;return{top:n,bottom:n,left:e.left,right:e.right}}function jf(e,t,n){let s=e.state,o=e.root.activeElement;s!=t&&e.updateState(t),o!=e.dom&&e.focus();try{return n()}finally{s!=t&&e.updateState(s),o!=e.dom&&o&&o.focus()}}const Yf=/[\u0590-\u08ac]/;let Zf=null,Xf=null,Jf=!1;function Qf(e,t,n){return Zf==t&&Xf==n?Jf:(Zf=t,Xf=n,Jf="up"==n||"down"==n?function(e,t,n){let s=t.selection,o="up"==n?s.$from:s.$to;return jf(e,t,()=>{let{node:t}=e.docView.domFromPos(o.pos,"up"==n?-1:1);for(;;){let n=e.docView.nearestDesc(t,!0);if(!n)break;if(n.node.isBlock){t=n.contentDOM||n.dom;break}t=n.dom.parentNode}let s=zf(e,o.pos,1);for(let e=t.firstChild;e;e=e.nextSibling){let t;if(1==e.nodeType)t=e.getClientRects();else{if(3!=e.nodeType)continue;t=nf(e,0,e.nodeValue.length).getClientRects()}for(let e=0;e<t.length;e++){let o=t[e];if(o.bottom>o.top+1&&("up"==n?s.top-o.top>2*(o.bottom-s.top):o.bottom-s.bottom>2*(s.bottom-o.top)))return!1}}return!0})}(e,t,n):function(e,t,n){let{$head:s}=t.selection;if(!s.parent.isTextblock)return!1;let o=s.parentOffset,i=!o,r=o==s.parent.content.size,a=e.domSelection();return a?Yf.test(s.parent.textContent)&&a.modify?jf(e,t,()=>{let{focusNode:t,focusOffset:o,anchorNode:i,anchorOffset:r}=e.domSelectionRange(),l=a.caretBidiLevel;a.modify("move",n,"character");let c=s.depth?e.docView.domAfterPos(s.before()):e.dom,{focusNode:u,focusOffset:d}=e.domSelectionRange(),p=u&&!c.contains(1==u.nodeType?u:u.parentNode)||t==u&&o==d;try{a.collapse(i,r),t&&(t!=i||o!=r)&&a.extend&&a.extend(t,o)}catch(h){}return null!=l&&(a.caretBidiLevel=l),p}):"left"==n||"backward"==n?i:r:s.pos==s.start()||s.pos==s.end()}(e,t,n))}class qf{constructor(e,t,n,s){this.parent=e,this.children=t,this.dom=n,this.contentDOM=s,this.dirty=0,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,n=this.posAtStart;;t++){let s=this.children[t];if(s==e)return n;n+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,n){if(this.contentDOM&&this.contentDOM.contains(1==e.nodeType?e:e.parentNode)){if(n<0){let n,s;if(e==this.contentDOM)n=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;n=e.previousSibling}for(;n&&(!(s=n.pmViewDesc)||s.parent!=this);)n=n.previousSibling;return n?this.posBeforeChild(s)+s.size:this.posAtStart}{let n,s;if(e==this.contentDOM)n=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;n=e.nextSibling}for(;n&&(!(s=n.pmViewDesc)||s.parent!=this);)n=n.nextSibling;return n?this.posBeforeChild(s):this.posAtEnd}}let s;if(e==this.dom&&this.contentDOM)s=t>qh(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=2&e.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==t)for(let t=e;;t=t.parentNode){if(t==this.dom){s=!1;break}if(t.previousSibling)break}if(null==s&&t==e.childNodes.length)for(let t=e;;t=t.parentNode){if(t==this.dom){s=!0;break}if(t.nextSibling)break}}return(null==s?n>0:s)?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let n=!0,s=e;s;s=s.parentNode){let o,i=this.getDesc(s);if(i&&(!t||i.node)){if(!n||!(o=i.nodeDOM)||(1==o.nodeType?o.contains(1==e.nodeType?e:e.parentNode):o==e))return i;n=!1}}}getDesc(e){let t=e.pmViewDesc;for(let n=t;n;n=n.parent)if(n==this)return t}posFromDOM(e,t,n){for(let s=e;s;s=s.parentNode){let o=this.getDesc(s);if(o)return o.localPosFromDOM(e,t,n)}return-1}descAt(e){for(let t=0,n=0;t<this.children.length;t++){let s=this.children[t],o=n+s.size;if(n==e&&o!=n){for(;!s.border&&s.children.length;)for(let e=0;e<s.children.length;e++){let t=s.children[e];if(t.size){s=t;break}}return s}if(e<o)return s.descAt(e-n-s.border);n=o}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,s=0;for(let o=0;n<this.children.length;n++){let t=this.children[n],i=o+t.size;if(i>e||t instanceof rm){s=e-o;break}o=i}if(s)return this.children[n].domFromPos(s-this.children[n].border,t);for(let o;n&&!(o=this.children[n-1]).size&&o instanceof em&&o.side>=0;n--);if(t<=0){let e,s=!0;for(;e=n?this.children[n-1]:null,e&&e.dom.parentNode!=this.contentDOM;n--,s=!1);return e&&t&&s&&!e.border&&!e.domAtom?e.domFromPos(e.size,t):{node:this.contentDOM,offset:e?qh(e.dom)+1:0}}{let e,s=!0;for(;e=n<this.children.length?this.children[n]:null,e&&e.dom.parentNode!=this.contentDOM;n++,s=!1);return e&&s&&!e.border&&!e.domAtom?e.domFromPos(0,t):{node:this.contentDOM,offset:e?qh(e.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,n=0){if(0==this.children.length)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,o=-1;for(let i=n,r=0;;r++){let n=this.children[r],a=i+n.size;if(-1==s&&e<=a){let o=i+n.border;if(e>=o&&t<=a-n.border&&n.node&&n.contentDOM&&this.contentDOM.contains(n.contentDOM))return n.parseRange(e,t,o);e=i;for(let t=r;t>0;t--){let n=this.children[t-1];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(1)){s=qh(n.dom)+1;break}e-=n.size}-1==s&&(s=0)}if(s>-1&&(a>t||r==this.children.length-1)){t=a;for(let e=r+1;e<this.children.length;e++){let n=this.children[e];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(-1)){o=qh(n.dom);break}t+=n.size}-1==o&&(o=this.contentDOM.childNodes.length);break}i=a}return{node:this.contentDOM,from:e,to:t,fromOffset:s,toOffset:o}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return 0==t.size||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:n}=this.domFromPos(e,0);if(1!=t.nodeType||n==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[n]}setSelection(e,t,n,s=!1){let o=Math.min(e,t),i=Math.max(e,t);for(let h=0,f=0;h<this.children.length;h++){let r=this.children[h],a=f+r.size;if(o>f&&i<a)return r.setSelection(e-f-r.border,t-f-r.border,n,s);f=a}let r=this.domFromPos(e,e?-1:1),a=t==e?r:this.domFromPos(t,t?-1:1),l=n.root.getSelection(),c=n.domSelectionRange(),u=!1;if((bf||Cf)&&e==t){let{node:e,offset:t}=r;if(3==e.nodeType){if(u=!(!t||"\n"!=e.nodeValue[t-1]),u&&t==e.nodeValue.length)for(let n,s=e;s;s=s.parentNode){if(n=s.nextSibling){"BR"==n.nodeName&&(r=a={node:n.parentNode,offset:qh(n)+1});break}let e=s.pmViewDesc;if(e&&e.node&&e.node.isBlock)break}}else{let n=e.childNodes[t-1];u=n&&("BR"==n.nodeName||"false"==n.contentEditable)}}if(bf&&c.focusNode&&c.focusNode!=a.node&&1==c.focusNode.nodeType){let e=c.focusNode.childNodes[c.focusOffset];e&&"false"==e.contentEditable&&(s=!0)}if(!(s||u&&Cf)&&sf(r.node,r.offset,c.anchorNode,c.anchorOffset)&&sf(a.node,a.offset,c.focusNode,c.focusOffset))return;let d=!1;if((l.extend||e==t)&&(!u||!bf)){l.collapse(r.node,r.offset);try{e!=t&&l.extend(a.node,a.offset),d=!0}catch(p){}}if(!d){if(e>t){let e=r;r=a,a=e}let n=document.createRange();n.setEnd(a.node,a.offset),n.setStart(r.node,r.offset),l.removeAllRanges(),l.addRange(n)}}ignoreMutation(e){return!this.contentDOM&&"selection"!=e.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let n=0,s=0;s<this.children.length;s++){let o=this.children[s],i=n+o.size;if(n==i?e<=i&&t>=n:e<i&&t>n){let s=n+o.border,r=i-o.border;if(e>=s&&t<=r)return this.dirty=e==n||t==i?2:1,void(e!=s||t!=r||!o.contentLost&&o.dom.parentNode==this.contentDOM?o.markDirty(e-s,t-s):o.dirty=3);o.dirty=o.dom!=o.contentDOM||o.dom.parentNode!=this.contentDOM||o.children.length?3:2}n=i}this.dirty=2}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let n=1==e?2:1;t.dirty<n&&(t.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class em extends qf{constructor(e,t,n,s){let o,i=t.type.toDOM;if("function"==typeof i&&(i=i(n,()=>o?o.parent?o.parent.posBeforeChild(o):void 0:s)),!t.type.spec.raw){if(1!=i.nodeType){let e=document.createElement("span");e.appendChild(i),i=e}i.contentEditable="false",i.classList.add("ProseMirror-widget")}super(e,[],i,null),this.widget=t,this.widget=t,o=this}matchesWidget(e){return 0==this.dirty&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return!!t&&t(e)}ignoreMutation(e){return"selection"!=e.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class tm extends qf{constructor(e,t,n,s){super(e,[],t,null),this.textDOM=n,this.text=s}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return"characterData"===e.type&&e.target.nodeValue==e.oldValue}}class nm extends qf{constructor(e,t,n,s,o){super(e,[],n,s),this.mark=t,this.spec=o}static create(e,t,n,s){let o=s.nodeViews[t.type.name],i=o&&o(t,s,n);return i&&i.dom||(i=cp.renderSpec(document,t.type.spec.toDOM(t,n),null,t.attrs)),new nm(e,t,i.dom,i.contentDOM||i.dom,i)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return 3!=this.dirty&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),0!=this.dirty){let e=this.parent;for(;!e.node;)e=e.parent;e.dirty<this.dirty&&(e.dirty=this.dirty),this.dirty=0}}slice(e,t,n){let s=nm.create(this.parent,this.mark,!0,n),o=this.children,i=this.size;t<i&&(o=bm(o,t,i,n)),e>0&&(o=bm(o,0,e,n));for(let r=0;r<o.length;r++)o[r].parent=s;return s.children=o,s}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class sm extends qf{constructor(e,t,n,s,o,i,r,a,l){super(e,[],o,i),this.node=t,this.outerDeco=n,this.innerDeco=s,this.nodeDOM=r}static create(e,t,n,s,o,i){let r,a=o.nodeViews[t.type.name],l=a&&a(t,o,()=>r?r.parent?r.parent.posBeforeChild(r):void 0:i,n,s),c=l&&l.dom,u=l&&l.contentDOM;if(t.isText)if(c){if(3!=c.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else c=document.createTextNode(t.text);else if(!c){let e=cp.renderSpec(document,t.type.spec.toDOM(t),null,t.attrs);({dom:c,contentDOM:u}=e)}u||t.isText||"BR"==c.nodeName||(c.hasAttribute("contenteditable")||(c.contentEditable="false"),t.type.spec.draggable&&(c.draggable=!0));let d=c;return c=fm(c,n,t),l?r=new am(e,t,n,s,c,u||null,d,l,o,i+1):t.isText?new im(e,t,n,s,c,d,o):new sm(e,t,n,s,c,u||null,d,o,i+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(e.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let t=this.children.length-1;t>=0;t--){let n=this.children[t];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>ld.empty)}else e.contentElement=this.contentDOM;else e.getContent=()=>this.node.content;return e}matchesNode(e,t,n){return 0==this.dirty&&e.eq(this.node)&&mm(t,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let n=this.node.inlineContent,s=t,o=e.composing?this.localCompositionInfo(e,t):null,i=o&&o.pos>-1?o:null,r=o&&o.pos<0,a=new ym(this,i&&i.node,e);!function(e,t,n,s){let o=t.locals(e),i=0;if(0==o.length){for(let n=0;n<e.childCount;n++){let r=e.child(n);s(r,o,t.forChild(i,r),n),i+=r.nodeSize}return}let r=0,a=[],l=null;for(let c=0;;){let u,d,p,h;for(;r<o.length&&o[r].to==i;){let e=o[r++];e.widget&&(u?(d||(d=[u])).push(e):u=e)}if(u)if(d){d.sort(vm);for(let e=0;e<d.length;e++)n(d[e],c,!!l)}else n(u,c,!!l);if(l)h=-1,p=l,l=null;else{if(!(c<e.childCount))break;h=c,p=e.child(c++)}for(let e=0;e<a.length;e++)a[e].to<=i&&a.splice(e--,1);for(;r<o.length&&o[r].from<=i&&o[r].to>i;)a.push(o[r++]);let f=i+p.nodeSize;if(p.isText){let e=f;r<o.length&&o[r].from<e&&(e=o[r].from);for(let t=0;t<a.length;t++)a[t].to<e&&(e=a[t].to);e<f&&(l=p.cut(e-i),p=p.cut(0,e-i),f=e,h=-1)}else for(;r<o.length&&o[r].to<f;)r++;s(p,p.isInline&&!p.isLeaf?a.filter(e=>!e.inline):a.slice(),t.forChild(i,p),h),i=f}}(this.node,this.innerDeco,(t,o,i)=>{t.spec.marks?a.syncToMarks(t.spec.marks,n,e):t.type.side>=0&&!i&&a.syncToMarks(o==this.node.childCount?pd.none:this.node.child(o).marks,n,e),a.placeWidget(t,e,s)},(t,i,l,c)=>{let u;a.syncToMarks(t.marks,n,e),a.findNodeMatch(t,i,l,c)||r&&e.state.selection.from>s&&e.state.selection.to<s+t.nodeSize&&(u=a.findIndexWithChild(o.node))>-1&&a.updateNodeAt(t,i,l,u,e)||a.updateNextNode(t,i,l,e,c,s)||a.addNode(t,i,l,e,s),s+=t.nodeSize}),a.syncToMarks([],n,e),this.node.isTextblock&&a.addTextblockHacks(),a.destroyRest(),(a.changed||2==this.dirty)&&(i&&this.protectLocalComposition(e,i),lm(this.contentDOM,this.children,e),Tf&&function(e){if("UL"==e.nodeName||"OL"==e.nodeName){let t=e.style.cssText;e.style.cssText=t+"; list-style: square !important",window.getComputedStyle(e).listStyle,e.style.cssText=t}}(this.dom))}localCompositionInfo(e,t){let{from:n,to:s}=e.state.selection;if(!(e.state.selection instanceof uh)||n<t||s>t+this.node.content.size)return null;let o=e.input.compositionNode;if(!o||!this.dom.contains(o.parentNode))return null;if(this.node.inlineContent){let e=o.nodeValue,i=function(e,t,n,s){for(let o=0,i=0;o<e.childCount&&i<=s;){let r=e.child(o++),a=i;if(i+=r.nodeSize,!r.isText)continue;let l=r.text;for(;o<e.childCount;){let t=e.child(o++);if(i+=t.nodeSize,!t.isText)break;l+=t.text}if(i>=n){if(i>=s&&l.slice(s-t.length-a,s-a)==t)return s-t.length;let e=a<s?l.lastIndexOf(t,s-a-1):-1;if(e>=0&&e+t.length+a>=n)return a+e;if(n==s&&l.length>=s+t.length-a&&l.slice(s-a,s-a+t.length)==t)return s}}return-1}(this.node.content,e,n-t,s-t);return i<0?null:{node:o,pos:i,text:e}}return{node:o,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:n,text:s}){if(this.getDesc(t))return;let o=t;for(;o.parentNode!=this.contentDOM;o=o.parentNode){for(;o.previousSibling;)o.parentNode.removeChild(o.previousSibling);for(;o.nextSibling;)o.parentNode.removeChild(o.nextSibling);o.pmViewDesc&&(o.pmViewDesc=void 0)}let i=new tm(this,o,t,s);e.input.compositionNodes.push(i),this.children=bm(this.children,n,n+s.length,e,i)}update(e,t,n,s){return!(3==this.dirty||!e.sameMarkup(this.node))&&(this.updateInner(e,t,n,s),!0)}updateInner(e,t,n,s){this.updateOuterDeco(t),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=0}updateOuterDeco(e){if(mm(e,this.outerDeco))return;let t=1!=this.nodeDOM.nodeType,n=this.dom;this.dom=pm(this.dom,this.nodeDOM,dm(this.outerDeco,this.node,t),dm(e,this.node,t)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){1==this.nodeDOM.nodeType&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.nodeDOM.draggable=!0))}deselectNode(){1==this.nodeDOM.nodeType&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function om(e,t,n,s,o){fm(s,t,e);let i=new sm(void 0,e,t,n,s,s,s,o,0);return i.contentDOM&&i.updateChildren(o,0),i}class im extends sm{constructor(e,t,n,s,o,i,r){super(e,t,n,s,o,null,i,r,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,n,s){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!e.sameMarkup(this.node))&&(this.updateOuterDeco(t),0==this.dirty&&e.text==this.node.text||e.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=e.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=e,this.dirty=0,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,n){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,n)}ignoreMutation(e){return"characterData"!=e.type&&"selection"!=e.type}slice(e,t,n){let s=this.node.cut(e,t),o=document.createTextNode(s.text);return new im(this.parent,s,this.outerDeco,this.innerDeco,o,o,n)}markDirty(e,t){super.markDirty(e,t),this.dom==this.nodeDOM||0!=e&&t!=this.nodeDOM.nodeValue.length||(this.dirty=3)}get domAtom(){return!1}isText(e){return this.node.text==e}}class rm extends qf{parseRule(){return{ignore:!0}}matchesHack(e){return 0==this.dirty&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class am extends sm{constructor(e,t,n,s,o,i,r,a,l,c){super(e,t,n,s,o,i,r,l,c),this.spec=a}update(e,t,n,s){if(3==this.dirty)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let o=this.spec.update(e,t,n);return o&&this.updateInner(e,t,n,s),o}return!(!this.contentDOM&&!e.isLeaf)&&super.update(e,t,n,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,n,s){this.spec.setSelection?this.spec.setSelection(e,t,n.root):super.setSelection(e,t,n,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return!!this.spec.stopEvent&&this.spec.stopEvent(e)}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function lm(e,t,n){let s=e.firstChild,o=!1;for(let i=0;i<t.length;i++){let r=t[i],a=r.dom;if(a.parentNode==e){for(;a!=s;)s=gm(s),o=!0;s=s.nextSibling}else o=!0,e.insertBefore(a,s);if(r instanceof nm){let t=s?s.previousSibling:e.lastChild;lm(r.contentDOM,r.children,n),s=t?t.nextSibling:e.firstChild}}for(;s;)s=gm(s),o=!0;o&&n.trackWrites==e&&(n.trackWrites=null)}const cm=function(e){e&&(this.nodeName=e)};cm.prototype=Object.create(null);const um=[new cm];function dm(e,t,n){if(0==e.length)return um;let s=n?um[0]:new cm,o=[s];for(let i=0;i<e.length;i++){let r=e[i].type.attrs;if(r){r.nodeName&&o.push(s=new cm(r.nodeName));for(let e in r){let i=r[e];null!=i&&(n&&1==o.length&&o.push(s=new cm(t.isInline?"span":"div")),"class"==e?s.class=(s.class?s.class+" ":"")+i:"style"==e?s.style=(s.style?s.style+";":"")+i:"nodeName"!=e&&(s[e]=i))}}}return o}function pm(e,t,n,s){if(n==um&&s==um)return t;let o=t;for(let i=0;i<s.length;i++){let t=s[i],r=n[i];if(i){let n;r&&r.nodeName==t.nodeName&&o!=e&&(n=o.parentNode)&&n.nodeName.toLowerCase()==t.nodeName||(n=document.createElement(t.nodeName),n.pmIsDeco=!0,n.appendChild(o),r=um[0]),o=n}hm(o,r||um[0],t)}return o}function hm(e,t,n){for(let s in t)"class"==s||"style"==s||"nodeName"==s||s in n||e.removeAttribute(s);for(let s in n)"class"!=s&&"style"!=s&&"nodeName"!=s&&n[s]!=t[s]&&e.setAttribute(s,n[s]);if(t.class!=n.class){let s=t.class?t.class.split(" ").filter(Boolean):[],o=n.class?n.class.split(" ").filter(Boolean):[];for(let t=0;t<s.length;t++)-1==o.indexOf(s[t])&&e.classList.remove(s[t]);for(let t=0;t<o.length;t++)-1==s.indexOf(o[t])&&e.classList.add(o[t]);0==e.classList.length&&e.removeAttribute("class")}if(t.style!=n.style){if(t.style){let n,s=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;for(;n=s.exec(t.style);)e.style.removeProperty(n[1])}n.style&&(e.style.cssText+=n.style)}}function fm(e,t,n){return pm(e,e,um,dm(t,n,1!=e.nodeType))}function mm(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].type.eq(t[n].type))return!1;return!0}function gm(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}class ym{constructor(e,t,n){this.lock=t,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=function(e,t){let n=t,s=n.children.length,o=e.childCount,i=new Map,r=[];e:for(;o>0;){let a;for(;;)if(s){let e=n.children[s-1];if(!(e instanceof nm)){a=e,s--;break}n=e,s=e.children.length}else{if(n==t)break e;s=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=e.child(o-1))break;--o,i.set(a,o),r.push(a)}}return{index:o,matched:i,matches:r.reverse()}}(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let n=e;n<t;n++)this.top.children[n].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,n){let s=0,o=this.stack.length>>1,i=Math.min(o,e.length);for(;s<i&&(s==o-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&!1!==e[s].type.spec.spanning;)s++;for(;s<o;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),o--;for(;o<e.length;){this.stack.push(this.top,this.index+1);let s=-1;for(let t=this.index;t<Math.min(this.index+3,this.top.children.length);t++){let n=this.top.children[t];if(n.matchesMark(e[o])&&!this.isLocked(n.dom)){s=t;break}}if(s>-1)s>this.index&&(this.changed=!0,this.destroyBetween(this.index,s)),this.top=this.top.children[this.index];else{let s=nm.create(this.top,e[o],t,n);this.top.children.splice(this.index,0,s),this.top=s,this.changed=!0}this.index=0,o++}}findNodeMatch(e,t,n,s){let o,i=-1;if(s>=this.preMatch.index&&(o=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&o.matchesNode(e,t,n))i=this.top.children.indexOf(o,this.index);else for(let r=this.index,a=Math.min(this.top.children.length,r+5);r<a;r++){let s=this.top.children[r];if(s.matchesNode(e,t,n)&&!this.preMatch.matched.has(s)){i=r;break}}return!(i<0)&&(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,t,n,s,o){let i=this.top.children[s];return 3==i.dirty&&i.dom==i.contentDOM&&(i.dirty=2),!!i.update(e,t,n,o)&&(this.destroyBetween(this.index,s),this.index++,!0)}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let t=e.pmViewDesc;if(t)for(let e=this.index;e<this.top.children.length;e++)if(this.top.children[e]==t)return e;return-1}e=t}}updateNextNode(e,t,n,s,o,i){for(let r=this.index;r<this.top.children.length;r++){let a=this.top.children[r];if(a instanceof sm){let l=this.preMatch.matched.get(a);if(null!=l&&l!=o)return!1;let c,u=a.dom,d=this.isLocked(u)&&!(e.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==e.text&&3!=a.dirty&&mm(t,a.outerDeco));if(!d&&a.update(e,t,n,s))return this.destroyBetween(this.index,r),a.dom!=u&&(this.changed=!0),this.index++,!0;if(!d&&(c=this.recreateWrapper(a,e,t,n,s,i)))return this.destroyBetween(this.index,r),this.top.children[this.index]=c,c.contentDOM&&(c.dirty=2,c.updateChildren(s,i+1),c.dirty=0),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,n,s,o,i){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content)||!mm(n,e.outerDeco)||!s.eq(e.innerDeco))return null;let r=sm.create(this.top,t,n,s,o,i);if(r.contentDOM){r.children=e.children,e.children=[];for(let e of r.children)e.parent=r}return e.destroy(),r}addNode(e,t,n,s,o){let i=sm.create(this.top,e,t,n,s,o);i.contentDOM&&i.updateChildren(s,o+1),this.top.children.splice(this.index++,0,i),this.changed=!0}placeWidget(e,t,n){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(!s||!s.matchesWidget(e)||e!=s.widget&&s.widget.type.toDOM.parentNode){let s=new em(this.top,e,t,n);this.top.children.splice(this.index++,0,s),this.changed=!0}else this.index++}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof nm;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof im)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Cf||wf)&&e&&"false"==e.dom.contentEditable&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);"IMG"==e&&(n.className="ProseMirror-separator",n.alt=""),"BR"==e&&(n.className="ProseMirror-trailingBreak");let s=new rm(this.top,[],n,null);t!=this.top?t.children.push(s):t.children.splice(this.index++,0,s),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||1==e.nodeType&&e.contains(this.lock.parentNode))}}function vm(e,t){return e.type.side-t.type.side}function bm(e,t,n,s,o){let i=[];for(let r=0,a=0;r<e.length;r++){let l=e[r],c=a,u=a+=l.size;c>=n||u<=t?i.push(l):(c<t&&i.push(l.slice(0,t-c,s)),o&&(i.push(o),o=void 0),u>n&&i.push(l.slice(n-c,l.size,s)))}return i}function km(e,t=null){let n=e.domSelectionRange(),s=e.state.doc;if(!n.focusNode)return null;let o=e.docView.nearestDesc(n.focusNode),i=o&&0==o.size,r=e.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(r<0)return null;let a,l,c=s.resolve(r);if(cf(n)){for(a=r;o&&!o.node;)o=o.parent;let e=o.node;if(o&&e.isAtom&&ph.isSelectable(e)&&o.parent&&(!e.isInline||!function(e,t,n){for(let s=0==t,o=t==af(e);s||o;){if(e==n)return!0;let t=qh(e);if(!(e=e.parentNode))return!1;s=s&&0==t,o=o&&t==af(e)}}(n.focusNode,n.focusOffset,o.dom))){let e=o.posBefore;l=new ph(r==e?c:s.resolve(e))}}else{if(n instanceof e.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let t=r,o=r;for(let s=0;s<n.rangeCount;s++){let i=n.getRangeAt(s);t=Math.min(t,e.docView.posFromDOM(i.startContainer,i.startOffset,1)),o=Math.max(o,e.docView.posFromDOM(i.endContainer,i.endOffset,-1))}if(t<0)return null;[a,r]=o==e.state.selection.anchor?[o,t]:[t,o],c=s.resolve(r)}else a=e.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(a<0)return null}let u=s.resolve(a);if(!l){l=Nm(e,u,c,"pointer"==t||e.state.selection.head<c.pos&&!i?1:-1)}return l}function wm(e){return e.editable?e.hasFocus():Rm(e)&&document.activeElement&&document.activeElement.contains(e.dom)}function Sm(e,t=!1){let n=e.state.selection;if(xm(e,n),wm(e)){if(!t&&e.input.mouseDown&&e.input.mouseDown.allowDefault&&wf){let t=e.domSelectionRange(),n=e.domObserver.currentSelection;if(t.anchorNode&&n.anchorNode&&sf(t.anchorNode,t.anchorOffset,n.anchorNode,n.anchorOffset))return e.input.mouseDown.delayedSelectionSync=!0,void e.domObserver.setCurSelection()}if(e.domObserver.disconnectSelection(),e.cursorWrapper)!function(e){let t=e.domSelection();if(!t)return;let n=e.cursorWrapper.dom,s="IMG"==n.nodeName;s?t.collapse(n.parentNode,qh(n)+1):t.collapse(n,0);!s&&!e.state.selection.visible&&yf&&vf<=11&&(n.disabled=!0,n.disabled=!1)}(e);else{let s,o,{anchor:i,head:r}=n;!Cm||n instanceof uh||(n.$from.parent.inlineContent||(s=Tm(e,n.from)),n.empty||n.$from.parent.inlineContent||(o=Tm(e,n.to))),e.docView.setSelection(i,r,e,t),Cm&&(s&&Im(s),o&&Im(o)),n.visible?e.dom.classList.remove("ProseMirror-hideselection"):(e.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(e){let t=e.dom.ownerDocument;t.removeEventListener("selectionchange",e.input.hideSelectionGuard);let n=e.domSelectionRange(),s=n.anchorNode,o=n.anchorOffset;t.addEventListener("selectionchange",e.input.hideSelectionGuard=()=>{n.anchorNode==s&&n.anchorOffset==o||(t.removeEventListener("selectionchange",e.input.hideSelectionGuard),setTimeout(()=>{wm(e)&&!e.state.selection.visible||e.dom.classList.remove("ProseMirror-hideselection")},20))})}(e))}e.domObserver.setCurSelection(),e.domObserver.connectSelection()}}const Cm=Cf||wf&&Sf<63;function Tm(e,t){let{node:n,offset:s}=e.docView.domFromPos(t,0),o=s<n.childNodes.length?n.childNodes[s]:null,i=s?n.childNodes[s-1]:null;if(Cf&&o&&"false"==o.contentEditable)return Em(o);if(!(o&&"false"!=o.contentEditable||i&&"false"!=i.contentEditable)){if(o)return Em(o);if(i)return Em(i)}}function Em(e){return e.contentEditable="true",Cf&&e.draggable&&(e.draggable=!1,e.wasDraggable=!0),e}function Im(e){e.contentEditable="false",e.wasDraggable&&(e.draggable=!0,e.wasDraggable=null)}function xm(e,t){if(t instanceof ph){let n=e.docView.descAt(t.from);n!=e.lastSelectedViewDesc&&(Am(e),n&&n.selectNode(),e.lastSelectedViewDesc=n)}else Am(e)}function Am(e){e.lastSelectedViewDesc&&(e.lastSelectedViewDesc.parent&&e.lastSelectedViewDesc.deselectNode(),e.lastSelectedViewDesc=void 0)}function Nm(e,t,n,s){return e.someProp("createSelectionBetween",s=>s(e,t,n))||uh.between(t,n,s)}function Mm(e){return!(e.editable&&!e.hasFocus())&&Rm(e)}function Rm(e){let t=e.domSelectionRange();if(!t.anchorNode)return!1;try{return e.dom.contains(3==t.anchorNode.nodeType?t.anchorNode.parentNode:t.anchorNode)&&(e.editable||e.dom.contains(3==t.focusNode.nodeType?t.focusNode.parentNode:t.focusNode))}catch(n){return!1}}function _m(e,t){let{$anchor:n,$head:s}=e.selection,o=t>0?n.max(s):n.min(s),i=o.parent.inlineContent?o.depth?e.doc.resolve(t>0?o.after():o.before()):null:o;return i&&rh.findFrom(i,t)}function Om(e,t){return e.dispatch(e.state.tr.setSelection(t).scrollIntoView()),!0}function Dm(e,t,n){let s=e.state.selection;if(!(s instanceof uh)){if(s instanceof ph&&s.node.isInline)return Om(e,new uh(t>0?s.$to:s.$from));{let n=_m(e.state,t);return!!n&&Om(e,n)}}if(n.indexOf("s")>-1){let{$head:n}=s,o=n.textOffset?null:t<0?n.nodeBefore:n.nodeAfter;if(!o||o.isText||!o.isLeaf)return!1;let i=e.state.doc.resolve(n.pos+o.nodeSize*(t<0?-1:1));return Om(e,new uh(s.$anchor,i))}if(!s.empty)return!1;if(e.endOfTextblock(t>0?"forward":"backward")){let n=_m(e.state,t);return!!(n&&n instanceof ph)&&Om(e,n)}if(!(Ef&&n.indexOf("m")>-1)){let n,o=s.$head,i=o.textOffset?null:t<0?o.nodeBefore:o.nodeAfter;if(!i||i.isText)return!1;let r=t<0?o.pos-i.nodeSize:o.pos;return!!(i.isAtom||(n=e.docView.descAt(r))&&!n.contentDOM)&&(ph.isSelectable(i)?Om(e,new ph(t<0?e.state.doc.resolve(o.pos-i.nodeSize):o)):!!Af&&Om(e,new uh(e.state.doc.resolve(t<0?r:r+i.nodeSize))))}}function Bm(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function Lm(e,t){let n=e.pmViewDesc;return n&&0==n.size&&(t<0||e.nextSibling||"BR"!=e.nodeName)}function Fm(e,t){return t<0?function(e){let t=e.domSelectionRange(),n=t.focusNode,s=t.focusOffset;if(!n)return;let o,i,r=!1;bf&&1==n.nodeType&&s<Bm(n)&&Lm(n.childNodes[s],-1)&&(r=!0);for(;;)if(s>0){if(1!=n.nodeType)break;{let e=n.childNodes[s-1];if(Lm(e,-1))o=n,i=--s;else{if(3!=e.nodeType)break;n=e,s=n.nodeValue.length}}}else{if(Pm(n))break;{let t=n.previousSibling;for(;t&&Lm(t,-1);)o=n.parentNode,i=qh(t),t=t.previousSibling;if(t)n=t,s=Bm(n);else{if(n=n.parentNode,n==e.dom)break;s=0}}}r?$m(e,n,s):o&&$m(e,o,i)}(e):function(e){let t=e.domSelectionRange(),n=t.focusNode,s=t.focusOffset;if(!n)return;let o,i,r=Bm(n);for(;;)if(s<r){if(1!=n.nodeType)break;if(!Lm(n.childNodes[s],1))break;o=n,i=++s}else{if(Pm(n))break;{let t=n.nextSibling;for(;t&&Lm(t,1);)o=t.parentNode,i=qh(t)+1,t=t.nextSibling;if(t)n=t,s=0,r=Bm(n);else{if(n=n.parentNode,n==e.dom)break;s=r=0}}}o&&$m(e,o,i)}(e)}function Pm(e){let t=e.pmViewDesc;return t&&t.node&&t.node.isBlock}function $m(e,t,n){if(3!=t.nodeType){let e,s;(s=function(e,t){for(;e&&t==e.childNodes.length&&!lf(e);)t=qh(e)+1,e=e.parentNode;for(;e&&t<e.childNodes.length;){let n=e.childNodes[t];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;e=n,t=0}}(t,n))?(t=s,n=0):(e=function(e,t){for(;e&&!t&&!lf(e);)t=qh(e),e=e.parentNode;for(;e&&t;){let n=e.childNodes[t-1];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;t=(e=n).childNodes.length}}(t,n))&&(t=e,n=e.nodeValue.length)}let s=e.domSelection();if(!s)return;if(cf(s)){let e=document.createRange();e.setEnd(t,n),e.setStart(t,n),s.removeAllRanges(),s.addRange(e)}else s.extend&&s.extend(t,n);e.domObserver.setCurSelection();let{state:o}=e;setTimeout(()=>{e.state==o&&Sm(e)},50)}function Um(e,t){let n=e.state.doc.resolve(t);if(!wf&&!If&&n.parent.inlineContent){let s=e.coordsAtPos(t);if(t>n.start()){let n=e.coordsAtPos(t-1),o=(n.top+n.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(n.left-s.left)>1)return n.left<s.left?"ltr":"rtl"}if(t<n.end()){let n=e.coordsAtPos(t+1),o=(n.top+n.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(n.left-s.left)>1)return n.left>s.left?"ltr":"rtl"}}return"rtl"==getComputedStyle(e.dom).direction?"rtl":"ltr"}function Vm(e,t,n){let s=e.state.selection;if(s instanceof uh&&!s.empty||n.indexOf("s")>-1)return!1;if(Ef&&n.indexOf("m")>-1)return!1;let{$from:o,$to:i}=s;if(!o.parent.inlineContent||e.endOfTextblock(t<0?"up":"down")){let n=_m(e.state,t);if(n&&n instanceof ph)return Om(e,n)}if(!o.parent.inlineContent){let n=t<0?o:i,r=s instanceof fh?rh.near(n,t):rh.findFrom(n,t);return!!r&&Om(e,r)}return!1}function Wm(e,t){if(!(e.state.selection instanceof uh))return!0;let{$head:n,$anchor:s,empty:o}=e.state.selection;if(!n.sameParent(s))return!0;if(!o)return!1;if(e.endOfTextblock(t>0?"forward":"backward"))return!0;let i=!n.textOffset&&(t<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let s=e.state.tr;return t<0?s.delete(n.pos-i.nodeSize,n.pos):s.delete(n.pos,n.pos+i.nodeSize),e.dispatch(s),!0}return!1}function Gm(e,t,n){e.domObserver.stop(),t.contentEditable=n,e.domObserver.start()}function zm(e,t){let n=t.keyCode,s=function(e){let t="";return e.ctrlKey&&(t+="c"),e.metaKey&&(t+="m"),e.altKey&&(t+="a"),e.shiftKey&&(t+="s"),t}(t);if(8==n||Ef&&72==n&&"c"==s)return Wm(e,-1)||Fm(e,-1);if(46==n&&!t.shiftKey||Ef&&68==n&&"c"==s)return Wm(e,1)||Fm(e,1);if(13==n||27==n)return!0;if(37==n||Ef&&66==n&&"c"==s){let t=37==n?"ltr"==Um(e,e.state.selection.from)?-1:1:-1;return Dm(e,t,s)||Fm(e,t)}if(39==n||Ef&&70==n&&"c"==s){let t=39==n?"ltr"==Um(e,e.state.selection.from)?1:-1:1;return Dm(e,t,s)||Fm(e,t)}return 38==n||Ef&&80==n&&"c"==s?Vm(e,-1,s)||Fm(e,-1):40==n||Ef&&78==n&&"c"==s?function(e){if(!Cf||e.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:n}=e.domSelectionRange();if(t&&1==t.nodeType&&0==n&&t.firstChild&&"false"==t.firstChild.contentEditable){let n=t.firstChild;Gm(e,n,"true"),setTimeout(()=>Gm(e,n,"false"),20)}return!1}(e)||Vm(e,1,s)||Fm(e,1):s==(Ef?"m":"c")&&(66==n||73==n||89==n||90==n)}function Hm(e,t){e.someProp("transformCopied",n=>{t=n(t,e)});let n=[],{content:s,openStart:o,openEnd:i}=t;for(;o>1&&i>1&&1==s.childCount&&1==s.firstChild.childCount;){o--,i--;let e=s.firstChild;n.push(e.type.name,e.attrs!=e.type.defaultAttrs?e.attrs:null),s=e.content}let r=e.someProp("clipboardSerializer")||cp.fromSchema(e.state.schema),a=tg(),l=a.createElement("div");l.appendChild(r.serializeFragment(s,{document:a}));let c,u=l.firstChild,d=0;for(;u&&1==u.nodeType&&(c=qm[u.nodeName.toLowerCase()]);){for(let e=c.length-1;e>=0;e--){let t=a.createElement(c[e]);for(;l.firstChild;)t.appendChild(l.firstChild);l.appendChild(t),d++}u=l.firstChild}return u&&1==u.nodeType&&u.setAttribute("data-pm-slice",`${o} ${i}${d?` -${d}`:""} ${JSON.stringify(n)}`),{dom:l,text:e.someProp("clipboardTextSerializer",n=>n(t,e))||t.content.textBetween(0,t.content.size,"\n\n"),slice:t}}function Km(e,t,n,s,o){let i,r,a=o.parent.type.spec.code;if(!n&&!t)return null;let l=!!t&&(s||a||!n);if(l){if(e.someProp("transformPastedText",n=>{t=n(t,a||s,e)}),a)return r=new fd(ld.from(e.state.schema.text(t.replace(/\r\n?/g,"\n"))),0,0),e.someProp("transformPasted",t=>{r=t(r,e,!0)}),r;let n=e.someProp("clipboardTextParser",n=>n(t,o,s,e));if(n)r=n;else{let n=o.marks(),{schema:s}=e.state,r=cp.fromSchema(s);i=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach(e=>{let t=i.appendChild(document.createElement("p"));e&&t.appendChild(r.serializeNode(s.text(e,n)))})}}else e.someProp("transformPastedHTML",t=>{n=t(n,e)}),i=function(e){let t=/^(\s*<meta [^>]*>)*/.exec(e);t&&(e=e.slice(t[0].length));let n,s=tg().createElement("div"),o=/<([a-z][^>\s]+)/i.exec(e);(n=o&&qm[o[1].toLowerCase()])&&(e=n.map(e=>"<"+e+">").join("")+e+n.map(e=>"</"+e+">").reverse().join(""));if(s.innerHTML=function(e){let t=window.trustedTypes;if(!t)return e;ng||(ng=t.defaultPolicy||t.createPolicy("ProseMirrorClipboard",{createHTML:e=>e}));return ng.createHTML(e)}(e),n)for(let i=0;i<n.length;i++)s=s.querySelector(n[i])||s;return s}(n),Af&&function(e){let t=e.querySelectorAll(wf?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<t.length;n++){let s=t[n];1==s.childNodes.length&&"Â "==s.textContent&&s.parentNode&&s.parentNode.replaceChild(e.ownerDocument.createTextNode(" "),s)}}(i);let c=i&&i.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let d=+u[3];d>0;d--){let e=i.firstChild;for(;e&&1!=e.nodeType;)e=e.nextSibling;if(!e)break;i=e}if(!r){let t=e.someProp("clipboardParser")||e.someProp("domParser")||qd.fromSchema(e.state.schema);r=t.parseSlice(i,{preserveWhitespace:!(!l&&!u),context:o,ruleFromNode:e=>"BR"!=e.nodeName||e.nextSibling||!e.parentNode||jm.test(e.parentNode.nodeName)?null:{ignore:!0}})}if(u)r=function(e,t){if(!e.size)return e;let n,s=e.content.firstChild.type.schema;try{n=JSON.parse(t)}catch(a){return e}let{content:o,openStart:i,openEnd:r}=e;for(let l=n.length-2;l>=0;l-=2){let e=s.nodes[n[l]];if(!e||e.hasRequiredAttrs())break;o=ld.from(e.create(n[l+1],o)),i++,r++}return new fd(o,i,r)}(Qm(r,+u[1],+u[2]),u[4]);else if(r=fd.maxOpen(function(e,t){if(e.childCount<2)return e;for(let n=t.depth;n>=0;n--){let s,o=t.node(n).contentMatchAt(t.index(n)),i=[];if(e.forEach(e=>{if(!i)return;let t,n=o.findWrapping(e.type);if(!n)return i=null;if(t=i.length&&s.length&&Zm(n,s,e,i[i.length-1],0))i[i.length-1]=t;else{i.length&&(i[i.length-1]=Xm(i[i.length-1],s.length));let t=Ym(e,n);i.push(t),o=o.matchType(t.type),s=n}}),i)return ld.from(i)}return e}(r.content,o),!0),r.openStart||r.openEnd){let e=0,t=0;for(let n=r.content.firstChild;e<r.openStart&&!n.type.spec.isolating;e++,n=n.firstChild);for(let n=r.content.lastChild;t<r.openEnd&&!n.type.spec.isolating;t++,n=n.lastChild);r=Qm(r,e,t)}return e.someProp("transformPasted",t=>{r=t(r,e,l)}),r}const jm=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Ym(e,t,n=0){for(let s=t.length-1;s>=n;s--)e=t[s].create(null,ld.from(e));return e}function Zm(e,t,n,s,o){if(o<e.length&&o<t.length&&e[o]==t[o]){let i=Zm(e,t,n,s.lastChild,o+1);if(i)return s.copy(s.content.replaceChild(s.childCount-1,i));if(s.contentMatchAt(s.childCount).matchType(o==e.length-1?n.type:e[o+1]))return s.copy(s.content.append(ld.from(Ym(n,e,o+1))))}}function Xm(e,t){if(0==t)return e;let n=e.content.replaceChild(e.childCount-1,Xm(e.lastChild,t-1)),s=e.contentMatchAt(e.childCount).fillBefore(ld.empty,!0);return e.copy(n.append(s))}function Jm(e,t,n,s,o,i){let r=t<0?e.firstChild:e.lastChild,a=r.content;return e.childCount>1&&(i=0),o<s-1&&(a=Jm(a,t,n,s,o+1,i)),o>=n&&(a=t<0?r.contentMatchAt(0).fillBefore(a,i<=o).append(a):a.append(r.contentMatchAt(r.childCount).fillBefore(ld.empty,!0))),e.replaceChild(t<0?0:e.childCount-1,r.copy(a))}function Qm(e,t,n){return t<e.openStart&&(e=new fd(Jm(e.content,-1,t,e.openStart,0,e.openEnd),t,e.openEnd)),n<e.openEnd&&(e=new fd(Jm(e.content,1,n,e.openEnd,0,0),e.openStart,n)),e}const qm={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let eg=null;function tg(){return eg||(eg=document.implementation.createHTMLDocument("title"))}let ng=null;const sg={},og={},ig={touchstart:!0,touchmove:!0};class rg{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function ag(e,t){e.input.lastSelectionOrigin=t,e.input.lastSelectionTime=Date.now()}function lg(e){e.someProp("handleDOMEvents",t=>{for(let n in t)e.input.eventHandlers[n]||e.dom.addEventListener(n,e.input.eventHandlers[n]=t=>cg(e,t))})}function cg(e,t){return e.someProp("handleDOMEvents",n=>{let s=n[t.type];return!!s&&(s(e,t)||t.defaultPrevented)})}function ug(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let n=t.target;n!=e.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(t))return!1;return!0}function dg(e){return{left:e.clientX,top:e.clientY}}function pg(e,t,n,s,o){if(-1==s)return!1;let i=e.state.doc.resolve(s);for(let r=i.depth+1;r>0;r--)if(e.someProp(t,t=>r>i.depth?t(e,n,i.nodeAfter,i.before(r),o,!0):t(e,n,i.node(r),i.before(r),o,!1)))return!0;return!1}function hg(e,t,n){if(e.focused||e.focus(),e.state.selection.eq(t))return;let s=e.state.tr.setSelection(t);s.setMeta("pointer",!0),e.dispatch(s)}function fg(e,t,n,s,o){return pg(e,"handleClickOn",t,n,s)||e.someProp("handleClick",n=>n(e,t,s))||(o?function(e,t){if(-1==t)return!1;let n,s,o=e.state.selection;o instanceof ph&&(n=o.node);let i=e.state.doc.resolve(t);for(let r=i.depth+1;r>0;r--){let e=r>i.depth?i.nodeAfter:i.node(r);if(ph.isSelectable(e)){s=n&&o.$from.depth>0&&r>=o.$from.depth&&i.before(o.$from.depth+1)==o.$from.pos?i.before(o.$from.depth):i.before(r);break}}return null!=s&&(hg(e,ph.create(e.state.doc,s)),!0)}(e,n):function(e,t){if(-1==t)return!1;let n=e.state.doc.resolve(t),s=n.nodeAfter;return!!(s&&s.isAtom&&ph.isSelectable(s))&&(hg(e,new ph(n)),!0)}(e,n))}function mg(e,t,n,s){return pg(e,"handleDoubleClickOn",t,n,s)||e.someProp("handleDoubleClick",n=>n(e,t,s))}function gg(e,t,n,s){return pg(e,"handleTripleClickOn",t,n,s)||e.someProp("handleTripleClick",n=>n(e,t,s))||function(e,t,n){if(0!=n.button)return!1;let s=e.state.doc;if(-1==t)return!!s.inlineContent&&(hg(e,uh.create(s,0,s.content.size)),!0);let o=s.resolve(t);for(let i=o.depth+1;i>0;i--){let t=i>o.depth?o.nodeAfter:o.node(i),n=o.before(i);if(t.inlineContent)hg(e,uh.create(s,n+1,n+1+t.content.size));else{if(!ph.isSelectable(t))continue;hg(e,ph.create(s,n))}return!0}}(e,n,s)}function yg(e){return Eg(e)}og.keydown=(e,t)=>{let n=t;if(e.input.shiftKey=16==n.keyCode||n.shiftKey,!kg(e,n)&&(e.input.lastKeyCode=n.keyCode,e.input.lastKeyCodeTime=Date.now(),!xf||!wf||13!=n.keyCode))if(229!=n.keyCode&&e.domObserver.forceFlush(),!Tf||13!=n.keyCode||n.ctrlKey||n.altKey||n.metaKey)e.someProp("handleKeyDown",t=>t(e,n))||zm(e,n)?n.preventDefault():ag(e,"key");else{let t=Date.now();e.input.lastIOSEnter=t,e.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{e.input.lastIOSEnter==t&&(e.someProp("handleKeyDown",t=>t(e,uf(13,"Enter"))),e.input.lastIOSEnter=0)},200)}},og.keyup=(e,t)=>{16==t.keyCode&&(e.input.shiftKey=!1)},og.keypress=(e,t)=>{let n=t;if(kg(e,n)||!n.charCode||n.ctrlKey&&!n.altKey||Ef&&n.metaKey)return;if(e.someProp("handleKeyPress",t=>t(e,n)))return void n.preventDefault();let s=e.state.selection;if(!(s instanceof uh&&s.$from.sameParent(s.$to))){let t=String.fromCharCode(n.charCode),o=()=>e.state.tr.insertText(t).scrollIntoView();/[\r\n]/.test(t)||e.someProp("handleTextInput",n=>n(e,s.$from.pos,s.$to.pos,t,o))||e.dispatch(o()),n.preventDefault()}};const vg=Ef?"metaKey":"ctrlKey";sg.mousedown=(e,t)=>{let n=t;e.input.shiftKey=n.shiftKey;let s=yg(e),o=Date.now(),i="singleClick";o-e.input.lastClick.time<500&&function(e,t){let n=t.x-e.clientX,s=t.y-e.clientY;return n*n+s*s<100}(n,e.input.lastClick)&&!n[vg]&&e.input.lastClick.button==n.button&&("singleClick"==e.input.lastClick.type?i="doubleClick":"doubleClick"==e.input.lastClick.type&&(i="tripleClick")),e.input.lastClick={time:o,x:n.clientX,y:n.clientY,type:i,button:n.button};let r=e.posAtCoords(dg(n));r&&("singleClick"==i?(e.input.mouseDown&&e.input.mouseDown.done(),e.input.mouseDown=new bg(e,r,n,!!s)):("doubleClick"==i?mg:gg)(e,r.pos,r.inside,n)?n.preventDefault():ag(e,"pointer"))};class bg{constructor(e,t,n,s){let o,i;if(this.view=e,this.pos=t,this.event=n,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[vg],this.allowDefault=n.shiftKey,t.inside>-1)o=e.state.doc.nodeAt(t.inside),i=t.inside;else{let n=e.state.doc.resolve(t.pos);o=n.parent,i=n.depth?n.before():0}const r=s?null:n.target,a=r?e.docView.nearestDesc(r,!0):null;this.target=a&&1==a.nodeDOM.nodeType?a.nodeDOM:null;let{selection:l}=e.state;(0==n.button&&o.type.spec.draggable&&!1!==o.type.spec.selectable||l instanceof ph&&l.from<=i&&l.to>i)&&(this.mightDrag={node:o,pos:i,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!bf||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),ag(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Sm(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(dg(e))),this.updateAllowDefault(e),this.allowDefault||!t?ag(this.view,"pointer"):fg(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():0==e.button&&(this.flushed||Cf&&this.mightDrag&&!this.mightDrag.node.isAtom||wf&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(hg(this.view,rh.near(this.view.state.doc.resolve(t.pos))),e.preventDefault()):ag(this.view,"pointer")}move(e){this.updateAllowDefault(e),ag(this.view,"pointer"),0==e.buttons&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}function kg(e,t){return!!e.composing||!!(Cf&&Math.abs(t.timeStamp-e.input.compositionEndedAt)<500)&&(e.input.compositionEndedAt=-2e8,!0)}sg.touchstart=e=>{e.input.lastTouch=Date.now(),yg(e),ag(e,"pointer")},sg.touchmove=e=>{e.input.lastTouch=Date.now(),ag(e,"pointer")},sg.contextmenu=e=>yg(e);const wg=xf?5e3:-1;function Sg(e,t){clearTimeout(e.input.composingTimeout),t>-1&&(e.input.composingTimeout=setTimeout(()=>Eg(e),t))}function Cg(e){for(e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=function(){let e=document.createEvent("Event");return e.initEvent("event",!0,!0),e.timeStamp}());e.input.compositionNodes.length>0;)e.input.compositionNodes.pop().markParentsDirty()}function Tg(e){let t=e.domSelectionRange();if(!t.focusNode)return null;let n=function(e,t){for(;;){if(3==e.nodeType&&t)return e;if(1==e.nodeType&&t>0){if("false"==e.contentEditable)return null;t=af(e=e.childNodes[t-1])}else{if(!e.parentNode||lf(e))return null;t=qh(e),e=e.parentNode}}}(t.focusNode,t.focusOffset),s=function(e,t){for(;;){if(3==e.nodeType&&t<e.nodeValue.length)return e;if(1==e.nodeType&&t<e.childNodes.length){if("false"==e.contentEditable)return null;e=e.childNodes[t],t=0}else{if(!e.parentNode||lf(e))return null;t=qh(e)+1,e=e.parentNode}}}(t.focusNode,t.focusOffset);if(n&&s&&n!=s){let t=s.pmViewDesc,o=e.domObserver.lastChangedTextNode;if(n==o||s==o)return o;if(!t||!t.isText(s.nodeValue))return s;if(e.input.compositionNode==s){let e=n.pmViewDesc;if(e&&e.isText(n.nodeValue))return s}}return n||s}function Eg(e,t=!1){if(!(xf&&e.domObserver.flushingSoon>=0)){if(e.domObserver.forceFlush(),Cg(e),t||e.docView&&e.docView.dirty){let n=km(e),s=e.state.selection;return n&&!n.eq(s)?e.dispatch(e.state.tr.setSelection(n)):!e.markCursor&&!t||s.$from.node(s.$from.sharedDepth(s.to)).inlineContent?e.updateState(e.state):e.dispatch(e.state.tr.deleteSelection()),!0}return!1}}og.compositionstart=og.compositionupdate=e=>{if(!e.composing){e.domObserver.flush();let{state:t}=e,n=t.selection.$to;if(t.selection instanceof uh&&(t.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(e=>!1===e.type.spec.inclusive)||wf&&If&&function(e){let{focusNode:t,focusOffset:n}=e.domSelectionRange();if(!t||1!=t.nodeType||n>=t.childNodes.length)return!1;let s=t.childNodes[n];return 1==s.nodeType&&"false"==s.contentEditable}(e)))e.markCursor=e.state.storedMarks||n.marks(),Eg(e,!0),e.markCursor=null;else if(Eg(e,!t.selection.empty),bf&&t.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let t=e.domSelectionRange();for(let n=t.focusNode,s=t.focusOffset;n&&1==n.nodeType&&0!=s;){let t=s<0?n.lastChild:n.childNodes[s-1];if(!t)break;if(3==t.nodeType){let n=e.domSelection();n&&n.collapse(t,t.nodeValue.length);break}n=t,s=-1}}e.input.composing=!0}Sg(e,wg)},og.compositionend=(e,t)=>{e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=t.timeStamp,e.input.compositionPendingChanges=e.domObserver.pendingRecords().length?e.input.compositionID:0,e.input.compositionNode=null,e.input.compositionPendingChanges&&Promise.resolve().then(()=>e.domObserver.flush()),e.input.compositionID++,Sg(e,20))};const Ig=yf&&vf<15||Tf&&Nf<604;function xg(e,t,n,s,o){let i=Km(e,t,n,s,e.state.selection.$from);if(e.someProp("handlePaste",t=>t(e,o,i||fd.empty)))return!0;if(!i)return!1;let r=function(e){return 0==e.openStart&&0==e.openEnd&&1==e.content.childCount?e.content.firstChild:null}(i),a=r?e.state.tr.replaceSelectionWith(r,s):e.state.tr.replaceSelection(i);return e.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function Ag(e){let t=e.getData("text/plain")||e.getData("Text");if(t)return t;let n=e.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}sg.copy=og.cut=(e,t)=>{let n=t,s=e.state.selection,o="cut"==n.type;if(s.empty)return;let i=Ig?null:n.clipboardData,r=s.content(),{dom:a,text:l}=Hm(e,r);i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):function(e,t){if(!e.dom.parentNode)return;let n=e.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(t),n.style.cssText="position: fixed; left: -10000px; top: 10px";let s=getSelection(),o=document.createRange();o.selectNodeContents(t),e.dom.blur(),s.removeAllRanges(),s.addRange(o),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),e.focus()},50)}(e,a),o&&e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},og.paste=(e,t)=>{let n=t;if(e.composing&&!xf)return;let s=Ig?null:n.clipboardData,o=e.input.shiftKey&&45!=e.input.lastKeyCode;s&&xg(e,Ag(s),s.getData("text/html"),o,n)?n.preventDefault():function(e,t){if(!e.dom.parentNode)return;let n=e.input.shiftKey||e.state.selection.$from.parent.type.spec.code,s=e.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(s.contentEditable="true"),s.style.cssText="position: fixed; left: -10000px; top: 10px",s.focus();let o=e.input.shiftKey&&45!=e.input.lastKeyCode;setTimeout(()=>{e.focus(),s.parentNode&&s.parentNode.removeChild(s),n?xg(e,s.value,null,o,t):xg(e,s.textContent,s.innerHTML,o,t)},50)}(e,n)};class Ng{constructor(e,t,n){this.slice=e,this.move=t,this.node=n}}const Mg=Ef?"altKey":"ctrlKey";function Rg(e,t){let n=e.someProp("dragCopies",e=>!e(t));return null!=n?n:!t[Mg]}sg.dragstart=(e,t)=>{let n=t,s=e.input.mouseDown;if(s&&s.done(),!n.dataTransfer)return;let o,i=e.state.selection,r=i.empty?null:e.posAtCoords(dg(n));if(r&&r.pos>=i.from&&r.pos<=(i instanceof ph?i.to-1:i.to));else if(s&&s.mightDrag)o=ph.create(e.state.doc,s.mightDrag.pos);else if(n.target&&1==n.target.nodeType){let t=e.docView.nearestDesc(n.target,!0);t&&t.node.type.spec.draggable&&t!=e.docView&&(o=ph.create(e.state.doc,t.posBefore))}let a=(o||e.state.selection).content(),{dom:l,text:c,slice:u}=Hm(e,a);(!n.dataTransfer.files.length||!wf||Sf>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(Ig?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",Ig||n.dataTransfer.setData("text/plain",c),e.dragging=new Ng(u,Rg(e,n),o)},sg.dragend=e=>{let t=e.dragging;window.setTimeout(()=>{e.dragging==t&&(e.dragging=null)},50)},og.dragover=og.dragenter=(e,t)=>t.preventDefault(),og.drop=(e,t)=>{try{!function(e,t,n){if(!t.dataTransfer)return;let s=e.posAtCoords(dg(t));if(!s)return;let o=e.state.doc.resolve(s.pos),i=n&&n.slice;i?e.someProp("transformPasted",t=>{i=t(i,e,!1)}):i=Km(e,Ag(t.dataTransfer),Ig?null:t.dataTransfer.getData("text/html"),!1,o);let r=!(!n||!Rg(e,t));if(e.someProp("handleDrop",n=>n(e,t,i||fd.empty,r)))return void t.preventDefault();if(!i)return;t.preventDefault();let a=i?Gp(e.state.doc,o.pos,i):o.pos;null==a&&(a=o.pos);let l=e.state.tr;if(r){let{node:e}=n;e?e.replace(l):l.deleteSelection()}let c=l.mapping.map(a),u=0==i.openStart&&0==i.openEnd&&1==i.content.childCount,d=l.doc;u?l.replaceRangeWith(c,c,i.content.firstChild):l.replaceRange(c,c,i);if(l.doc.eq(d))return;let p=l.doc.resolve(c);if(u&&ph.isSelectable(i.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(i.content.firstChild))l.setSelection(new ph(p));else{let t=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach((e,n,s,o)=>t=o),l.setSelection(Nm(e,p,l.doc.resolve(t)))}e.focus(),e.dispatch(l.setMeta("uiEvent","drop"))}(e,t,e.dragging)}finally{e.dragging=null}},sg.focus=e=>{e.input.lastFocus=Date.now(),e.focused||(e.domObserver.stop(),e.dom.classList.add("ProseMirror-focused"),e.domObserver.start(),e.focused=!0,setTimeout(()=>{e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.domSelectionRange())&&Sm(e)},20))},sg.blur=(e,t)=>{let n=t;e.focused&&(e.domObserver.stop(),e.dom.classList.remove("ProseMirror-focused"),e.domObserver.start(),n.relatedTarget&&e.dom.contains(n.relatedTarget)&&e.domObserver.currentSelection.clear(),e.focused=!1)},sg.beforeinput=(e,t)=>{if(wf&&xf&&"deleteContentBackward"==t.inputType){e.domObserver.flushSoon();let{domChangeCount:t}=e.input;setTimeout(()=>{if(e.input.domChangeCount!=t)return;if(e.dom.blur(),e.focus(),e.someProp("handleKeyDown",t=>t(e,uf(8,"Backspace"))))return;let{$cursor:n}=e.state.selection;n&&n.pos>0&&e.dispatch(e.state.tr.delete(n.pos-1,n.pos).scrollIntoView())},50)}};for(let os in og)sg[os]=og[os];function _g(e,t){if(e==t)return!0;for(let n in e)if(e[n]!==t[n])return!1;for(let n in t)if(!(n in e))return!1;return!0}class Og{constructor(e,t){this.toDOM=e,this.spec=t||Pg,this.side=this.spec.side||0}map(e,t,n,s){let{pos:o,deleted:i}=e.mapResult(t.from+s,this.side<0?-1:1);return i?null:new Lg(o-n,o-n,this)}valid(){return!0}eq(e){return this==e||e instanceof Og&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&_g(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Dg{constructor(e,t){this.attrs=e,this.spec=t||Pg}map(e,t,n,s){let o=e.map(t.from+s,this.spec.inclusiveStart?-1:1)-n,i=e.map(t.to+s,this.spec.inclusiveEnd?1:-1)-n;return o>=i?null:new Lg(o,i,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof Dg&&_g(this.attrs,e.attrs)&&_g(this.spec,e.spec)}static is(e){return e.type instanceof Dg}destroy(){}}class Bg{constructor(e,t){this.attrs=e,this.spec=t||Pg}map(e,t,n,s){let o=e.mapResult(t.from+s,1);if(o.deleted)return null;let i=e.mapResult(t.to+s,-1);return i.deleted||i.pos<=o.pos?null:new Lg(o.pos-n,i.pos-n,this)}valid(e,t){let n,{index:s,offset:o}=e.content.findIndex(t.from);return o==t.from&&!(n=e.child(s)).isText&&o+n.nodeSize==t.to}eq(e){return this==e||e instanceof Bg&&_g(this.attrs,e.attrs)&&_g(this.spec,e.spec)}destroy(){}}class Lg{constructor(e,t,n){this.from=e,this.to=t,this.type=n}copy(e,t){return new Lg(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,n){return this.type.map(e,this,t,n)}static widget(e,t,n){return new Lg(e,e,new Og(t,n))}static inline(e,t,n,s){return new Lg(e,t,new Dg(n,s))}static node(e,t,n,s){return new Lg(e,t,new Bg(n,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof Dg}get widget(){return this.type instanceof Og}}const Fg=[],Pg={};class $g{constructor(e,t){this.local=e.length?e:Fg,this.children=t.length?t:Fg}static create(e,t){return t.length?Hg(t,e,0,Pg):Ug}find(e,t,n){let s=[];return this.findInner(null==e?0:e,null==t?1e9:t,s,0,n),s}findInner(e,t,n,s,o){for(let i=0;i<this.local.length;i++){let r=this.local[i];r.from<=t&&r.to>=e&&(!o||o(r.spec))&&n.push(r.copy(r.from+s,r.to+s))}for(let i=0;i<this.children.length;i+=3)if(this.children[i]<t&&this.children[i+1]>e){let r=this.children[i]+1;this.children[i+2].findInner(e-r,t-r,n,s+r,o)}}map(e,t,n){return this==Ug||0==e.maps.length?this:this.mapInner(e,t,0,0,n||Pg)}mapInner(e,t,n,s,o){let i;for(let r=0;r<this.local.length;r++){let a=this.local[r].map(e,n,s);a&&a.type.valid(t,a)?(i||(i=[])).push(a):o.onRemove&&o.onRemove(this.local[r].spec)}return this.children.length?function(e,t,n,s,o,i,r){let a=e.slice();for(let c=0,u=i;c<n.maps.length;c++){let e=0;n.maps[c].forEach((t,n,s,o)=>{let i=o-s-(n-t);for(let r=0;r<a.length;r+=3){let s=a[r+1];if(s<0||t>s+u-e)continue;let o=a[r]+u-e;n>=o?a[r+1]=t<=o?-2:-1:t>=u&&i&&(a[r]+=i,a[r+1]+=i)}e+=i}),u=n.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(-2==a[c+1]){l=!0,a[c+1]=-1;continue}let t=n.map(e[c]+i),u=t-o;if(u<0||u>=s.content.size){l=!0;continue}let d=n.map(e[c+1]+i,-1)-o,{index:p,offset:h}=s.content.findIndex(u),f=s.maybeChild(p);if(f&&h==u&&h+f.nodeSize==d){let s=a[c+2].mapInner(n,f,t+1,e[c]+i+1,r);s!=Ug?(a[c]=u,a[c+1]=d,a[c+2]=s):(a[c+1]=-2,l=!0)}else l=!0}if(l){let l=function(e,t,n,s,o,i,r){function a(e,t){for(let i=0;i<e.local.length;i++){let a=e.local[i].map(s,o,t);a?n.push(a):r.onRemove&&r.onRemove(e.local[i].spec)}for(let n=0;n<e.children.length;n+=3)a(e.children[n+2],e.children[n]+t+1)}for(let l=0;l<e.length;l+=3)-1==e[l+1]&&a(e[l+2],t[l]+i+1);return n}(a,e,t,n,o,i,r),c=Hg(l,s,0,r);t=c.local;for(let e=0;e<a.length;e+=3)a[e+1]<0&&(a.splice(e,3),e-=3);for(let e=0,t=0;e<c.children.length;e+=3){let n=c.children[e];for(;t<a.length&&a[t]<n;)t+=3;a.splice(t,0,c.children[e],c.children[e+1],c.children[e+2])}}return new $g(t.sort(Kg),a)}(this.children,i||[],e,t,n,s,o):i?new $g(i.sort(Kg),Fg):Ug}add(e,t){return t.length?this==Ug?$g.create(e,t):this.addInner(e,t,0):this}addInner(e,t,n){let s,o=0;e.forEach((e,i)=>{let r,a=i+n;if(r=Gg(t,e,a)){for(s||(s=this.children.slice());o<s.length&&s[o]<i;)o+=3;s[o]==i?s[o+2]=s[o+2].addInner(e,r,a+1):s.splice(o,0,i,i+e.nodeSize,Hg(r,e,a+1,Pg)),o+=3}});let i=Wg(o?zg(t):t,-n);for(let r=0;r<i.length;r++)i[r].type.valid(e,i[r])||i.splice(r--,1);return new $g(i.length?this.local.concat(i).sort(Kg):this.local,s||this.children)}remove(e){return 0==e.length||this==Ug?this:this.removeInner(e,0)}removeInner(e,t){let n=this.children,s=this.local;for(let o=0;o<n.length;o+=3){let s,i=n[o]+t,r=n[o+1]+t;for(let t,n=0;n<e.length;n++)(t=e[n])&&t.from>i&&t.to<r&&(e[n]=null,(s||(s=[])).push(t));if(!s)continue;n==this.children&&(n=this.children.slice());let a=n[o+2].removeInner(s,i+1);a!=Ug?n[o+2]=a:(n.splice(o,3),o-=3)}if(s.length)for(let o,i=0;i<e.length;i++)if(o=e[i])for(let e=0;e<s.length;e++)s[e].eq(o,t)&&(s==this.local&&(s=this.local.slice()),s.splice(e--,1));return n==this.children&&s==this.local?this:s.length||n.length?new $g(s,n):Ug}forChild(e,t){if(this==Ug)return this;if(t.isLeaf)return $g.empty;let n,s;for(let r=0;r<this.children.length;r+=3)if(this.children[r]>=e){this.children[r]==e&&(n=this.children[r+2]);break}let o=e+1,i=o+t.content.size;for(let r=0;r<this.local.length;r++){let e=this.local[r];if(e.from<i&&e.to>o&&e.type instanceof Dg){let t=Math.max(o,e.from)-o,n=Math.min(i,e.to)-o;t<n&&(s||(s=[])).push(e.copy(t,n))}}if(s){let e=new $g(s.sort(Kg),Fg);return n?new Vg([e,n]):e}return n||Ug}eq(e){if(this==e)return!0;if(!(e instanceof $g)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return jg(this.localsInner(e))}localsInner(e){if(this==Ug)return Fg;if(e.inlineContent||!this.local.some(Dg.is))return this.local;let t=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof Dg||t.push(this.local[n]);return t}forEachSet(e){e(this)}}$g.empty=new $g([],[]),$g.removeOverlap=jg;const Ug=$g.empty;class Vg{constructor(e){this.members=e}map(e,t){const n=this.members.map(n=>n.map(e,t,Pg));return Vg.from(n)}forChild(e,t){if(t.isLeaf)return $g.empty;let n=[];for(let s=0;s<this.members.length;s++){let o=this.members[s].forChild(e,t);o!=Ug&&(o instanceof Vg?n=n.concat(o.members):n.push(o))}return Vg.from(n)}eq(e){if(!(e instanceof Vg)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,n=!0;for(let s=0;s<this.members.length;s++){let o=this.members[s].localsInner(e);if(o.length)if(t){n&&(t=t.slice(),n=!1);for(let e=0;e<o.length;e++)t.push(o[e])}else t=o}return t?jg(n?t:t.sort(Kg)):Fg}static from(e){switch(e.length){case 0:return Ug;case 1:return e[0];default:return new Vg(e.every(e=>e instanceof $g)?e:e.reduce((e,t)=>e.concat(t instanceof $g?t:t.members),[]))}}forEachSet(e){for(let t=0;t<this.members.length;t++)this.members[t].forEachSet(e)}}function Wg(e,t){if(!t||!e.length)return e;let n=[];for(let s=0;s<e.length;s++){let o=e[s];n.push(new Lg(o.from+t,o.to+t,o.type))}return n}function Gg(e,t,n){if(t.isLeaf)return null;let s=n+t.nodeSize,o=null;for(let i,r=0;r<e.length;r++)(i=e[r])&&i.from>n&&i.to<s&&((o||(o=[])).push(i),e[r]=null);return o}function zg(e){let t=[];for(let n=0;n<e.length;n++)null!=e[n]&&t.push(e[n]);return t}function Hg(e,t,n,s){let o=[],i=!1;t.forEach((t,r)=>{let a=Gg(e,t,r+n);if(a){i=!0;let e=Hg(a,t,n+r+1,s);e!=Ug&&o.push(r,r+t.nodeSize,e)}});let r=Wg(i?zg(e):e,-n).sort(Kg);for(let a=0;a<r.length;a++)r[a].type.valid(t,r[a])||(s.onRemove&&s.onRemove(r[a].spec),r.splice(a--,1));return r.length||o.length?new $g(r,o):Ug}function Kg(e,t){return e.from-t.from||e.to-t.to}function jg(e){let t=e;for(let n=0;n<t.length-1;n++){let s=t[n];if(s.from!=s.to)for(let o=n+1;o<t.length;o++){let i=t[o];if(i.from!=s.from){i.from<s.to&&(t==e&&(t=e.slice()),t[n]=s.copy(s.from,i.from),Yg(t,o,s.copy(i.from,s.to)));break}i.to!=s.to&&(t==e&&(t=e.slice()),t[o]=i.copy(i.from,s.to),Yg(t,o+1,i.copy(s.to,i.to)))}}return t}function Yg(e,t,n){for(;t<e.length&&Kg(n,e[t])>0;)t++;e.splice(t,0,n)}function Zg(e){let t=[];return e.someProp("decorations",n=>{let s=n(e.state);s&&s!=Ug&&t.push(s)}),e.cursorWrapper&&t.push($g.create(e.state.doc,[e.cursorWrapper.deco])),Vg.from(t)}const Xg={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Jg=yf&&vf<=11;class Qg{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class qg{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new Qg,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(e=>{for(let t=0;t<e.length;t++)this.queue.push(e[t]);yf&&vf<=11&&e.some(e=>"childList"==e.type&&e.removedNodes.length||"characterData"==e.type&&e.oldValue.length>e.target.nodeValue.length)?this.flushSoon():this.flush()}),Jg&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Xg)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(Mm(this.view)){if(this.suppressingSelectionUpdates)return Sm(this.view);if(yf&&vf<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&sf(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t,n=new Set;for(let o=e.focusNode;o;o=ef(o))n.add(o);for(let o=e.anchorNode;o;o=ef(o))if(n.has(o)){t=o;break}let s=t&&this.view.docView.nearestDesc(t);return s&&s.ignoreMutation({type:"selection",target:3==t.nodeType?t.parentNode:t})?(this.setCurSelection(),!0):void 0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let n=e.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&Mm(e)&&!this.ignoreSelectionChange(n),o=-1,i=-1,r=!1,a=[];if(e.editable)for(let c=0;c<t.length;c++){let e=this.registerMutation(t[c],a);e&&(o=o<0?e.from:Math.min(e.from,o),i=i<0?e.to:Math.max(e.to,i),e.typeOver&&(r=!0))}if(bf&&a.length){let t=a.filter(e=>"BR"==e.nodeName);if(2==t.length){let[e,n]=t;e.parentNode&&e.parentNode.parentNode==n.parentNode?n.remove():e.remove()}else{let{focusNode:n}=this.currentSelection;for(let s of t){let t=s.parentNode;!t||"LI"!=t.nodeName||n&&sy(e,n)==t||s.remove()}}}else if((wf||Cf)&&a.some(e=>"BR"==e.nodeName)&&(8==e.input.lastKeyCode||46==e.input.lastKeyCode))for(let c of a)if("BR"==c.nodeName&&c.parentNode){let e=c.nextSibling;e&&1==e.nodeType&&"false"==e.contentEditable&&c.parentNode.removeChild(c)}let l=null;o<0&&s&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&cf(n)&&(l=km(e))&&l.eq(rh.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Sm(e),this.currentSelection.set(n),e.scrollToSelection()):(o>-1||s)&&(o>-1&&(e.docView.markDirty(o,i),function(e){if(ey.has(e))return;if(ey.set(e,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(e.dom).whiteSpace)){if(e.requiresGeckoHackNode=bf,ty)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),ty=!0}}(e)),this.handleDOMChange(o,i,r,a),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||Sm(e),this.currentSelection.set(n))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if("attributes"==e.type&&(n==this.view.docView||"contenteditable"==e.attributeName||"style"==e.attributeName&&!e.oldValue&&!e.target.getAttribute("style")))return null;if(!n||n.ignoreMutation(e))return null;if("childList"==e.type){for(let n=0;n<e.addedNodes.length;n++){let s=e.addedNodes[n];t.push(s),3==s.nodeType&&(this.lastChangedTextNode=s)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let s=e.previousSibling,o=e.nextSibling;if(yf&&vf<=11&&e.addedNodes.length)for(let t=0;t<e.addedNodes.length;t++){let{previousSibling:n,nextSibling:i}=e.addedNodes[t];(!n||Array.prototype.indexOf.call(e.addedNodes,n)<0)&&(s=n),(!i||Array.prototype.indexOf.call(e.addedNodes,i)<0)&&(o=i)}let i=s&&s.parentNode==e.target?qh(s)+1:0,r=n.localPosFromDOM(e.target,i,-1),a=o&&o.parentNode==e.target?qh(o):e.target.childNodes.length;return{from:r,to:n.localPosFromDOM(e.target,a,1)}}return"attributes"==e.type?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=e.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let ey=new WeakMap,ty=!1;function ny(e,t){let n=t.startContainer,s=t.startOffset,o=t.endContainer,i=t.endOffset,r=e.domAtPos(e.state.selection.anchor);return sf(r.node,r.offset,o,i)&&([n,s,o,i]=[o,i,n,s]),{anchorNode:n,anchorOffset:s,focusNode:o,focusOffset:i}}function sy(e,t){for(let n=t.parentNode;n&&n!=e.dom;n=n.parentNode){let t=e.docView.nearestDesc(n,!0);if(t&&t.node.isBlock)return n}return null}function oy(e){let t=e.pmViewDesc;if(t)return t.parseRule();if("BR"==e.nodeName&&e.parentNode){if(Cf&&/^(ul|ol)$/i.test(e.parentNode.nodeName)){let e=document.createElement("div");return e.appendChild(document.createElement("li")),{skip:e}}if(e.parentNode.lastChild==e||Cf&&/^(tr|table)$/i.test(e.parentNode.nodeName))return{ignore:!0}}else if("IMG"==e.nodeName&&e.getAttribute("mark-placeholder"))return{ignore:!0};return null}const iy=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function ry(e,t,n,s,o){let i=e.input.compositionPendingChanges||(e.composing?e.input.compositionID:0);if(e.input.compositionPendingChanges=0,t<0){let t=e.input.lastSelectionTime>Date.now()-50?e.input.lastSelectionOrigin:null,n=km(e,t);if(n&&!e.state.selection.eq(n)){if(wf&&xf&&13===e.input.lastKeyCode&&Date.now()-100<e.input.lastKeyCodeTime&&e.someProp("handleKeyDown",t=>t(e,uf(13,"Enter"))))return;let s=e.state.tr.setSelection(n);"pointer"==t?s.setMeta("pointer",!0):"key"==t&&s.scrollIntoView(),i&&s.setMeta("composition",i),e.dispatch(s)}return}let r=e.state.doc.resolve(t),a=r.sharedDepth(n);t=r.before(a+1),n=e.state.doc.resolve(n).after(a+1);let l,c,u=e.state.selection,d=function(e,t,n){let s,{node:o,fromOffset:i,toOffset:r,from:a,to:l}=e.docView.parseRange(t,n),c=e.domSelectionRange(),u=c.anchorNode;if(u&&e.dom.contains(1==u.nodeType?u:u.parentNode)&&(s=[{node:u,offset:c.anchorOffset}],cf(c)||s.push({node:c.focusNode,offset:c.focusOffset})),wf&&8===e.input.lastKeyCode)for(let g=r;g>i;g--){let e=o.childNodes[g-1],t=e.pmViewDesc;if("BR"==e.nodeName&&!t){r=g;break}if(!t||t.size)break}let d=e.state.doc,p=e.someProp("domParser")||qd.fromSchema(e.state.schema),h=d.resolve(a),f=null,m=p.parse(o,{topNode:h.parent,topMatch:h.parent.contentMatchAt(h.index()),topOpen:!0,from:i,to:r,preserveWhitespace:"pre"!=h.parent.type.whitespace||"full",findPositions:s,ruleFromNode:oy,context:h});if(s&&null!=s[0].pos){let e=s[0].pos,t=s[1]&&s[1].pos;null==t&&(t=e),f={anchor:e+a,head:t+a}}return{doc:m,sel:f,from:a,to:l}}(e,t,n),p=e.state.doc,h=p.slice(d.from,d.to);8===e.input.lastKeyCode&&Date.now()-100<e.input.lastKeyCodeTime?(l=e.state.selection.to,c="end"):(l=e.state.selection.from,c="start"),e.input.lastKeyCode=null;let f=function(e,t,n,s,o){let i=e.findDiffStart(t,n);if(null==i)return null;let{a:r,b:a}=e.findDiffEnd(t,n+e.size,n+t.size);if("end"==o){s-=r+Math.max(0,i-Math.min(r,a))-i}if(r<i&&e.size<t.size){let e=s<=i&&s>=r?i-s:0;i-=e,i&&i<t.size&&cy(t.textBetween(i-1,i+1))&&(i+=e?1:-1),a=i+(a-r),r=i}else if(a<i){let t=s<=i&&s>=a?i-s:0;i-=t,i&&i<e.size&&cy(e.textBetween(i-1,i+1))&&(i+=t?1:-1),r=i+(r-a),a=i}return{start:i,endA:r,endB:a}}(h.content,d.doc.content,d.from,l,c);if(f&&e.input.domChangeCount++,(Tf&&e.input.lastIOSEnter>Date.now()-225||xf)&&o.some(e=>1==e.nodeType&&!iy.test(e.nodeName))&&(!f||f.endA>=f.endB)&&e.someProp("handleKeyDown",t=>t(e,uf(13,"Enter"))))return void(e.input.lastIOSEnter=0);if(!f){if(!(s&&u instanceof uh&&!u.empty&&u.$head.sameParent(u.$anchor))||e.composing||d.sel&&d.sel.anchor!=d.sel.head){if(d.sel){let t=ay(e,e.state.doc,d.sel);if(t&&!t.eq(e.state.selection)){let n=e.state.tr.setSelection(t);i&&n.setMeta("composition",i),e.dispatch(n)}}return}f={start:u.from,endA:u.to,endB:u.to}}e.state.selection.from<e.state.selection.to&&f.start==f.endB&&e.state.selection instanceof uh&&(f.start>e.state.selection.from&&f.start<=e.state.selection.from+2&&e.state.selection.from>=d.from?f.start=e.state.selection.from:f.endA<e.state.selection.to&&f.endA>=e.state.selection.to-2&&e.state.selection.to<=d.to&&(f.endB+=e.state.selection.to-f.endA,f.endA=e.state.selection.to)),yf&&vf<=11&&f.endB==f.start+1&&f.endA==f.start&&f.start>d.from&&" Â "==d.doc.textBetween(f.start-d.from-1,f.start-d.from+1)&&(f.start--,f.endA--,f.endB--);let m=d.doc.resolveNoCache(f.start-d.from),g=d.doc.resolveNoCache(f.endB-d.from),y=p.resolve(f.start),v=m.sameParent(g)&&m.parent.inlineContent&&y.end()>=f.endA;if((Tf&&e.input.lastIOSEnter>Date.now()-225&&(!v||o.some(e=>"DIV"==e.nodeName||"P"==e.nodeName))||!v&&m.pos<d.doc.content.size&&(!m.sameParent(g)||!m.parent.inlineContent)&&m.pos<g.pos&&!/\S/.test(d.doc.textBetween(m.pos,g.pos,"","")))&&e.someProp("handleKeyDown",t=>t(e,uf(13,"Enter"))))return void(e.input.lastIOSEnter=0);if(e.state.selection.anchor>f.start&&function(e,t,n,s,o){if(n-t<=o.pos-s.pos||ly(s,!0,!1)<o.pos)return!1;let i=e.resolve(t);if(!s.parent.isTextblock){let e=i.nodeAfter;return null!=e&&n==t+e.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let r=e.resolve(ly(i,!0,!0));return!(!r.parent.isTextblock||r.pos>n||ly(r,!0,!1)<n)&&s.parent.content.cut(s.parentOffset).eq(r.parent.content)}(p,f.start,f.endA,m,g)&&e.someProp("handleKeyDown",t=>t(e,uf(8,"Backspace"))))return void(xf&&wf&&e.domObserver.suppressSelectionUpdates());wf&&f.endB==f.start&&(e.input.lastChromeDelete=Date.now()),xf&&!v&&m.start()!=g.start()&&0==g.parentOffset&&m.depth==g.depth&&d.sel&&d.sel.anchor==d.sel.head&&d.sel.head==f.endA&&(f.endB-=2,g=d.doc.resolveNoCache(f.endB-d.from),setTimeout(()=>{e.someProp("handleKeyDown",function(t){return t(e,uf(13,"Enter"))})},20));let b,k=f.start,w=f.endA,S=t=>{let n=t||e.state.tr.replace(k,w,d.doc.slice(f.start-d.from,f.endB-d.from));if(d.sel){let t=ay(e,n.doc,d.sel);t&&!(wf&&e.composing&&t.empty&&(f.start!=f.endB||e.input.lastChromeDelete<Date.now()-100)&&(t.head==k||t.head==n.mapping.map(w)-1)||yf&&t.empty&&t.head==k)&&n.setSelection(t)}return i&&n.setMeta("composition",i),n.scrollIntoView()};if(v)if(m.pos==g.pos){yf&&vf<=11&&0==m.parentOffset&&(e.domObserver.suppressSelectionUpdates(),setTimeout(()=>Sm(e),20));let t=S(e.state.tr.delete(k,w)),n=p.resolve(f.start).marksAcross(p.resolve(f.endA));n&&t.ensureMarks(n),e.dispatch(t)}else if(f.endA==f.endB&&(b=function(e,t){let n,s,o,i=e.firstChild.marks,r=t.firstChild.marks,a=i,l=r;for(let u=0;u<r.length;u++)a=r[u].removeFromSet(a);for(let u=0;u<i.length;u++)l=i[u].removeFromSet(l);if(1==a.length&&0==l.length)s=a[0],n="add",o=e=>e.mark(s.addToSet(e.marks));else{if(0!=a.length||1!=l.length)return null;s=l[0],n="remove",o=e=>e.mark(s.removeFromSet(e.marks))}let c=[];for(let u=0;u<t.childCount;u++)c.push(o(t.child(u)));if(ld.from(c).eq(e))return{mark:s,type:n}}(m.parent.content.cut(m.parentOffset,g.parentOffset),y.parent.content.cut(y.parentOffset,f.endA-y.start())))){let t=S(e.state.tr);"add"==b.type?t.addMark(k,w,b.mark):t.removeMark(k,w,b.mark),e.dispatch(t)}else if(m.parent.child(m.index()).isText&&m.index()==g.index()-(g.textOffset?0:1)){let t=m.parent.textBetween(m.parentOffset,g.parentOffset),n=()=>S(e.state.tr.insertText(t,k,w));e.someProp("handleTextInput",s=>s(e,k,w,t,n))||e.dispatch(n())}else e.dispatch(S());else e.dispatch(S())}function ay(e,t,n){return Math.max(n.anchor,n.head)>t.content.size?null:Nm(e,t.resolve(n.anchor),t.resolve(n.head))}function ly(e,t,n){let s=e.depth,o=t?e.end():e.pos;for(;s>0&&(t||e.indexAfter(s)==e.node(s).childCount);)s--,o++,t=!1;if(n){let t=e.node(s).maybeChild(e.indexAfter(s));for(;t&&!t.isLeaf;)t=t.firstChild,o++}return o}function cy(e){if(2!=e.length)return!1;let t=e.charCodeAt(0),n=e.charCodeAt(1);return t>=56320&&t<=57343&&n>=55296&&n<=56319}class uy{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new rg,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(my),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):"function"==typeof e?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=hy(this),py(this),this.nodeViews=fy(this),this.docView=om(this.state.doc,dy(this),Zg(this),this.dom,this),this.domObserver=new qg(this,(e,t,n,s)=>ry(this,e,t,n,s)),this.domObserver.start(),function(e){for(let t in sg){let n=sg[t];e.dom.addEventListener(t,e.input.eventHandlers[t]=t=>{!ug(e,t)||cg(e,t)||!e.editable&&t.type in og||n(e,t)},ig[t]?{passive:!0}:void 0)}Cf&&e.dom.addEventListener("input",()=>null),lg(e)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&lg(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(my),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let n in this._props)t[n]=this._props[n];t.state=this.state;for(let n in e)t[n]=e[n];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){var n;let s=this.state,o=!1,i=!1;e.storedMarks&&this.composing&&(Cg(this),i=!0),this.state=e;let r=s.plugins!=e.plugins||this._props.plugins!=t.plugins;if(r||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let e=fy(this);(function(e,t){let n=0,s=0;for(let o in e){if(e[o]!=t[o])return!0;n++}for(let o in t)s++;return n!=s})(e,this.nodeViews)&&(this.nodeViews=e,o=!0)}(r||t.handleDOMEvents!=this._props.handleDOMEvents)&&lg(this),this.editable=hy(this),py(this);let a=Zg(this),l=dy(this),c=s.plugins==e.plugins||s.doc.eq(e.doc)?e.scrollToSelection>s.scrollToSelection?"to selection":"preserve":"reset",u=o||!this.docView.matchesNode(e.doc,l,a);!u&&e.selection.eq(s.selection)||(i=!0);let d="preserve"==c&&i&&null==this.dom.style.overflowAnchor&&function(e){let t,n,s=e.dom.getBoundingClientRect(),o=Math.max(0,s.top);for(let i=(s.left+s.right)/2,r=o+1;r<Math.min(innerHeight,s.bottom);r+=5){let s=e.root.elementFromPoint(i,r);if(!s||s==e.dom||!e.dom.contains(s))continue;let a=s.getBoundingClientRect();if(a.top>=o-20){t=s,n=a.top;break}}return{refDOM:t,refTop:n,stack:Df(e.dom)}}(this);if(i){this.domObserver.stop();let t=u&&(yf||wf)&&!this.composing&&!s.selection.empty&&!e.selection.empty&&function(e,t){let n=Math.min(e.$anchor.sharedDepth(e.head),t.$anchor.sharedDepth(t.head));return e.$anchor.start(n)!=t.$anchor.start(n)}(s.selection,e.selection);if(u){let n=wf?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=Tg(this)),!o&&this.docView.update(e.doc,l,a,this)||(this.docView.updateOuterDeco(l),this.docView.destroy(),this.docView=om(e.doc,l,a,this.dom,this)),n&&!this.trackWrites&&(t=!0)}t||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&function(e){let t=e.docView.domFromPos(e.state.selection.anchor,0),n=e.domSelectionRange();return sf(t.node,t.offset,n.anchorNode,n.anchorOffset)}(this))?Sm(this,t):(xm(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),(null===(n=this.dragging)||void 0===n?void 0:n.node)&&!s.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,s),"reset"==c?this.dom.scrollTop=0:"to selection"==c?this.scrollToSelection():d&&function({refDOM:e,refTop:t,stack:n}){let s=e?e.getBoundingClientRect().top:0;Bf(n,0==s?0:s-t)}(d)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(e&&this.dom.contains(1==e.nodeType?e:e.parentNode))if(this.someProp("handleScrollToSelection",e=>e(this)));else if(this.state.selection instanceof ph){let t=this.docView.domAfterPos(this.state.selection.from);1==t.nodeType&&Of(this,t.getBoundingClientRect(),e)}else Of(this,this.coordsAtPos(this.state.selection.head,1),e);else;}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(e&&e.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let t=0;t<this.pluginViews.length;t++){let n=this.pluginViews[t];n.update&&n.update(this,e)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let e=0;e<this.directPlugins.length;e++){let t=this.directPlugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}for(let e=0;e<this.state.plugins.length;e++){let t=this.state.plugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}}}updateDraggedNode(e,t){let n=e.node,s=-1;if(this.state.doc.nodeAt(n.from)==n.node)s=n.from;else{let e=n.from+(this.state.doc.content.size-t.doc.content.size);(e>0&&this.state.doc.nodeAt(e))==n.node&&(s=e)}this.dragging=new Ng(e.slice,e.move,s<0?void 0:ph.create(this.state.doc,s))}someProp(e,t){let n,s=this._props&&this._props[e];if(null!=s&&(n=t?t(s):s))return n;for(let i=0;i<this.directPlugins.length;i++){let s=this.directPlugins[i].props[e];if(null!=s&&(n=t?t(s):s))return n}let o=this.state.plugins;if(o)for(let i=0;i<o.length;i++){let s=o[i].props[e];if(null!=s&&(n=t?t(s):s))return n}}hasFocus(){if(yf){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if("false"==e.contentEditable)return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function(e){if(e.setActive)return e.setActive();if(Lf)return e.focus(Lf);let t=Df(e);e.focus(null==Lf?{get preventScroll(){return Lf={preventScroll:!0},!0}}:void 0),Lf||(Lf=!1,Bf(t,0))}(this.dom),Sm(this),this.domObserver.start()}get root(){let e=this._root;if(null==e)for(let t=this.dom.parentNode;t;t=t.parentNode)if(9==t.nodeType||11==t.nodeType&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t;return e||document}updateRoot(){this._root=null}posAtCoords(e){return Uf(this,e)}coordsAtPos(e,t=1){return zf(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,n=-1){let s=this.docView.posFromDOM(e,t,n);if(null==s)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(e,t){return Qf(this,t||this.state,e)}pasteHTML(e,t){return xg(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return xg(this,e,null,!0,t||new ClipboardEvent("paste"))}serializeForClipboard(e){return Hm(this,e)}destroy(){this.docView&&(!function(e){e.domObserver.stop();for(let t in e.input.eventHandlers)e.dom.removeEventListener(t,e.input.eventHandlers[t]);clearTimeout(e.input.composingTimeout),clearTimeout(e.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Zg(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,tf=null)}get isDestroyed(){return null==this.docView}dispatchEvent(e){return function(e,t){cg(e,t)||!sg[t.type]||!e.editable&&t.type in og||sg[t.type](e,t)}(this,e)}domSelectionRange(){let e=this.domSelection();return e?Cf&&11===this.root.nodeType&&function(e){let t=e.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}(this.dom.ownerDocument)==this.dom&&function(e,t){if(t.getComposedRanges){let n=t.getComposedRanges(e.root)[0];if(n)return ny(e,n)}let n;function s(e){e.preventDefault(),e.stopImmediatePropagation(),n=e.getTargetRanges()[0]}return e.dom.addEventListener("beforeinput",s,!0),document.execCommand("indent"),e.dom.removeEventListener("beforeinput",s,!0),n?ny(e,n):null}(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}function dy(e){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(e.editable),e.someProp("attributes",n=>{if("function"==typeof n&&(n=n(e.state)),n)for(let e in n)"class"==e?t.class+=" "+n[e]:"style"==e?t.style=(t.style?t.style+";":"")+n[e]:t[e]||"contenteditable"==e||"nodeName"==e||(t[e]=String(n[e]))}),t.translate||(t.translate="no"),[Lg.node(0,e.state.doc.content.size,t)]}function py(e){if(e.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),e.cursorWrapper={dom:t,deco:Lg.widget(e.state.selection.from,t,{raw:!0,marks:e.markCursor})}}else e.cursorWrapper=null}function hy(e){return!e.someProp("editable",t=>!1===t(e.state))}function fy(e){let t=Object.create(null);function n(e){for(let n in e)Object.prototype.hasOwnProperty.call(t,n)||(t[n]=e[n])}return e.someProp("nodeViews",n),e.someProp("markViews",n),t}function my(e){if(e.spec.state||e.spec.filterTransaction||e.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}uy.prototype.dispatch=function(e){let t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))};for(var gy={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},yy={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},vy="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),by="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),ky=0;ky<10;ky++)gy[48+ky]=gy[96+ky]=String(ky);for(ky=1;ky<=24;ky++)gy[ky+111]="F"+ky;for(ky=65;ky<=90;ky++)gy[ky]=String.fromCharCode(ky+32),yy[ky]=String.fromCharCode(ky);for(var wy in gy)yy.hasOwnProperty(wy)||(yy[wy]=gy[wy]);const Sy="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),Cy="undefined"!=typeof navigator&&/Win/.test(navigator.platform);function Ty(e){let t,n,s,o,i=e.split(/-(?!$)/),r=i[i.length-1];"Space"==r&&(r=" ");for(let a=0;a<i.length-1;a++){let e=i[a];if(/^(cmd|meta|m)$/i.test(e))o=!0;else if(/^a(lt)?$/i.test(e))t=!0;else if(/^(c|ctrl|control)$/i.test(e))n=!0;else if(/^s(hift)?$/i.test(e))s=!0;else{if(!/^mod$/i.test(e))throw new Error("Unrecognized modifier name: "+e);Sy?o=!0:n=!0}}return t&&(r="Alt-"+r),n&&(r="Ctrl-"+r),o&&(r="Meta-"+r),s&&(r="Shift-"+r),r}function Ey(e,t,n=!0){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),n&&t.shiftKey&&(e="Shift-"+e),e}function Iy(e){let t=function(e){let t=Object.create(null);for(let n in e)t[Ty(n)]=e[n];return t}(e);return function(e,n){let s,o=function(e){var t=!(vy&&e.metaKey&&e.shiftKey&&!e.ctrlKey&&!e.altKey||by&&e.shiftKey&&e.key&&1==e.key.length||"Unidentified"==e.key)&&e.key||(e.shiftKey?yy:gy)[e.keyCode]||e.key||"Unidentified";return"Esc"==t&&(t="Escape"),"Del"==t&&(t="Delete"),"Left"==t&&(t="ArrowLeft"),"Up"==t&&(t="ArrowUp"),"Right"==t&&(t="ArrowRight"),"Down"==t&&(t="ArrowDown"),t}(n),i=t[Ey(o,n)];if(i&&i(e.state,e.dispatch,e))return!0;if(1==o.length&&" "!=o){if(n.shiftKey){let s=t[Ey(o,n,!1)];if(s&&s(e.state,e.dispatch,e))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(Cy&&n.ctrlKey&&n.altKey)&&(s=gy[n.keyCode])&&s!=o){let o=t[Ey(s,n)];if(o&&o(e.state,e.dispatch,e))return!0}}return!1}}var xy=Object.defineProperty,Ay=(e,t)=>{for(var n in t)xy(e,n,{get:t[n],enumerable:!0})};function Ny(e){const{state:t,transaction:n}=e;let{selection:s}=n,{doc:o}=n,{storedMarks:i}=n;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return i},get selection(){return s},get doc(){return o},get tr(){return s=n.selection,o=n.doc,i=n.storedMarks,n}}}var My=class{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:s}=t,{tr:o}=n,i=this.buildProps(o);return Object.fromEntries(Object.entries(e).map(([e,t])=>[e,(...e)=>{const n=t(...e)(i);return o.getMeta("preventDispatch")||this.hasCustomState||s.dispatch(o),n}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:s,state:o}=this,{view:i}=s,r=[],a=!!e,l=e||o.tr,c={...Object.fromEntries(Object.entries(n).map(([e,n])=>[e,(...e)=>{const s=this.buildProps(l,t),o=n(...e)(s);return r.push(o),c}])),run:()=>(a||!t||l.getMeta("preventDispatch")||this.hasCustomState||i.dispatch(l),r.every(e=>!0===e))};return c}createCan(e){const{rawCommands:t,state:n}=this,s=!1,o=e||n.tr,i=this.buildProps(o,s);return{...Object.fromEntries(Object.entries(t).map(([e,t])=>[e,(...e)=>t(...e)({...i,dispatch:void 0})])),chain:()=>this.createChain(o,s)}}buildProps(e,t=!0){const{rawCommands:n,editor:s,state:o}=this,{view:i}=s,r={tr:e,editor:s,view:i,state:Ny({state:o,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e,t),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map(([e,t])=>[e,(...e)=>t(...e)(r)]))}};return r}},Ry={};Ay(Ry,{blur:()=>_y,clearContent:()=>Oy,clearNodes:()=>Dy,command:()=>By,createParagraphNear:()=>Ly,cut:()=>Fy,deleteCurrentNode:()=>Py,deleteNode:()=>Uy,deleteRange:()=>Vy,deleteSelection:()=>Wy,enter:()=>Gy,exitCode:()=>zy,extendMarkRange:()=>Jy,first:()=>Qy,focus:()=>sv,forEach:()=>ov,insertContent:()=>iv,insertContentAt:()=>cv,joinBackward:()=>pv,joinDown:()=>dv,joinForward:()=>hv,joinItemBackward:()=>fv,joinItemForward:()=>mv,joinTextblockBackward:()=>gv,joinTextblockForward:()=>yv,joinUp:()=>uv,keyboardShortcut:()=>bv,lift:()=>wv,liftEmptyBlock:()=>Sv,liftListItem:()=>Cv,newlineInCode:()=>Tv,resetAttributes:()=>xv,scrollIntoView:()=>Av,selectAll:()=>Nv,selectNodeBackward:()=>Mv,selectNodeForward:()=>Rv,selectParentNode:()=>_v,selectTextblockEnd:()=>Ov,selectTextblockStart:()=>Dv,setContent:()=>Lv,setMark:()=>gb,setMeta:()=>yb,setNode:()=>vb,setNodeSelection:()=>bb,setTextDirection:()=>kb,setTextSelection:()=>wb,sinkListItem:()=>Sb,splitBlock:()=>Tb,splitListItem:()=>Eb,toggleList:()=>Ab,toggleMark:()=>Nb,toggleNode:()=>Mb,toggleWrap:()=>Rb,undoInputRule:()=>_b,unsetAllMarks:()=>Ob,unsetMark:()=>Db,unsetTextDirection:()=>Bb,updateAttributes:()=>Lb,wrapIn:()=>Fb,wrapInList:()=>Pb});var _y=()=>({editor:e,view:t})=>(requestAnimationFrame(()=>{var n;e.isDestroyed||(t.dom.blur(),null==(n=null==window?void 0:window.getSelection())||n.removeAllRanges())}),!0),Oy=(e=!0)=>({commands:t})=>t.setContent("",{emitUpdate:e}),Dy=()=>({state:e,tr:t,dispatch:n})=>{const{selection:s}=t,{ranges:o}=s;return!n||(o.forEach(({$from:n,$to:s})=>{e.doc.nodesBetween(n.pos,s.pos,(e,n)=>{if(e.type.isText)return;const{doc:s,mapping:o}=t,i=s.resolve(o.map(n)),r=s.resolve(o.map(n+e.nodeSize)),a=i.blockRange(r);if(!a)return;const l=Dp(a);if(e.type.isTextblock){const{defaultType:e}=i.parent.contentMatchAt(i.index());t.setNodeMarkup(a.start,e)}(l||0===l)&&t.lift(a,l)})}),!0)},By=e=>t=>e(t),Ly=()=>({state:e,dispatch:t})=>Wh(e,t),Fy=(e,t)=>({editor:n,tr:s})=>{const{state:o}=n,i=o.doc.slice(e.from,e.to);s.deleteRange(e.from,e.to);const r=s.mapping.map(t);return s.insert(r,i.content),s.setSelection(new uh(s.doc.resolve(Math.max(r-1,0)))),!0},Py=()=>({tr:e,dispatch:t})=>{const{selection:n}=e,s=n.$anchor.node();if(s.content.size>0)return!1;const o=e.selection.$anchor;for(let i=o.depth;i>0;i-=1){if(o.node(i).type===s.type){if(t){const t=o.before(i),n=o.after(i);e.delete(t,n).scrollIntoView()}return!0}}return!1};function $y(e,t){if("string"==typeof e){if(!t.nodes[e])throw Error(`There is no node type named '${e}'. Maybe you forgot to add the extension?`);return t.nodes[e]}return e}var Uy=e=>({tr:t,state:n,dispatch:s})=>{const o=$y(e,n.schema),i=t.selection.$anchor;for(let e=i.depth;e>0;e-=1){if(i.node(e).type===o){if(s){const n=i.before(e),s=i.after(e);t.delete(n,s).scrollIntoView()}return!0}}return!1},Vy=e=>({tr:t,dispatch:n})=>{const{from:s,to:o}=e;return n&&t.delete(s,o),!0},Wy=()=>({state:e,dispatch:t})=>Nh(e,t),Gy=()=>({commands:e})=>e.keyboardShortcut("Enter"),zy=()=>({state:e,dispatch:t})=>((e,t)=>{let{$head:n,$anchor:s}=e.selection;if(!n.parent.type.spec.code||!n.sameParent(s))return!1;let o=n.node(-1),i=n.indexAfter(-1),r=Vh(o.contentMatchAt(i));if(!r||!o.canReplaceWith(i,i,r))return!1;if(t){let s=n.after(),o=e.tr.replaceWith(s,s,r.createAndFill());o.setSelection(rh.near(o.doc.resolve(s),1)),t(o.scrollIntoView())}return!0})(e,t);function Hy(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function Ky(e,t,n={strict:!0}){const s=Object.keys(t);return!s.length||s.every(s=>n.strict?t[s]===e[s]:Hy(t[s])?t[s].test(e[s]):t[s]===e[s])}function jy(e,t,n={}){return e.find(e=>e.type===t&&Ky(Object.fromEntries(Object.keys(n).map(t=>[t,e.attrs[t]])),n))}function Yy(e,t,n={}){return!!jy(e,t,n)}function Zy(e,t,n){var s;if(!e||!t)return;let o=e.parent.childAfter(e.parentOffset);if(o.node&&o.node.marks.some(e=>e.type===t)||(o=e.parent.childBefore(e.parentOffset)),!o.node||!o.node.marks.some(e=>e.type===t))return;n=n||(null==(s=o.node.marks[0])?void 0:s.attrs);if(!jy([...o.node.marks],t,n))return;let i=o.index,r=e.start()+o.offset,a=i+1,l=r+o.node.nodeSize;for(;i>0&&Yy([...e.parent.child(i-1).marks],t,n);)i-=1,r-=e.parent.child(i).nodeSize;for(;a<e.parent.childCount&&Yy([...e.parent.child(a).marks],t,n);)l+=e.parent.child(a).nodeSize,a+=1;return{from:r,to:l}}function Xy(e,t){if("string"==typeof e){if(!t.marks[e])throw Error(`There is no mark type named '${e}'. Maybe you forgot to add the extension?`);return t.marks[e]}return e}var Jy=(e,t={})=>({tr:n,state:s,dispatch:o})=>{const i=Xy(e,s.schema),{doc:r,selection:a}=n,{$from:l,from:c,to:u}=a;if(o){const e=Zy(l,i,t);if(e&&e.from<=c&&e.to>=u){const t=uh.create(r,e.from,e.to);n.setSelection(t)}}return!0},Qy=e=>t=>{const n="function"==typeof e?e(t):e;for(let e=0;e<n.length;e+=1)if(n[e](t))return!0;return!1};function qy(e){return e instanceof uh}function ev(e=0,t=0,n=0){return Math.min(Math.max(e,t),n)}function tv(e,t=null){if(!t)return null;const n=rh.atStart(e),s=rh.atEnd(e);if("start"===t||!0===t)return n;if("end"===t)return s;const o=n.from,i=s.to;return"all"===t?uh.create(e,ev(0,o,i),ev(e.content.size,o,i)):uh.create(e,ev(t,o,i),ev(t,o,i))}function nv(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var sv=(e=null,t={})=>({editor:n,view:s,tr:o,dispatch:i})=>{t={scrollIntoView:!0,...t};const r=()=>{(nv()||"Android"===navigator.platform||/android/i.test(navigator.userAgent))&&s.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(s.focus(),(null==t?void 0:t.scrollIntoView)&&n.commands.scrollIntoView())})};if(s.hasFocus()&&null===e||!1===e)return!0;if(i&&null===e&&!qy(n.state.selection))return r(),!0;const a=tv(o.doc,e)||n.state.selection,l=n.state.selection.eq(a);return i&&(l||o.setSelection(a),l&&o.storedMarks&&o.setStoredMarks(o.storedMarks),r()),!0},ov=(e,t)=>n=>e.every((e,s)=>t(e,{...n,index:s})),iv=(e,t)=>({tr:n,commands:s})=>s.insertContentAt({from:n.selection.from,to:n.selection.to},e,t),rv=e=>{const t=e.childNodes;for(let n=t.length-1;n>=0;n-=1){const s=t[n];3===s.nodeType&&s.nodeValue&&/^(\n\s\s|\n)$/.test(s.nodeValue)?e.removeChild(s):1===s.nodeType&&rv(s)}return e};function av(e){if("undefined"==typeof window)throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const t=`<body>${e}</body>`,n=(new window.DOMParser).parseFromString(t,"text/html").body;return rv(n)}function lv(e,t,n){if(e instanceof _d||e instanceof ld)return e;n={slice:!0,parseOptions:{},...n};const s="string"==typeof e;if("object"==typeof e&&null!==e)try{if(Array.isArray(e)&&e.length>0)return ld.fromArray(e.map(e=>t.nodeFromJSON(e)));const s=t.nodeFromJSON(e);return n.errorOnInvalidContent&&s.check(),s}catch(o){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:o});return console.warn("[tiptap warn]: Invalid content.","Passed value:",e,"Error:",o),lv("",t,n)}if(s){if(n.errorOnInvalidContent){let s=!1,o="";const i=new Jd({topNode:t.spec.topNode,marks:t.spec.marks,nodes:t.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:e=>(s=!0,o="string"==typeof e?e:e.outerHTML,null)}]}})});if(n.slice?qd.fromSchema(i).parseSlice(av(e),n.parseOptions):qd.fromSchema(i).parse(av(e),n.parseOptions),n.errorOnInvalidContent&&s)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${o}`)})}const s=qd.fromSchema(t);return n.slice?s.parseSlice(av(e),n.parseOptions).content:s.parse(av(e),n.parseOptions)}return lv("",t,n)}var cv=(e,t,n)=>({tr:s,dispatch:o,editor:i})=>{var r;if(o){let o;const l=e=>{i.emit("contentError",{editor:i,error:e,disableCollaboration:()=>{"collaboration"in i.storage&&"object"==typeof i.storage.collaboration&&i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...(n={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n}).parseOptions};if(!n.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{lv(t,i.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(a){l(a)}try{o=lv(t,i.schema,{parseOptions:c,errorOnInvalidContent:null!=(r=n.errorOnInvalidContent)?r:i.options.enableContentCheck})}catch(a){return l(a),!1}let{from:u,to:d}="number"==typeof e?{from:e,to:e}:{from:e.from,to:e.to},p=!0,h=!0;if(("type"in o?[o]:o).forEach(e=>{e.check(),p=!!p&&(e.isText&&0===e.marks.length),h=!!h&&e.isBlock}),u===d&&h){const{parent:e}=s.doc.resolve(u);e.isTextblock&&!e.type.spec.code&&!e.childCount&&(u-=1,d+=1)}let f;if(p){if(Array.isArray(t))f=t.map(e=>e.text||"").join("");else if(t instanceof ld){let e="";t.forEach(t=>{t.text&&(e+=t.text)}),f=e}else f="object"==typeof t&&t&&t.text?t.text:t;s.insertText(f,u,d)}else{f=o;const e=s.doc.resolve(u),t=e.node(),n=0===e.parentOffset,i=t.isText||t.isTextblock,r=t.content.size>0;n&&i&&r&&(u=Math.max(0,u-1)),s.replaceWith(u,d,f)}n.updateSelection&&function(e,t,n){const s=e.steps.length-1;if(s<t)return;const o=e.steps[s];if(!(o instanceof Np||o instanceof Mp))return;const i=e.mapping.maps[s];let r=0;i.forEach((e,t,n,s)=>{0===r&&(r=s)}),e.setSelection(rh.near(e.doc.resolve(r),n))}(s,s.steps.length-1,-1),n.applyInputRules&&s.setMeta("applyInputRules",{from:u,text:f}),n.applyPasteRules&&s.setMeta("applyPasteRules",{from:u,text:f})}return!0},uv=()=>({state:e,dispatch:t})=>((e,t)=>{let n,s=e.selection,o=s instanceof ph;if(o){if(s.node.isTextblock||!Up(e.doc,s.from))return!1;n=s.from}else if(n=Wp(e.doc,s.from,-1),null==n)return!1;if(t){let s=e.tr.join(n);o&&s.setSelection(ph.create(s.doc,n-e.doc.resolve(n).nodeBefore.nodeSize)),t(s.scrollIntoView())}return!0})(e,t),dv=()=>({state:e,dispatch:t})=>((e,t)=>{let n,s=e.selection;if(s instanceof ph){if(s.node.isTextblock||!Up(e.doc,s.to))return!1;n=s.to}else if(n=Wp(e.doc,s.to,1),null==n)return!1;return t&&t(e.tr.join(n).scrollIntoView()),!0})(e,t),pv=()=>({state:e,dispatch:t})=>Rh(e,t),hv=()=>({state:e,dispatch:t})=>Fh(e,t),fv=()=>({state:e,dispatch:t,tr:n})=>{try{const s=Wp(e.doc,e.selection.$from.pos,-1);return null!=s&&(n.join(s,2),t&&t(n),!0)}catch{return!1}},mv=()=>({state:e,dispatch:t,tr:n})=>{try{const s=Wp(e.doc,e.selection.$from.pos,1);return null!=s&&(n.join(s,2),t&&t(n),!0)}catch{return!1}},gv=()=>({state:e,dispatch:t})=>((e,t,n)=>{let s=Mh(e,n);if(!s)return!1;let o=Bh(s);return!!o&&_h(e,o,t)})(e,t),yv=()=>({state:e,dispatch:t})=>((e,t,n)=>{let s=Lh(e,n);if(!s)return!1;let o=$h(s);return!!o&&_h(e,o,t)})(e,t);function vv(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}var bv=e=>({editor:t,view:n,tr:s,dispatch:o})=>{const i=function(e){const t=e.split(/-(?!$)/);let n,s,o,i,r=t[t.length-1];"Space"===r&&(r=" ");for(let a=0;a<t.length-1;a+=1){const e=t[a];if(/^(cmd|meta|m)$/i.test(e))i=!0;else if(/^a(lt)?$/i.test(e))n=!0;else if(/^(c|ctrl|control)$/i.test(e))s=!0;else if(/^s(hift)?$/i.test(e))o=!0;else{if(!/^mod$/i.test(e))throw new Error(`Unrecognized modifier name: ${e}`);nv()||vv()?i=!0:s=!0}}return n&&(r=`Alt-${r}`),s&&(r=`Ctrl-${r}`),i&&(r=`Meta-${r}`),o&&(r=`Shift-${r}`),r}(e).split(/-(?!$)/),r=i.find(e=>!["Alt","Ctrl","Meta","Shift"].includes(e)),a=new KeyboardEvent("keydown",{key:"Space"===r?" ":r,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),l=t.captureTransaction(()=>{n.someProp("handleKeyDown",e=>e(n,a))});return null==l||l.steps.forEach(e=>{const t=e.map(s.mapping);t&&o&&s.maybeStep(t)}),!0};function kv(e,t,n={}){const{from:s,to:o,empty:i}=e.selection,r=t?$y(t,e.schema):null,a=[];e.doc.nodesBetween(s,o,(e,t)=>{if(e.isText)return;const n=Math.max(s,t),i=Math.min(o,t+e.nodeSize);a.push({node:e,from:n,to:i})});const l=o-s,c=a.filter(e=>!r||r.name===e.node.type.name).filter(e=>Ky(e.node.attrs,n,{strict:!1}));if(i)return!!c.length;return c.reduce((e,t)=>e+t.to-t.from,0)>=l}var wv=(e,t={})=>({state:n,dispatch:s})=>!!kv(n,$y(e,n.schema),t)&&((e,t)=>{let{$from:n,$to:s}=e.selection,o=n.blockRange(s),i=o&&Dp(o);return null!=i&&(t&&t(e.tr.lift(o,i).scrollIntoView()),!0)})(n,s),Sv=()=>({state:e,dispatch:t})=>Gh(e,t),Cv=e=>({state:t,dispatch:n})=>Qh($y(e,t.schema))(t,n),Tv=()=>({state:e,dispatch:t})=>Uh(e,t);function Ev(e,t){return t.nodes[e]?"node":t.marks[e]?"mark":null}function Iv(e,t){const n="string"==typeof t?[t]:t;return Object.keys(e).reduce((t,s)=>(n.includes(s)||(t[s]=e[s]),t),{})}var xv=(e,t)=>({tr:n,state:s,dispatch:o})=>{let i=null,r=null;const a=Ev("string"==typeof e?e:e.name,s.schema);if(!a)return!1;"node"===a&&(i=$y(e,s.schema)),"mark"===a&&(r=Xy(e,s.schema));let l=!1;return n.selection.ranges.forEach(e=>{s.doc.nodesBetween(e.$from.pos,e.$to.pos,(e,s)=>{i&&i===e.type&&(l=!0,o&&n.setNodeMarkup(s,void 0,Iv(e.attrs,t))),r&&e.marks.length&&e.marks.forEach(i=>{r===i.type&&(l=!0,o&&n.addMark(s,s+e.nodeSize,r.create(Iv(i.attrs,t))))})})}),l},Av=()=>({tr:e,dispatch:t})=>(t&&e.scrollIntoView(),!0),Nv=()=>({tr:e,dispatch:t})=>{if(t){const t=new fh(e.doc);e.setSelection(t)}return!0},Mv=()=>({state:e,dispatch:t})=>Dh(e,t),Rv=()=>({state:e,dispatch:t})=>Ph(e,t),_v=()=>({state:e,dispatch:t})=>((e,t)=>{let n,{$from:s,to:o}=e.selection,i=s.sharedDepth(o);return 0!=i&&(n=s.before(i),t&&t(e.tr.setSelection(ph.create(e.doc,n))),!0)})(e,t),Ov=()=>({state:e,dispatch:t})=>Yh(e,t),Dv=()=>({state:e,dispatch:t})=>jh(e,t);function Bv(e,t,n={},s={}){return lv(e,t,{slice:!1,parseOptions:n,errorOnInvalidContent:s.errorOnInvalidContent})}var Lv=(e,{errorOnInvalidContent:t,emitUpdate:n=!0,parseOptions:s={}}={})=>({editor:o,tr:i,dispatch:r,commands:a})=>{const{doc:l}=i;if("full"!==s.preserveWhitespace){const a=Bv(e,o.schema,s,{errorOnInvalidContent:null!=t?t:o.options.enableContentCheck});return r&&i.replaceWith(0,l.content.size,a).setMeta("preventUpdate",!n),!0}return r&&i.setMeta("preventUpdate",!n),a.insertContentAt({from:0,to:l.content.size},e,{parseOptions:s,errorOnInvalidContent:null!=t?t:o.options.enableContentCheck})};function Fv(e,t){const n=Xy(t,e.schema),{from:s,to:o,empty:i}=e.selection,r=[];i?(e.storedMarks&&r.push(...e.storedMarks),r.push(...e.selection.$head.marks())):e.doc.nodesBetween(s,o,e=>{r.push(...e.marks)});const a=r.find(e=>e.type.name===n.name);return a?{...a.attrs}:{}}function Pv(e,t){const n=new oh(e);return t.forEach(e=>{e.steps.forEach(e=>{n.step(e)})}),n}function $v(e){return t=>function(e,t){for(let n=e.depth;n>0;n-=1){const s=e.node(n);if(t(s))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:s}}}(t.$from,e)}function Uv(e,t,n){if(void 0===e.config[t]&&e.parent)return Uv(e.parent,t,n);if("function"==typeof e.config[t]){return e.config[t].bind({...n,parent:e.parent?Uv(e.parent,t,n):null})}return e.config[t]}function Vv(e){return e.map(e=>{const t=Uv(e,"addExtensions",{name:e.name,options:e.options,storage:e.storage});return t?[e,...Vv(t())]:e}).flat(10)}function Wv(e,t){const n=cp.fromSchema(t).serializeFragment(e),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(n),s.innerHTML}function Gv(e){return"function"==typeof e}function zv(e,t=void 0,...n){return Gv(e)?t?e.bind(t)(...n):e(...n):e}function Hv(e){return{baseExtensions:e.filter(e=>"extension"===e.type),nodeExtensions:e.filter(e=>"node"===e.type),markExtensions:e.filter(e=>"mark"===e.type)}}function Kv(e){const t=[],{nodeExtensions:n,markExtensions:s}=Hv(e),o=[...n,...s],i={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return e.forEach(e=>{const n=Uv(e,"addGlobalAttributes",{name:e.name,options:e.options,storage:e.storage,extensions:o});if(!n)return;n().forEach(e=>{e.types.forEach(n=>{Object.entries(e.attributes).forEach(([e,s])=>{t.push({type:n,name:e,attribute:{...i,...s}})})})})}),o.forEach(e=>{const n={name:e.name,options:e.options,storage:e.storage},s=Uv(e,"addAttributes",n);if(!s)return;const o=s();Object.entries(o).forEach(([n,s])=>{const o={...i,...s};"function"==typeof(null==o?void 0:o.default)&&(o.default=o.default()),(null==o?void 0:o.isRequired)&&void 0===(null==o?void 0:o.default)&&delete o.default,t.push({type:e.name,name:n,attribute:o})})}),t}function jv(...e){return e.filter(e=>!!e).reduce((e,t)=>{const n={...e};return Object.entries(t).forEach(([e,t])=>{if(n[e])if("class"===e){const s=t?String(t).split(" "):[],o=n[e]?n[e].split(" "):[],i=s.filter(e=>!o.includes(e));n[e]=[...o,...i].join(" ")}else if("style"===e){const s=t?t.split(";").map(e=>e.trim()).filter(Boolean):[],o=n[e]?n[e].split(";").map(e=>e.trim()).filter(Boolean):[],i=new Map;o.forEach(e=>{const[t,n]=e.split(":").map(e=>e.trim());i.set(t,n)}),s.forEach(e=>{const[t,n]=e.split(":").map(e=>e.trim());i.set(t,n)}),n[e]=Array.from(i.entries()).map(([e,t])=>`${e}: ${t}`).join("; ")}else n[e]=t;else n[e]=t}),n},{})}function Yv(e,t){return t.filter(t=>t.type===e.type.name).filter(e=>e.attribute.rendered).map(t=>t.attribute.renderHTML?t.attribute.renderHTML(e.attrs)||{}:{[t.name]:e.attrs[t.name]}).reduce((e,t)=>jv(e,t),{})}function Zv(e,t){return"style"in e?e:{...e,getAttrs:n=>{const s=e.getAttrs?e.getAttrs(n):e.attrs;if(!1===s)return!1;const o=t.reduce((e,t)=>{const s=t.attribute.parseHTML?t.attribute.parseHTML(n):function(e){return"string"!=typeof e?e:e.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(e):"true"===e||"false"!==e&&e}(n.getAttribute(t.name));return null==s?e:{...e,[t.name]:s}},{});return{...s,...o}}}}function Xv(e){return Object.fromEntries(Object.entries(e).filter(([e,t])=>("attrs"!==e||!function(e={}){return 0===Object.keys(e).length&&e.constructor===Object}(t))&&null!=t))}function Jv(e){var t,n;const s={};return!(null==(t=null==e?void 0:e.attribute)?void 0:t.isRequired)&&"default"in((null==e?void 0:e.attribute)||{})&&(s.default=e.attribute.default),void 0!==(null==(n=null==e?void 0:e.attribute)?void 0:n.validate)&&(s.validate=e.attribute.validate),[e.name,s]}function Qv(e){return e.sort((e,t)=>{const n=Uv(e,"priority")||100,s=Uv(t,"priority")||100;return n>s?-1:n<s?1:0})}function qv(e){const t=Qv(Vv(e)),n=function(e){const t=e.filter((t,n)=>e.indexOf(t)!==n);return Array.from(new Set(t))}(t.map(e=>e.name));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map(e=>`'${e}'`).join(", ")}]. This can lead to issues.`),t}function eb(e,t,n){const{from:s,to:o}=t,{blockSeparator:i="\n\n",textSerializers:r={}}=n||{};let a="";return e.nodesBetween(s,o,(e,n,l,c)=>{var u;e.isBlock&&n>s&&(a+=i);const d=null==r?void 0:r[e.type.name];if(d)return l&&(a+=d({node:e,pos:n,parent:l,index:c,range:t})),!1;e.isText&&(a+=null==(u=null==e?void 0:e.text)?void 0:u.slice(Math.max(s,n)-n,o-n))}),a}function tb(e){return Object.fromEntries(Object.entries(e.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}function nb(e,t){const n=Ev("string"==typeof t?t:t.name,e.schema);return"node"===n?function(e,t){const n=$y(t,e.schema),{from:s,to:o}=e.selection,i=[];e.doc.nodesBetween(s,o,e=>{i.push(e)});const r=i.reverse().find(e=>e.type.name===n.name);return r?{...r.attrs}:{}}(e,t):"mark"===n?Fv(e,t):{}}function sb(e){const t=function(e,t=JSON.stringify){const n={};return e.filter(e=>{const s=t(e);return!Object.prototype.hasOwnProperty.call(n,s)&&(n[s]=!0)})}(e);return 1===t.length?t:t.filter((e,n)=>{const s=t.filter((e,t)=>t!==n);return!s.some(t=>e.oldRange.from>=t.oldRange.from&&e.oldRange.to<=t.oldRange.to&&e.newRange.from>=t.newRange.from&&e.newRange.to<=t.newRange.to)})}function ob(e){const{mapping:t,steps:n}=e,s=[];return t.maps.forEach((e,o)=>{const i=[];if(e.ranges.length)e.forEach((e,t)=>{i.push({from:e,to:t})});else{const{from:e,to:t}=n[o];if(void 0===e||void 0===t)return;i.push({from:e,to:t})}i.forEach(({from:e,to:n})=>{const i=t.slice(o).map(e,-1),r=t.slice(o).map(n),a=t.invert().map(i,-1),l=t.invert().map(r);s.push({oldRange:{from:a,to:l},newRange:{from:i,to:r}})})}),sb(s)}function ib(e,t,n){const s=[];return e===t?n.resolve(e).marks().forEach(t=>{const o=Zy(n.resolve(e),t.type);o&&s.push({mark:t,...o})}):n.nodesBetween(e,t,(e,t)=>{e&&void 0!==(null==e?void 0:e.nodeSize)&&s.push(...e.marks.map(n=>({from:t,to:t+e.nodeSize,mark:n})))}),s}function rb(e,t){return t.nodes[e]||t.marks[e]||null}function ab(e,t,n){return Object.fromEntries(Object.entries(n).filter(([n])=>{const s=e.find(e=>e.type===t&&e.name===n);return!!s&&s.attribute.keepOnSplit}))}function lb(e,t,n={}){const{empty:s,ranges:o}=e.selection,i=t?Xy(t,e.schema):null;if(s)return!!(e.storedMarks||e.selection.$from.marks()).filter(e=>!i||i.name===e.type.name).find(e=>Ky(e.attrs,n,{strict:!1}));let r=0;const a=[];if(o.forEach(({$from:t,$to:n})=>{const s=t.pos,o=n.pos;e.doc.nodesBetween(s,o,(e,t)=>{if(!e.isText&&!e.marks.length)return;const n=Math.max(s,t),i=Math.min(o,t+e.nodeSize);r+=i-n,a.push(...e.marks.map(e=>({mark:e,from:n,to:i})))})}),0===r)return!1;const l=a.filter(e=>!i||i.name===e.mark.type.name).filter(e=>Ky(e.mark.attrs,n,{strict:!1})).reduce((e,t)=>e+t.to-t.from,0),c=a.filter(e=>!i||e.mark.type!==i&&e.mark.type.excludes(i)).reduce((e,t)=>e+t.to-t.from,0);return(l>0?l+c:l)>=r}function cb(e,t){return Array.isArray(t)?t.some(t=>("string"==typeof t?t:t.name)===e.name):t}function ub(e,t){const{nodeExtensions:n}=Hv(t),s=n.find(t=>t.name===e);if(!s)return!1;const o=zv(Uv(s,"group",{name:s.name,options:s.options,storage:s.storage}));return"string"==typeof o&&o.split(" ").includes("list")}function db(e,{checkChildren:t=!0,ignoreWhitespace:n=!1}={}){var s;if(n){if("hardBreak"===e.type.name)return!0;if(e.isText)return/^\s*$/m.test(null!=(s=e.text)?s:"")}if(e.isText)return!e.text;if(e.isAtom||e.isLeaf)return!1;if(0===e.content.childCount)return!0;if(t){let s=!0;return e.content.forEach(e=>{!1!==s&&(db(e,{ignoreWhitespace:n,checkChildren:t})||(s=!1))}),s}return!1}function pb(e){return e instanceof ph}var hb=class e{constructor(e){this.position=e}static fromJSON(t){return new e(t.position)}toJSON(){return{position:this.position}}};function fb(e,t){const n=t.mapping.mapResult(e.position);return{position:new hb(n.pos),mapResult:n}}function mb(e){return new hb(e)}var gb=(e,t={})=>({tr:n,state:s,dispatch:o})=>{const{selection:i}=n,{empty:r,ranges:a}=i,l=Xy(e,s.schema);if(o)if(r){const e=Fv(s,l);n.addStoredMark(l.create({...e,...t}))}else a.forEach(e=>{const o=e.$from.pos,i=e.$to.pos;s.doc.nodesBetween(o,i,(e,s)=>{const r=Math.max(s,o),a=Math.min(s+e.nodeSize,i);e.marks.find(e=>e.type===l)?e.marks.forEach(e=>{l===e.type&&n.addMark(r,a,l.create({...e.attrs,...t}))}):n.addMark(r,a,l.create(t))})});return function(e,t,n){var s;const{selection:o}=t;let i=null;if(qy(o)&&(i=o.$cursor),i){const t=null!=(s=e.storedMarks)?s:i.marks();return i.parent.type.allowsMarkType(n)&&(!!n.isInSet(t)||!t.some(e=>e.type.excludes(n)))}const{ranges:r}=o;return r.some(({$from:t,$to:s})=>{let o=0===t.depth&&e.doc.inlineContent&&e.doc.type.allowsMarkType(n);return e.doc.nodesBetween(t.pos,s.pos,(e,t,s)=>{if(o)return!1;if(e.isInline){const t=!s||s.type.allowsMarkType(n),i=!!n.isInSet(e.marks)||!e.marks.some(e=>e.type.excludes(n));o=t&&i}return!o}),o})}(s,n,l)},yb=(e,t)=>({tr:n})=>(n.setMeta(e,t),!0),vb=(e,t={})=>({state:n,dispatch:s,chain:o})=>{const i=$y(e,n.schema);let r;return n.selection.$anchor.sameParent(n.selection.$head)&&(r=n.selection.$anchor.parent.attrs),i.isTextblock?o().command(({commands:e})=>!!Zh(i,{...r,...t})(n)||e.clearNodes()).command(({state:e})=>Zh(i,{...r,...t})(e,s)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},bb=e=>({tr:t,dispatch:n})=>{if(n){const{doc:n}=t,s=ev(e,0,n.content.size),o=ph.create(n,s);t.setSelection(o)}return!0},kb=(e,t)=>({tr:n,state:s,dispatch:o})=>{const{selection:i}=s;let r,a;return"number"==typeof t?(r=t,a=t):t&&"from"in t&&"to"in t?(r=t.from,a=t.to):(r=i.from,a=i.to),o&&n.doc.nodesBetween(r,a,(t,s)=>{t.isText||n.setNodeMarkup(s,void 0,{...t.attrs,dir:e})}),!0},wb=e=>({tr:t,dispatch:n})=>{if(n){const{doc:n}=t,{from:s,to:o}="number"==typeof e?{from:e,to:e}:e,i=uh.atStart(n).from,r=uh.atEnd(n).to,a=ev(s,i,r),l=ev(o,i,r),c=uh.create(n,a,l);t.setSelection(c)}return!0},Sb=e=>({state:t,dispatch:n})=>{const s=$y(e,t.schema);return(o=s,function(e,t){let{$from:n,$to:s}=e.selection,i=n.blockRange(s,e=>e.childCount>0&&e.firstChild.type==o);if(!i)return!1;let r=i.startIndex;if(0==r)return!1;let a=i.parent,l=a.child(r-1);if(l.type!=o)return!1;if(t){let n=l.lastChild&&l.lastChild.type==a.type,s=ld.from(n?o.create():null),r=new fd(ld.from(o.create(null,ld.from(a.type.create(null,s)))),n?3:1,0),c=i.start,u=i.end;t(e.tr.step(new Mp(c-(n?3:1),u,c,u,r,1,!0)).scrollIntoView())}return!0})(t,n);var o};function Cb(e,t){const n=e.storedMarks||e.selection.$to.parentOffset&&e.selection.$from.marks();if(n){const s=n.filter(e=>null==t?void 0:t.includes(e.type.name));e.tr.ensureMarks(s)}}var Tb=({keepMarks:e=!0}={})=>({tr:t,state:n,dispatch:s,editor:o})=>{const{selection:i,doc:r}=t,{$from:a,$to:l}=i,c=ab(o.extensionManager.attributes,a.node().type.name,a.node().attrs);if(i instanceof ph&&i.node.isBlock)return!(!a.parentOffset||!$p(r,a.pos))&&(s&&(e&&Cb(n,o.extensionManager.splittableMarks),t.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const u=l.parentOffset===l.parent.content.size,d=0===a.depth?void 0:function(e){for(let t=0;t<e.edgeCount;t+=1){const{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}(a.node(-1).contentMatchAt(a.indexAfter(-1)));let p=u&&d?[{type:d,attrs:c}]:void 0,h=$p(t.doc,t.mapping.map(a.pos),1,p);if(p||h||!$p(t.doc,t.mapping.map(a.pos),1,d?[{type:d}]:void 0)||(h=!0,p=d?[{type:d,attrs:c}]:void 0),s){if(h&&(i instanceof uh&&t.deleteSelection(),t.split(t.mapping.map(a.pos),1,p),d&&!u&&!a.parentOffset&&a.parent.type!==d)){const e=t.mapping.map(a.before()),n=t.doc.resolve(e);a.node(-1).canReplaceWith(n.index(),n.index()+1,d)&&t.setNodeMarkup(t.mapping.map(a.before()),d)}e&&Cb(n,o.extensionManager.splittableMarks),t.scrollIntoView()}return h},Eb=(e,t={})=>({tr:n,state:s,dispatch:o,editor:i})=>{var r;const a=$y(e,s.schema),{$from:l,$to:c}=s.selection,u=s.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const p=i.extensionManager.attributes;if(0===l.parent.content.size&&l.node(-1).childCount===l.indexAfter(-1)){if(2===l.depth||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(o){let e=ld.empty;const s=l.index(-1)?1:l.index(-2)?2:3;for(let t=l.depth-s;t>=l.depth-3;t-=1)e=ld.from(l.node(t).copy(e));const o=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,i={...ab(p,l.node().type.name,l.node().attrs),...t},c=(null==(r=a.contentMatch.defaultType)?void 0:r.createAndFill(i))||void 0;e=e.append(ld.from(a.createAndFill(null,c)||void 0));const u=l.before(l.depth-(s-1));n.replace(u,l.after(-o),new fd(e,4-s,0));let d=-1;n.doc.nodesBetween(u,n.doc.content.size,(e,t)=>{if(d>-1)return!1;e.isTextblock&&0===e.content.size&&(d=t+1)}),d>-1&&n.setSelection(uh.near(n.doc.resolve(d))),n.scrollIntoView()}return!0}const h=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,f={...ab(p,d.type.name,d.attrs),...t},m={...ab(p,l.node().type.name,l.node().attrs),...t};n.delete(l.pos,c.pos);const g=h?[{type:a,attrs:f},{type:h,attrs:m}]:[{type:a,attrs:f}];if(!$p(n.doc,l.pos,2))return!1;if(o){const{selection:e,storedMarks:t}=s,{splittableMarks:r}=i.extensionManager,a=t||e.$to.parentOffset&&e.$from.marks();if(n.split(l.pos,2,g).scrollIntoView(),!a||!o)return!0;const c=a.filter(e=>r.includes(e.type.name));n.ensureMarks(c)}return!0},Ib=(e,t)=>{const n=$v(e=>e.type===t)(e.selection);if(!n)return!0;const s=e.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(void 0===s)return!0;const o=e.doc.nodeAt(s);return n.node.type!==(null==o?void 0:o.type)||!Up(e.doc,n.pos)||(e.join(n.pos),!0)},xb=(e,t)=>{const n=$v(e=>e.type===t)(e.selection);if(!n)return!0;const s=e.doc.resolve(n.start).after(n.depth);if(void 0===s)return!0;const o=e.doc.nodeAt(s);return n.node.type!==(null==o?void 0:o.type)||!Up(e.doc,s)||(e.join(s),!0)},Ab=(e,t,n,s={})=>({editor:o,tr:i,state:r,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:p}=o.extensionManager,h=$y(e,r.schema),f=$y(t,r.schema),{selection:m,storedMarks:g}=r,{$from:y,$to:v}=m,b=y.blockRange(v),k=g||m.$to.parentOffset&&m.$from.marks();if(!b)return!1;const w=$v(e=>ub(e.type.name,d))(m);if(b.depth>=1&&w&&b.depth-w.depth<=1){if(w.node.type===h)return c.liftListItem(f);if(ub(w.node.type.name,d)&&h.validContent(w.node.content)&&a)return l().command(()=>(i.setNodeMarkup(w.pos,h),!0)).command(()=>Ib(i,h)).command(()=>xb(i,h)).run()}return n&&k&&a?l().command(()=>{const e=u().wrapInList(h,s),t=k.filter(e=>p.includes(e.type.name));return i.ensureMarks(t),!!e||c.clearNodes()}).wrapInList(h,s).command(()=>Ib(i,h)).command(()=>xb(i,h)).run():l().command(()=>!!u().wrapInList(h,s)||c.clearNodes()).wrapInList(h,s).command(()=>Ib(i,h)).command(()=>xb(i,h)).run()},Nb=(e,t={},n={})=>({state:s,commands:o})=>{const{extendEmptyMarkRange:i=!1}=n,r=Xy(e,s.schema);return lb(s,r,t)?o.unsetMark(r,{extendEmptyMarkRange:i}):o.setMark(r,t)},Mb=(e,t,n={})=>({state:s,commands:o})=>{const i=$y(e,s.schema),r=$y(t,s.schema),a=kv(s,i,n);let l;return s.selection.$anchor.sameParent(s.selection.$head)&&(l=s.selection.$anchor.parent.attrs),a?o.setNode(r,l):o.setNode(i,{...l,...n})},Rb=(e,t={})=>({state:n,commands:s})=>{const o=$y(e,n.schema);return kv(n,o,t)?s.lift(o):s.wrapIn(o,t)},_b=()=>({state:e,dispatch:t})=>{const n=e.plugins;for(let s=0;s<n.length;s+=1){const o=n[s];let i;if(o.spec.isInputRules&&(i=o.getState(e))){if(t){const t=e.tr,n=i.transform;for(let e=n.steps.length-1;e>=0;e-=1)t.step(n.steps[e].invert(n.docs[e]));if(i.text){const n=t.doc.resolve(i.from).marks();t.replaceWith(i.from,i.to,e.schema.text(i.text,n))}else t.delete(i.from,i.to)}return!0}}return!1},Ob=()=>({tr:e,dispatch:t})=>{const{selection:n}=e,{empty:s,ranges:o}=n;return s||t&&o.forEach(t=>{e.removeMark(t.$from.pos,t.$to.pos)}),!0},Db=(e,t={})=>({tr:n,state:s,dispatch:o})=>{var i;const{extendEmptyMarkRange:r=!1}=t,{selection:a}=n,l=Xy(e,s.schema),{$from:c,empty:u,ranges:d}=a;if(!o)return!0;if(u&&r){let{from:e,to:t}=a;const s=null==(i=c.marks().find(e=>e.type===l))?void 0:i.attrs,o=Zy(c,l,s);o&&(e=o.from,t=o.to),n.removeMark(e,t,l)}else d.forEach(e=>{n.removeMark(e.$from.pos,e.$to.pos,l)});return n.removeStoredMark(l),!0},Bb=e=>({tr:t,state:n,dispatch:s})=>{const{selection:o}=n;let i,r;return"number"==typeof e?(i=e,r=e):e&&"from"in e&&"to"in e?(i=e.from,r=e.to):(i=o.from,r=o.to),s&&t.doc.nodesBetween(i,r,(e,n)=>{if(e.isText)return;const s={...e.attrs};delete s.dir,t.setNodeMarkup(n,void 0,s)}),!0},Lb=(e,t={})=>({tr:n,state:s,dispatch:o})=>{let i=null,r=null;const a=Ev("string"==typeof e?e:e.name,s.schema);if(!a)return!1;"node"===a&&(i=$y(e,s.schema)),"mark"===a&&(r=Xy(e,s.schema));let l=!1;return n.selection.ranges.forEach(e=>{const a=e.$from.pos,c=e.$to.pos;let u,d,p,h;n.selection.empty?s.doc.nodesBetween(a,c,(e,t)=>{i&&i===e.type&&(l=!0,p=Math.max(t,a),h=Math.min(t+e.nodeSize,c),u=t,d=e)}):s.doc.nodesBetween(a,c,(e,s)=>{s<a&&i&&i===e.type&&(l=!0,p=Math.max(s,a),h=Math.min(s+e.nodeSize,c),u=s,d=e),s>=a&&s<=c&&(i&&i===e.type&&(l=!0,o&&n.setNodeMarkup(s,void 0,{...e.attrs,...t})),r&&e.marks.length&&e.marks.forEach(i=>{if(r===i.type&&(l=!0,o)){const o=Math.max(s,a),l=Math.min(s+e.nodeSize,c);n.addMark(o,l,r.create({...i.attrs,...t}))}}))}),d&&(void 0!==u&&o&&n.setNodeMarkup(u,void 0,{...d.attrs,...t}),r&&d.marks.length&&d.marks.forEach(e=>{r===e.type&&o&&n.addMark(p,h,r.create({...e.attrs,...t}))}))}),l},Fb=(e,t={})=>({state:n,dispatch:s})=>function(e,t=null){return function(n,s){let{$from:o,$to:i}=n.selection,r=o.blockRange(i),a=r&&Bp(r,e,t);return!!a&&(s&&s(n.tr.wrap(r,a).scrollIntoView()),!0)}}($y(e,n.schema),t)(n,s),Pb=(e,t={})=>({state:n,dispatch:s})=>Jh($y(e,n.schema),t)(n,s),$b=class{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){const n=this.callbacks[e];return n&&n.forEach(e=>e.apply(this,t)),this}off(e,t){const n=this.callbacks[e];return n&&(t?this.callbacks[e]=n.filter(e=>e!==t):delete this.callbacks[e]),this}once(e,t){const n=(...s)=>{this.off(e,n),t.apply(this,s)};return this.on(e,n)}removeAllListeners(){this.callbacks={}}},Ub=class{constructor(e){var t;this.find=e.find,this.handler=e.handler,this.undoable=null==(t=e.undoable)||t}};function Vb(e){var t;const{editor:n,from:s,to:o,text:i,rules:r,plugin:a}=e,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(s);if(c.parent.type.spec.code||(null==(t=c.nodeBefore||c.nodeAfter)?void 0:t.marks.find(e=>e.type.spec.code)))return!1;let u=!1;const d=((e,t=500)=>{let n="";const s=e.parentOffset;return e.parent.nodesBetween(Math.max(0,s-t),s,(e,t,o,i)=>{var r,a;const l=(null==(a=(r=e.type.spec).toText)?void 0:a.call(r,{node:e,pos:t,parent:o,index:i}))||e.textContent||"%leaf%";n+=e.isAtom&&!e.isText?l:l.slice(0,Math.max(0,s-t))}),n})(c)+i;return r.forEach(e=>{if(u)return;const t=((e,t)=>{if(Hy(t))return t.exec(e);const n=t(e);if(!n)return null;const s=[n.text];return s.index=n.index,s.input=e,s.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),s.push(n.replaceWith)),s})(d,e.find);if(!t)return;const r=l.state.tr,c=Ny({state:l.state,transaction:r}),p={from:s-(t[0].length-i.length),to:o},{commands:h,chain:f,can:m}=new My({editor:n,state:c});null!==e.handler({state:c,range:p,match:t,commands:h,chain:f,can:m})&&r.steps.length&&(e.undoable&&r.setMeta(a,{transform:r,from:s,to:o,text:i}),l.dispatch(r),u=!0)}),u}function Wb(e){return"Object"===function(e){return Object.prototype.toString.call(e).slice(8,-1)}(e)&&(e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype)}function Gb(e,t){const n={...e};return Wb(e)&&Wb(t)&&Object.keys(t).forEach(s=>{Wb(t[s])&&Wb(e[s])?n[s]=Gb(e[s],t[s]):n[s]=t[s]}),n}var zb=class{constructor(e={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...e},this.name=this.config.name}get options(){return{...zv(Uv(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...zv(Uv(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(e={}){const t=this.extend({...this.config,addOptions:()=>Gb(this.options,e)});return t.name=this.name,t.parent=this.parent,t}extend(e={}){const t=new this.constructor({...this.config,...e});return t.parent=this,this.child=t,t.name="name"in e?e.name:t.parent.name,t}},Hb=class e extends zb{constructor(){super(...arguments),this.type="mark"}static create(t={}){const n="function"==typeof t?t():t;return new e(n)}static handleExit({editor:e,mark:t}){const{tr:n}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const o=s.marks();if(!!!o.find(e=>(null==e?void 0:e.type.name)===t.name))return!1;const i=o.find(e=>(null==e?void 0:e.type.name)===t.name);return i&&n.removeStoredMark(i),n.insertText(" ",s.pos),e.view.dispatch(n),!0}return!1}configure(e){return super.configure(e)}extend(e){const t="function"==typeof e?e():e;return super.extend(t)}};var Kb=class{constructor(e){this.find=e.find,this.handler=e.handler}};function jb(e){const{editor:t,state:n,from:s,to:o,rule:i,pasteEvent:r,dropEvent:a}=e,{commands:l,chain:c,can:u}=new My({editor:t,state:n}),d=[];n.doc.nodesBetween(s,o,(e,t)=>{var p,h,f,m,g;if((null==(h=null==(p=e.type)?void 0:p.spec)?void 0:h.code)||!(e.isText||e.isTextblock||e.isInline))return;const y=null!=(g=null!=(m=null==(f=e.content)?void 0:f.size)?m:e.nodeSize)?g:0,v=Math.max(s,t),b=Math.min(o,t+y);if(v>=b)return;((e,t,n)=>{if(Hy(t))return[...e.matchAll(t)];const s=t(e,n);return s?s.map(t=>{const n=[t.text];return n.index=t.index,n.input=e,n.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),n.push(t.replaceWith)),n}):[]})(e.isText?e.text||"":e.textBetween(v-t,b-t,void 0,"ï¿¼"),i.find,r).forEach(e=>{if(void 0===e.index)return;const t=v+e.index+1,s=t+e[0].length,o={from:n.tr.mapping.map(t),to:n.tr.mapping.map(s)},p=i.handler({state:n,range:o,match:e,commands:l,chain:c,can:u,pasteEvent:r,dropEvent:a});d.push(p)})});return d.every(e=>null!==e)}var Yb=null;function Zb(e){const{editor:t,rules:n}=e;let s,o=null,i=!1,r=!1,a="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null;try{s="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch{s=null}const l=({state:e,from:n,to:o,rule:i,pasteEvt:r})=>{const l=e.tr,c=Ny({state:e,transaction:l});if(jb({editor:t,state:c,from:Math.max(n-1,0),to:o.b-1,rule:i,pasteEvent:r,dropEvent:s})&&l.steps.length){try{s="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch{s=null}return a="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null,l}};return n.map(e=>new Eh({view(e){const n=n=>{var s;o=(null==(s=e.dom.parentElement)?void 0:s.contains(n.target))?e.dom.parentElement:null,o&&(Yb=t)},s=()=>{Yb&&(Yb=null)};return window.addEventListener("dragstart",n),window.addEventListener("dragend",s),{destroy(){window.removeEventListener("dragstart",n),window.removeEventListener("dragend",s)}}},props:{handleDOMEvents:{drop:(e,t)=>{if(r=o===e.dom.parentElement,s=t,!r){const e=Yb;(null==e?void 0:e.isEditable)&&setTimeout(()=>{const t=e.state.selection;t&&e.commands.deleteRange({from:t.from,to:t.to})},10)}return!1},paste:(e,t)=>{var n;const s=null==(n=t.clipboardData)?void 0:n.getData("text/html");return a=t,i=!!(null==s?void 0:s.includes("data-pm-slice")),!1}}},appendTransaction:(t,n,s)=>{const o=t[0],c="paste"===o.getMeta("uiEvent")&&!i,u="drop"===o.getMeta("uiEvent")&&!r,d=o.getMeta("applyPasteRules"),p=!!d;if(!c&&!u&&!p)return;if(p){let{text:t}=d;"string"==typeof t||(t=Wv(ld.from(t),s.schema));const{from:n}=d,o=n+t.length,i=(e=>{var t;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return null==(t=n.clipboardData)||t.setData("text/html",e),n})(t);return l({rule:e,state:s,from:n,to:{b:o},pasteEvt:i})}const h=n.doc.content.findDiffStart(s.doc.content),f=n.doc.content.findDiffEnd(s.doc.content);return"number"==typeof h&&f&&h!==f.b?l({rule:e,state:s,from:h,to:f,pasteEvt:a}):void 0}}))}var Xb=class{constructor(e,t){this.splittableMarks=[],this.editor=t,this.baseExtensions=e,this.extensions=qv(e),this.schema=function(e,t){var n;const s=Kv(e),{nodeExtensions:o,markExtensions:i}=Hv(e),r=null==(n=o.find(e=>Uv(e,"topNode")))?void 0:n.name,a=Object.fromEntries(o.map(n=>{const o=s.filter(e=>e.type===n.name),i={name:n.name,options:n.options,storage:n.storage,editor:t},r=Xv({...e.reduce((e,t)=>{const s=Uv(t,"extendNodeSchema",i);return{...e,...s?s(n):{}}},{}),content:zv(Uv(n,"content",i)),marks:zv(Uv(n,"marks",i)),group:zv(Uv(n,"group",i)),inline:zv(Uv(n,"inline",i)),atom:zv(Uv(n,"atom",i)),selectable:zv(Uv(n,"selectable",i)),draggable:zv(Uv(n,"draggable",i)),code:zv(Uv(n,"code",i)),whitespace:zv(Uv(n,"whitespace",i)),linebreakReplacement:zv(Uv(n,"linebreakReplacement",i)),defining:zv(Uv(n,"defining",i)),isolating:zv(Uv(n,"isolating",i)),attrs:Object.fromEntries(o.map(Jv))}),a=zv(Uv(n,"parseHTML",i));a&&(r.parseDOM=a.map(e=>Zv(e,o)));const l=Uv(n,"renderHTML",i);l&&(r.toDOM=e=>l({node:e,HTMLAttributes:Yv(e,o)}));const c=Uv(n,"renderText",i);return c&&(r.toText=c),[n.name,r]})),l=Object.fromEntries(i.map(n=>{const o=s.filter(e=>e.type===n.name),i={name:n.name,options:n.options,storage:n.storage,editor:t},r=Xv({...e.reduce((e,t)=>{const s=Uv(t,"extendMarkSchema",i);return{...e,...s?s(n):{}}},{}),inclusive:zv(Uv(n,"inclusive",i)),excludes:zv(Uv(n,"excludes",i)),group:zv(Uv(n,"group",i)),spanning:zv(Uv(n,"spanning",i)),code:zv(Uv(n,"code",i)),attrs:Object.fromEntries(o.map(Jv))}),a=zv(Uv(n,"parseHTML",i));a&&(r.parseDOM=a.map(e=>Zv(e,o)));const l=Uv(n,"renderHTML",i);return l&&(r.toDOM=e=>l({mark:e,HTMLAttributes:Yv(e,o)})),[n.name,r]}));return new Jd({topNode:r,nodes:a,marks:l})}(this.extensions,t),this.setupExtensions()}get commands(){return this.extensions.reduce((e,t)=>{const n=Uv(t,"addCommands",{name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:this.editor,type:rb(t.name,this.schema)});return n?{...e,...n()}:e},{})}get plugins(){const{editor:e}=this;return Qv([...this.extensions].reverse()).flatMap(t=>{const n={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:e,type:rb(t.name,this.schema)},s=[],o=Uv(t,"addKeyboardShortcuts",n);let i={};if("mark"===t.type&&Uv(t,"exitable",n)&&(i.ArrowRight=()=>Hb.handleExit({editor:e,mark:t})),o){const t=Object.fromEntries(Object.entries(o()).map(([t,n])=>[t,()=>n({editor:e})]));i={...i,...t}}const r=new Eh({props:{handleKeyDown:Iy(i)}});s.push(r);const a=Uv(t,"addInputRules",n);if(cb(t,e.options.enableInputRules)&&a){const t=a();if(t&&t.length){const n=function(e){const{editor:t,rules:n}=e,s=new Eh({state:{init:()=>null,apply(e,o,i){const r=e.getMeta(s);if(r)return r;const a=e.getMeta("applyInputRules");return!!a&&setTimeout(()=>{let{text:e}=a;"string"==typeof e||(e=Wv(ld.from(e),i.schema));const{from:o}=a,r=o+e.length;Vb({editor:t,from:o,to:r,text:e,rules:n,plugin:s})}),e.selectionSet||e.docChanged?null:o}},props:{handleTextInput:(e,o,i,r)=>Vb({editor:t,from:o,to:i,text:r,rules:n,plugin:s}),handleDOMEvents:{compositionend:e=>(setTimeout(()=>{const{$cursor:o}=e.state.selection;o&&Vb({editor:t,from:o.pos,to:o.pos,text:"",rules:n,plugin:s})}),!1)},handleKeyDown(e,o){if("Enter"!==o.key)return!1;const{$cursor:i}=e.state.selection;return!!i&&Vb({editor:t,from:i.pos,to:i.pos,text:"\n",rules:n,plugin:s})}},isInputRules:!0});return s}({editor:e,rules:t}),o=Array.isArray(n)?n:[n];s.push(...o)}}const l=Uv(t,"addPasteRules",n);if(cb(t,e.options.enablePasteRules)&&l){const t=l();if(t&&t.length){const n=Zb({editor:e,rules:t});s.push(...n)}}const c=Uv(t,"addProseMirrorPlugins",n);if(c){const e=c();s.push(...e)}return s})}get attributes(){return Kv(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:t}=Hv(this.extensions);return Object.fromEntries(t.filter(e=>!!Uv(e,"addNodeView")).map(t=>{const n=this.attributes.filter(e=>e.type===t.name),s={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:e,type:$y(t.name,this.schema)},o=Uv(t,"addNodeView",s);if(!o)return[];const i=o();if(!i)return[];return[t.name,(s,o,r,a,l)=>{const c=Yv(s,n);return i({node:s,view:o,getPos:r,decorations:a,innerDecorations:l,editor:e,extension:t,HTMLAttributes:c})}]}))}get markViews(){const{editor:e}=this,{markExtensions:t}=Hv(this.extensions);return Object.fromEntries(t.filter(e=>!!Uv(e,"addMarkView")).map(t=>{const n=this.attributes.filter(e=>e.type===t.name),s={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:e,type:Xy(t.name,this.schema)},o=Uv(t,"addMarkView",s);if(!o)return[];return[t.name,(s,i,r)=>{const a=Yv(s,n);return o()({mark:s,view:i,inline:r,editor:e,extension:t,HTMLAttributes:a,updateAttributes:t=>{!function(e,t,n={}){const{state:s}=t,{doc:o,tr:i}=s,r=e;o.descendants((t,s)=>{const o=i.mapping.map(s),a=i.mapping.map(s)+t.nodeSize;let l=null;if(t.marks.forEach(e=>{if(e!==r)return!1;l=e}),!l)return;let c=!1;if(Object.keys(n).forEach(e=>{n[e]!==l.attrs[e]&&(c=!0)}),c){const t=e.type.create({...e.attrs,...n});i.removeMark(o,a,e.type),i.addMark(o,a,t)}}),i.docChanged&&t.view.dispatch(i)}(s,e,t)}})}]}))}setupExtensions(){const e=this.extensions;this.editor.extensionStorage=Object.fromEntries(e.map(e=>[e.name,e.storage])),e.forEach(e=>{var t;const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:rb(e.name,this.schema)};if("mark"===e.type){(null==(t=zv(Uv(e,"keepOnSplit",n)))||t)&&this.splittableMarks.push(e.name)}const s=Uv(e,"onBeforeCreate",n),o=Uv(e,"onCreate",n),i=Uv(e,"onUpdate",n),r=Uv(e,"onSelectionUpdate",n),a=Uv(e,"onTransaction",n),l=Uv(e,"onFocus",n),c=Uv(e,"onBlur",n),u=Uv(e,"onDestroy",n);s&&this.editor.on("beforeCreate",s),o&&this.editor.on("create",o),i&&this.editor.on("update",i),r&&this.editor.on("selectionUpdate",r),a&&this.editor.on("transaction",a),l&&this.editor.on("focus",l),c&&this.editor.on("blur",c),u&&this.editor.on("destroy",u)})}};Xb.resolve=qv,Xb.sort=Qv,Xb.flatten=Vv;Ay({},{ClipboardTextSerializer:()=>Qb,Commands:()=>qb,Delete:()=>ek,Drop:()=>tk,Editable:()=>nk,FocusEvents:()=>ok,Keymap:()=>ik,Paste:()=>rk,Tabindex:()=>ak,TextDirection:()=>lk,focusEventsPluginKey:()=>sk});var Jb=class e extends zb{constructor(){super(...arguments),this.type="extension"}static create(t={}){const n="function"==typeof t?t():t;return new e(n)}configure(e){return super.configure(e)}extend(e){const t="function"==typeof e?e():e;return super.extend(t)}},Qb=Jb.create({name:"clipboardTextSerializer",addOptions:()=>({blockSeparator:void 0}),addProseMirrorPlugins(){return[new Eh({key:new Ah("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:e}=this,{state:t,schema:n}=e,{doc:s,selection:o}=t,{ranges:i}=o,r=Math.min(...i.map(e=>e.$from.pos)),a=Math.max(...i.map(e=>e.$to.pos)),l=tb(n);return eb(s,{from:r,to:a},{...void 0!==this.options.blockSeparator?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),qb=Jb.create({name:"commands",addCommands:()=>({...Ry})}),ek=Jb.create({name:"delete",onUpdate({transaction:e,appendedTransactions:t}){var n,s,o;const i=()=>{var n,s,o,i;if(null!=(i=null==(o=null==(s=null==(n=this.editor.options.coreExtensionOptions)?void 0:n.delete)?void 0:s.filterTransaction)?void 0:o.call(s,e))?i:e.getMeta("y-sync$"))return;const r=Pv(e.before,[e,...t]);ob(r).forEach(t=>{r.mapping.mapResult(t.oldRange.from).deletedAfter&&r.mapping.mapResult(t.oldRange.to).deletedBefore&&r.before.nodesBetween(t.oldRange.from,t.oldRange.to,(n,s)=>{const o=s+n.nodeSize-2,i=t.oldRange.from<=s&&o<=t.oldRange.to;this.editor.emit("delete",{type:"node",node:n,from:s,to:o,newFrom:r.mapping.map(s),newTo:r.mapping.map(o),deletedRange:t.oldRange,newRange:t.newRange,partial:!i,editor:this.editor,transaction:e,combinedTransform:r})})});const a=r.mapping;r.steps.forEach((t,n)=>{var s,o;if(t instanceof Ip){const i=a.slice(n).map(t.from,-1),l=a.slice(n).map(t.to),c=a.invert().map(i,-1),u=a.invert().map(l),d=null==(s=r.doc.nodeAt(i-1))?void 0:s.marks.some(e=>e.eq(t.mark)),p=null==(o=r.doc.nodeAt(l))?void 0:o.marks.some(e=>e.eq(t.mark));this.editor.emit("delete",{type:"mark",mark:t.mark,from:t.from,to:t.to,deletedRange:{from:c,to:u},newRange:{from:i,to:l},partial:Boolean(p||d),editor:this.editor,transaction:e,combinedTransform:r})}})};null==(o=null==(s=null==(n=this.editor.options.coreExtensionOptions)?void 0:n.delete)?void 0:s.async)||o?setTimeout(i,0):i()}}),tk=Jb.create({name:"drop",addProseMirrorPlugins(){return[new Eh({key:new Ah("tiptapDrop"),props:{handleDrop:(e,t,n,s)=>{this.editor.emit("drop",{editor:this.editor,event:t,slice:n,moved:s})}}})]}}),nk=Jb.create({name:"editable",addProseMirrorPlugins(){return[new Eh({key:new Ah("editable"),props:{editable:()=>this.editor.options.editable}})]}}),sk=new Ah("focusEvents"),ok=Jb.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:e}=this;return[new Eh({key:sk,props:{handleDOMEvents:{focus:(t,n)=>{e.isFocused=!0;const s=e.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return t.dispatch(s),!1},blur:(t,n)=>{e.isFocused=!1;const s=e.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return t.dispatch(s),!1}}}})]}}),ik=Jb.create({name:"keymap",addKeyboardShortcuts(){const e=()=>this.editor.commands.first(({commands:e})=>[()=>e.undoInputRule(),()=>e.command(({tr:t})=>{const{selection:n,doc:s}=t,{empty:o,$anchor:i}=n,{pos:r,parent:a}=i,l=i.parent.isTextblock&&r>0?t.doc.resolve(r-1):i,c=l.parent.type.spec.isolating,u=i.pos-i.parentOffset,d=c&&1===l.parent.childCount?u===i.pos:rh.atStart(s).from===r;return!(!o||!a.type.isTextblock||a.textContent.length||!d||d&&"paragraph"===i.parent.type.name)&&e.clearNodes()}),()=>e.deleteSelection(),()=>e.joinBackward(),()=>e.selectNodeBackward()]),t=()=>this.editor.commands.first(({commands:e})=>[()=>e.deleteSelection(),()=>e.deleteCurrentNode(),()=>e.joinForward(),()=>e.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:e})=>[()=>e.newlineInCode(),()=>e.createParagraphNear(),()=>e.liftEmptyBlock(),()=>e.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:e,"Mod-Backspace":e,"Shift-Backspace":e,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},s={...n},o={...n,"Ctrl-h":e,"Alt-Backspace":e,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return nv()||vv()?o:s},addProseMirrorPlugins(){return[new Eh({key:new Ah("clearDocument"),appendTransaction:(e,t,n)=>{if(e.some(e=>e.getMeta("composition")))return;const s=e.some(e=>e.docChanged)&&!t.doc.eq(n.doc),o=e.some(e=>e.getMeta("preventClearDocument"));if(!s||o)return;const{empty:i,from:r,to:a}=t.selection,l=rh.atStart(t.doc).from,c=rh.atEnd(t.doc).to;if(i||!(r===l&&a===c))return;if(!db(n.doc))return;const u=n.tr,d=Ny({state:n,transaction:u}),{commands:p}=new My({editor:this.editor,state:d});return p.clearNodes(),u.steps.length?u:void 0}})]}}),rk=Jb.create({name:"paste",addProseMirrorPlugins(){return[new Eh({key:new Ah("tiptapPaste"),props:{handlePaste:(e,t,n)=>{this.editor.emit("paste",{editor:this.editor,event:t,slice:n})}}})]}}),ak=Jb.create({name:"tabindex",addProseMirrorPlugins(){return[new Eh({key:new Ah("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),lk=Jb.create({name:"textDirection",addOptions:()=>({direction:void 0}),addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:e}=Hv(this.extensions);return[{types:e.filter(e=>"text"!==e.name).map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const t=e.getAttribute("dir");return!t||"ltr"!==t&&"rtl"!==t&&"auto"!==t?this.options.direction:t},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new Eh({key:new Ah("textDirection"),props:{attributes:()=>{const e=this.options.direction;return e?{dir:e}:{}}}})]}}),ck=class e{constructor(e,t,n=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=n,this.resolvedPos=e,this.editor=t,this.currentNode=s}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return null!=(e=this.actualDepth)?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let t=this.from,n=this.to;if(this.isBlock){if(0===this.content.size)return void console.error(`You canâ€™t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);t=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:t,to:n},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(0===this.depth)return null;const t=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(t);return new e(n,this.editor)}get before(){let t=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.from-3)),new e(t,this.editor)}get after(){let t=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.to+3)),new e(t,this.editor)}get children(){const t=[];return this.node.content.forEach((n,s)=>{const o=n.isBlock&&!n.isTextblock,i=n.isAtom&&!n.isText,r=this.pos+s+(i?0:1);if(r<0||r>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(r);if(!o&&a.depth<=this.depth)return;const l=new e(a,this.editor,o,o?n:null);o&&(l.actualDepth=this.depth+1),t.push(new e(a,this.editor,o,o?n:null))}),t}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,t={}){let n=null,s=this.parent;for(;s&&!n;){if(s.node.type.name===e)if(Object.keys(t).length>0){const e=s.node.attrs,n=Object.keys(t);for(let s=0;s<n.length;s+=1){const o=n[s];if(e[o]!==t[o])break}}else n=s;s=s.parent}return n}querySelector(e,t={}){return this.querySelectorAll(e,t,!0)[0]||null}querySelectorAll(e,t={},n=!1){let s=[];if(!this.children||0===this.children.length)return s;const o=Object.keys(t);return this.children.forEach(i=>{if(!(n&&s.length>0)){if(i.node.type.name===e){o.every(e=>t[e]===i.node.attrs[e])&&s.push(i)}n&&s.length>0||(s=s.concat(i.querySelectorAll(e,t,n)))}}),s}setAttribute(e){const{tr:t}=this.editor.state;t.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(t)}};var uk=class extends $b{constructor(e={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:"undefined"!=typeof document?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:e})=>{throw e},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:fb,createMappablePosition:mb},this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:e,slice:t,moved:n})=>this.options.onDrop(e,t,n)),this.on("paste",({event:e,slice:t})=>this.options.onPaste(e,t)),this.on("delete",this.options.onDelete);const t=this.createDoc(),n=tv(t,this.options.autofocus);this.editorState=Ch.create({doc:t,schema:this.schema,selection:n||void 0}),this.options.element&&this.mount(this.options.element)}mount(e){if("undefined"==typeof document)throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(e),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(!1!==this.options.autofocus&&null!==this.options.autofocus&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const e=this.editorView.dom;(null==e?void 0:e.editor)&&delete e.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{"function"==typeof this.css.remove?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(e){console.warn("Failed to remove CSS element:",e)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&"undefined"!=typeof document&&(this.css=function(e,t){const n=document.querySelector("style[data-tiptap-style]");if(null!==n)return n;const s=document.createElement("style");return t&&s.setAttribute("nonce",t),s.setAttribute("data-tiptap-style",""),s.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(s),s}('.ProseMirror {\n  position: relative;\n}\n\n.ProseMirror {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  white-space: break-spaces;\n  -webkit-font-variant-ligatures: none;\n  font-variant-ligatures: none;\n  font-feature-settings: "liga" 0; /* the above doesn\'t seem to work in Edge */\n}\n\n.ProseMirror [contenteditable="false"] {\n  white-space: normal;\n}\n\n.ProseMirror [contenteditable="false"] [contenteditable="true"] {\n  white-space: pre-wrap;\n}\n\n.ProseMirror pre {\n  white-space: pre-wrap;\n}\n\nimg.ProseMirror-separator {\n  display: inline !important;\n  border: none !important;\n  margin: 0 !important;\n  width: 0 !important;\n  height: 0 !important;\n}\n\n.ProseMirror-gapcursor {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n  margin: 0;\n}\n\n.ProseMirror-gapcursor:after {\n  content: "";\n  display: block;\n  position: absolute;\n  top: -2px;\n  width: 20px;\n  border-top: 1px solid black;\n  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n}\n\n@keyframes ProseMirror-cursor-blink {\n  to {\n    visibility: hidden;\n  }\n}\n\n.ProseMirror-hideselection *::selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection *::-moz-selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection * {\n  caret-color: transparent;\n}\n\n.ProseMirror-focused .ProseMirror-gapcursor {\n  display: block;\n}',this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},this.editorView&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,t=!0){this.setOptions({editable:e}),t&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:e=>{this.editorState=e},dispatch:e=>{this.dispatchTransaction(e)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(e,t)=>{if(this.editorView)return this.editorView[t];if("state"===t)return this.editorState;if(t in e)return Reflect.get(e,t);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${t}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(e,t){const n=Gv(t)?t(e,[...this.state.plugins]):[...this.state.plugins,e],s=this.state.reconfigure({plugins:n});return this.view.updateState(s),s}unregisterPlugin(e){if(this.isDestroyed)return;const t=this.state.plugins;let n=t;if([].concat(e).forEach(e=>{const t="string"==typeof e?`${e}$`:e.key;n=n.filter(e=>!e.key.startsWith(t))}),t.length===n.length)return;const s=this.state.reconfigure({plugins:n});return this.view.updateState(s),s}createExtensionManager(){var e,t;const n=[...this.options.enableCoreExtensions?[nk,Qb.configure({blockSeparator:null==(t=null==(e=this.options.coreExtensionOptions)?void 0:e.clipboardTextSerializer)?void 0:t.blockSeparator}),qb,ok,ik,ak,tk,rk,ek,lk.configure({direction:this.options.textDirection})].filter(e=>"object"!=typeof this.options.enableCoreExtensions||!1!==this.options.enableCoreExtensions[e.name]):[],...this.options.extensions].filter(e=>["extension","node","mark"].includes(null==e?void 0:e.type));this.extensionManager=new Xb(n,this)}createCommandManager(){this.commandManager=new My({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let e;try{e=Bv(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(t){if(!(t instanceof Error&&["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(t.message)))throw t;this.emit("contentError",{editor:this,error:t,disableCollaboration:()=>{"collaboration"in this.storage&&"object"==typeof this.storage.collaboration&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(e=>"collaboration"!==e.name),this.createExtensionManager()}}),e=Bv(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return e}createView(e){var t;this.editorView=new uy(e,{...this.options.editorProps,attributes:{role:"textbox",...null==(t=this.options.editorProps)?void 0:t.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const n=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(n),this.prependClass(),this.injectCSS();this.view.dom.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction)return this.capturedTransaction?void e.steps.forEach(e=>{var t;return null==(t=this.capturedTransaction)?void 0:t.step(e)}):void(this.capturedTransaction=e);const{state:t,transactions:n}=this.state.applyTransaction(e),s=!this.state.selection.eq(t.selection),o=n.includes(e),i=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:e,nextState:t}),!o)return;this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e,appendedTransactions:n.slice(1)}),s&&this.emit("selectionUpdate",{editor:this,transaction:e});const r=n.findLast(e=>e.getMeta("focus")||e.getMeta("blur")),a=null==r?void 0:r.getMeta("focus"),l=null==r?void 0:r.getMeta("blur");a&&this.emit("focus",{editor:this,event:a.event,transaction:r}),l&&this.emit("blur",{editor:this,event:l.event,transaction:r}),e.getMeta("preventUpdate")||!n.some(e=>e.docChanged)||i.doc.eq(t.doc)||this.emit("update",{editor:this,transaction:e,appendedTransactions:n.slice(1)})}getAttributes(e){return nb(this.state,e)}isActive(e,t){const n="string"==typeof e?e:null,s="string"==typeof e?t:e;return function(e,t,n={}){if(!t)return kv(e,null,n)||lb(e,null,n);const s=Ev(t,e.schema);return"node"===s?kv(e,t,n):"mark"===s&&lb(e,t,n)}(this.state,n,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Wv(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:t="\n\n",textSerializers:n={}}=e||{};return function(e,t){return eb(e,{from:0,to:e.content.size},t)}(this.state.doc,{blockSeparator:t,textSerializers:{...tb(this.schema),...n}})}get isEmpty(){return db(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var e,t;return null==(t=null==(e=this.editorView)?void 0:e.isDestroyed)||t}$node(e,t){var n;return(null==(n=this.$doc)?void 0:n.querySelector(e,t))||null}$nodes(e,t){var n;return(null==(n=this.$doc)?void 0:n.querySelectorAll(e,t))||null}$pos(e){const t=this.state.doc.resolve(e);return new ck(t,this)}get $doc(){return this.$pos(0)}};function dk(e){return new Ub({find:e.find,handler:({state:t,range:n,match:s})=>{const o=zv(e.getAttributes,void 0,s);if(!1===o||null===o)return null;const{tr:i}=t,r=s[s.length-1],a=s[0];if(r){const s=a.search(/\S/),l=n.from+a.indexOf(r),c=l+r.length;if(ib(n.from,n.to,t.doc).filter(t=>t.mark.type.excluded.find(n=>n===e.type&&n!==t.mark.type)).filter(e=>e.to>l).length)return null;c<n.to&&i.delete(c,n.to),l>n.from&&i.delete(n.from+s,l);const u=n.from+s+r.length;i.addMark(n.from+s,u,e.type.create(o||{})),i.removeStoredMark(e.type)}},undoable:e.undoable})}function pk(e){return new Ub({find:e.find,handler:({state:t,range:n,match:s})=>{const o=zv(e.getAttributes,void 0,s)||{},{tr:i}=t,r=n.from;let a=n.to;const l=e.type.create(o);if(s[1]){let e=r+s[0].lastIndexOf(s[1]);e>a?e=a:a=e+s[1].length;const t=s[0][s[0].length-1];i.insertText(t,r+s[0].length-1),i.replaceWith(e,a,l)}else if(s[0]){const t=e.type.isInline?r:r-1;i.insert(t,e.type.create(o)).delete(i.mapping.map(r),i.mapping.map(a))}i.scrollIntoView()},undoable:e.undoable})}function hk(e){return new Ub({find:e.find,handler:({state:t,range:n,match:s})=>{const o=t.doc.resolve(n.from),i=zv(e.getAttributes,void 0,s)||{};if(!o.node(-1).canReplaceWith(o.index(-1),o.indexAfter(-1),e.type))return null;t.tr.delete(n.from,n.to).setBlockType(n.from,n.from,e.type,i)},undoable:e.undoable})}function fk(e){return new Ub({find:e.find,handler:({state:t,range:n,match:s,chain:o})=>{const i=zv(e.getAttributes,void 0,s)||{},r=t.tr.delete(n.from,n.to),a=r.doc.resolve(n.from).blockRange(),l=a&&Bp(a,e.type,i);if(!l)return null;if(r.wrap(a,l),e.keepMarks&&e.editor){const{selection:n,storedMarks:s}=t,{splittableMarks:o}=e.editor.extensionManager,i=s||n.$to.parentOffset&&n.$from.marks();if(i){const e=i.filter(e=>o.includes(e.type.name));r.ensureMarks(e)}}if(e.keepAttributes){const t="bulletList"===e.type.name||"orderedList"===e.type.name?"listItem":"taskList";o().updateAttributes(t,i).run()}const c=r.doc.resolve(n.from-1).nodeBefore;c&&c.type===e.type&&Up(r.doc,n.from-1)&&(!e.joinPredicate||e.joinPredicate(s,c))&&r.join(n.from-1)},undoable:e.undoable})}var mk=class{constructor(e){var t,n,s,o,i,r;this.directions=["bottom-left","bottom-right","top-left","top-right"],this.minSize={height:8,width:8},this.preserveAspectRatio=!1,this.classNames={container:"",wrapper:"",handle:"",resizing:""},this.initialWidth=0,this.initialHeight=0,this.aspectRatio=1,this.isResizing=!1,this.activeHandle=null,this.startX=0,this.startY=0,this.startWidth=0,this.startHeight=0,this.isShiftKeyPressed=!1,this.lastEditableState=void 0,this.handleMap=new Map,this.handleMouseMove=e=>{if(!this.isResizing||!this.activeHandle)return;const t=e.clientX-this.startX,n=e.clientY-this.startY;this.handleResize(t,n)},this.handleTouchMove=e=>{if(!this.isResizing||!this.activeHandle)return;const t=e.touches[0];if(!t)return;const n=t.clientX-this.startX,s=t.clientY-this.startY;this.handleResize(n,s)},this.handleMouseUp=()=>{if(!this.isResizing)return;const e=this.element.offsetWidth,t=this.element.offsetHeight;this.onCommit(e,t),this.isResizing=!1,this.activeHandle=null,this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},this.handleKeyDown=e=>{"Shift"===e.key&&(this.isShiftKeyPressed=!0)},this.handleKeyUp=e=>{"Shift"===e.key&&(this.isShiftKeyPressed=!1)},this.node=e.node,this.editor=e.editor,this.element=e.element,this.contentElement=e.contentElement,this.getPos=e.getPos,this.onResize=e.onResize,this.onCommit=e.onCommit,this.onUpdate=e.onUpdate,(null==(t=e.options)?void 0:t.min)&&(this.minSize={...this.minSize,...e.options.min}),(null==(n=e.options)?void 0:n.max)&&(this.maxSize=e.options.max),(null==(s=null==e?void 0:e.options)?void 0:s.directions)&&(this.directions=e.options.directions),(null==(o=e.options)?void 0:o.preserveAspectRatio)&&(this.preserveAspectRatio=e.options.preserveAspectRatio),(null==(i=e.options)?void 0:i.className)&&(this.classNames={container:e.options.className.container||"",wrapper:e.options.className.wrapper||"",handle:e.options.className.handle||"",resizing:e.options.className.resizing||""}),(null==(r=e.options)?void 0:r.createCustomHandle)&&(this.createCustomHandle=e.options.createCustomHandle),this.wrapper=this.createWrapper(),this.container=this.createContainer(),this.applyInitialSize(),this.attachHandles(),this.editor.on("update",this.handleEditorUpdate.bind(this))}get dom(){return this.container}get contentDOM(){return this.contentElement}handleEditorUpdate(){const e=this.editor.isEditable;e!==this.lastEditableState&&(this.lastEditableState=e,e?e&&0===this.handleMap.size&&this.attachHandles():this.removeHandles())}update(e,t,n){return e.type===this.node.type&&(this.node=e,!this.onUpdate||this.onUpdate(e,t,n))}destroy(){this.isResizing&&(this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.isResizing=!1,this.activeHandle=null),this.editor.off("update",this.handleEditorUpdate.bind(this)),this.container.remove()}createContainer(){const e=document.createElement("div");return e.dataset.resizeContainer="",e.dataset.node=this.node.type.name,e.style.display="flex",this.classNames.container&&(e.className=this.classNames.container),e.appendChild(this.wrapper),e}createWrapper(){const e=document.createElement("div");return e.style.position="relative",e.style.display="block",e.dataset.resizeWrapper="",this.classNames.wrapper&&(e.className=this.classNames.wrapper),e.appendChild(this.element),e}createHandle(e){const t=document.createElement("div");return t.dataset.resizeHandle=e,t.style.position="absolute",this.classNames.handle&&(t.className=this.classNames.handle),t}positionHandle(e,t){const n=t.includes("top"),s=t.includes("bottom"),o=t.includes("left"),i=t.includes("right");n&&(e.style.top="0"),s&&(e.style.bottom="0"),o&&(e.style.left="0"),i&&(e.style.right="0"),"top"!==t&&"bottom"!==t||(e.style.left="0",e.style.right="0"),"left"!==t&&"right"!==t||(e.style.top="0",e.style.bottom="0")}attachHandles(){this.directions.forEach(e=>{let t;t=this.createCustomHandle?this.createCustomHandle(e):this.createHandle(e),t instanceof HTMLElement||(console.warn(`[ResizableNodeView] createCustomHandle("${e}") did not return an HTMLElement. Falling back to default handle.`),t=this.createHandle(e)),this.createCustomHandle||this.positionHandle(t,e),t.addEventListener("mousedown",t=>this.handleResizeStart(t,e)),t.addEventListener("touchstart",t=>this.handleResizeStart(t,e)),this.handleMap.set(e,t),this.wrapper.appendChild(t)})}removeHandles(){this.handleMap.forEach(e=>e.remove()),this.handleMap.clear()}applyInitialSize(){const e=this.node.attrs.width,t=this.node.attrs.height;e?(this.element.style.width=`${e}px`,this.initialWidth=e):this.initialWidth=this.element.offsetWidth,t?(this.element.style.height=`${t}px`,this.initialHeight=t):this.initialHeight=this.element.offsetHeight,this.initialWidth>0&&this.initialHeight>0&&(this.aspectRatio=this.initialWidth/this.initialHeight)}handleResizeStart(e,t){e.preventDefault(),e.stopPropagation(),this.isResizing=!0,this.activeHandle=t,"touches"in e?(this.startX=e.touches[0].clientX,this.startY=e.touches[0].clientY):(this.startX=e.clientX,this.startY=e.clientY),this.startWidth=this.element.offsetWidth,this.startHeight=this.element.offsetHeight,this.startWidth>0&&this.startHeight>0&&(this.aspectRatio=this.startWidth/this.startHeight),this.getPos(),this.container.dataset.resizeState="true",this.classNames.resizing&&this.container.classList.add(this.classNames.resizing),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("touchmove",this.handleTouchMove),document.addEventListener("mouseup",this.handleMouseUp),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}handleResize(e,t){if(!this.activeHandle)return;const n=this.preserveAspectRatio||this.isShiftKeyPressed,{width:s,height:o}=this.calculateNewDimensions(this.activeHandle,e,t),i=this.applyConstraints(s,o,n);this.element.style.width=`${i.width}px`,this.element.style.height=`${i.height}px`,this.onResize&&this.onResize(i.width,i.height)}calculateNewDimensions(e,t,n){let s=this.startWidth,o=this.startHeight;const i=e.includes("right"),r=e.includes("left"),a=e.includes("bottom"),l=e.includes("top");i?s=this.startWidth+t:r&&(s=this.startWidth-t),a?o=this.startHeight+n:l&&(o=this.startHeight-n),"right"!==e&&"left"!==e||(s=this.startWidth+(i?t:-t)),"top"!==e&&"bottom"!==e||(o=this.startHeight+(a?n:-n));return this.preserveAspectRatio||this.isShiftKeyPressed?this.applyAspectRatio(s,o,e):{width:s,height:o}}applyConstraints(e,t,n){var s,o,i,r;if(!n){let n=Math.max(this.minSize.width,e),i=Math.max(this.minSize.height,t);return(null==(s=this.maxSize)?void 0:s.width)&&(n=Math.min(this.maxSize.width,n)),(null==(o=this.maxSize)?void 0:o.height)&&(i=Math.min(this.maxSize.height,i)),{width:n,height:i}}let a=e,l=t;return a<this.minSize.width&&(a=this.minSize.width,l=a/this.aspectRatio),l<this.minSize.height&&(l=this.minSize.height,a=l*this.aspectRatio),(null==(i=this.maxSize)?void 0:i.width)&&a>this.maxSize.width&&(a=this.maxSize.width,l=a/this.aspectRatio),(null==(r=this.maxSize)?void 0:r.height)&&l>this.maxSize.height&&(l=this.maxSize.height,a=l*this.aspectRatio),{width:a,height:l}}applyAspectRatio(e,t,n){const s="top"===n||"bottom"===n;return"left"===n||"right"===n?{width:e,height:e/this.aspectRatio}:s?{width:t*this.aspectRatio,height:t}:{width:e,height:e/this.aspectRatio}}};function gk(e){if(!(null==e?void 0:e.trim()))return{};const t={},n=[],s=e.replace(/["']([^"']*)["']/g,e=>(n.push(e),`__QUOTED_${n.length-1}__`)),o=s.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(o){const e=o.map(e=>e.trim().slice(1));t.class=e.join(" ")}const i=s.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);i&&(t.id=i[1]);Array.from(s.matchAll(/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g)).forEach(([,e,s])=>{var o;const i=parseInt((null==(o=s.match(/__QUOTED_(\d+)__/))?void 0:o[1])||"0",10),r=n[i];r&&(t[e]=r.slice(1,-1))});const r=s.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();if(r){r.split(/\s+/).filter(Boolean).forEach(e=>{e.match(/^[a-zA-Z][\w-]*$/)&&(t[e]=!0)})}return t}function yk(e){if(!e||0===Object.keys(e).length)return"";const t=[];if(e.class){String(e.class).split(/\s+/).filter(Boolean).forEach(e=>t.push(`.${e}`))}return e.id&&t.push(`#${e.id}`),Object.entries(e).forEach(([e,n])=>{"class"!==e&&"id"!==e&&(!0===n?t.push(e):!1!==n&&null!=n&&t.push(`${e}="${String(n)}"`))}),t.join(" ")}function vk(e){const{nodeName:t,name:n,parseAttributes:s=gk,serializeAttributes:o=yk,defaultAttributes:i={},requiredAttributes:r=[],allowedAttributes:a}=e,l=n||t;return{parseMarkdown:(e,n)=>{const s={...i,...e.attributes};return n.createNode(t,s,[])},markdownTokenizer:{name:t,level:"block",start(e){var t;const n=new RegExp(`^:::${l}(?:\\s|$)`,"m"),s=null==(t=e.match(n))?void 0:t.index;return void 0!==s?s:-1},tokenize(e,n,o){const i=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),a=e.match(i);if(!a)return;const c=a[1]||"",u=s(c);return r.find(e=>!(e in u))?void 0:{type:t,raw:a[0],attributes:u}}},renderMarkdown:e=>{const t=(e=>{if(!a)return e;const t={};return a.forEach(n=>{n in e&&(t[n]=e[n])}),t})(e.attrs||{}),n=o(t);return`:::${l}${n?` {${n}}`:""} :::`}}}function bk(e){const{nodeName:t,name:n,getContent:s,parseAttributes:o=gk,serializeAttributes:i=yk,defaultAttributes:r={},content:a="block",allowedAttributes:l}=e,c=n||t;return{parseMarkdown:(e,n)=>{let o;if(s){const t=s(e);o="string"==typeof t?[{type:"text",text:t}]:t}else o="block"===a?n.parseChildren(e.tokens||[]):n.parseInline(e.tokens||[]);const i={...r,...e.attributes};return n.createNode(t,i,o)},markdownTokenizer:{name:t,level:"block",start(e){var t;const n=new RegExp(`^:::${c}`,"m"),s=null==(t=e.match(n))?void 0:t.index;return void 0!==s?s:-1},tokenize(e,n,s){var i;const r=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),l=e.match(r);if(!l)return;const[u,d=""]=l,p=o(d);let h=1;const f=u.length;let m="";const g=/^:::([\w-]*)(\s.*)?/gm,y=e.slice(f);for(g.lastIndex=0;;){const n=g.exec(y);if(null===n)break;const o=n.index,r=n[1];if(!(null==(i=n[2])?void 0:i.endsWith(":::")))if(r)h+=1;else if(h-=1,0===h){const i=y.slice(0,o);m=i.trim();const r=e.slice(0,f+o+n[0].length);let l=[];if(m)if("block"===a)for(l=s.blockTokens(i),l.forEach(e=>{!e.text||e.tokens&&0!==e.tokens.length||(e.tokens=s.inlineTokens(e.text))});l.length>0;){const e=l[l.length-1];if("paragraph"!==e.type||e.text&&""!==e.text.trim())break;l.pop()}else l=s.inlineTokens(m);return{type:t,raw:r,attributes:p,content:m,tokens:l}}}}},renderMarkdown:(e,t)=>{const n=(e=>{if(!l)return e;const t={};return l.forEach(n=>{n in e&&(t[n]=e[n])}),t})(e.attrs||{}),s=i(n),o=s?` {${s}}`:"",r=t.renderChildren(e.content||[],"\n\n");return`:::${c}${o}\n\n${r}\n\n:::`}}}function kk(e){if(!e.trim())return{};const t={},n=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let s=n.exec(e);for(;null!==s;){const[,o,i,r]=s;t[o]=i||r,s=n.exec(e)}return t}function wk(e){return Object.entries(e).filter(([,e])=>null!=e).map(([e,t])=>`${e}="${t}"`).join(" ")}function Sk(e){const{nodeName:t,name:n,getContent:s,parseAttributes:o=kk,serializeAttributes:i=wk,defaultAttributes:r={},selfClosing:a=!1,allowedAttributes:l}=e,c=n||t,u=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(e,n)=>{const o={...r,...e.attributes};if(a)return n.createNode(t,o);const i=s?s(e):e.content||"";return i?n.createNode(t,o,[n.createTextNode(i)]):n.createNode(t,o,[])},markdownTokenizer:{name:t,level:"inline",start(e){const t=a?new RegExp(`\\[${u}\\s*[^\\]]*\\]`):new RegExp(`\\[${u}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${u}\\]`),n=e.match(t),s=null==n?void 0:n.index;return void 0!==s?s:-1},tokenize(e,n,s){const i=a?new RegExp(`^\\[${u}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${u}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${u}\\]`),r=e.match(i);if(!r)return;let l="",c="";if(a){const[,e]=r;c=e}else{const[,e,t]=r;c=e,l=t||""}const d=o(c.trim());return{type:t,raw:r[0],content:l.trim(),attributes:d}}},renderMarkdown:e=>{let t="";s?t=s(e):e.content&&e.content.length>0&&(t=e.content.filter(e=>"text"===e.type).map(e=>e.text).join(""));const n=(e=>{if(!l)return e;const t={};return l.forEach(n=>{const s="string"==typeof n?n:n.name,o="string"==typeof n?void 0:n.skipIfDefault;if(s in e){const n=e[s];if(void 0!==o&&n===o)return;t[s]=n}}),t})(e.attrs||{}),o=i(n),r=o?` ${o}`:"";return a?`[${c}${r}]`:`[${c}${r}]${t}[/${c}]`}}}function Ck(e,t,n){var s,o,i,r;const a=e.split("\n"),l=[];let c="",u=0;const d=t.baseIndentSize||2;for(;u<a.length;){const e=a[u],p=e.match(t.itemPattern);if(!p){if(l.length>0)break;if(""===e.trim()){u+=1,c=`${c}${e}\n`;continue}return}const h=t.extractItemData(p),{indentLevel:f,mainContent:m}=h;c=`${c}${e}\n`;const g=[m];for(u+=1;u<a.length;){const e=a[u];if(""===e.trim()){const t=a.slice(u+1).findIndex(e=>""!==e.trim());if(-1===t)break;if(((null==(o=null==(s=a[u+1+t].match(/^(\s*)/))?void 0:s[1])?void 0:o.length)||0)>f){g.push(e),c=`${c}${e}\n`,u+=1;continue}break}if(!(((null==(r=null==(i=e.match(/^(\s*)/))?void 0:i[1])?void 0:r.length)||0)>f))break;g.push(e),c=`${c}${e}\n`,u+=1}let y;const v=g.slice(1);if(v.length>0){const e=v.map(e=>e.slice(f+d)).join("\n");e.trim()&&(y=t.customNestedParser?t.customNestedParser(e):n.blockTokens(e))}const b=t.createToken(h,y);l.push(b)}if(0!==l.length)return{items:l,raw:c}}function Tk(e,t,n,s){if(!e||!Array.isArray(e.content))return"";const o="function"==typeof n?n(s):n,[i,...r]=e.content,a=[`${o}${t.renderChildren([i])}`];return r&&r.length>0&&r.forEach(e=>{const n=t.renderChildren([e]);if(n){const e=n.split("\n").map(e=>e?t.indent(e):"").join("\n");a.push(e)}}),a.join("\n")}Ay({},{createAtomBlockMarkdownSpec:()=>vk,createBlockMarkdownSpec:()=>bk,createInlineMarkdownSpec:()=>Sk,parseAttributes:()=>gk,parseIndentedBlocks:()=>Ck,renderNestedMarkdownContent:()=>Tk,serializeAttributes:()=>yk});var Ek=class e extends zb{constructor(){super(...arguments),this.type="node"}static create(t={}){const n="function"==typeof t?t():t;return new e(n)}configure(e){return super.configure(e)}extend(e){const t="function"==typeof e?e():e;return super.extend(t)}};function Ik(e){return new Kb({find:e.find,handler:({state:t,range:n,match:s,pasteEvent:o})=>{const i=zv(e.getAttributes,void 0,s,o);if(!1===i||null===i)return null;const{tr:r}=t,a=s[s.length-1],l=s[0];let c=n.to;if(a){const s=l.search(/\S/),o=n.from+l.indexOf(a),u=o+a.length;if(ib(n.from,n.to,t.doc).filter(t=>t.mark.type.excluded.find(n=>n===e.type&&n!==t.mark.type)).filter(e=>e.to>o).length)return null;u<n.to&&r.delete(u,n.to),o>n.from&&r.delete(n.from+s,o),c=n.from+s+a.length,r.addMark(n.from+s,c,e.type.create(i||{})),r.removeStoredMark(e.type)}}})}function xk(e){return vt((t,n)=>({get:()=>(t(),e),set(t){e=t,requestAnimationFrame(()=>{requestAnimationFrame(()=>{n()})})}}))}var Ak=class extends uk{constructor(e={}){return super(e),this.contentComponent=null,this.appContext=null,this.reactiveState=xk(this.view.state),this.reactiveExtensionStorage=xk(this.extensionStorage),this.on("beforeTransaction",({nextState:e})=>{this.reactiveState.value=e,this.reactiveExtensionStorage.value=this.extensionStorage}),yt(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(e,t){const n=super.registerPlugin(e,t);return this.reactiveState&&(this.reactiveState.value=n),n}unregisterPlugin(e){const t=super.unregisterPlugin(e);return this.reactiveState&&t&&(this.reactiveState.value=t),t}},Nk=Ze({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(e){const t=Ge(),n=bt();return gt(()=>{const s=e.editor;s&&s.options.element&&t.value&&pt(()=>{var e;if(!t.value||!(null==(e=s.view.dom)?void 0:e.firstChild))return;const o=ht(t.value);t.value.append(s.view.dom),s.contentComponent=n.ctx._,n&&(s.appContext={...n.appContext,provides:n.provides}),s.setOptions({element:o}),s.createNodeViews()})}),ft(()=>{const t=e.editor;t&&(t.contentComponent=null,t.appContext=null)}),{rootEl:t}},render(){return mt("div",{ref:e=>{this.rootEl=e}})}}),Mk=(e,t)=>{if("slot"===e)return 0;if(e instanceof Function)return e(t);const{children:n,...s}=null!=t?t:{};if("svg"===e)throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[e,s,n]},Rk=/^\s*>\s$/,_k=Ek.create({name:"blockquote",addOptions:()=>({HTMLAttributes:{}}),content:"block+",group:"block",defining:!0,parseHTML:()=>[{tag:"blockquote"}],renderHTML({HTMLAttributes:e}){return Mk("blockquote",{...jv(this.options.HTMLAttributes,e),children:Mk("slot",{})})},parseMarkdown:(e,t)=>t.createNode("blockquote",void 0,t.parseChildren(e.tokens||[])),renderMarkdown:(e,t)=>{if(!e.content)return"";const n=[];return e.content.forEach(e=>{const s=t.renderChildren([e]).split("\n").map(e=>""===e.trim()?">":`> ${e}`);n.push(s.join("\n"))}),n.join("\n>\n")},addCommands(){return{setBlockquote:()=>({commands:e})=>e.wrapIn(this.name),toggleBlockquote:()=>({commands:e})=>e.toggleWrap(this.name),unsetBlockquote:()=>({commands:e})=>e.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[fk({find:Rk,type:this.type})]}}),Ok=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,Dk=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,Bk=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,Lk=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Fk=Hb.create({name:"bold",addOptions:()=>({HTMLAttributes:{}}),parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:e=>"normal"!==e.style.fontWeight&&null},{style:"font-weight=400",clearMark:e=>e.type.name===this.name},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}]},renderHTML({HTMLAttributes:e}){return Mk("strong",{...jv(this.options.HTMLAttributes,e),children:Mk("slot",{})})},markdownTokenName:"strong",parseMarkdown:(e,t)=>t.applyMark("bold",t.parseInline(e.tokens||[])),renderMarkdown:(e,t)=>`**${t.renderChildren(e)}**`,addCommands(){return{setBold:()=>({commands:e})=>e.setMark(this.name),toggleBold:()=>({commands:e})=>e.toggleMark(this.name),unsetBold:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[dk({find:Ok,type:this.type}),dk({find:Bk,type:this.type})]},addPasteRules(){return[Ik({find:Dk,type:this.type}),Ik({find:Lk,type:this.type})]}}),Pk=/(^|[^`])`([^`]+)`(?!`)$/,$k=/(^|[^`])`([^`]+)`(?!`)/g,Uk=Hb.create({name:"code",addOptions:()=>({HTMLAttributes:{}}),excludes:"_",code:!0,exitable:!0,parseHTML:()=>[{tag:"code"}],renderHTML({HTMLAttributes:e}){return["code",jv(this.options.HTMLAttributes,e),0]},markdownTokenName:"codespan",parseMarkdown:(e,t)=>t.applyMark("code",[{type:"text",text:e.text||""}]),renderMarkdown:(e,t)=>e.content?`\`${t.renderChildren(e.content)}\``:"",addCommands(){return{setCode:()=>({commands:e})=>e.setMark(this.name),toggleCode:()=>({commands:e})=>e.toggleMark(this.name),unsetCode:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[dk({find:Pk,type:this.type})]},addPasteRules(){return[Ik({find:$k,type:this.type})]}}),Vk=/^```([a-z]+)?[\s\n]$/,Wk=/^~~~([a-z]+)?[\s\n]$/,Gk=Ek.create({name:"codeBlock",addOptions:()=>({languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:4,HTMLAttributes:{}}),content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:e=>{var t;const{languageClassPrefix:n}=this.options;if(!n)return null;const s=[...(null==(t=e.firstElementChild)?void 0:t.classList)||[]].filter(e=>e.startsWith(n)).map(e=>e.replace(n,""))[0];return s||null},rendered:!1}}},parseHTML:()=>[{tag:"pre",preserveWhitespace:"full"}],renderHTML({node:e,HTMLAttributes:t}){return["pre",jv(this.options.HTMLAttributes,t),["code",{class:e.attrs.language?this.options.languageClassPrefix+e.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(e,t)=>{var n;return!1===(null==(n=e.raw)?void 0:n.startsWith("```"))&&"indented"!==e.codeBlockStyle?[]:t.createNode("codeBlock",{language:e.lang||null},e.text?[t.createTextNode(e.text)]:[])},renderMarkdown:(e,t)=>{var n;let s="";const o=(null==(n=e.attrs)?void 0:n.language)||"";if(e.content){s=[`\`\`\`${o}`,t.renderChildren(e.content),"```"].join("\n")}else s=`\`\`\`${o}\n\n\`\`\``;return s},addCommands(){return{setCodeBlock:e=>({commands:t})=>t.setNode(this.name,e),toggleCodeBlock:e=>({commands:t})=>t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:e,$anchor:t}=this.editor.state.selection,n=1===t.pos;return!(!e||t.parent.type.name!==this.name)&&(!(!n&&t.parent.textContent.length)&&this.editor.commands.clearNodes())},Tab:({editor:e})=>{var t;if(!this.options.enableTabIndentation)return!1;const n=null!=(t=this.options.tabSize)?t:4,{state:s}=e,{selection:o}=s,{$from:i,empty:r}=o;if(i.parent.type!==this.type)return!1;const a=" ".repeat(n);return r?e.commands.insertContent(a):e.commands.command(({tr:e})=>{const{from:t,to:n}=o,i=s.doc.textBetween(t,n,"\n","\n").split("\n").map(e=>a+e).join("\n");return e.replaceWith(t,n,s.schema.text(i)),!0})},"Shift-Tab":({editor:e})=>{var t;if(!this.options.enableTabIndentation)return!1;const n=null!=(t=this.options.tabSize)?t:4,{state:s}=e,{selection:o}=s,{$from:i,empty:r}=o;return i.parent.type===this.type&&(r?e.commands.command(({tr:e})=>{var t;const{pos:o}=i,r=i.start(),a=i.end(),l=s.doc.textBetween(r,a,"\n","\n").split("\n");let c=0,u=0;const d=o-r;for(let n=0;n<l.length;n+=1){if(u+l[n].length>=d){c=n;break}u+=l[n].length+1}const p=(null==(t=l[c].match(/^ */))?void 0:t[0])||"",h=Math.min(p.length,n);if(0===h)return!0;let f=r;for(let n=0;n<c;n+=1)f+=l[n].length+1;e.delete(f,f+h);return o-f<=h&&e.setSelection(uh.create(e.doc,f)),!0}):e.commands.command(({tr:e})=>{const{from:t,to:i}=o,r=s.doc.textBetween(t,i,"\n","\n").split("\n").map(e=>{var t;const s=(null==(t=e.match(/^ */))?void 0:t[0])||"",o=Math.min(s.length,n);return e.slice(o)}).join("\n");return e.replaceWith(t,i,s.schema.text(r)),!0}))},Enter:({editor:e})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:t}=e,{selection:n}=t,{$from:s,empty:o}=n;if(!o||s.parent.type!==this.type)return!1;const i=s.parentOffset===s.parent.nodeSize-2,r=s.parent.textContent.endsWith("\n\n");return!(!i||!r)&&e.chain().command(({tr:e})=>(e.delete(s.pos-2,s.pos),!0)).exitCode().run()},ArrowDown:({editor:e})=>{if(!this.options.exitOnArrowDown)return!1;const{state:t}=e,{selection:n,doc:s}=t,{$from:o,empty:i}=n;if(!i||o.parent.type!==this.type)return!1;if(!(o.parentOffset===o.parent.nodeSize-2))return!1;const r=o.after();if(void 0===r)return!1;return s.nodeAt(r)?e.commands.command(({tr:e})=>(e.setSelection(rh.near(s.resolve(r))),!0)):e.commands.exitCode()}}},addInputRules(){return[hk({find:Vk,type:this.type,getAttributes:e=>({language:e[1]})}),hk({find:Wk,type:this.type,getAttributes:e=>({language:e[1]})})]},addProseMirrorPlugins(){return[new Eh({key:new Ah("codeBlockVSCodeHandler"),props:{handlePaste:(e,t)=>{if(!t.clipboardData)return!1;if(this.editor.isActive(this.type.name))return!1;const n=t.clipboardData.getData("text/plain"),s=t.clipboardData.getData("vscode-editor-data"),o=s?JSON.parse(s):void 0,i=null==o?void 0:o.mode;if(!n||!i)return!1;const{tr:r,schema:a}=e.state,l=a.text(n.replace(/\r\n?/g,"\n"));return r.replaceSelectionWith(this.type.create({language:i},l)),r.selection.$from.parent.type!==this.type&&r.setSelection(uh.near(r.doc.resolve(Math.max(0,r.selection.from-2)))),r.setMeta("paste",!0),e.dispatch(r),!0}}})]}}),zk=Ek.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(e,t)=>e.content?t.renderChildren(e.content,"\n\n"):""}),Hk=Ek.create({name:"hardBreak",markdownTokenName:"br",addOptions:()=>({keepMarks:!0,HTMLAttributes:{}}),inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML:()=>[{tag:"br"}],renderHTML({HTMLAttributes:e}){return["br",jv(this.options.HTMLAttributes,e)]},renderText:()=>"\n",renderMarkdown:()=>"  \n",parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:e,chain:t,state:n,editor:s})=>e.first([()=>e.exitCode(),()=>e.command(()=>{const{selection:e,storedMarks:o}=n;if(e.$from.parent.type.spec.isolating)return!1;const{keepMarks:i}=this.options,{splittableMarks:r}=s.extensionManager,a=o||e.$to.parentOffset&&e.$from.marks();return t().insertContent({type:this.name}).command(({tr:e,dispatch:t})=>{if(t&&a&&i){const t=a.filter(e=>r.includes(e.type.name));e.ensureMarks(t)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Kk=Ek.create({name:"heading",addOptions:()=>({levels:[1,2,3,4,5,6],HTMLAttributes:{}}),content:"inline*",group:"block",defining:!0,addAttributes:()=>({level:{default:1,rendered:!1}}),parseHTML(){return this.options.levels.map(e=>({tag:`h${e}`,attrs:{level:e}}))},renderHTML({node:e,HTMLAttributes:t}){return[`h${this.options.levels.includes(e.attrs.level)?e.attrs.level:this.options.levels[0]}`,jv(this.options.HTMLAttributes,t),0]},parseMarkdown:(e,t)=>t.createNode("heading",{level:e.depth||1},t.parseInline(e.tokens||[])),renderMarkdown:(e,t)=>{var n;const s=(null==(n=e.attrs)?void 0:n.level)?parseInt(e.attrs.level,10):1,o="#".repeat(s);return e.content?`${o} ${t.renderChildren(e.content)}`:""},addCommands(){return{setHeading:e=>({commands:t})=>!!this.options.levels.includes(e.level)&&t.setNode(this.name,e),toggleHeading:e=>({commands:t})=>!!this.options.levels.includes(e.level)&&t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return this.options.levels.reduce((e,t)=>({...e,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})}),{})},addInputRules(){return this.options.levels.map(e=>hk({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${e}})\\s$`),type:this.type,getAttributes:{level:e}}))}}),jk=Ek.create({name:"horizontalRule",addOptions:()=>({HTMLAttributes:{},nextNodeType:"paragraph"}),group:"block",parseHTML:()=>[{tag:"hr"}],renderHTML({HTMLAttributes:e}){return["hr",jv(this.options.HTMLAttributes,e)]},markdownTokenName:"hr",parseMarkdown:(e,t)=>t.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:e,state:t})=>{if(!function(e,t){const{selection:n}=e,{$from:s}=n;if(n instanceof ph){const e=s.index();return s.parent.canReplaceWith(e,e+1,t)}let o=s.depth;for(;o>=0;){const e=s.index(o);if(s.node(o).contentMatchAt(e).matchType(t))return!0;o-=1}return!1}(t,t.schema.nodes[this.name]))return!1;const{selection:n}=t,{$to:s}=n,o=e();return pb(n)?o.insertContentAt(s.pos,{type:this.name}):o.insertContent({type:this.name}),o.command(({state:e,tr:t,dispatch:n})=>{if(n){const{$to:n}=t.selection,s=n.end();if(n.nodeAfter)n.nodeAfter.isTextblock?t.setSelection(uh.create(t.doc,n.pos+1)):n.nodeAfter.isBlock?t.setSelection(ph.create(t.doc,n.pos)):t.setSelection(uh.create(t.doc,n.pos));else{const o=e.schema.nodes[this.options.nextNodeType]||n.parent.type.contentMatch.defaultType,i=null==o?void 0:o.create();i&&(t.insert(s,i),t.setSelection(uh.create(t.doc,s+1)))}t.scrollIntoView()}return!0}).run()}}},addInputRules(){return[pk({find:/^(?:---|â€”-|___\s|\*\*\*\s)$/,type:this.type})]}}),Yk=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,Zk=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,Xk=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,Jk=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Qk=Hb.create({name:"italic",addOptions:()=>({HTMLAttributes:{}}),parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:e=>"normal"!==e.style.fontStyle&&null},{style:"font-style=normal",clearMark:e=>e.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:e}){return["em",jv(this.options.HTMLAttributes,e),0]},addCommands(){return{setItalic:()=>({commands:e})=>e.setMark(this.name),toggleItalic:()=>({commands:e})=>e.toggleMark(this.name),unsetItalic:()=>({commands:e})=>e.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(e,t)=>t.applyMark("italic",t.parseInline(e.tokens||[])),renderMarkdown:(e,t)=>`*${t.renderChildren(e)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[dk({find:Yk,type:this.type}),dk({find:Xk,type:this.type})]},addPasteRules(){return[Ik({find:Zk,type:this.type}),Ik({find:Jk,type:this.type})]}});const qk="numeric",ew="ascii",tw="alpha",nw="asciinumeric",sw="alphanumeric",ow="domain",iw="emoji",rw="scheme",aw="slashscheme",lw="whitespace";function cw(e,t){return e in t||(t[e]=[]),t[e]}function uw(e,t,n){t[qk]&&(t[nw]=!0,t[sw]=!0),t[ew]&&(t[nw]=!0,t[tw]=!0),t[nw]&&(t[sw]=!0),t[tw]&&(t[sw]=!0),t[sw]&&(t[ow]=!0),t[iw]&&(t[ow]=!0);for(const s in t){const t=cw(s,n);t.indexOf(e)<0&&t.push(e)}}function dw(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}dw.groups={},dw.prototype={accepts(){return!!this.t},go(e){const t=this,n=t.j[e];if(n)return n;for(let s=0;s<t.jr.length;s++){const n=t.jr[s][0],o=t.jr[s][1];if(o&&n.test(e))return o}return t.jd},has(e,t=!1){return t?e in this.j:!!this.go(e)},ta(e,t,n,s){for(let o=0;o<e.length;o++)this.tt(e[o],t,n,s)},tr(e,t,n,s){let o;return s=s||dw.groups,t&&t.j?o=t:(o=new dw(t),n&&s&&uw(t,n,s)),this.jr.push([e,o]),o},ts(e,t,n,s){let o=this;const i=e.length;if(!i)return o;for(let r=0;r<i-1;r++)o=o.tt(e[r]);return o.tt(e[i-1],t,n,s)},tt(e,t,n,s){s=s||dw.groups;const o=this;if(t&&t.j)return o.j[e]=t,t;const i=t;let r,a=o.go(e);if(a?(r=new dw,Object.assign(r.j,a.j),r.jr.push.apply(r.jr,a.jr),r.jd=a.jd,r.t=a.t):r=new dw,i){if(s)if(r.t&&"string"==typeof r.t){const e=Object.assign(function(e,t){const n={};for(const s in t)t[s].indexOf(e)>=0&&(n[s]=!0);return n}(r.t,s),n);uw(i,e,s)}else n&&uw(i,n,s);r.t=i}return o.j[e]=r,r}};const pw=(e,t,n,s,o)=>e.ta(t,n,s,o),hw=(e,t,n,s,o)=>e.tr(t,n,s,o),fw=(e,t,n,s,o)=>e.ts(t,n,s,o),mw=(e,t,n,s,o)=>e.tt(t,n,s,o),gw="WORD",yw="UWORD",vw="ASCIINUMERICAL",bw="ALPHANUMERICAL",kw="LOCALHOST",ww="TLD",Sw="UTLD",Cw="SCHEME",Tw="SLASH_SCHEME",Ew="NUM",Iw="WS",xw="NL",Aw="OPENBRACE",Nw="CLOSEBRACE",Mw="OPENBRACKET",Rw="CLOSEBRACKET",_w="OPENPAREN",Ow="CLOSEPAREN",Dw="OPENANGLEBRACKET",Bw="CLOSEANGLEBRACKET",Lw="FULLWIDTHLEFTPAREN",Fw="FULLWIDTHRIGHTPAREN",Pw="LEFTCORNERBRACKET",$w="RIGHTCORNERBRACKET",Uw="LEFTWHITECORNERBRACKET",Vw="RIGHTWHITECORNERBRACKET",Ww="FULLWIDTHLESSTHAN",Gw="FULLWIDTHGREATERTHAN",zw="AMPERSAND",Hw="APOSTROPHE",Kw="ASTERISK",jw="AT",Yw="BACKSLASH",Zw="BACKTICK",Xw="CARET",Jw="COLON",Qw="COMMA",qw="DOLLAR",eS="DOT",tS="EQUALS",nS="EXCLAMATION",sS="HYPHEN",oS="PERCENT",iS="PIPE",rS="PLUS",aS="POUND",lS="QUERY",cS="QUOTE",uS="FULLWIDTHMIDDLEDOT",dS="SEMI",pS="SLASH",hS="TILDE",fS="UNDERSCORE",mS="EMOJI",gS="SYM";var yS=Object.freeze({__proto__:null,ALPHANUMERICAL:bw,AMPERSAND:zw,APOSTROPHE:Hw,ASCIINUMERICAL:vw,ASTERISK:Kw,AT:jw,BACKSLASH:Yw,BACKTICK:Zw,CARET:Xw,CLOSEANGLEBRACKET:Bw,CLOSEBRACE:Nw,CLOSEBRACKET:Rw,CLOSEPAREN:Ow,COLON:Jw,COMMA:Qw,DOLLAR:qw,DOT:eS,EMOJI:mS,EQUALS:tS,EXCLAMATION:nS,FULLWIDTHGREATERTHAN:Gw,FULLWIDTHLEFTPAREN:Lw,FULLWIDTHLESSTHAN:Ww,FULLWIDTHMIDDLEDOT:uS,FULLWIDTHRIGHTPAREN:Fw,HYPHEN:sS,LEFTCORNERBRACKET:Pw,LEFTWHITECORNERBRACKET:Uw,LOCALHOST:kw,NL:xw,NUM:Ew,OPENANGLEBRACKET:Dw,OPENBRACE:Aw,OPENBRACKET:Mw,OPENPAREN:_w,PERCENT:oS,PIPE:iS,PLUS:rS,POUND:aS,QUERY:lS,QUOTE:cS,RIGHTCORNERBRACKET:$w,RIGHTWHITECORNERBRACKET:Vw,SCHEME:Cw,SEMI:dS,SLASH:pS,SLASH_SCHEME:Tw,SYM:gS,TILDE:hS,TLD:ww,UNDERSCORE:fS,UTLD:Sw,UWORD:yw,WORD:gw,WS:Iw});const vS=/[a-z]/,bS=/\p{L}/u,kS=/\p{Emoji}/u,wS=/\d/,SS=/\s/;let CS=null,TS=null;function ES(e,t){const n=function(e){const t=[],n=e.length;let s=0;for(;s<n;){let o,i=e.charCodeAt(s),r=i<55296||i>56319||s+1===n||(o=e.charCodeAt(s+1))<56320||o>57343?e[s]:e.slice(s,s+2);t.push(r),s+=r.length}return t}(t.replace(/[A-Z]/g,e=>e.toLowerCase())),s=n.length,o=[];let i=0,r=0;for(;r<s;){let a=e,l=null,c=0,u=null,d=-1,p=-1;for(;r<s&&(l=a.go(n[r]));)a=l,a.accepts()?(d=0,p=0,u=a):d>=0&&(d+=n[r].length,p++),c+=n[r].length,i+=n[r].length,r++;i-=d,r-=p,c-=d,o.push({t:u.t,v:t.slice(i-c,i),s:i-c,e:i})}return o}function IS(e,t,n,s,o){let i;const r=t.length;for(let a=0;a<r-1;a++){const n=t[a];e.j[n]?i=e.j[n]:(i=new dw(s),i.jr=o.slice(),e.j[n]=i),e=i}return i=new dw(n),i.jr=o.slice(),e.j[t[r-1]]=i,i}function xS(e){const t=[],n=[];let s=0;for(;s<e.length;){let o=0;for(;"0123456789".indexOf(e[s+o])>=0;)o++;if(o>0){t.push(n.join(""));for(let t=parseInt(e.substring(s,s+o),10);t>0;t--)n.pop();s+=o}else n.push(e[s]),s++}return t}const AS={defaultProtocol:"http",events:null,format:MS,formatHref:MS,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function NS(e,t=null){let n=Object.assign({},AS);e&&(n=Object.assign(n,e instanceof NS?e.o:e));const s=n.ignoreTags,o=[];for(let i=0;i<s.length;i++)o.push(s[i].toUpperCase());this.o=n,t&&(this.defaultRender=t),this.ignoreTags=o}function MS(e){return e}function RS(e,t){this.t="token",this.v=e,this.tk=t}function _S(e,t){class n extends RS{constructor(t,n){super(t,n),this.t=e}}for(const s in t)n.prototype[s]=t[s];return n.t=e,n}NS.prototype={o:AS,ignoreTags:[],defaultRender:e=>e,check(e){return this.get("validate",e.toString(),e)},get(e,t,n){const s=null!=t;let o=this.o[e];return o?("object"==typeof o?(o=n.t in o?o[n.t]:AS[e],"function"==typeof o&&s&&(o=o(t,n))):"function"==typeof o&&s&&(o=o(t,n.t,n)),o):o},getObj(e,t,n){let s=this.o[e];return"function"==typeof s&&null!=t&&(s=s(t,n.t,n)),s},render(e){const t=e.render(this);return(this.get("render",null,e)||this.defaultRender)(t,e.t,e)}},RS.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const t=this.toString(),n=e.get("truncate",t,this),s=e.get("format",t,this);return n&&s.length>n?s.substring(0,n)+"â€¦":s},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=AS.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const t=this,n=this.toHref(e.get("defaultProtocol")),s=e.get("formatHref",n,this),o=e.get("tagName",n,t),i=this.toFormattedString(e),r={},a=e.get("className",n,t),l=e.get("target",n,t),c=e.get("rel",n,t),u=e.getObj("attributes",n,t),d=e.getObj("events",n,t);return r.href=s,a&&(r.class=a),l&&(r.target=l),c&&(r.rel=c),u&&Object.assign(r,u),{tagName:o,attributes:r,content:i,eventListeners:d}}};const OS=_S("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),DS=_S("text"),BS=_S("nl"),LS=_S("url",{isLink:!0,toHref(e=AS.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==kw&&e[1].t===Jw}}),FS=e=>new dw(e);function PS(e,t,n){const s=n[0].s,o=n[n.length-1].e;return new e(t.slice(s,o),n)}const $S="undefined"!=typeof console&&console&&console.warn||(()=>{}),US={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function VS(e,t=!1){if(US.initialized&&$S(`linkifyjs: already initialized - will not register custom scheme "${e}" until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(e))throw new Error('linkifyjs: incorrect scheme format.\n1. Must only contain digits, lowercase ASCII letters or "-"\n2. Cannot start or end with "-"\n3. "-" cannot repeat');US.customSchemes.push([e,t])}function WS(){US.scanner=function(e=[]){const t={};dw.groups=t;const n=new dw;null==CS&&(CS=xS("aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mÃ¶gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2")),null==TS&&(TS=xS("ÎµÎ»1Ï…2Ð±Ð³1ÐµÐ»3Ð´ÐµÑ‚Ð¸4ÐµÑŽ2ÐºÐ°Ñ‚Ð¾Ð»Ð¸Ðº6Ð¾Ð¼3Ð¼ÐºÐ´2Ð¾Ð½1ÑÐºÐ²Ð°6Ð¾Ð½Ð»Ð°Ð¹Ð½5Ñ€Ð³3Ñ€ÑƒÑ2Ñ„2ÑÐ°Ð¹Ñ‚3Ñ€Ð±3ÑƒÐºÑ€3Ò›Ð°Ð·3Õ°Õ¡Õµ3×™×©×¨××œ5×§×•×3Ø§Ø¨ÙˆØ¸Ø¨ÙŠ5Ø±Ø§Ù…ÙƒÙˆ5Ù„Ø§Ø±Ø¯Ù†4Ø¨Ø­Ø±ÙŠÙ†5Ø¬Ø²Ø§Ø¦Ø±5Ø³Ø¹ÙˆØ¯ÙŠØ©6Ø¹Ù„ÙŠØ§Ù†5Ù…ØºØ±Ø¨5Ù…Ø§Ø±Ø§Øª5ÛŒØ±Ø§Ù†5Ø¨Ø§Ø±Øª2Ø²Ø§Ø±4ÙŠØªÙƒ3Ú¾Ø§Ø±Øª5ØªÙˆÙ†Ø³4Ø³ÙˆØ¯Ø§Ù†3Ø±ÙŠØ©5Ø´Ø¨ÙƒØ©4Ø¹Ø±Ø§Ù‚2Ø¨2Ù…Ø§Ù†4ÙÙ„Ø³Ø·ÙŠÙ†6Ù‚Ø·Ø±3ÙƒØ§Ø«ÙˆÙ„ÙŠÙƒ6ÙˆÙ…3Ù…ØµØ±2Ù„ÙŠØ³ÙŠØ§5ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§7Ù‚Ø¹4Ù‡Ù…Ø±Ø§Ù‡5Ù¾Ø§Ú©Ø³ØªØ§Ù†7Ú€Ø§Ø±Øª4à¤•à¥‰à¤®3à¤¨à¥‡à¤Ÿ3à¤­à¤¾à¤°à¤¤0à¤®à¥3à¥‹à¤¤5à¤¸à¤‚à¤—à¤ à¤¨5à¦¬à¦¾à¦‚à¦²à¦¾5à¦­à¦¾à¦°à¦¤2à§°à¦¤4à¨­à¨¾à¨°à¨¤4àª­àª¾àª°àª¤4à¬­à¬¾à¬°à¬¤4à®‡à®¨à¯à®¤à®¿à®¯à®¾6à®²à®™à¯à®•à¯ˆ6à®šà®¿à®™à¯à®•à®ªà¯à®ªà¯‚à®°à¯11à°­à°¾à°°à°¤à±5à²­à²¾à²°à²¤4à´­à´¾à´°à´¤à´‚5à¶½à¶‚à¶šà·4à¸„à¸­à¸¡3à¹„à¸—à¸¢3àº¥àº²àº§3áƒ’áƒ”2ã¿ã‚“ãª3ã‚¢ãƒžã‚¾ãƒ³4ã‚¯ãƒ©ã‚¦ãƒ‰4ã‚°ãƒ¼ã‚°ãƒ«4ã‚³ãƒ 2ã‚¹ãƒˆã‚¢3ã‚»ãƒ¼ãƒ«3ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³6ãƒã‚¤ãƒ³ãƒˆ4ä¸–ç•Œ2ä¸­ä¿¡1å›½1åœ‹1æ–‡ç½‘3äºšé©¬é€Š3ä¼ä¸š2ä½›å±±2ä¿¡æ¯2å¥åº·2å…«å¦2å…¬å¸1ç›Š2å°æ¹¾1ç£2å•†åŸŽ1åº—1æ ‡2å˜‰é‡Œ0å¤§é…’åº—5åœ¨çº¿2å¤§æ‹¿2å¤©ä¸»æ•™3å¨±ä¹2å®¶é›»2å¹¿ä¸œ2å¾®åš2æ…ˆå–„2æˆ‘çˆ±ä½ 3æ‰‹æœº2æ‹›è˜2æ”¿åŠ¡1åºœ2æ–°åŠ å¡2é—»2æ—¶å°š2æ›¸ç±2æœºæž„2æ·¡é©¬é”¡3æ¸¸æˆ2æ¾³é–€2ç‚¹çœ‹2ç§»åŠ¨2ç»„ç»‡æœºæž„4ç½‘å€1åº—1ç«™1ç»œ2è”é€š2è°·æ­Œ2è´­ç‰©2é€šè²©2é›†å›¢2é›»è¨Šç›ˆç§‘4é£žåˆ©æµ¦3é£Ÿå“2é¤åŽ…2é¦™æ ¼é‡Œæ‹‰3æ¸¯2ë‹·ë„·1ì»´2ì‚¼ì„±2í•œêµ­2")),mw(n,"'",Hw),mw(n,"{",Aw),mw(n,"}",Nw),mw(n,"[",Mw),mw(n,"]",Rw),mw(n,"(",_w),mw(n,")",Ow),mw(n,"<",Dw),mw(n,">",Bw),mw(n,"ï¼ˆ",Lw),mw(n,"ï¼‰",Fw),mw(n,"ã€Œ",Pw),mw(n,"ã€",$w),mw(n,"ã€Ž",Uw),mw(n,"ã€",Vw),mw(n,"ï¼œ",Ww),mw(n,"ï¼ž",Gw),mw(n,"&",zw),mw(n,"*",Kw),mw(n,"@",jw),mw(n,"`",Zw),mw(n,"^",Xw),mw(n,":",Jw),mw(n,",",Qw),mw(n,"$",qw),mw(n,".",eS),mw(n,"=",tS),mw(n,"!",nS),mw(n,"-",sS),mw(n,"%",oS),mw(n,"|",iS),mw(n,"+",rS),mw(n,"#",aS),mw(n,"?",lS),mw(n,'"',cS),mw(n,"/",pS),mw(n,";",dS),mw(n,"~",hS),mw(n,"_",fS),mw(n,"\\",Yw),mw(n,"ãƒ»",uS);const s=hw(n,wS,Ew,{[qk]:!0});hw(s,wS,s);const o=hw(s,vS,vw,{[nw]:!0}),i=hw(s,bS,bw,{[sw]:!0}),r=hw(n,vS,gw,{[ew]:!0});hw(r,wS,o),hw(r,vS,r),hw(o,wS,o),hw(o,vS,o);const a=hw(n,bS,yw,{[tw]:!0});hw(a,vS),hw(a,wS,i),hw(a,bS,a),hw(i,wS,i),hw(i,vS),hw(i,bS,i);const l=mw(n,"\n",xw,{[lw]:!0}),c=mw(n,"\r",Iw,{[lw]:!0}),u=hw(n,SS,Iw,{[lw]:!0});mw(n,"ï¿¼",u),mw(c,"\n",l),mw(c,"ï¿¼",u),hw(c,SS,u),mw(u,"\r"),mw(u,"\n"),hw(u,SS,u),mw(u,"ï¿¼",u);const d=hw(n,kS,mS,{[iw]:!0});mw(d,"#"),hw(d,kS,d),mw(d,"ï¸",d);const p=mw(d,"â€");mw(p,"#"),hw(p,kS,d);const h=[[vS,r],[wS,o]],f=[[vS,null],[bS,a],[wS,i]];for(let m=0;m<CS.length;m++)IS(n,CS[m],ww,gw,h);for(let m=0;m<TS.length;m++)IS(n,TS[m],Sw,yw,f);uw(ww,{tld:!0,ascii:!0},t),uw(Sw,{utld:!0,alpha:!0},t),IS(n,"file",Cw,gw,h),IS(n,"mailto",Cw,gw,h),IS(n,"http",Tw,gw,h),IS(n,"https",Tw,gw,h),IS(n,"ftp",Tw,gw,h),IS(n,"ftps",Tw,gw,h),uw(Cw,{scheme:!0,ascii:!0},t),uw(Tw,{slashscheme:!0,ascii:!0},t),e=e.sort((e,t)=>e[0]>t[0]?1:-1);for(let m=0;m<e.length;m++){const t=e[m][0],s=e[m][1]?{[rw]:!0}:{[aw]:!0};t.indexOf("-")>=0?s[ow]=!0:vS.test(t)?wS.test(t)?s[nw]=!0:s[ew]=!0:s[qk]=!0,fw(n,t,t,s)}return fw(n,"localhost",kw,{ascii:!0}),n.jd=new dw(gS),{start:n,tokens:Object.assign({groups:t},yS)}}(US.customSchemes);for(let e=0;e<US.tokenQueue.length;e++)US.tokenQueue[e][1]({scanner:US.scanner});US.parser=function({groups:e}){const t=e.domain.concat([zw,Kw,jw,Yw,Zw,Xw,qw,tS,sS,Ew,oS,iS,rS,aS,pS,gS,hS,fS]),n=[Hw,Jw,Qw,eS,nS,oS,lS,cS,dS,Dw,Bw,Aw,Nw,Rw,Mw,_w,Ow,Lw,Fw,Pw,$w,Uw,Vw,Ww,Gw],s=[zw,Hw,Kw,Yw,Zw,Xw,qw,tS,sS,Aw,Nw,oS,iS,rS,aS,lS,pS,gS,hS,fS],o=FS(),i=mw(o,hS);pw(i,s,i),pw(i,e.domain,i);const r=FS(),a=FS(),l=FS();pw(o,e.domain,r),pw(o,e.scheme,a),pw(o,e.slashscheme,l),pw(r,s,i),pw(r,e.domain,r);const c=mw(r,jw);mw(i,jw,c),mw(a,jw,c),mw(l,jw,c);const u=mw(i,eS);pw(u,s,i),pw(u,e.domain,i);const d=FS();pw(c,e.domain,d),pw(d,e.domain,d);const p=mw(d,eS);pw(p,e.domain,d);const h=FS(OS);pw(p,e.tld,h),pw(p,e.utld,h),mw(c,kw,h);const f=mw(d,sS);mw(f,sS,f),pw(f,e.domain,d),pw(h,e.domain,d),mw(h,eS,p),mw(h,sS,f);const m=mw(h,Jw);pw(m,e.numeric,OS);const g=mw(r,sS),y=mw(r,eS);mw(g,sS,g),pw(g,e.domain,r),pw(y,s,i),pw(y,e.domain,r);const v=FS(LS);pw(y,e.tld,v),pw(y,e.utld,v),pw(v,e.domain,r),pw(v,s,i),mw(v,eS,y),mw(v,sS,g),mw(v,jw,c);const b=mw(v,Jw),k=FS(LS);pw(b,e.numeric,k);const w=FS(LS),S=FS();pw(w,t,w),pw(w,n,S),pw(S,t,w),pw(S,n,S),mw(v,pS,w),mw(k,pS,w);const C=mw(a,Jw),T=mw(l,Jw),E=mw(T,pS),I=mw(E,pS);pw(a,e.domain,r),mw(a,eS,y),mw(a,sS,g),pw(l,e.domain,r),mw(l,eS,y),mw(l,sS,g),pw(C,e.domain,w),mw(C,pS,w),mw(C,lS,w),pw(I,e.domain,w),pw(I,t,w),mw(I,pS,w);const x=[[Aw,Nw],[Mw,Rw],[_w,Ow],[Dw,Bw],[Lw,Fw],[Pw,$w],[Uw,Vw],[Ww,Gw]];for(let A=0;A<x.length;A++){const[e,s]=x[A],o=mw(w,e);mw(S,e,o),mw(o,s,w);const i=FS(LS);pw(o,t,i);const r=FS();pw(o,n),pw(i,t,i),pw(i,n,r),pw(r,t,i),pw(r,n,r),mw(i,s,w),mw(r,s,w)}return mw(o,kw,v),mw(o,xw,BS),{start:o,tokens:yS}}(US.scanner.tokens);for(let e=0;e<US.pluginQueue.length;e++)US.pluginQueue[e][1]({scanner:US.scanner,parser:US.parser});return US.initialized=!0,US}function GS(e){return US.initialized||WS(),function(e,t,n){let s=n.length,o=0,i=[],r=[];for(;o<s;){let a=e,l=null,c=null,u=0,d=null,p=-1;for(;o<s&&!(l=a.go(n[o].t));)r.push(n[o++]);for(;o<s&&(c=l||a.go(n[o].t));)l=null,a=c,a.accepts()?(p=0,d=a):p>=0&&p++,o++,u++;if(p<0)o-=u,o<s&&(r.push(n[o]),o++);else{r.length>0&&(i.push(PS(DS,t,r)),r=[]),o-=p,u-=p;const e=d.t,s=n.slice(o-u,o);i.push(PS(e,t,s))}}return r.length>0&&i.push(PS(DS,t,r)),i}(US.parser.start,e,ES(US.scanner.start,e))}function zS(e,t=null,n=null){if(t&&"object"==typeof t){if(n)throw Error(`linkifyjs: Invalid link type ${t}; must be a string`);n=t,t=null}const s=new NS(n),o=GS(e),i=[];for(let r=0;r<o.length;r++){const e=o[r];!e.isLink||t&&e.t!==t||!s.check(e)||i.push(e.toFormattedObject(s))}return i}GS.scan=ES;var HS="[\0- Â áš€á Žâ€€-\u2029âŸã€€]",KS=new RegExp(HS),jS=new RegExp(`${HS}$`),YS=new RegExp(HS,"g");function ZS(e,t){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return t&&t.forEach(e=>{const t="string"==typeof e?e:e.scheme;t&&n.push(t)}),!e||e.replace(YS,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var XS=Hb.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(e=>{"string"!=typeof e?VS(e.scheme,e.optionalSlashes):VS(e)})},onDestroy(){dw.groups={},US.scanner=null,US.parser=null,US.tokenQueue=[],US.pluginQueue=[],US.customSchemes=[],US.initialized=!1},inclusive(){return this.options.autolink},addOptions:()=>({openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(e,t)=>!!ZS(e,t.protocols),validate:e=>!!e,shouldAutoLink:e=>!!e}),addAttributes(){return{href:{default:null,parseHTML:e=>e.getAttribute("href")},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:e=>{const t=e.getAttribute("href");return!(!t||!this.options.isAllowedUri(t,{defaultValidate:e=>!!ZS(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol}))&&null}}]},renderHTML({HTMLAttributes:e}){return this.options.isAllowedUri(e.href,{defaultValidate:e=>!!ZS(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",jv(this.options.HTMLAttributes,e),0]:["a",jv(this.options.HTMLAttributes,{...e,href:""}),0]},markdownTokenName:"link",parseMarkdown:(e,t)=>t.applyMark("link",t.parseInline(e.tokens||[]),{href:e.href,title:e.title||null}),renderMarkdown:(e,t)=>{var n;const s=(null==(n=e.attrs)?void 0:n.href)||"";return`[${t.renderChildren(e)}](${s})`},addCommands(){return{setLink:e=>({chain:t})=>{const{href:n}=e;return!!this.options.isAllowedUri(n,{defaultValidate:e=>!!ZS(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})&&t().setMark(this.name,e).setMeta("preventAutolink",!0).run()},toggleLink:e=>({chain:t})=>{const{href:n}=e||{};return!(n&&!this.options.isAllowedUri(n,{defaultValidate:e=>!!ZS(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol}))&&t().toggleMark(this.name,e,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:e})=>e().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Ik({find:e=>{const t=[];if(e){const{protocols:n,defaultProtocol:s}=this.options,o=zS(e).filter(e=>e.isLink&&this.options.isAllowedUri(e.value,{defaultValidate:e=>!!ZS(e,n),protocols:n,defaultProtocol:s}));o.length&&o.forEach(e=>{this.options.shouldAutoLink(e.value)&&t.push({text:e.value,data:{href:e.href},index:e.start})})}return t},type:this.type,getAttributes:e=>{var t;return{href:null==(t=e.data)?void 0:t.href}}})]},addProseMirrorPlugins(){const e=[],{protocols:t,defaultProtocol:n}=this.options;var s;return this.options.autolink&&e.push((s={type:this.type,defaultProtocol:this.options.defaultProtocol,validate:e=>this.options.isAllowedUri(e,{defaultValidate:e=>!!ZS(e,t),protocols:t,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink},new Eh({key:new Ah("autolink"),appendTransaction:(e,t,n)=>{const o=e.some(e=>e.docChanged)&&!t.doc.eq(n.doc),i=e.some(e=>e.getMeta("preventAutolink"));if(!o||i)return;const{tr:r}=n;return ob(Pv(t.doc,[...e])).forEach(({newRange:e})=>{const t=function(e,t,n){const s=[];return e.nodesBetween(t.from,t.to,(e,t)=>{n(e)&&s.push({node:e,pos:t})}),s}(n.doc,e,e=>e.isTextblock);let o,i;if(t.length>1)o=t[0],i=n.doc.textBetween(o.pos,o.pos+o.node.nodeSize,void 0," ");else if(t.length){const s=n.doc.textBetween(e.from,e.to," "," ");if(!jS.test(s))return;o=t[0],i=n.doc.textBetween(o.pos,e.to,void 0," ")}if(o&&i){const e=i.split(KS).filter(Boolean);if(e.length<=0)return!1;const t=e[e.length-1],l=o.pos+i.lastIndexOf(t);if(!t)return!1;const c=GS(t).map(e=>e.toObject(s.defaultProtocol));if(!(1===(a=c).length?a[0].isLink:3===a.length&&a[1].isLink&&["()","[]"].includes(a[0].value+a[2].value)))return!1;c.filter(e=>e.isLink).map(e=>({...e,from:l+e.start+1,to:l+e.end+1})).filter(e=>!n.schema.marks.code||!n.doc.rangeHasMark(e.from,e.to,n.schema.marks.code)).filter(e=>s.validate(e.value)).filter(e=>s.shouldAutoLink(e.value)).forEach(e=>{ib(e.from,e.to,n.doc).some(e=>e.mark.type===s.type)||r.addMark(e.from,e.to,s.type.create({href:e.href}))})}var a}),r.steps.length?r:void 0}}))),e.push(function(e){return new Eh({key:new Ah("handleClickLink"),props:{handleClick:(t,n,s)=>{var o,i;if(0!==s.button)return!1;if(!t.editable)return!1;let r=!1;if(e.enableClickSelection&&(r=e.editor.commands.extendMarkRange(e.type.name)),e.openOnClick){let n=null;if(s.target instanceof HTMLAnchorElement)n=s.target;else{let e=s.target;const t=[];for(;"DIV"!==e.nodeName;)t.push(e),e=e.parentNode;n=t.find(e=>"A"===e.nodeName)}if(!n)return r;const a=nb(t.state,e.type.name),l=null!=(o=null==n?void 0:n.href)?o:a.href,c=null!=(i=null==n?void 0:n.target)?i:a.target;n&&l&&(window.open(l,c),r=!0)}return r}}})}({type:this.type,editor:this.editor,openOnClick:"whenNotEditable"===this.options.openOnClick||this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&e.push(function(e){return new Eh({key:new Ah("handlePasteLink"),props:{handlePaste:(t,n,s)=>{const{shouldAutoLink:o}=e,{state:i}=t,{selection:r}=i,{empty:a}=r;if(a)return!1;let l="";s.content.forEach(e=>{l+=e.textContent});const c=zS(l,{defaultProtocol:e.defaultProtocol}).find(e=>e.isLink&&e.value===l);return!(!l||!c||void 0!==o&&!o(c.href))&&e.editor.commands.setMark(e.type,{href:c.href})}}})}({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),e}}),JS=XS,QS=Object.defineProperty,qS="textStyle",eC=/^\s*([-+*])\s$/,tC=Ek.create({name:"bulletList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML:()=>[{tag:"ul"}],renderHTML({HTMLAttributes:e}){return["ul",jv(this.options.HTMLAttributes,e),0]},markdownTokenName:"list",parseMarkdown:(e,t)=>"list"!==e.type||e.ordered?[]:{type:"bulletList",content:e.items?t.parseChildren(e.items):[]},renderMarkdown:(e,t)=>e.content?t.renderChildren(e.content,"\n"):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes("listItem",this.editor.getAttributes(qS)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let e=fk({find:eC,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(e=fk({find:eC,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(qS),editor:this.editor})),[e]}}),nC=Ek.create({name:"listItem",addOptions:()=>({HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes:e}){return["li",jv(this.options.HTMLAttributes,e),0]},markdownTokenName:"list_item",parseMarkdown:(e,t)=>{if("list_item"!==e.type)return[];let n=[];if(e.tokens&&e.tokens.length>0){if(e.tokens.some(e=>"paragraph"===e.type))n=t.parseChildren(e.tokens);else{const s=e.tokens[0];if(s&&"text"===s.type&&s.tokens&&s.tokens.length>0){if(n=[{type:"paragraph",content:t.parseInline(s.tokens)}],e.tokens.length>1){const s=e.tokens.slice(1),o=t.parseChildren(s);n.push(...o)}}else n=t.parseChildren(e.tokens)}}return 0===n.length&&(n=[{type:"paragraph",content:[]}]),{type:"listItem",content:n}},renderMarkdown:(e,t,n)=>Tk(e,t,e=>"bulletList"===e.parentType?"- ":"orderedList"===e.parentType?`${e.index+1}. `:"- ",n),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}});((e,t)=>{for(var n in t)QS(e,n,{get:t[n],enumerable:!0})})({},{findListItemPos:()=>sC,getNextListDepth:()=>oC,handleBackspace:()=>lC,handleDelete:()=>dC,hasListBefore:()=>iC,hasListItemAfter:()=>pC,hasListItemBefore:()=>rC,listItemHasSubList:()=>aC,nextListIsDeeper:()=>cC,nextListIsHigher:()=>uC});var sC=(e,t)=>{const{$from:n}=t.selection,s=$y(e,t.schema);let o=null,i=n.depth,r=n.pos,a=null;for(;i>0&&null===a;)o=n.node(i),o.type===s?a=i:(i-=1,r-=1);return null===a?null:{$pos:t.doc.resolve(r),depth:a}},oC=(e,t)=>{const n=sC(e,t);if(!n)return!1;const[,s]=((e,t,n,s=20)=>{const o=e.doc.resolve(n);let i=s,r=null;for(;i>0&&null===r;){const e=o.node(i);(null==e?void 0:e.type.name)===t?r=e:i-=1}return[r,i]})(t,e,n.$pos.pos+4);return s},iC=(e,t,n)=>{const{$anchor:s}=e.selection,o=Math.max(0,s.pos-2),i=e.doc.resolve(o).node();return!(!i||!n.includes(i.type.name))},rC=(e,t)=>{var n;const{$anchor:s}=t.selection,o=t.doc.resolve(s.pos-2);return 0!==o.index()&&(null==(n=o.nodeBefore)?void 0:n.type.name)===e},aC=(e,t,n)=>{if(!n)return!1;const s=$y(e,t.schema);let o=!1;return n.descendants(e=>{e.type===s&&(o=!0)}),o},lC=(e,t,n)=>{if(e.commands.undoInputRule())return!0;if(e.state.selection.from!==e.state.selection.to)return!1;if(!kv(e.state,t)&&iC(e.state,t,n)){const{$anchor:n}=e.state.selection,s=e.state.doc.resolve(n.before()-1),o=[];s.node().descendants((e,n)=>{e.type.name===t&&o.push({node:e,pos:n})});const i=o.at(-1);if(!i)return!1;const r=e.state.doc.resolve(s.start()+i.pos+1);return e.chain().cut({from:n.start()-1,to:n.end()+1},r.end()).joinForward().run()}if(!kv(e.state,t))return!1;if(!(e=>{const{$from:t,$to:n}=e.selection;return!(t.parentOffset>0||t.pos!==n.pos)})(e.state))return!1;const s=sC(t,e.state);if(!s)return!1;const o=e.state.doc.resolve(s.$pos.pos-2).node(s.depth),i=aC(t,e.state,o);return rC(t,e.state)&&!i?e.commands.joinItemBackward():e.chain().liftListItem(t).run()},cC=(e,t)=>{const n=oC(e,t),s=sC(e,t);return!(!s||!n)&&n>s.depth},uC=(e,t)=>{const n=oC(e,t),s=sC(e,t);return!(!s||!n)&&n<s.depth},dC=(e,t)=>{if(!kv(e.state,t))return!1;if(!((e,t)=>{const{$from:n,$to:s,$anchor:o}=e.selection;if(t){const n=$v(e=>e.type.name===t)(e.selection);if(!n)return!1;const s=e.doc.resolve(n.pos+1);return o.pos+1===s.end()}return!(s.parentOffset<s.parent.nodeSize-2||n.pos!==s.pos)})(e.state,t))return!1;const{selection:n}=e.state,{$from:s,$to:o}=n;return!(!n.empty&&s.sameParent(o))&&(cC(t,e.state)?e.chain().focus(e.state.selection.from+4).lift(t).joinBackward().run():uC(t,e.state)?e.chain().joinForward().joinBackward().run():e.commands.joinItemForward())},pC=(e,t)=>{var n;const{$anchor:s}=t.selection,o=t.doc.resolve(s.pos-s.parentOffset-2);return o.index()!==o.parent.childCount-1&&(null==(n=o.nodeAfter)?void 0:n.type.name)===e},hC=Jb.create({name:"listKeymap",addOptions:()=>({listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}),addKeyboardShortcuts(){return{Delete:({editor:e})=>{let t=!1;return this.options.listTypes.forEach(({itemName:n})=>{void 0!==e.state.schema.nodes[n]&&dC(e,n)&&(t=!0)}),t},"Mod-Delete":({editor:e})=>{let t=!1;return this.options.listTypes.forEach(({itemName:n})=>{void 0!==e.state.schema.nodes[n]&&dC(e,n)&&(t=!0)}),t},Backspace:({editor:e})=>{let t=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:s})=>{void 0!==e.state.schema.nodes[n]&&lC(e,n,s)&&(t=!0)}),t},"Mod-Backspace":({editor:e})=>{let t=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:s})=>{void 0!==e.state.schema.nodes[n]&&lC(e,n,s)&&(t=!0)}),t}}}}),fC=/^(\s*)(\d+)\.\s+(.*)$/,mC=/^\s/;function gC(e,t,n){var s;const o=[];let i=0;for(;i<e.length;){const r=e[i];if(r.indent===t){const a=r.content.split("\n"),l=(null==(s=a[0])?void 0:s.trim())||"",c=[];l&&c.push({type:"paragraph",raw:l,tokens:n.inlineTokens(l)});const u=a.slice(1).join("\n").trim();if(u){const e=n.blockTokens(u);c.push(...e)}let d=i+1;const p=[];for(;d<e.length&&e[d].indent>t;)p.push(e[d]),d+=1;if(p.length>0){const e=Math.min(...p.map(e=>e.indent)),t=gC(p,e,n);c.push({type:"list",ordered:!0,start:p[0].number,items:t,raw:p.map(e=>e.raw).join("\n")})}o.push({type:"list_item",raw:r.raw,tokens:c}),i=d}else i+=1}return o}var yC="textStyle",vC=/^(\d+)\.\s$/,bC=Ek.create({name:"orderedList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes:()=>({start:{default:1,parseHTML:e=>e.hasAttribute("start")?parseInt(e.getAttribute("start")||"",10):1},type:{default:null,parseHTML:e=>e.getAttribute("type")}}),parseHTML:()=>[{tag:"ol"}],renderHTML({HTMLAttributes:e}){const{start:t,...n}=e;return 1===t?["ol",jv(this.options.HTMLAttributes,n),0]:["ol",jv(this.options.HTMLAttributes,e),0]},markdownTokenName:"list",parseMarkdown:(e,t)=>{if("list"!==e.type||!e.ordered)return[];const n=e.start||1,s=e.items?function(e,t){return e.map(e=>{if("list_item"!==e.type)return t.parseChildren([e])[0];const n=[];return e.tokens&&e.tokens.length>0&&e.tokens.forEach(e=>{if("paragraph"===e.type||"list"===e.type||"blockquote"===e.type||"code"===e.type)n.push(...t.parseChildren([e]));else if("text"===e.type&&e.tokens){const s=t.parseChildren([e]);n.push({type:"paragraph",content:s})}else{const s=t.parseChildren([e]);s.length>0&&n.push(...s)}}),{type:"listItem",content:n}})}(e.items,t):[];return 1!==n?{type:"orderedList",attrs:{start:n},content:s}:{type:"orderedList",content:s}},renderMarkdown:(e,t)=>e.content?t.renderChildren(e.content,"\n"):"",markdownTokenizer:{name:"orderedList",level:"block",start:e=>{const t=e.match(/^(\s*)(\d+)\.\s+/),n=null==t?void 0:t.index;return void 0!==n?n:-1},tokenize:(e,t,n)=>{var s;const o=e.split("\n"),[i,r]=function(e){const t=[];let n=0,s=0;for(;n<e.length;){const o=e[n],i=o.match(fC);if(!i)break;const[,r,a,l]=i,c=r.length;let u=l,d=n+1;const p=[o];for(;d<e.length;){const t=e[d];if(t.match(fC))break;if(""===t.trim())p.push(t),u+="\n",d+=1;else{if(!t.match(mC))break;p.push(t),u+=`\n${t.slice(c+2)}`,d+=1}}t.push({indent:c,number:parseInt(a,10),content:u.trim(),raw:p.join("\n")}),s=d,n=d}return[t,s]}(o);if(0===i.length)return;const a=gC(i,0,n);if(0===a.length)return;return{type:"list",ordered:!0,start:(null==(s=i[0])?void 0:s.number)||1,items:a,raw:o.slice(0,r).join("\n")}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes("listItem",this.editor.getAttributes(yC)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let e=fk({find:vC,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(e=fk({find:vC,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(yC)}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1],editor:this.editor})),[e]}}),kC=/^\s*(\[([( |x])?\])\s$/,wC=Ek.create({name:"taskItem",addOptions:()=>({nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}),content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes:()=>({checked:{default:!1,keepOnSplit:!1,parseHTML:e=>{const t=e.getAttribute("data-checked");return""===t||"true"===t},renderHTML:e=>({"data-checked":e.checked})}}),parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:e,HTMLAttributes:t}){return["li",jv(this.options.HTMLAttributes,t,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:e.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(e,t)=>{const n=[];if(e.tokens&&e.tokens.length>0?n.push(t.createNode("paragraph",{},t.parseInline(e.tokens))):e.text?n.push(t.createNode("paragraph",{},[t.createNode("text",{text:e.text})])):n.push(t.createNode("paragraph",{},[])),e.nestedTokens&&e.nestedTokens.length>0){const s=t.parseChildren(e.nestedTokens);n.push(...s)}return t.createNode("taskItem",{checked:e.checked||!1},n)},renderMarkdown:(e,t)=>{var n;return Tk(e,t,`- [${(null==(n=e.attrs)?void 0:n.checked)?"x":" "}] `)},addKeyboardShortcuts(){const e={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...e,Tab:()=>this.editor.commands.sinkListItem(this.name)}:e},addNodeView(){return({node:e,HTMLAttributes:t,getPos:n,editor:s})=>{const o=document.createElement("li"),i=document.createElement("label"),r=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),c=e=>{var t,n;a.ariaLabel=(null==(n=null==(t=this.options.a11y)?void 0:t.checkboxLabel)?void 0:n.call(t,e,a.checked))||`Task item checkbox for ${e.textContent||"empty task item"}`};return c(e),i.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",e=>e.preventDefault()),a.addEventListener("change",t=>{if(!s.isEditable&&!this.options.onReadOnlyChecked)return void(a.checked=!a.checked);const{checked:o}=t.target;s.isEditable&&"function"==typeof n&&s.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:e})=>{const t=n();if("number"!=typeof t)return!1;const s=e.doc.nodeAt(t);return e.setNodeMarkup(t,void 0,{...null==s?void 0:s.attrs,checked:o}),!0}).run(),!s.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(e,o)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([e,t])=>{o.setAttribute(e,t)}),o.dataset.checked=e.attrs.checked,a.checked=e.attrs.checked,i.append(a,r),o.append(i,l),Object.entries(t).forEach(([e,t])=>{o.setAttribute(e,t)}),{dom:o,contentDOM:l,update:e=>e.type===this.type&&(o.dataset.checked=e.attrs.checked,a.checked=e.attrs.checked,c(e),!0)}}},addInputRules(){return[fk({find:kC,type:this.type,getAttributes:e=>({checked:"x"===e[e.length-1]})})]}}),SC=Ek.create({name:"taskList",addOptions:()=>({itemTypeName:"taskItem",HTMLAttributes:{}}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:e}){return["ul",jv(this.options.HTMLAttributes,e,{"data-type":this.name}),0]},parseMarkdown:(e,t)=>t.createNode("taskList",{},t.parseChildren(e.items||[])),renderMarkdown:(e,t)=>e.content?t.renderChildren(e.content,"\n"):"",markdownTokenizer:{name:"taskList",level:"block",start(e){var t;const n=null==(t=e.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))?void 0:t.index;return void 0!==n?n:-1},tokenize(e,t,n){const s=e=>{const t=Ck(e,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:e=>({indentLevel:e[1].length,mainContent:e[4],checked:"x"===e[3].toLowerCase()}),createToken:(e,t)=>({type:"taskItem",raw:"",mainContent:e.mainContent,indentLevel:e.indentLevel,checked:e.checked,text:e.mainContent,tokens:n.inlineTokens(e.mainContent),nestedTokens:t}),customNestedParser:s},n);return t?[{type:"taskList",raw:t.raw,items:t.items}]:n.blockTokens(e)},o=Ck(e,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:e=>({indentLevel:e[1].length,mainContent:e[4],checked:"x"===e[3].toLowerCase()}),createToken:(e,t)=>({type:"taskItem",raw:"",mainContent:e.mainContent,indentLevel:e.indentLevel,checked:e.checked,text:e.mainContent,tokens:n.inlineTokens(e.mainContent),nestedTokens:t}),customNestedParser:s},n);if(o)return{type:"taskList",raw:o.raw,items:o.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:e})=>e.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});Jb.create({name:"listKit",addExtensions(){const e=[];return!1!==this.options.bulletList&&e.push(tC.configure(this.options.bulletList)),!1!==this.options.listItem&&e.push(nC.configure(this.options.listItem)),!1!==this.options.listKeymap&&e.push(hC.configure(this.options.listKeymap)),!1!==this.options.orderedList&&e.push(bC.configure(this.options.orderedList)),!1!==this.options.taskItem&&e.push(wC.configure(this.options.taskItem)),!1!==this.options.taskList&&e.push(SC.configure(this.options.taskList)),e}});var CC=Ek.create({name:"paragraph",priority:1e3,addOptions:()=>({HTMLAttributes:{}}),group:"block",content:"inline*",parseHTML:()=>[{tag:"p"}],renderHTML({HTMLAttributes:e}){return["p",jv(this.options.HTMLAttributes,e),0]},parseMarkdown:(e,t)=>{const n=e.tokens||[];return 1===n.length&&"image"===n[0].type?t.parseChildren([n[0]]):t.createNode("paragraph",void 0,t.parseInline(n))},renderMarkdown:(e,t)=>e&&Array.isArray(e.content)?t.renderChildren(e.content):"",addCommands(){return{setParagraph:()=>({commands:e})=>e.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),TC=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,EC=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,IC=Hb.create({name:"strike",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:e=>!!e.includes("line-through")&&{}}],renderHTML({HTMLAttributes:e}){return["s",jv(this.options.HTMLAttributes,e),0]},markdownTokenName:"del",parseMarkdown:(e,t)=>t.applyMark("strike",t.parseInline(e.tokens||[])),renderMarkdown:(e,t)=>`~~${t.renderChildren(e)}~~`,addCommands(){return{setStrike:()=>({commands:e})=>e.setMark(this.name),toggleStrike:()=>({commands:e})=>e.toggleMark(this.name),unsetStrike:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[dk({find:TC,type:this.type})]},addPasteRules(){return[Ik({find:EC,type:this.type})]}}),xC=Ek.create({name:"text",group:"inline",parseMarkdown:e=>({type:"text",text:e.text||""}),renderMarkdown:e=>e.text||""}),AC=Hb.create({name:"underline",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:e=>!!e.includes("underline")&&{}}],renderHTML({HTMLAttributes:e}){return["u",jv(this.options.HTMLAttributes,e),0]},parseMarkdown(e,t){return t.applyMark(this.name||"underline",t.parseInline(e.tokens||[]))},renderMarkdown:(e,t)=>`++${t.renderChildren(e)}++`,markdownTokenizer:{name:"underline",level:"inline",start:e=>e.indexOf("++"),tokenize(e,t,n){const s=/^(\+\+)([\s\S]+?)(\+\+)/.exec(e);if(!s)return;const o=s[2].trim();return{type:"underline",raw:s[0],text:o,tokens:n.inlineTokens(o)}}},addCommands(){return{setUnderline:()=>({commands:e})=>e.setMark(this.name),toggleUnderline:()=>({commands:e})=>e.toggleMark(this.name),unsetUnderline:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function NC(e={}){return new Eh({view:t=>new MC(t,e)})}class MC{constructor(e,t){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!==(n=t.width)&&void 0!==n?n:1,this.color=!1===t.color?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(t=>{let n=e=>{this[t](e)};return e.dom.addEventListener(t,n),{name:t,handler:n}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){null!=this.cursorPos&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,null==e?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e,t=this.editorView.state.doc.resolve(this.cursorPos),n=!t.parent.inlineContent,s=this.editorView.dom,o=s.getBoundingClientRect(),i=o.width/s.offsetWidth,r=o.height/s.offsetHeight;if(n){let n=t.nodeBefore,s=t.nodeAfter;if(n||s){let t=this.editorView.nodeDOM(this.cursorPos-(n?n.nodeSize:0));if(t){let o=t.getBoundingClientRect(),i=n?o.bottom:o.top;n&&s&&(i=(i+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let a=this.width/2*r;e={left:o.left,right:o.right,top:i-a,bottom:i+a}}}}if(!e){let t=this.editorView.coordsAtPos(this.cursorPos),n=this.width/2*i;e={left:t.left-n,right:t.left+n,top:t.top,bottom:t.bottom}}let a,l,c=this.editorView.dom.offsetParent;if(this.element||(this.element=c.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n),!c||c==document.body&&"static"==getComputedStyle(c).position)a=-pageXOffset,l=-pageYOffset;else{let e=c.getBoundingClientRect(),t=e.width/c.offsetWidth,n=e.height/c.offsetHeight;a=e.left-c.scrollLeft*t,l=e.top-c.scrollTop*n}this.element.style.left=(e.left-a)/i+"px",this.element.style.top=(e.top-l)/r+"px",this.element.style.width=(e.right-e.left)/i+"px",this.element.style.height=(e.bottom-e.top)/r+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),s=n&&n.type.spec.disableDropCursor,o="function"==typeof s?s(this.editorView,t,e):s;if(t&&!o){let e=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let t=Gp(this.editorView.state.doc,e,this.editorView.dragging.slice);null!=t&&(e=t)}this.setCursor(e),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class RC extends rh{constructor(e){super(e,e)}map(e,t){let n=e.resolve(t.map(this.head));return RC.valid(n)?new RC(n):rh.near(n)}content(){return fd.empty}eq(e){return e instanceof RC&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new RC(e.resolve(t.pos))}getBookmark(){return new _C(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!function(e){for(let t=e.depth;t>=0;t--){let n=e.index(t),s=e.node(t);if(0!=n)for(let e=s.child(n-1);;e=e.lastChild){if(0==e.childCount&&!e.inlineContent||OC(e.type))return!0;if(e.inlineContent)return!1}else if(s.type.spec.isolating)return!0}return!0}(e)||!function(e){for(let t=e.depth;t>=0;t--){let n=e.indexAfter(t),s=e.node(t);if(n!=s.childCount)for(let e=s.child(n);;e=e.firstChild){if(0==e.childCount&&!e.inlineContent||OC(e.type))return!0;if(e.inlineContent)return!1}else if(s.type.spec.isolating)return!0}return!0}(e))return!1;let n=t.type.spec.allowGapCursor;if(null!=n)return n;let s=t.contentMatchAt(e.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(e,t,n=!1){e:for(;;){if(!n&&RC.valid(e))return e;let s=e.pos,o=null;for(let n=e.depth;;n--){let i=e.node(n);if(t>0?e.indexAfter(n)<i.childCount:e.index(n)>0){o=i.child(t>0?e.indexAfter(n):e.index(n)-1);break}if(0==n)return null;s+=t;let r=e.doc.resolve(s);if(RC.valid(r))return r}for(;;){let i=t>0?o.firstChild:o.lastChild;if(!i){if(o.isAtom&&!o.isText&&!ph.isSelectable(o)){e=e.doc.resolve(s+o.nodeSize*t),n=!1;continue e}break}o=i,s+=t;let r=e.doc.resolve(s);if(RC.valid(r))return r}return null}}}RC.prototype.visible=!1,RC.findFrom=RC.findGapCursorFrom,rh.jsonID("gapcursor",RC);class _C{constructor(e){this.pos=e}map(e){return new _C(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return RC.valid(t)?new RC(t):rh.near(t)}}function OC(e){return e.isAtom||e.spec.isolating||e.spec.createGapCursor}const DC=Iy({ArrowLeft:BC("horiz",-1),ArrowRight:BC("horiz",1),ArrowUp:BC("vert",-1),ArrowDown:BC("vert",1)});function BC(e,t){const n="vert"==e?t>0?"down":"up":t>0?"right":"left";return function(e,s,o){let i=e.selection,r=t>0?i.$to:i.$from,a=i.empty;if(i instanceof uh){if(!o.endOfTextblock(n)||0==r.depth)return!1;a=!1,r=e.doc.resolve(t>0?r.after():r.before())}let l=RC.findGapCursorFrom(r,t,a);return!!l&&(s&&s(e.tr.setSelection(new RC(l))),!0)}}function LC(e,t,n){if(!e||!e.editable)return!1;let s=e.state.doc.resolve(t);if(!RC.valid(s))return!1;let o=e.posAtCoords({left:n.clientX,top:n.clientY});return!(o&&o.inside>-1&&ph.isSelectable(e.state.doc.nodeAt(o.inside)))&&(e.dispatch(e.state.tr.setSelection(new RC(s))),!0)}function FC(e,t){if("insertCompositionText"!=t.inputType||!(e.state.selection instanceof RC))return!1;let{$from:n}=e.state.selection,s=n.parent.contentMatchAt(n.index()).findWrapping(e.state.schema.nodes.text);if(!s)return!1;let o=ld.empty;for(let r=s.length-1;r>=0;r--)o=ld.from(s[r].createAndFill(null,o));let i=e.state.tr.replace(n.pos,n.pos,new fd(o,0,0));return i.setSelection(uh.near(i.doc.resolve(n.pos+1))),e.dispatch(i),!1}function PC(e){if(!(e.selection instanceof RC))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",$g.create(e.doc,[Lg.widget(e.selection.head,t,{key:"gapcursor"})])}var $C=200,UC=function(){};UC.prototype.append=function(e){return e.length?(e=UC.from(e),!this.length&&e||e.length<$C&&this.leafAppend(e)||this.length<$C&&e.leafPrepend(this)||this.appendInner(e)):this},UC.prototype.prepend=function(e){return e.length?UC.from(e).append(this):this},UC.prototype.appendInner=function(e){return new WC(this,e)},UC.prototype.slice=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=this.length),e>=t?UC.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))},UC.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)},UC.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)},UC.prototype.map=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length);var s=[];return this.forEach(function(t,n){return s.push(e(t,n))},t,n),s},UC.from=function(e){return e instanceof UC?e:e&&e.length?new VC(e):UC.empty};var VC=function(e){function t(t){e.call(this),this.values=t}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(e,n){return 0==e&&n==this.length?this:new t(this.values.slice(e,n))},t.prototype.getInner=function(e){return this.values[e]},t.prototype.forEachInner=function(e,t,n,s){for(var o=t;o<n;o++)if(!1===e(this.values[o],s+o))return!1},t.prototype.forEachInvertedInner=function(e,t,n,s){for(var o=t-1;o>=n;o--)if(!1===e(this.values[o],s+o))return!1},t.prototype.leafAppend=function(e){if(this.length+e.length<=$C)return new t(this.values.concat(e.flatten()))},t.prototype.leafPrepend=function(e){if(this.length+e.length<=$C)return new t(e.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(t.prototype,n),t}(UC);UC.empty=new VC([]);var WC=function(e){function t(t,n){e.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(e){return e<this.left.length?this.left.get(e):this.right.get(e-this.left.length)},t.prototype.forEachInner=function(e,t,n,s){var o=this.left.length;return!(t<o&&!1===this.left.forEachInner(e,t,Math.min(n,o),s))&&(!(n>o&&!1===this.right.forEachInner(e,Math.max(t-o,0),Math.min(this.length,n)-o,s+o))&&void 0)},t.prototype.forEachInvertedInner=function(e,t,n,s){var o=this.left.length;return!(t>o&&!1===this.right.forEachInvertedInner(e,t-o,Math.max(n,o)-o,s+o))&&(!(n<o&&!1===this.left.forEachInvertedInner(e,Math.min(t,o),n,s))&&void 0)},t.prototype.sliceInner=function(e,t){if(0==e&&t==this.length)return this;var n=this.left.length;return t<=n?this.left.slice(e,t):e>=n?this.right.slice(e-n,t-n):this.left.slice(e,n).append(this.right.slice(0,t-n))},t.prototype.leafAppend=function(e){var n=this.right.leafAppend(e);if(n)return new t(this.left,n)},t.prototype.leafPrepend=function(e){var n=this.left.leafPrepend(e);if(n)return new t(n,this.right)},t.prototype.appendInner=function(e){return this.left.depth>=Math.max(this.right.depth,e.depth)+1?new t(this.left,new t(this.right,e)):new t(this,e)},t}(UC);class GC{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(0==this.eventCount)return null;let n,s,o=this.items.length;for(;;o--){if(this.items.get(o-1).selection){--o;break}}t&&(n=this.remapping(o,this.items.length),s=n.maps.length);let i,r,a=e.tr,l=[],c=[];return this.items.forEach((e,t)=>{if(!e.step)return n||(n=this.remapping(o,t+1),s=n.maps.length),s--,void c.push(e);if(n){c.push(new zC(e.map));let t,o=e.step.map(n.slice(s));o&&a.maybeStep(o).doc&&(t=a.mapping.maps[a.mapping.maps.length-1],l.push(new zC(t,void 0,void 0,l.length+c.length))),s--,t&&n.appendMap(t,s)}else a.maybeStep(e.step);return e.selection?(i=n?e.selection.map(n.slice(s)):e.selection,r=new GC(this.items.slice(0,o).append(c.reverse().concat(l)),this.eventCount-1),!1):void 0},this.items.length,0),{remaining:r,transform:a,selection:i}}addTransform(e,t,n,s){let o=[],i=this.eventCount,r=this.items,a=!s&&r.length?r.get(r.length-1):null;for(let c=0;c<e.steps.length;c++){let n,l=e.steps[c].invert(e.docs[c]),u=new zC(e.mapping.maps[c],l,t);(n=a&&a.merge(u))&&(u=n,c?o.pop():r=r.slice(0,r.length-1)),o.push(u),t&&(i++,t=void 0),s||(a=u)}let l=i-n.depth;return l>KC&&(r=function(e,t){let n;return e.forEach((e,s)=>{if(e.selection&&0==t--)return n=s,!1}),e.slice(n)}(r,l),i-=l),new GC(r.append(o),i)}remapping(e,t){let n=new kp;return this.items.forEach((t,s)=>{let o=null!=t.mirrorOffset&&s-t.mirrorOffset>=e?n.maps.length-t.mirrorOffset:void 0;n.appendMap(t.map,o)},e,t),n}addMaps(e){return 0==this.eventCount?this:new GC(this.items.append(e.map(e=>new zC(e))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let n=[],s=Math.max(0,this.items.length-t),o=e.mapping,i=e.steps.length,r=this.eventCount;this.items.forEach(e=>{e.selection&&r--},s);let a=t;this.items.forEach(t=>{let s=o.getMirror(--a);if(null==s)return;i=Math.min(i,s);let l=o.maps[s];if(t.step){let i=e.steps[s].invert(e.docs[s]),c=t.selection&&t.selection.map(o.slice(a+1,s));c&&r++,n.push(new zC(l,i,c))}else n.push(new zC(l))},s);let l=[];for(let d=t;d<i;d++)l.push(new zC(o.maps[d]));let c=this.items.slice(0,s).append(l).append(n),u=new GC(c,r);return u.emptyItemCount()>500&&(u=u.compress(this.items.length-n.length)),u}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),n=t.maps.length,s=[],o=0;return this.items.forEach((i,r)=>{if(r>=e)s.push(i),i.selection&&o++;else if(i.step){let e=i.step.map(t.slice(n)),r=e&&e.getMap();if(n--,r&&t.appendMap(r,n),e){let a=i.selection&&i.selection.map(t.slice(n));a&&o++;let l,c=new zC(r.invert(),e,a),u=s.length-1;(l=s.length&&s[u].merge(c))?s[u]=l:s.push(c)}}else i.map&&n--},this.items.length,0),new GC(UC.from(s.reverse()),o)}}GC.empty=new GC(UC.empty,0);class zC{constructor(e,t,n,s){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new zC(t.getMap().invert(),t,this.selection)}}}class HC{constructor(e,t,n,s,o){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=s,this.prevComposition=o}}const KC=20;function jC(e){let t=[];for(let n=e.length-1;n>=0&&0==t.length;n--)e[n].forEach((e,n,s,o)=>t.push(s,o));return t}function YC(e,t){if(!e)return null;let n=[];for(let s=0;s<e.length;s+=2){let o=t.map(e[s],1),i=t.map(e[s+1],-1);o<=i&&n.push(o,i)}return n}let ZC=!1,XC=null;function JC(e){let t=e.plugins;if(XC!=t){ZC=!1,XC=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){ZC=!0;break}}return ZC}const QC=new Ah("history"),qC=new Ah("closeHistory");function eT(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new Eh({key:QC,state:{init:()=>new HC(GC.empty,GC.empty,null,0,-1),apply:(t,n,s)=>function(e,t,n,s){let o,i=n.getMeta(QC);if(i)return i.historyState;n.getMeta(qC)&&(e=new HC(e.done,e.undone,null,0,-1));let r=n.getMeta("appendedTransaction");if(0==n.steps.length)return e;if(r&&r.getMeta(QC))return r.getMeta(QC).redo?new HC(e.done.addTransform(n,void 0,s,JC(t)),e.undone,jC(n.mapping.maps),e.prevTime,e.prevComposition):new HC(e.done,e.undone.addTransform(n,void 0,s,JC(t)),null,e.prevTime,e.prevComposition);if(!1===n.getMeta("addToHistory")||r&&!1===r.getMeta("addToHistory"))return(o=n.getMeta("rebased"))?new HC(e.done.rebased(n,o),e.undone.rebased(n,o),YC(e.prevRanges,n.mapping),e.prevTime,e.prevComposition):new HC(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),YC(e.prevRanges,n.mapping),e.prevTime,e.prevComposition);{let o=n.getMeta("composition"),i=0==e.prevTime||!r&&e.prevComposition!=o&&(e.prevTime<(n.time||0)-s.newGroupDelay||!function(e,t){if(!t)return!1;if(!e.docChanged)return!0;let n=!1;return e.mapping.maps[0].forEach((e,s)=>{for(let o=0;o<t.length;o+=2)e<=t[o+1]&&s>=t[o]&&(n=!0)}),n}(n,e.prevRanges)),a=r?YC(e.prevRanges,n.mapping):jC(n.mapping.maps);return new HC(e.done.addTransform(n,i?t.selection.getBookmark():void 0,s,JC(t)),GC.empty,a,n.time,null==o?e.prevComposition:o)}}(n,s,t,e)},config:e,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,s="historyUndo"==n?nT:"historyRedo"==n?sT:null;return!(!s||!e.editable)&&(t.preventDefault(),s(e.state,e.dispatch))}}}})}function tT(e,t){return(n,s)=>{let o=QC.getState(n);if(!o||0==(e?o.undone:o.done).eventCount)return!1;if(s){let i=function(e,t,n){let s=JC(t),o=QC.get(t).spec.config,i=(n?e.undone:e.done).popEvent(t,s);if(!i)return null;let r=i.selection.resolve(i.transform.doc),a=(n?e.done:e.undone).addTransform(i.transform,t.selection.getBookmark(),o,s),l=new HC(n?a:i.remaining,n?i.remaining:a,null,0,-1);return i.transform.setSelection(r).setMeta(QC,{redo:n,historyState:l})}(o,n,e);i&&s(t?i.scrollIntoView():i)}return!0}}const nT=tT(!1,!0),sT=tT(!0,!0);Jb.create({name:"characterCount",addOptions:()=>({limit:null,mode:"textSize",textCounter:e=>e.length,wordCounter:e=>e.split(" ").filter(e=>""!==e).length}),addStorage:()=>({characters:()=>0,words:()=>0}),onBeforeCreate(){this.storage.characters=e=>{const t=(null==e?void 0:e.node)||this.editor.state.doc;if("textSize"===((null==e?void 0:e.mode)||this.options.mode)){const e=t.textBetween(0,t.content.size,void 0," ");return this.options.textCounter(e)}return t.nodeSize},this.storage.words=e=>{const t=(null==e?void 0:e.node)||this.editor.state.doc,n=t.textBetween(0,t.content.size," "," ");return this.options.wordCounter(n)}},addProseMirrorPlugins(){let e=!1;return[new Eh({key:new Ah("characterCount"),appendTransaction:(t,n,s)=>{if(e)return;const o=this.options.limit;if(null==o||0===o)return void(e=!0);const i=this.storage.characters({node:s.doc});if(i>o){const t=0,n=i-o;console.warn(`[CharacterCount] Initial content exceeded limit of ${o} characters. Content was automatically trimmed.`);const r=s.tr.deleteRange(t,n);return e=!0,r}e=!0},filterTransaction:(e,t)=>{const n=this.options.limit;if(!e.docChanged||0===n||null==n)return!0;const s=this.storage.characters({node:t.doc}),o=this.storage.characters({node:e.doc});if(o<=n)return!0;if(s>n&&o>n&&o<=s)return!0;if(s>n&&o>n&&o>s)return!1;if(!e.getMeta("paste"))return!1;const i=e.selection.$head.pos,r=i-(o-n),a=i;e.deleteRange(r,a);return!(this.storage.characters({node:e.doc})>n)}})]}});var oT=Jb.create({name:"dropCursor",addOptions:()=>({color:"currentColor",width:1,class:void 0}),addProseMirrorPlugins(){return[NC(this.options)]}});Jb.create({name:"focus",addOptions:()=>({className:"has-focus",mode:"all"}),addProseMirrorPlugins(){return[new Eh({key:new Ah("focus"),props:{decorations:({doc:e,selection:t})=>{const{isEditable:n,isFocused:s}=this.editor,{anchor:o}=t,i=[];if(!n||!s)return $g.create(e,[]);let r=0;"deepest"===this.options.mode&&e.descendants((e,t)=>{if(e.isText)return;if(!(o>=t&&o<=t+e.nodeSize-1))return!1;r+=1});let a=0;return e.descendants((e,t)=>{if(e.isText)return!1;if(!(o>=t&&o<=t+e.nodeSize-1))return!1;a+=1;if("deepest"===this.options.mode&&r-a>0||"shallowest"===this.options.mode&&a>1)return"deepest"===this.options.mode;i.push(Lg.node(t,t+e.nodeSize,{class:this.options.className}))}),$g.create(e,i)}}})]}});var iT=Jb.create({name:"gapCursor",addProseMirrorPlugins:()=>[new Eh({props:{decorations:PC,createSelectionBetween:(e,t,n)=>t.pos==n.pos&&RC.valid(n)?new RC(n):null,handleClick:LC,handleKeyDown:DC,handleDOMEvents:{beforeinput:FC}}})],extendNodeSchema(e){var t;return{allowGapCursor:null!=(t=zv(Uv(e,"allowGapCursor",{name:e.name,options:e.options,storage:e.storage})))?t:null}}}),rT=Jb.create({name:"placeholder",addOptions:()=>({emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something â€¦",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}),addProseMirrorPlugins(){return[new Eh({key:new Ah("placeholder"),props:{decorations:({doc:e,selection:t})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:s}=t,o=[];if(!n)return null;const i=this.editor.isEmpty;return e.descendants((e,t)=>{const n=s>=t&&s<=t+e.nodeSize,r=!e.isLeaf&&db(e);if((n||!this.options.showOnlyCurrent)&&r){const s=[this.options.emptyNodeClass];i&&s.push(this.options.emptyEditorClass);const r=Lg.node(t,t+e.nodeSize,{class:s.join(" "),"data-placeholder":"function"==typeof this.options.placeholder?this.options.placeholder({editor:this.editor,node:e,pos:t,hasAnchor:n}):this.options.placeholder});o.push(r)}return this.options.includeChildren}),$g.create(e,o)}}})]}});function aT({types:e,node:t}){return t&&Array.isArray(e)&&e.includes(t.type)||(null==t?void 0:t.type)===e}Jb.create({name:"selection",addOptions:()=>({className:"selection"}),addProseMirrorPlugins(){const{editor:e,options:t}=this;return[new Eh({key:new Ah("selection"),props:{decorations:n=>n.selection.empty||e.isFocused||!e.isEditable||pb(n.selection)||e.view.dragging?null:$g.create(n.doc,[Lg.inline(n.selection.from,n.selection.to,{class:t.className})])}})]}});var lT=Jb.create({name:"trailingNode",addOptions:()=>({node:void 0,notAfter:[]}),addProseMirrorPlugins(){var e;const t=new Ah(this.name),n=this.options.node||(null==(e=this.editor.schema.topNodeType.contentMatch.defaultType)?void 0:e.name)||"paragraph",s=Object.entries(this.editor.schema.nodes).map(([,e])=>e).filter(e=>(this.options.notAfter||[]).concat(n).includes(e.name));return[new Eh({key:t,appendTransaction:(e,s,o)=>{const{doc:i,tr:r,schema:a}=o,l=t.getState(o),c=i.content.size,u=a.nodes[n];if(l)return r.insert(c,u.create())},state:{init:(e,t)=>!aT({node:t.tr.doc.lastChild,types:s}),apply:(e,t)=>{if(!e.docChanged)return t;if(e.getMeta("__uniqueIDTransaction"))return t;return!aT({node:e.doc.lastChild,types:s})}}})]}}),cT=Jb.create({name:"undoRedo",addOptions:()=>({depth:100,newGroupDelay:500}),addCommands:()=>({undo:()=>({state:e,dispatch:t})=>nT(e,t),redo:()=>({state:e,dispatch:t})=>sT(e,t)}),addProseMirrorPlugins(){return[eT(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-Ñ":()=>this.editor.commands.undo(),"Shift-Mod-Ñ":()=>this.editor.commands.redo()}}}),uT=Jb.create({name:"starterKit",addExtensions(){var e,t,n,s;const o=[];return!1!==this.options.bold&&o.push(Fk.configure(this.options.bold)),!1!==this.options.blockquote&&o.push(_k.configure(this.options.blockquote)),!1!==this.options.bulletList&&o.push(tC.configure(this.options.bulletList)),!1!==this.options.code&&o.push(Uk.configure(this.options.code)),!1!==this.options.codeBlock&&o.push(Gk.configure(this.options.codeBlock)),!1!==this.options.document&&o.push(zk.configure(this.options.document)),!1!==this.options.dropcursor&&o.push(oT.configure(this.options.dropcursor)),!1!==this.options.gapcursor&&o.push(iT.configure(this.options.gapcursor)),!1!==this.options.hardBreak&&o.push(Hk.configure(this.options.hardBreak)),!1!==this.options.heading&&o.push(Kk.configure(this.options.heading)),!1!==this.options.undoRedo&&o.push(cT.configure(this.options.undoRedo)),!1!==this.options.horizontalRule&&o.push(jk.configure(this.options.horizontalRule)),!1!==this.options.italic&&o.push(Qk.configure(this.options.italic)),!1!==this.options.listItem&&o.push(nC.configure(this.options.listItem)),!1!==this.options.listKeymap&&o.push(hC.configure(null==(e=this.options)?void 0:e.listKeymap)),!1!==this.options.link&&o.push(XS.configure(null==(t=this.options)?void 0:t.link)),!1!==this.options.orderedList&&o.push(bC.configure(this.options.orderedList)),!1!==this.options.paragraph&&o.push(CC.configure(this.options.paragraph)),!1!==this.options.strike&&o.push(IC.configure(this.options.strike)),!1!==this.options.text&&o.push(xC.configure(this.options.text)),!1!==this.options.underline&&o.push(AC.configure(null==(n=this.options)?void 0:n.underline)),!1!==this.options.trailingNode&&o.push(lT.configure(null==(s=this.options)?void 0:s.trailingNode)),o}}),dT=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,pT=Ek.create({name:"image",addOptions:()=>({inline:!1,allowBase64:!1,HTMLAttributes:{},resize:!1}),inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes:()=>({src:{default:null},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}}),parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:e}){return["img",jv(this.options.HTMLAttributes,e)]},parseMarkdown:(e,t)=>t.createNode("image",{src:e.href,title:e.title,alt:e.text}),renderMarkdown:e=>{var t,n,s,o,i,r;const a=null!=(n=null==(t=e.attrs)?void 0:t.src)?n:"",l=null!=(o=null==(s=e.attrs)?void 0:s.alt)?o:"",c=null!=(r=null==(i=e.attrs)?void 0:i.title)?r:"";return c?`![${l}](${a} "${c}")`:`![${l}](${a})`},addNodeView(){if(!this.options.resize||!this.options.resize.enabled||"undefined"==typeof document)return null;const{directions:e,minWidth:t,minHeight:n,alwaysPreserveAspectRatio:s}=this.options.resize;return({node:o,getPos:i,HTMLAttributes:r,editor:a})=>{const l=document.createElement("img");Object.entries(r).forEach(([e,t])=>{if(null!=t)switch(e){case"width":case"height":break;default:l.setAttribute(e,t)}}),l.src=r.src;const c=new mk({element:l,editor:a,node:o,getPos:i,onResize:(e,t)=>{l.style.width=`${e}px`,l.style.height=`${t}px`},onCommit:(e,t)=>{const n=i();void 0!==n&&this.editor.chain().setNodeSelection(n).updateAttributes(this.name,{width:e,height:t}).run()},onUpdate:(e,t,n)=>e.type===o.type,options:{directions:e,min:{width:t,height:n},preserveAspectRatio:!0===s}}),u=c.dom;return u.style.visibility="hidden",u.style.pointerEvents="none",l.onload=()=>{u.style.visibility="",u.style.pointerEvents=""},c}},addCommands(){return{setImage:e=>({commands:t})=>t.insertContent({type:this.name,attrs:e})}},addInputRules(){return[pk({find:dT,type:this.type,getAttributes:e=>{const[,,t,n,s]=e;return{src:n,alt:t,title:s}}})]}}),hT=rT;const fT=Ze({__name:"RichTextInput",props:{placeholder:{default:""},disabled:{type:Boolean,default:!1},modelValue:{default:""}},emits:["update:modelValue","submit","paste-image","preview-image","focus","blur","keydown"],setup(e,{expose:t,emit:n}){const s=Ek.create({name:"fileReference",group:"inline",inline:!0,atom:!0,addAttributes:()=>({path:{default:""}}),parseHTML:()=>[{tag:"span[data-file-ref]",getAttrs:e=>"string"!=typeof e&&{path:e.getAttribute("data-file-ref")}}],renderHTML({node:e,HTMLAttributes:t}){const n=e.attrs.path,s=n.split(/[/\\]/).pop()||n;return["span",jv(t,{class:"file-reference","data-file-ref":n}),`@${s}`]}}),o=e,i=n,r=Ge(!1),a=Ge(null),l=Ge(null),c=Ge({top:0,left:0}),u=We(()=>({top:`${c.value.top}px`,left:`${c.value.left}px`}));function d(e){const t=e.target;"IMG"===t.tagName&&t.classList.contains("inline-image")?(a.value=t,l.value=null,h()):t.classList.contains("file-reference")&&(l.value=t,a.value=null,h())}function p(e){const t=e.relatedTarget;t?.classList?.contains("floating-delete-btn")||(a.value=null,l.value=null)}function h(){const e=a.value||l.value;if(!e)return;const t=e.getBoundingClientRect(),n=e.closest(".rich-text-input-wrapper")?.getBoundingClientRect();n&&(c.value={top:t.top-n.top-4,left:t.right-n.left-10})}function f(){if(m.value){if(a.value){const e=a.value.getAttribute("src");if(e){let t=!1;m.value.state.doc.descendants((n,s)=>!(!t&&"image"===n.type.name&&n.attrs.src===e)||(m.value?.chain().focus().deleteRange({from:s,to:s+n.nodeSize}).run(),t=!0,!1))}return void(a.value=null)}if(l.value){const e=l.value.getAttribute("data-file-ref");if(e){let t=!1;m.value.state.doc.descendants((n,s)=>!(!t&&"fileReference"===n.type.name&&n.attrs.path===e)||(m.value?.chain().focus().deleteRange({from:s,to:s+n.nodeSize}).run(),t=!0,!1))}l.value=null}}}const m=((e={})=>{const t=He();return ot(()=>{t.value=new Ak(e)}),ft(()=>{var e,n,s;const o=null==(e=t.value)?void 0:e.view.dom,i=null==o?void 0:o.cloneNode(!0);null==(n=null==o?void 0:o.parentNode)||n.replaceChild(i,o),null==(s=t.value)||s.destroy()}),t})({content:o.modelValue,editable:!o.disabled,extensions:[uT.configure({heading:!1,bulletList:!1,orderedList:!1,blockquote:!1,codeBlock:!1,horizontalRule:!1,link:!1}),JS.configure({autolink:!0,openOnClick:!1,linkOnPaste:!0,HTMLAttributes:{class:"linkified-link",rel:"noopener noreferrer"}}),pT.configure({inline:!0,allowBase64:!0,HTMLAttributes:{class:"inline-image"}}),hT.configure({placeholder:o.placeholder}),s],editorProps:{attributes:{class:"prose-editor"},handleClick(e,t,n){const s=n.target;if("IMG"===s.tagName&&s.classList.contains("inline-image")){const e=s.getAttribute("src");if(e)return i("preview-image",e),!0}if(s.classList.contains("file-reference")){const e=s.getAttribute("data-file-ref");if(e)return Nc.openFile(e),!0}return!1},handleKeyDown:(e,t)=>(i("keydown",t),"Escape"===t.key||("Tab"===t.key?(t.preventDefault(),!0):"Enter"!==t.key||!t.ctrlKey||t.shiftKey||t.altKey?!("Enter"!==t.key||t.shiftKey||t.altKey||t.ctrlKey||t.metaKey)&&(t.preventDefault(),function(){const e=g();(e.text.trim()||e.images.length>0)&&i("submit",e)}(),!0):(t.preventDefault(),!0))),handlePaste(e,t){const n=t.clipboardData?.items;if(!n)return!1;for(let s=0;s<n.length;s++){const e=n[s];if(e.type.startsWith("image/")){const n=e.getAsFile();if(n)return t.preventDefault(),i("paste-image",n),!0}}return!1}},onFocus(){r.value=!0,i("focus")},onBlur(){r.value=!1,i("blur")},onUpdate({editor:e}){const t=JSON.stringify(e.getJSON());i("update:modelValue",t)},onCreate({editor:e}){if(o.placeholder){const t=e.view.dom.querySelector("p.is-editor-empty");t&&t.setAttribute("data-placeholder",o.placeholder)}}});function g(){if(!m.value)return{text:"",images:[]};const e=m.value.getText(),t=[];return m.value.state.doc.descendants(e=>{if("image"===e.type.name){const n=e.attrs.src;if(n&&n.startsWith("data:")){const e=n.match(/^data:([^;]+);base64,(.+)$/);e&&t.push({id:`img-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,mimeType:e[1],data:e[2],name:`image.${e[1].split("/")[1]||"png"}`})}}return!0}),{text:e,images:t}}return Ke(()=>o.modelValue,e=>{if(!m.value)return;if(e!==JSON.stringify(m.value.getJSON()))try{const t=e?JSON.parse(e):"";m.value.commands.setContent(t,!1,{preserveWhitespace:"full"})}catch{m.value.commands.setContent(e||"",!1,{preserveWhitespace:"full"})}}),Ke(()=>o.disabled,e=>{m.value?.setEditable(!e)}),Ke(()=>o.placeholder,e=>{if(m.value&&e){const t=m.value.view.dom.querySelector("p.is-editor-empty");t&&t.setAttribute("data-placeholder",e)}}),ft(()=>{m.value?.destroy()}),t({clear:function(){m.value?.commands.clearContent()},focus:function(){m.value?.commands.focus()},insertImage:function(e,t){if(!m.value)return;const n=`data:${t};base64,${e}`;m.value.chain().focus().setImage({src:n}).insertContent(" ").run()},insertFileReference:function(e){m.value&&m.value.chain().focus().insertContent({type:"fileReference",attrs:{path:e}}).insertContent(" ").run()},replaceRangeWithFileReference:function(e,t,n){if(!m.value)return;const s=e+1,o=t+1;m.value.chain().focus().deleteRange({from:s,to:o}).insertContent({type:"fileReference",attrs:{path:n}}).insertContent(" ").run()},getCursorPosition:function(){return m.value?m.value.state.selection.from-1:0},isCursorAtStart:function(){if(!m.value)return!0;const{from:e}=m.value.state.selection;return e<=1},getText:function(){return m.value?.getText()||""},setContent:function(e){m.value?.commands.setContent(e,!1,{preserveWhitespace:"full"})},extractContent:g,extractContentBlocks:function(){if(!m.value)return[];const e=[];let t="";return m.value.state.doc.descendants(n=>{if(n.isText&&n.text)t+=n.text;else if("fileReference"===n.type.name){t.trim()&&(e.push({type:"text",text:t.trim()}),t="");const s=n.attrs.path;s&&e.push({type:"text",text:`@${s}`})}else if("image"===n.type.name){t.trim()&&(e.push({type:"text",text:t.trim()}),t="");const s=n.attrs.src;if(s?.startsWith("data:")){const t=s.match(/^data:([^;]+);base64,(.+)$/);t&&e.push({type:"image",source:{type:"base64",media_type:t[1],data:t[2]}})}}else"hardBreak"===n.type.name&&(t+="\n");return!0}),t.trim()&&e.push({type:"text",text:t.trim()}),e},deleteToLineStart:function(){if(!m.value)return;const{state:e}=m.value,{selection:t}=e,{$from:n}=t,s=n.start(),o=n.pos;o!==s&&m.value.chain().focus().deleteRange({from:s,to:o}).run()},insertNewLine:function(){m.value&&m.value.chain().focus().splitBlock().run()}}),(t,n)=>(st(),Qe("div",{class:dt(["rich-text-input-wrapper",{focused:r.value,disabled:e.disabled}])},[kt(ht(Nk),{editor:ht(m),class:"rich-text-editor",onMouseover:d,onMouseout:p},null,8,["editor"]),a.value||l.value?(st(),Qe("button",{key:0,ref:"deleteBtnRef",class:"floating-delete-btn",style:it(u.value),onClick:f}," Ã— ",4)):qe("",!0)],2))}}),mT=ju(fT,[["__scopeId","data-v-b62d956a"]]),gT=["title"],yT=ju(Ze({__name:"ThinkingToggle",props:{thinkingMode:{},thinkingTokens:{},thinkingLevels:{}},emits:["change"],setup(e,{emit:t}){const{t:n}=Ye(),s=e,o=t,i=We(()=>s.thinkingLevels);function r(e){const t=s.thinkingLevels.find(t=>t.tokens===e);if(t)return t.id;if(0===e)return"off";let n=s.thinkingLevels[0],o=Math.abs(e-n.tokens);for(const i of s.thinkingLevels){const t=Math.abs(e-i.tokens);t<o&&(o=t,n=i)}return n.id}const a=Ge(r(s.thinkingTokens));Ke(()=>s.thinkingTokens,e=>{a.value=r(e)});const l=We(()=>"optional"===s.thinkingMode),c=We(()=>{switch(s.thinkingMode){case"always":return n("thinking.alwaysOn");case"never":return n("thinking.notSupported");case"optional":return n("thinking.selectLevel")}});function u(){if(!l.value)return;const e=s.thinkingLevels.find(e=>e.id===a.value);e&&o("change",e.tokens)}return(e,t)=>{const n=Ct,s=wt;return st(),Qe("div",{class:dt(["thinking-select",{"is-disabled":!l.value}]),title:c.value},[t[1]||(t[1]=tt("span",{class:"thinking-icon"},"ðŸ§ ",-1)),kt(s,{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),disabled:!l.value,class:"level-select",placement:"top",size:"small",onChange:u},{default:St(()=>[(st(!0),Qe(lt,null,ct(i.value,e=>(st(),Je(n,{key:e.id,value:e.id,label:e.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","disabled"])],10,gT)}}}),[["__scopeId","data-v-8459bd01"]]),vT=["title"],bT={key:0,class:"toggle-icon"},kT={width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor"},wT={key:0,d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"},ST={key:1,d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"},CT={class:"toggle-label"},TT={class:"toggle-indicator"},ET=ju(Ze({__name:"StatusToggle",props:{label:{},enabled:{type:Boolean},disabled:{type:Boolean,default:!1},showIcon:{type:Boolean,default:!0},tooltip:{default:""}},emits:["toggle"],setup(e,{emit:t}){const n=e,s=t;function o(){n.disabled||s("toggle",!n.enabled)}return(t,n)=>(st(),Qe("div",{class:dt(["status-toggle",{"is-enabled":e.enabled,"is-disabled":e.disabled}]),title:e.tooltip,onClick:o},[e.showIcon?(st(),Qe("span",bT,[Tt(t.$slots,"icon",{},()=>[(st(),Qe("svg",kT,[e.enabled?(st(),Qe("path",wT)):(st(),Qe("path",ST))]))],!0)])):qe("",!0),tt("span",CT,ut(e.label),1),tt("span",TT,[tt("span",{class:dt(["dot",e.enabled?"active":"inactive"])},null,2)])],10,vT))}}),[["__scopeId","data-v-1814b258"]]),IT={class:"thinking-config-panel"},xT={key:0,class:"thinking-config-claude"},AT={class:"config-row"},NT={class:"config-label"},MT=["checked"],RT={key:0,class:"config-section"},_T={class:"config-row"},OT={class:"config-label"},DT=["value"],BT=["value"],LT={class:"config-row"},FT={class:"config-label"},PT=["value"],$T={class:"config-row"},UT={class:"config-label"},VT=["value"],WT={key:1,class:"validation-error"},GT={key:1,class:"thinking-config-codex"},zT={class:"config-row"},HT={class:"config-label"},KT=["value"],jT=["value"],YT={key:0,class:"config-description"},ZT={key:0,class:"config-row"},XT={class:"config-label"},JT=["value"],QT=["value"],qT={key:0,class:"config-description"},eE={key:1,class:"validation-error"},tE=ju(Ze({__name:"ThinkingConfigPanel",props:{backendType:{},modelValue:{}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,s=t,o=Ge(null),i=We(()=>Tl(n.modelValue)?n.modelValue:{type:"claude",enabled:!0,tokenBudget:8096}),r=We(()=>El(n.modelValue)?n.modelValue:{type:"codex",effort:"medium",summary:"auto"}),a=Object.values(kl),l=We(()=>function(e){if(0===e)return kl.OFF;const t=Object.values(kl);let n=kl.HIGH;for(const s of t)Math.abs(s.tokens-e)<Math.abs(n.tokens-e)&&(n=s);return n}(i.value.tokenBudget)),c=Sl(),u=Object.values(Cl),d=We(()=>{const e=r.value.effort||null;return c.find(t=>t.id===e)}),p=We(()=>u.find(e=>e.id===r.value.summary));function h(e){o.value=null,Tl(e)&&(e.enabled&&e.tokenBudget<0?o.value="Token é¢„ç®—ä¸èƒ½ä¸ºè´Ÿæ•°":e.tokenBudget>65536&&(o.value="Token é¢„ç®—ä¸èƒ½è¶…è¿‡ 65536"))}return Ke(()=>n.modelValue,e=>{h(e)},{immediate:!0}),(t,n)=>{return st(),Qe("div",IT,["claude"===e.backendType?(st(),Qe("div",xT,[tt("div",AT,[tt("label",NT,[n[6]||(n[6]=tt("span",null,"å¯ç”¨æ€è€ƒ",-1)),tt("input",{type:"checkbox",checked:i.value.enabled,onChange:n[0]||(n[0]=e=>function(e){const t=e.target.checked,n={...i.value,enabled:t};s("update:modelValue",n),h(n)}(e)),class:"toggle-checkbox"},null,40,MT)])]),i.value.enabled?(st(),Qe("div",RT,[tt("div",_T,[tt("label",OT,[n[7]||(n[7]=tt("span",null,"é¢„è®¾çº§åˆ«",-1)),tt("select",{value:l.value.id,onChange:n[1]||(n[1]=e=>function(e){const t=e.target.value,n=a.find(e=>e.id===t);if(n){const e={...i.value,tokenBudget:n.tokens,enabled:n.tokens>0};s("update:modelValue",e),h(e)}}(e)),class:"config-select"},[(st(!0),Qe(lt,null,ct(ht(a),e=>(st(),Qe("option",{key:e.id,value:e.id},ut(e.label),9,BT))),128))],40,DT)])]),tt("div",LT,[tt("label",FT,[tt("span",null,"Token é¢„ç®—: "+ut((f=i.value.tokenBudget,0===f?"å…³é—­":f>=1024?`${Math.round(f/1024)}K`:`${f}`)),1)]),tt("input",{type:"range",value:i.value.tokenBudget,onInput:n[2]||(n[2]=e=>function(e){const t=parseInt(e.target.value,10),n={...i.value,tokenBudget:t};s("update:modelValue",n),h(n)}(e)),min:"0",max:"32768",step:"1024",class:"token-slider"},null,40,PT)]),tt("div",$T,[tt("label",UT,[n[8]||(n[8]=tt("span",null,"è‡ªå®šä¹‰ Token æ•°",-1)),tt("input",{type:"number",value:i.value.tokenBudget,onInput:n[3]||(n[3]=e=>function(e){const t=parseInt(e.target.value,10);if(!isNaN(t)){const e={...i.value,tokenBudget:t};s("update:modelValue",e),h(e)}}(e)),min:"0",max:"65536",step:"1024",class:"token-input"},null,40,VT)])])])):qe("",!0),o.value?(st(),Qe("div",WT,ut(o.value),1)):qe("",!0)])):"codex"===e.backendType?(st(),Qe("div",GT,[tt("div",zT,[tt("label",HT,[n[9]||(n[9]=tt("span",null,"æŽ¨ç†å¼ºåº¦",-1)),tt("select",{value:r.value.effort||"OFF",onChange:n[4]||(n[4]=e=>function(e){const t=e.target.value,n="OFF"===t?null:t,o={...r.value,effort:n};s("update:modelValue",o),h(o)}(e)),class:"config-select"},[(st(!0),Qe(lt,null,ct(ht(c),e=>(st(),Qe("option",{key:e.id||"OFF",value:e.id||"OFF"},ut(e.label),9,jT))),128))],40,KT)]),d.value?(st(),Qe("div",YT,ut(d.value.description),1)):qe("",!0)]),null!==r.value.effort?(st(),Qe("div",ZT,[tt("label",XT,[n[10]||(n[10]=tt("span",null,"æ‘˜è¦æ¨¡å¼",-1)),tt("select",{value:r.value.summary,onChange:n[5]||(n[5]=e=>function(e){const t=e.target.value,n={...r.value,summary:t};s("update:modelValue",n),h(n)}(e)),class:"config-select"},[(st(!0),Qe(lt,null,ct(ht(u),e=>(st(),Qe("option",{key:e.id,value:e.id},ut(e.label),9,QT))),128))],40,JT)]),p.value?(st(),Qe("div",qT,ut(p.value.description),1)):qe("",!0)])):qe("",!0),o.value?(st(),Qe("div",eE,ut(o.value),1)):qe("",!0)])):qe("",!0)]);var f}}}),[["__scopeId","data-v-3466f1b0"]]),nE=[{id:"gpt-5.2-codex",displayName:"GPT-5.2 Codex",supportsReasoning:!0},{id:"gpt-5.2",displayName:"GPT-5.2",supportsReasoning:!0}],sE="gpt-5.2-codex",oE="on-request",iE="workspace-write",rE="medium",aE=[{value:"untrusted",label:"Untrusted",description:"åªè‡ªåŠ¨è¿è¡Œå—ä¿¡ä»»å‘½ä»¤ï¼Œå…¶ä»–éœ€æ‰¹å‡†",icon:"ðŸ”’"},{value:"on-failure",label:"On Failure",description:"è‡ªåŠ¨è¿è¡Œæ‰€æœ‰å‘½ä»¤ï¼Œä»…å¤±è´¥æ—¶è¯¢é—®",icon:"âš ï¸"},{value:"on-request",label:"On Request",description:"ç”±æ¨¡åž‹å†³å®šä½•æ—¶è¯¢é—®ï¼ˆé»˜è®¤ï¼‰",icon:"ðŸ¤–"},{value:"never",label:"Never",description:"ä»Žä¸è¯¢é—®ï¼Œå®Œå…¨è‡ªåŠ¨æ‰§è¡Œ",icon:"âš¡"}],lE=[{value:"read-only",label:"Read Only",description:"åªè¯»æ¨¡å¼ï¼Œä¸èƒ½å†™å…¥ä»»ä½•æ–‡ä»¶",icon:"ðŸ‘ï¸"},{value:"workspace-write",label:"Workspace",description:"åªèƒ½å†™å…¥å·¥ä½œåŒºç›®å½•ï¼ˆæŽ¨èï¼‰",icon:"ðŸ“"},{value:"danger-full-access",label:"Full Access",description:"å®Œå…¨è®¿é—®ï¼Œæ— æ²™ç›’é™åˆ¶ï¼ˆå±é™©ï¼‰",icon:"ðŸ”¥"}],cE=[{value:"minimal",label:"Minimal",description:"æœ€å°æŽ¨ç†ï¼Œå¿«é€Ÿå“åº”",shortLabel:"Min"},{value:"low",label:"Low",description:"ä½Žçº§æŽ¨ç†",shortLabel:"Low"},{value:"medium",label:"Medium",description:"ä¸­ç­‰æŽ¨ç†ï¼ˆæŽ¨èï¼‰",shortLabel:"Med"},{value:"high",label:"High",description:"é«˜çº§æŽ¨ç†",shortLabel:"High"},{value:"xhigh",label:"X-High",description:"æœ€é«˜çº§æŽ¨ç†ï¼Œé€‚åˆå¤æ‚ä»»åŠ¡",shortLabel:"Max"}];function uE(e){const t=aE.find(t=>t.value===e);return t?.icon??"?"}function dE(e){const t=lE.find(t=>t.value===e);return t?.icon??"?"}const pE={class:"codex-toolbar"},hE={class:"model-option-label"},fE={class:"mode-option-label"},mE={class:"mode-prefix-icon"},gE={class:"mode-option-label"},yE={class:"mode-icon"},vE={class:"mode-prefix-icon"},bE={class:"mode-option-label"},kE={class:"mode-icon"},wE=ju(Ze({__name:"CodexToolbar",props:{model:{},approvalMode:{},sandboxMode:{},reasoningEffort:{},disabled:{type:Boolean,default:!1}},emits:["update:model","update:approvalMode","update:sandboxMode","update:reasoningEffort"],setup(e,{emit:t}){const n=e,s=t,o=Ge(n.model),i=Ge(n.approvalMode),r=Ge(n.sandboxMode),a=Ge(n.reasoningEffort),l=nE,c=aE,u=lE,d=cE;function p(e){s("update:model",e)}function h(e){s("update:approvalMode",e)}function f(e){s("update:sandboxMode",e)}function m(e){s("update:reasoningEffort",e)}return Ke(()=>n.model,e=>{o.value=e}),Ke(()=>n.approvalMode,e=>{i.value=e}),Ke(()=>n.sandboxMode,e=>{r.value=e}),Ke(()=>n.reasoningEffort,e=>{a.value=e}),(t,n)=>{const s=Ct,g=wt;return st(),Qe("div",pE,[kt(g,{modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=e=>o.value=e),class:"cursor-selector model-selector",disabled:e.disabled,placement:"top-start",teleported:!0,"popper-class":"chat-input-select-dropdown","popper-options":{modifiers:[{name:"preventOverflow",options:{boundary:"viewport"}},{name:"flip",options:{fallbackPlacements:["top-start","top"]}}]},onChange:p},{default:St(()=>[(st(!0),Qe(lt,null,ct(ht(l),e=>(st(),Je(s,{key:e.id,value:e.id,label:e.displayName},{default:St(()=>[tt("span",hE,ut(e.displayName),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue","disabled"]),kt(g,{modelValue:a.value,"onUpdate:modelValue":n[1]||(n[1]=e=>a.value=e),class:"cursor-selector reasoning-selector",disabled:e.disabled,placement:"top-start",teleported:!0,"popper-class":"chat-input-select-dropdown","popper-options":{modifiers:[{name:"preventOverflow",options:{boundary:"viewport"}},{name:"flip",options:{fallbackPlacements:["top-start","top"]}}]},onChange:m},{prefix:St(()=>[...n[4]||(n[4]=[tt("span",{class:"mode-prefix-icon"},"â—",-1)])]),default:St(()=>[(st(!0),Qe(lt,null,ct(ht(d),e=>(st(),Je(s,{key:e.value,value:e.value,label:e.shortLabel},{default:St(()=>[tt("span",fE,[n[5]||(n[5]=tt("span",{class:"mode-icon"},"â—",-1)),tt("span",null,ut(e.label),1)])]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue","disabled"]),kt(g,{modelValue:i.value,"onUpdate:modelValue":n[2]||(n[2]=e=>i.value=e),class:"cursor-selector approval-selector",disabled:e.disabled,placement:"top-start",teleported:!0,"popper-class":"chat-input-select-dropdown mode-dropdown","popper-options":{modifiers:[{name:"preventOverflow",options:{boundary:"viewport"}},{name:"flip",options:{fallbackPlacements:["top-start","top"]}}]},onChange:h},{prefix:St(()=>[tt("span",mE,ut(ht(uE)(i.value)),1)]),default:St(()=>[(st(!0),Qe(lt,null,ct(ht(c),e=>(st(),Je(s,{key:e.value,value:e.value,label:e.label},{default:St(()=>[tt("span",gE,[tt("span",yE,ut(e.icon),1),tt("span",null,ut(e.label),1)])]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue","disabled"]),kt(g,{modelValue:r.value,"onUpdate:modelValue":n[3]||(n[3]=e=>r.value=e),class:"cursor-selector sandbox-selector",disabled:e.disabled,placement:"top-start",teleported:!0,"popper-class":"chat-input-select-dropdown mode-dropdown","popper-options":{modifiers:[{name:"preventOverflow",options:{boundary:"viewport"}},{name:"flip",options:{fallbackPlacements:["top-start","top"]}}]},onChange:f},{prefix:St(()=>[tt("span",vE,ut(ht(dE)(r.value)),1)]),default:St(()=>[(st(!0),Qe(lt,null,ct(ht(u),e=>(st(),Je(s,{key:e.value,value:e.value,label:e.label},{default:St(()=>[tt("span",bE,[tt("span",kE,ut(e.icon),1),tt("span",null,ut(e.label),1)])]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue","disabled"])])}}}),[["__scopeId","data-v-a98e32d0"]]);function SE(e){if("object"!=typeof e||null===e)return!1;const t=e;return"string"==typeof t.name&&"string"==typeof t.relativePath&&"string"==typeof t.absolutePath&&"string"==typeof t.fileType&&"number"==typeof t.size&&"number"==typeof t.lastModified}const CE=new class{getApiUrl(e){return`${Za()}${e}`}async searchFiles(e,t=10){try{const n=await fetch(this.getApiUrl(`/api/files/search?query=${encodeURIComponent(e)}&maxResults=${t}`));if(!n.ok)return console.warn("æ–‡ä»¶æœç´¢å¤±è´¥:",n.statusText),{files:[],isIndexing:!1,error:n.statusText};const s=await n.json();return function(e){if("object"!=typeof e||null===e)return!1;const t=e;return!("boolean"!=typeof t.success||void 0!==t.data&&null!==t.data&&!Array.isArray(t.data)||void 0!==t.error&&null!==t.error&&"string"!=typeof t.error)}(s)?"INDEXING"===s.errorCode?{files:[],isIndexing:!0,error:s.error}:s.success&&s.data?{files:s.data.filter(SE),isIndexing:!1}:(console.warn("æ–‡ä»¶æœç´¢å¤±è´¥:",s.error),{files:[],isIndexing:!1,error:s.error}):(console.warn("æ–‡ä»¶æœç´¢å“åº”æ ¼å¼æ— æ•ˆ:",s),{files:[],isIndexing:!1,error:"å“åº”æ ¼å¼æ— æ•ˆ"})}catch(n){return console.error("æ–‡ä»¶æœç´¢å¼‚å¸¸:",n),{files:[],isIndexing:!1,error:String(n)}}}};const TE=["image/jpeg","image/png","image/gif","image/bmp","image/webp"];const EE=[{id:"off",name:"Off",tokens:0,isCustom:!1},{id:"think",name:"Think",tokens:2048,isCustom:!1},{id:"ultra",name:"Ultra",tokens:8096,isCustom:!1}],IE=["default","acceptEdits","bypassPermissions","plan"],xE={default:"?",acceptEdits:"âœŽ",bypassPermissions:"âˆž",plan:"â˜°"};function AE(e={}){const t=lu(),n=Yc(),s=Ge(e.initialPermission??"default"),o=Ge(e.initialSkipPermissions??!1),i=Ge(!1),r=Ge(null),a=We(()=>{const e=t.currentTab?.backendType?.value,s=n.currentBackendType;return console.log("ðŸ”„ [currentBackendType] Tab:",e,"Global:",s),e??s}),l=We(()=>{if(r.value)return r.value;const e=a.value,s=t.currentTab?.modelId.value;if("codex"===e)return s||(n.settings.codexModel||"gpt-5.2-codex");if(!s)return Qc.OPUS_45;const o=nu().find(e=>e.modelId===s);return o?.id??Qc.OPUS_45}),c=We(()=>{const e=t.currentTab;return e?e.thinkingLevel.value:8096}),u=We(()=>ou(l.value).thinkingMode),d=We(()=>"optional"===u.value),p=We(()=>c.value>0),h=We(()=>n.ideSettings?.thinkingLevels||EE),f=We(()=>nu()),m=We(()=>n.getModelsForBackend("codex").map(e=>({id:e.id,displayName:e.displayName,modelId:e.id,isBuiltIn:!0}))),g=We({get:()=>{const e=t.currentTab?.modelId.value;return e||n.settings.codexModel||"gpt-5.1-codex-max"},set:e=>{}}),y=We(()=>"codex"===a.value?m.value:f.value);async function v(e){if(!d.value)return;console.log(`ðŸ§  [handleThinkingLevelChange] åˆ‡æ¢æ€è€ƒçº§åˆ«: ${e}`);const n=t.currentTab;n&&(await n.updateSettings({thinkingLevel:e}),console.log("âœ… [handleThinkingLevelChange] æ€è€ƒçº§åˆ«åˆ‡æ¢å®Œæˆ"))}return{currentModel:l,thinkingLevel:c,thinkingLevels:h,currentThinkingMode:u,canToggleThinkingComputed:d,thinkingEnabled:p,thinkingTogglePending:i,selectedPermissionValue:s,skipPermissionsValue:o,baseModelOptions:y,claudeModelOptions:f,codexModelOptions:m,selectedCodexModel:g,currentBackendType:a,PERMISSION_MODES:IE,getBaseModelLabel:function(e){return function(e){const t=su(e);return t?.displayName??e}(e)},getModeIcon:function(e){return xE[e]??"?"},handleBaseModelChange:async function(e){const n=ou(e);let s;switch(n.thinkingMode){case"always":s=8096;break;case"never":s=0;break;case"optional":s=c.value>0?c.value:8096}console.log(`ðŸ”„ [handleBaseModelChange] åˆ‡æ¢æ¨¡åž‹: ${n.displayName}, thinkingLevel=${s}`),r.value=e;const o=t.currentTab;if(o)try{await o.updateSettings({model:n.modelId,thinkingLevel:s}),console.log("âœ… [handleBaseModelChange] æ¨¡åž‹åˆ‡æ¢å®Œæˆ")}catch(i){console.error("âŒ [handleBaseModelChange] æ¨¡åž‹åˆ‡æ¢å¤±è´¥:",i)}finally{r.value===e&&(r.value=null)}},handleThinkingLevelChange:v,handleThinkingToggle:async function(e){const t=e?8096:0;await v(t)},toggleThinkingEnabled:async function(e="click"){if(!d.value)return void console.log(`ðŸ§  [ThinkingToggle] ${e} - å½“å‰æ¨¡åž‹ä¸æ”¯æŒåˆ‡æ¢æ€è€ƒ`);if(i.value)return;const t=[0,2048,8096],n=t.indexOf(c.value),s=t[(n+1)%t.length];console.log(`ðŸ§  [ThinkingToggle] ${e} -> ${s}`),await v(s)},handleSkipPermissionsChange:function(s){console.log(`ðŸ”“ [handleSkipPermissionsChange] åˆ‡æ¢è·³è¿‡æƒé™: ${s}`),o.value=s;const i=t.currentTab;i&&(i.setPendingSetting("skipPermissions",s),console.log("âœ… [handleSkipPermissionsChange] è·³è¿‡æƒé™å·²æ›´æ–°ï¼ˆçº¯å‰ç«¯ï¼Œæ— éœ€é‡è¿žï¼‰")),n.saveSettings({skipPermissions:s}),e.onSkipPermissionsChange?.(s)},cyclePermissionMode:async function(){const e=(IE.indexOf(s.value)+1)%IE.length,o=IE[e];console.log(`ðŸ”„ [cyclePermissionMode] åˆ‡æ¢æƒé™æ¨¡å¼: ${o}`);const i=t.currentTab;i&&(await i.setPermissionMode(o),console.log("âœ… [cyclePermissionMode] æƒé™æ¨¡å¼åˆ‡æ¢å®Œæˆ")),n.updatePermissionMode(o)},setPermissionMode:async function(e){console.log(`ðŸ”’ [setPermissionMode] è®¾ç½®æƒé™æ¨¡å¼: ${e}`);const s=t.currentTab;s&&(await s.setPermissionMode(e),console.log("âœ… [setPermissionMode] æƒé™æ¨¡å¼åˆ‡æ¢å®Œæˆ")),n.updatePermissionMode(e)},updatePermission:function(e){s.value=e},updateSkipPermissions:function(e){o.value=e}}}const NE={key:0,class:"pending-task-bar"},ME={class:"task-header"},RE={class:"task-label"},_E={key:1,class:"top-toolbar"},OE=["disabled"],DE={class:"btn-text"},BE={class:"context-tag active-file-tag"},LE={class:"tag-file-name"},FE={key:0,class:"tag-line-range"},PE=["title"],$E=["src","onClick"],UE={class:"tag-icon"},VE={class:"tag-text"},WE=["title","onClick"],GE={class:"drop-zone-content"},zE={class:"drop-text"},HE={class:"error-text"},KE={class:"bottom-toolbar"},jE={class:"toolbar-left"},YE={class:"cursor-style-selectors"},ZE={class:"mode-prefix-icon"},XE={class:"model-option-label"},JE={class:"toolbar-right"},QE=["title"],qE=["disabled","title"],eI=["disabled","title"],tI=["title"],nI={key:4,class:"thinking-config-dropdown"},sI={class:"menu-text"},oI={class:"menu-text"},iI=Ze({__name:"ChatInput",props:{pendingTasks:{default:()=>[]},contexts:{default:()=>[]},isGenerating:{type:Boolean,default:!1},enabled:{type:Boolean,default:!0},selectedModel:{default:Ru.SONNET},actualModelId:{},selectedPermission:{default:"default"},skipPermissions:{type:Boolean,default:!1},showContextControls:{type:Boolean,default:!0},showModelSelector:{type:Boolean,default:!0},showPermissionControls:{type:Boolean,default:!0},showSendButton:{type:Boolean,default:!0},tokenUsage:{},placeholderText:{default:""},messageHistory:{},sessionTokenUsage:{},inline:{type:Boolean,default:!1},editDisabled:{type:Boolean,default:!1},showToast:{},modelValue:{default:""},backendType:{default:"claude"},thinkingConfig:{}},emits:["send","force-send","stop","context-add","context-remove","skip-permissions-change","cancel","update:modelValue","update:thinkingConfig"],setup(e,{expose:t,emit:n}){const s=e,o=n,{t:i}=cu(),r=lu(),a=Yc(),{currentModel:l,currentThinkingMode:c,thinkingLevel:u,thinkingLevels:d,selectedPermissionValue:p,skipPermissionsValue:h,claudeModelOptions:f,getModeIcon:m,handleBaseModelChange:g,handleThinkingLevelChange:y,toggleThinkingEnabled:v,handleSkipPermissionsChange:b,cyclePermissionMode:k,setPermissionMode:w,updatePermission:S,updateSkipPermissions:C}=AE({initialPermission:s.selectedPermission,initialSkipPermissions:s.skipPermissions,onSkipPermissionsChange:e=>o("skip-permissions-change",e)}),T=We(()=>r.currentTab?.modelId?.value??a.settings.codexModel??sE),E=We(()=>a.settings.codexApprovalMode??oE),I=We(()=>a.settings.codexSandboxMode??iE),x=We(()=>a.settings.codexReasoningEffort??rE);function A(e){console.log(`ðŸ”„ [Codex] åˆ‡æ¢æ¨¡åž‹: ${e}`);const t=r.currentTab;t&&t.updateSettings({model:e}),a.saveSettings({codexModel:e})}function N(e){console.log(`ðŸ”„ [Codex] åˆ‡æ¢å®¡æ‰¹æ¨¡å¼: ${e}`),a.saveSettings({codexApprovalMode:e})}function M(e){console.log(`ðŸ”„ [Codex] åˆ‡æ¢æ²™ç›’æ¨¡å¼: ${e}`),a.saveSettings({codexSandboxMode:e})}function R(e){console.log(`ðŸ”„ [Codex] åˆ‡æ¢æŽ¨ç†æ·±åº¦: ${e}`),a.saveSettings({codexReasoningEffort:e})}const _=Ge(!1),O=We(()=>s.thinkingConfig?s.thinkingConfig:"codex"===s.backendType?{type:"codex",effort:"medium",summary:"auto"}:{type:"claude",enabled:!0,tokenBudget:8096});function D(e){o("update:thinkingConfig",e)}function B(e){if(!_.value)return;const t=e.target;t.closest(".thinking-config-dropdown")||t.closest(".thinking-config-btn")||(_.value=!1)}We(()=>!!El(O.value)&&null!==O.value.effort),We(()=>{if(!El(O.value))return"OFF";const e=O.value.effort;if(null===e)return"OFF";const t=Sl().find(t=>t.id===e);return t?.label||e.toUpperCase()}),We(()=>{if(!El(O.value))return"é…ç½®æŽ¨ç†å¼ºåº¦";const e=O.value.effort;if(null===e)return"æŽ¨ç†å·²å…³é—­";const t=Sl().find(t=>t.id===e);return t?.description||"é…ç½®æŽ¨ç†å¼ºåº¦"});const L=We(()=>r.currentLastError);function F(){r.clearCurrentError()}const P=Ge(),$=We(()=>P.value?.$el),U=Ge(),V=Ge(),W=We({get:()=>s.modelValue,set:e=>o("update:modelValue",e)}),G=Ge(!1),z=Ge(!1),H=Ge([]),K=Ge(!1),j=Ge(!1),Y=Ge(0),Z=Ge([]),X=Ge(!1),J=Ge(!1),Q=Ge(""),q=Ge(null),ee=We({get:()=>r.currentTab?.uiState.activeFileDismissed??!1,set:e=>{r.currentTab&&(r.currentTab.uiState.activeFileDismissed=e)}});let te=null;const{containerHeight:ne,startResize:se}=function(e={}){const{minHeight:t=110,maxHeight:n=500,initialHeight:s=null}=e,o=Ge(s),i=Ge(!1);return{containerHeight:o,isResizing:i,minHeight:t,maxHeight:n,startResize:function(e){e.preventDefault(),i.value=!0;const s=e.clientY,r=e.target.closest(".unified-chat-input-container"),a=o.value??r?.offsetHeight??120,l=e=>{const i=s-e.clientY,r=Math.min(n,Math.max(t,a+i));o.value=r},c=()=>{i.value=!1,document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",c)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",c)},resetHeight:function(){o.value=null},setHeight:function(e){o.value=Math.min(n,Math.max(t,e))}}}(),{showSendContextMenu:oe,sendContextMenuPosition:ie,handleSendButtonContextMenu:re,handleSendFromContextMenu:ae,handleForceSendFromContextMenu:le,closeSendContextMenu:ce}=function(e={}){const t=Ge(!1),n=Ge({x:0,y:0});return{showSendContextMenu:t,sendContextMenuPosition:n,handleSendButtonContextMenu:function(e){e.preventDefault(),t.value=!0,n.value={x:e.clientX,y:e.clientY}},handleSendFromContextMenu:function(){t.value=!1,e.onSend?.()},handleForceSendFromContextMenu:function(){t.value=!1,e.onForceSend?.()},closeSendContextMenu:function(){t.value=!1}}}({onSend:()=>nt(),onForceSend:()=>rt()}),{previewVisible:ue,previewImageSrc:de,readImageAsBase64:pe,addImageToContext:he,handlePasteImage:fe,handleImageFileSelect:me,openImagePreview:ge,closeImagePreview:ye,getImagePreviewUrl:ve}=function(e={}){const t=Ge(!1),n=Ge("");function s(e){return new Promise((t,n)=>{const s=new FileReader;s.onload=e=>{const n=e.target?.result,s=n.split(",")[1];t(s)},s.onerror=n,s.readAsDataURL(e)})}function o(e){return TE.includes(e)}async function i(t){console.log(`ðŸ–¼ï¸ [addImageToContext] å¼€å§‹å¤„ç†å›¾ç‰‡: ${t.name}`);try{if(!o(t.type))return console.error(`ðŸ–¼ï¸ [addImageToContext] ä¸æ”¯æŒçš„å›¾ç‰‡æ ¼å¼: ${t.type}`),void e.showToast?.(`ä¸æ”¯æŒçš„å›¾ç‰‡æ ¼å¼: ${t.type}`);console.log("ðŸ–¼ï¸ [addImageToContext] è¯»å–å›¾ç‰‡ä¸º base64...");const n=await s(t);console.log(`ðŸ–¼ï¸ [addImageToContext] base64 é•¿åº¦: ${n.length}`);const i={type:"image",displayType:"TAG",uri:`image://${t.name}`,name:t.name,mimeType:t.type,base64Data:n,size:t.size};console.log("ðŸ–¼ï¸ [addImageToContext] åˆ›å»ºå›¾ç‰‡å¼•ç”¨:",{type:i.type,name:i.name,mimeType:i.mimeType,size:i.size,base64Length:n.length}),e.onContextAdd?.(i),console.log("ðŸ–¼ï¸ [addImageToContext] å·²å‘é€ context-add äº‹ä»¶")}catch(n){console.error("ðŸ–¼ï¸ [addImageToContext] è¯»å–å›¾ç‰‡å¤±è´¥:",n),e.showToast?.("è¯»å–å›¾ç‰‡å¤±è´¥")}}return{previewVisible:t,previewImageSrc:n,readImageAsBase64:s,isValidImageType:o,addImageToContext:i,handlePasteImage:async function(t){if(console.log("ðŸ“‹ [handlePasteImage] æŽ¥æ”¶åˆ°ç²˜è´´å›¾ç‰‡:",t.name),e.isCursorAtStart?.()??1)console.log("ðŸ“‹ [handlePasteImage] å…‰æ ‡åœ¨æœ€å‰é¢ï¼Œå°†å›¾ç‰‡ä½œä¸ºä¸Šä¸‹æ–‡"),await i(t);else{console.log("ðŸ“‹ [handlePasteImage] å…‰æ ‡ä¸åœ¨æœ€å‰é¢ï¼Œå°†å›¾ç‰‡æ’å…¥ç¼–è¾‘å™¨");const n=await s(t);e.onInsertToEditor?.(n,t.type)}},handleImageFileSelect:async function(t){if(!t||0===t.length)return;const n=e.isCursorAtStart?.()??!0;for(let o=0;o<t.length;o++)if(n)await i(t[o]);else{const n=await s(t[o]);e.onInsertToEditor?.(n,t[o].type)}},openImagePreview:function(e){n.value=e,t.value=!0},closeImagePreview:function(){t.value=!1,n.value=""},getImagePreviewUrl:function(e){return`data:${e.mimeType};base64,${e.base64Data}`}}}({onContextAdd:e=>o("context-add",e),onInsertToEditor:(e,t)=>P.value?.insertImage(e,t),isCursorAtStart:()=>P.value?.isCursorAtStart()??!0,showToast:s.showToast}),{isDragging:be,handleDragOver:ke,handleDragLeave:we,handleDrop:Se}=function(e={}){const t=Ge(!1),n=e.readImageAsBase64||function(e){return new Promise((t,n)=>{const s=new FileReader;s.onload=e=>{const n=e.target?.result,s=n.split(",")[1];t(s)},s.onerror=n,s.readAsDataURL(e)})};async function s(t){try{const n={type:"file",uri:t.name,displayType:"TAG",path:t.name,fullPath:t.name};e.onContextAdd?.(n)}catch(n){console.error("Failed to read file:",n)}}return{isDragging:t,handleDragOver:function(e){e.preventDefault(),t.value=!0},handleDragLeave:function(e){e.preventDefault(),e.target===e.currentTarget&&(t.value=!1)},handleDrop:async function(o){o.preventDefault(),t.value=!1;const i=o.dataTransfer?.files;if(!i||0===i.length)return;const r=e.isCursorAtStart?.()??!0;for(let t=0;t<i.length;t++){const o=i[t];if(o.type&&o.type.startsWith("image/"))if(r)console.log("ðŸ“‹ [handleDrop] å…‰æ ‡åœ¨æœ€å‰é¢ï¼Œå°†å›¾ç‰‡ä½œä¸ºä¸Šä¸‹æ–‡"),e.onImageAdd&&await e.onImageAdd(o);else{console.log("ðŸ“‹ [handleDrop] å…‰æ ‡ä¸åœ¨æœ€å‰é¢ï¼Œå°†å›¾ç‰‡æ’å…¥ç¼–è¾‘å™¨");const t=await n(o);e.onInsertImageToEditor?.(t,o.type)}else await s(o)}},addFileToContext:s}}({onContextAdd:e=>o("context-add",e),onImageAdd:he,onInsertImageToEditor:(e,t)=>P.value?.insertImage(e,t),isCursorAtStart:()=>P.value?.isCursorAtStart()??!0,readImageAsBase64:pe}),Ce=We({get:()=>l.value,set:e=>{}}),Te=Ge(null);function Ee(e){if(!oe.value)return;const t=e.target instanceof Node?e.target:null;t&&Te.value?.contains(t)||ce()}function Ie(e){if(!oe.value)return;const t=e.target instanceof Node?e.target:null;t&&Te.value?.contains(t)||ce()}function xe(){document.removeEventListener("mousedown",Ee,!0),document.removeEventListener("contextmenu",Ie,!0),window.removeEventListener("blur",ce)}Ke(oe,e=>{e?(document.addEventListener("mousedown",Ee,!0),document.addEventListener("contextmenu",Ie,!0),window.addEventListener("blur",ce)):xe()});const Ae=We(()=>s.pendingTasks.filter(e=>"PENDING"===e.status||"RUNNING"===e.status)),Ne=We(()=>W.value.trim().length>0),Me=We(()=>{if(s.editDisabled)return!1;return(P.value?.getText()?.trim()||(P.value?.extractContentBlocks()?.length??0)>0)&&s.enabled}),Re=We(()=>s.placeholderText||""),_e=We(()=>null!==q.value&&!ee.value);function Oe(e){const t=e.replace(/\\/g,"/").split("/");return t[t.length-1]||e}const De=We(()=>q.value?Oe(q.value.relativePath):""),Be=We(()=>{if(!q.value)return"";const e=q.value;if(e.hasSelection&&e.startLine&&e.endLine){const t=e.startColumn||1,n=e.endColumn||1;return`:${e.startLine}:${t}-${e.endLine}:${n}`}if(e.line){const t=e.column||1;return`:${e.line}:${t}`}return""});function Le(){ee.value=!0}function Fe(){P.value?.focus()}async function Pe(e){await fe(e)}function $e(e){const t=e.trim();return t.startsWith("/")&&/^\/\w+/.test(t)}async function Ue(e){if(!s.enabled)return;const t=P.value?.extractContentBlocks()||[];if(0===t.length)return;const n=$e(P.value?.getText()||"");Ye();const i=!n&&_e.value?q.value:null;o("send",t,{isSlashCommand:n,ideContext:i}),P.value?.clear(),W.value=""}async function Ve(){const e=P.value?.getCursorPosition()??0,t=function(e,t){if(t<=0||t>e.length)return null;let n=-1;for(let o=t-1;o>=0;o--){const t=e[o];if("@"===t){n=o;break}if(" "===t||"\n"===t||"\t"===t)return null}if(-1===n)return null;if(n>0){const t=e[n-1];if(" "!==t&&"\n"!==t&&"\t"!==t)return null}if(t<n+1)return null;const s=n+1;return{atPosition:n,query:e.substring(s,t)}}(P.value?.getText()??"",e);if(t){Y.value=t.atPosition;try{const e=await CE.searchFiles(t.query,10);Z.value=e.files,X.value=e.isIndexing,j.value=e.files.length>0||e.isIndexing}catch(n){console.error("æ–‡ä»¶æœç´¢å¤±è´¥:",n),Z.value=[],X.value=!1,j.value=!1}}else j.value=!1,Z.value=[],X.value=!1}function ze(e){const t=P.value?.getCursorPosition()??0;P.value?.replaceRangeWithFileReference(Y.value,t,e.absolutePath),He()}function He(){j.value=!1,Z.value=[],X.value=!1}function je(e){P.value?.setContent(e.name+" "),W.value=e.name+" ",J.value=!1,Q.value="",pt(()=>{P.value?.focus()})}function Ye(){J.value=!1,Q.value=""}async function Ze(e){if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"].includes(e.key)&&pt(()=>Ve()),"Escape"===e.key){if(e.preventDefault(),e.stopPropagation(),_.value)return void(_.value=!1);if(s.isGenerating)return void o("stop");if(s.inline)return void o("cancel")}return"Tab"!==e.key||!e.shiftKey||e.ctrlKey||e.metaKey?"Tab"!==e.key||e.shiftKey||e.ctrlKey||e.metaKey||"claude"!==s.backendType?"Enter"!==e.key||!e.ctrlKey||e.shiftKey||e.altKey?"b"!==e.key||!e.ctrlKey||e.shiftKey||e.altKey?"Enter"===e.key&&e.shiftKey?void 0:"j"!==e.key||!e.ctrlKey||e.shiftKey||e.altKey?"u"!==e.key||!e.ctrlKey||e.shiftKey||e.altKey?void 0:(e.preventDefault(),void P.value?.deleteToLineStart()):(e.preventDefault(),void P.value?.insertNewLine()):(e.preventDefault(),void async function(){if(!s.isGenerating)return;try{await r.runInBackground(),console.log("âœ… [ChatInput] åŽå°è¿è¡Œè¯·æ±‚å·²å‘é€")}catch(e){console.error("[ChatInput] åŽå°è¿è¡Œè¯·æ±‚å¤±è´¥:",e)}}()):(e.preventDefault(),void rt()):(e.preventDefault(),void(await v("keyboard"))):(e.preventDefault(),void k())}async function nt(){if(!Me.value)return;const e=P.value?.extractContentBlocks()||[];if(e.length>0){const t=$e(P.value?.getText()||"");Ye();const n=!t&&_e.value?q.value:null;o("send",e,{isSlashCommand:t,ideContext:n}),P.value?.clear(),W.value=""}}async function rt(){const e=P.value?.extractContentBlocks()||[];if(0===e.length||!s.isGenerating)return;const t=_e.value?q.value:null;o("force-send",e,{ideContext:t}),P.value?.clear(),W.value=""}async function at(){z.value=!0;try{const e=await CE.searchFiles("",10);H.value=e.files,K.value=e.isIndexing}catch(e){console.error("èŽ·å–æ–‡ä»¶å¤±è´¥:",e),H.value=[],K.value=!1}}async function ft(e){const t=e.trim();try{const e=await CE.searchFiles(t,10);H.value=e.files,K.value=e.isIndexing}catch(n){console.error("æ–‡ä»¶æœç´¢å¤±è´¥:",n),H.value=[],K.value=!1}}function mt(){z.value=!1,H.value=[],K.value=!1}function gt(e){const t={type:"file",uri:e.relativePath,displayType:"TAG",path:e.relativePath,fullPath:e.absolutePath,name:e.name};o("context-add",t),z.value=!1,H.value=[]}function yt(e){return Ot(e)?e.name||"å›¾ç‰‡":Bt(e)?e.fullPath||e.path||e.uri||"":Lt(e)?e.url||"":e.uri||""}function vt(e){if(Ot(e))return"å›¾ç‰‡";if(Bt(e)){const t=e.path||e.uri||"",n=t.replace(/\\/g,"/").split("/");return n[n.length-1]||t}if(Lt(e))return e.title||e.url||"";const t=e.uri||"",n=t.replace(/\\/g,"/").split("/");return n[n.length-1]||t}function bt(e){return Ot(e)?ve(e):""}function Tt(e){ge(e)}function xt(e){return Ot(e)?"ðŸ–¼ï¸":Bt(e)?"ðŸ“„":Lt(e)?"ðŸŒ":"folder"===e.type?"ðŸ“":"path"in e?"ðŸ“„":"ðŸ“Ž"}function At(e){return"SWITCH_MODEL"===e.type?`/model ${e.alias}`:e.text.trim()}function Nt(){if(!s.tokenUsage)return"";const e=s.tokenUsage;return"codex"===s.backendType?`Total: ${e.totalTokens} tokens`:i("chat.tokenTooltip",{input:e.inputTokens,output:e.outputTokens,cacheCreation:e.cacheCreationTokens,cacheRead:e.cacheReadTokens})}async function Mt(e){await Se(e)}function Rt(){V.value?.click()}async function _t(e){const t=e.target;await me(t.files),t.value=""}function Ot(e){return"image"===e.type}We(()=>{if(!q.value)return"";const e=q.value,t=Oe(e.relativePath);return e.hasSelection&&e.startLine&&e.endLine?`${t}:${e.startLine}-${e.endLine}`:e.line?`${t}:${e.line}`:t}),Ke(()=>s.selectedPermission,e=>{S(e)}),Ke(()=>s.skipPermissions,e=>{C(e)}),Ke(W,()=>{Ve(),function(){const e=P.value?.getText()??"";if(e.startsWith("/")){if(/\s/.test(e))return J.value=!1,void(Q.value="");Q.value=e.slice(1),J.value=!0}else J.value=!1,Q.value=""}()});const Dt=Ot;function Bt(e){return"file"===e.type}function Lt(e){return"url"in e||"web"===e.type}function Ft(e){"Escape"===e.key&&s.isGenerating&&(e.preventDefault(),e.stopPropagation(),console.log("ðŸ›‘ [GlobalKeydown] ESC pressed, stopping generation"),o("stop"))}return t({setContent(e){P.value?.clear(),W.value="";for(const t of e)if("text"===t.type&&"text"in t)P.value?.setContent(t.text);else if("image"===t.type&&"source"in t){const e=t;"base64"===e.source?.type&&P.value?.insertImage(e.source.data,e.source.media_type)}}}),ot(()=>{pt(()=>{setTimeout(()=>{Fe()},200)}),document.addEventListener("keydown",Ft),document.addEventListener("mousedown",B),te=Kc.onActiveFileChange(e=>{q.value=e,ee.value=!1,console.log("ðŸ“‚ [ChatInput] æ´»è·ƒæ–‡ä»¶æ›´æ–°:",e?.relativePath||"æ— ")}),Kc.getActiveFile().then(e=>{e&&(q.value=e,console.log("ðŸ“‚ [ChatInput] åˆå§‹æ´»è·ƒæ–‡ä»¶:",e.relativePath))}).catch(e=>{console.warn("ðŸ“‚ [ChatInput] èŽ·å–åˆå§‹æ´»è·ƒæ–‡ä»¶å¤±è´¥:",e)})}),Xe(()=>{xe(),document.removeEventListener("keydown",Ft),document.removeEventListener("mousedown",B),te&&(te(),te=null)}),(t,n)=>{const r=It,a=Ct,l=wt;return st(),Qe("div",{class:dt(["unified-chat-input-container",{focused:G.value,generating:e.isGenerating,"inline-mode":e.inline}]),style:it({height:ht(ne)?ht(ne)+"px":void 0,"--input-max-height":ht(500)+"px"})},[tt("div",{class:"resize-handle",onMousedown:n[0]||(n[0]=(...e)=>ht(se)&&ht(se)(...e))},[...n[16]||(n[16]=[tt("div",{class:"resize-handle-bar"},null,-1)])],32),Ae.value.length>0?(st(),Qe("div",NE,[tt("div",ME,ut(ht(i)("chat.taskQueueCount",{count:Ae.value.length})),1),(st(!0),Qe(lt,null,ct(Ae.value,e=>{return st(),Qe("div",{key:e.id,class:"task-row"},[tt("span",RE,ut(At(e)),1),tt("span",{class:dt(["task-status",`status-${e.status.toLowerCase()}`])},ut((t=e.status,{PENDING:i("chat.taskStatus.pending"),RUNNING:i("chat.taskStatus.running"),SUCCESS:i("chat.taskStatus.success"),FAILED:i("chat.taskStatus.failed")}[t]||t)),3)]);var t}),128))])):qe("",!0),e.showContextControls&&(e.contexts.length>0||e.enabled)?(st(),Qe("div",_E,[tt("button",{ref_key:"addContextButtonRef",ref:U,class:"add-context-btn",disabled:!e.enabled,onClick:at},[tt("span",DE,ut(ht(i)("chat.addContext")),1)],8,OE),_e.value?(st(),Je(r,{key:0,content:q.value?.path||"",placement:"top","show-after":300},{default:St(()=>[tt("div",BE,[tt("span",LE,ut(De.value),1),Be.value?(st(),Qe("span",FE,ut(Be.value),1)):qe("",!0),tt("button",{class:"tag-remove",title:ht(i)("common.remove"),onClick:et(Le,["stop"])}," Ã— ",8,PE)])]),_:1},8,["content"])):qe("",!0),(st(!0),Qe(lt,null,ct(e.contexts,(e,t)=>(st(),Je(r,{key:`context-${t}`,content:yt(e),placement:"top","show-after":300},{default:St(()=>[tt("div",{class:dt(["context-tag",{"image-tag":ht(Dt)(e)}])},[ht(Dt)(e)?(st(),Qe("img",{key:0,src:bt(e),class:"tag-image-preview",alt:"å›¾ç‰‡",onClick:t=>function(e){Ot(e)&&ge(bt(e))}(e)},null,8,$E)):(st(),Qe(lt,{key:1},[tt("span",UE,ut(xt(e)),1),tt("span",VE,ut(vt(e)),1)],64)),tt("button",{class:"tag-remove",title:ht(i)("common.remove"),onClick:et(t=>function(e){o("context-remove",e)}(e),["stop"])}," Ã— ",8,WE)],2)]),_:2},1032,["content"]))),128))])):qe("",!0),ht(be)?(st(),Qe("div",{key:2,class:"drop-zone-overlay",onDrop:et(Mt,["prevent"]),onDragover:n[1]||(n[1]=et(()=>{},["prevent"])),onDragleave:n[2]||(n[2]=(...e)=>ht(we)&&ht(we)(...e))},[tt("div",GE,[n[17]||(n[17]=tt("span",{class:"drop-icon"},"ðŸ“",-1)),tt("span",zE,ut(ht(i)("chat.dropFileToAddContext")),1)])],32)):qe("",!0),L.value?(st(),Qe("div",{key:3,class:"error-banner",onClick:F},[n[18]||(n[18]=tt("span",{class:"error-icon"},"âš ï¸",-1)),tt("span",HE,ut(L.value),1),n[19]||(n[19]=tt("button",{class:"error-dismiss",title:"å…³é—­"},"Ã—",-1))])):qe("",!0),tt("div",{class:dt(["input-area",{"generating-state":e.isGenerating}]),onClick:Fe,onDrop:et(Mt,["prevent"]),onDragover:n[6]||(n[6]=et((...e)=>ht(ke)&&ht(ke)(...e),["prevent"])),onDragleave:n[7]||(n[7]=(...e)=>ht(we)&&ht(we)(...e))},[kt(mT,{ref_key:"richTextInputRef",ref:P,modelValue:W.value,"onUpdate:modelValue":n[3]||(n[3]=e=>W.value=e),class:"message-textarea",placeholder:Re.value,disabled:!e.enabled,onFocus:n[4]||(n[4]=e=>G.value=!0),onBlur:n[5]||(n[5]=e=>G.value=!1),onKeydown:Ze,onPasteImage:Pe,onPreviewImage:Tt,onSubmit:Ue},null,8,["modelValue","placeholder","disabled"])],34),tt("div",KE,[tt("div",jE,[tt("div",YE,[e.showPermissionControls&&"claude"===e.backendType?(st(),Je(l,{key:0,modelValue:ht(p),"onUpdate:modelValue":n[8]||(n[8]=e=>Et(p)?p.value=e:null),class:"cursor-selector mode-selector",disabled:!e.enabled,placement:"top-start",teleported:!0,"popper-class":"chat-input-select-dropdown mode-dropdown","popper-options":{modifiers:[{name:"preventOverflow",options:{boundary:"viewport"}},{name:"flip",options:{fallbackPlacements:["top-start","top"]}}]},onChange:n[9]||(n[9]=e=>ht(w)(ht(p)))},{prefix:St(()=>[tt("span",ZE,ut(ht(m)(ht(p))),1)]),default:St(()=>[kt(a,{value:"default",label:"Default"},{default:St(()=>[...n[20]||(n[20]=[tt("span",{class:"mode-option-label"},[tt("span",{class:"mode-icon"},"?"),tt("span",null,"Default")],-1)])]),_:1}),kt(a,{value:"acceptEdits",label:"Accept Edits"},{default:St(()=>[...n[21]||(n[21]=[tt("span",{class:"mode-option-label"},[tt("span",{class:"mode-icon"},"âœŽ"),tt("span",null,"Accept Edits")],-1)])]),_:1}),kt(a,{value:"bypassPermissions",label:"Bypass"},{default:St(()=>[...n[22]||(n[22]=[tt("span",{class:"mode-option-label"},[tt("span",{class:"mode-icon"},"âˆž"),tt("span",null,"Bypass")],-1)])]),_:1}),kt(a,{value:"plan",label:"Plan"},{default:St(()=>[...n[23]||(n[23]=[tt("span",{class:"mode-option-label"},[tt("span",{class:"mode-icon"},"â˜°"),tt("span",null,"Plan")],-1)])]),_:1})]),_:1},8,["modelValue","disabled"])):qe("",!0),e.showModelSelector&&"claude"===e.backendType?(st(),Qe(lt,{key:1},[kt(l,{modelValue:Ce.value,"onUpdate:modelValue":n[10]||(n[10]=e=>Ce.value=e),class:"cursor-selector model-selector",disabled:!e.enabled,placement:"top-start",teleported:!0,"popper-class":"chat-input-select-dropdown","popper-options":{modifiers:[{name:"preventOverflow",options:{boundary:"viewport"}},{name:"flip",options:{fallbackPlacements:["top-start","top"]}}]},onChange:ht(g)},{default:St(()=>[(st(!0),Qe(lt,null,ct(ht(f),e=>(st(),Je(a,{key:e.id,value:e.id,label:e.displayName},{default:St(()=>[tt("span",XE,ut(e.displayName),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue","disabled","onChange"]),kt(yT,{"thinking-mode":ht(c),"thinking-tokens":ht(u),"thinking-levels":ht(d),onChange:ht(y)},null,8,["thinking-mode","thinking-tokens","thinking-levels","onChange"])],64)):qe("",!0)]),"codex"===e.backendType?(st(),Je(wE,{key:0,model:T.value,"approval-mode":E.value,"sandbox-mode":I.value,"reasoning-effort":x.value,disabled:!e.enabled,"onUpdate:model":A,"onUpdate:approvalMode":N,"onUpdate:sandboxMode":M,"onUpdate:reasoningEffort":R},null,8,["model","approval-mode","sandbox-mode","reasoning-effort","disabled"])):qe("",!0),e.showPermissionControls?(st(),Je(ET,{key:1,label:ht(i)("permission.mode.bypass"),enabled:ht(h),disabled:!e.enabled,tooltip:ht(i)("permission.mode.bypassTooltip"),onToggle:ht(b)},null,8,["label","enabled","disabled","tooltip","onToggle"])):qe("",!0)]),tt("div",JE,[kt(od,{"session-token-usage":e.sessionTokenUsage},null,8,["session-token-usage"]),e.tokenUsage?(st(),Qe("div",{key:0,class:"token-stats",title:Nt()},ut((v=e.tokenUsage,s.backendType,`${v.totalTokens} tokens`)),9,QE)):qe("",!0),tt("button",{class:"icon-btn attach-btn",disabled:!e.enabled,title:ht(i)("chat.uploadImage"),onClick:Rt},[...n[24]||(n[24]=[tt("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[tt("path",{d:"M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"})],-1)])],8,qE),tt("input",{ref_key:"imageInputRef",ref:V,type:"file",accept:"image/jpeg,image/png,image/gif,image/bmp,image/webp",multiple:"",style:{display:"none"},onChange:_t},null,544),e.isGenerating?(st(),Qe("button",{key:2,class:"icon-btn stop-icon-btn",title:ht(i)("chat.stopGenerating"),onClick:n[12]||(n[12]=e=>t.$emit("stop"))},[...n[26]||(n[26]=[tt("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[tt("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"})],-1)])],8,tI)):(st(),Qe("button",{key:1,class:dt(["icon-btn send-icon-btn",{active:Me.value}]),disabled:!Me.value,title:ht(i)("chat.sendMessageShortcut"),onClick:nt,onContextmenu:n[11]||(n[11]=(...e)=>ht(re)&&ht(re)(...e))},[...n[25]||(n[25]=[tt("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[tt("path",{d:"M8 5.14v14l11-7-11-7z"})],-1)])],42,eI))])]),_.value&&"codex"===e.backendType?(st(),Qe("div",nI,[kt(tE,{"backend-type":e.backendType,"model-value":O.value,"onUpdate:modelValue":D},null,8,["backend-type","model-value"])])):qe("",!0),ht(oe)?(st(),Qe("div",{key:5,ref_key:"sendContextMenuRef",ref:Te,class:"send-context-menu",style:it({left:ht(ie).x+"px",top:ht(ie).y+"px"}),onClick:n[15]||(n[15]=et(()=>{},["stop"]))},[tt("div",{class:"context-menu-item",onClick:n[13]||(n[13]=(...e)=>ht(ae)&&ht(ae)(...e))},[n[27]||(n[27]=tt("span",{class:"menu-icon"},"ðŸ“¤",-1)),tt("span",sI,ut(ht(i)("common.send")),1)]),e.isGenerating&&Ne.value?(st(),Qe("div",{key:0,class:"context-menu-item",onClick:n[14]||(n[14]=(...e)=>ht(le)&&ht(le)(...e))},[n[28]||(n[28]=tt("span",{class:"menu-icon"},"âš¡",-1)),tt("span",oI,ut(ht(i)("chat.interruptAndSend")),1)])):qe("",!0)],4)):qe("",!0),kt(Yu,{visible:z.value,files:H.value,"anchor-element":U.value??null,"show-search-input":!0,placeholder:ht(i)("tools.search"),"is-indexing":K.value,onSelect:gt,onDismiss:mt,onSearch:ft},null,8,["visible","files","anchor-element","placeholder","is-indexing"]),kt(Zu,{visible:j.value,files:Z.value,"anchor-element":$.value,"at-position":Y.value,"is-indexing":X.value,onSelect:ze,onDismiss:He},null,8,["visible","files","anchor-element","at-position","is-indexing"]),kt(td,{visible:J.value,query:Q.value,"anchor-element":$.value,onSelect:je,onDismiss:Ye},null,8,["visible","query","anchor-element"]),kt(Lu,{visible:ht(ue),"image-src":ht(de),"image-alt":"å›¾ç‰‡é¢„è§ˆ",onClose:ht(ye)},null,8,["visible","image-src","onClose"])],6);var v}}}),rI=ju(iI,[["__scopeId","data-v-6530e1b9"]]);const aI=new class{constructor(){De(this,"md"),this.md=new qt({html:!1,linkify:!0,typographer:!0,breaks:!0}),this.setupCustomRules()}render(e){return this.md.render(e)}setupCustomRules(){this.md.renderer.rules.fence=(e,t,n,s,o)=>{const i=e[t],r=i.info.trim()||"text",a=i.content;return`<div class="code-block-wrapper" data-lang="${r}">\n        <div class="code-block-header">\n          <span class="language">${r}</span>\n          <button class="copy-btn" data-code="${encodeURIComponent(a)}"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button>\n        </div>\n        <div class="code-content"><code class="language-${r}">${this.escapeHtml(a)}</code></div>\n      </div>`};const e=this.md.renderer.rules.link_open||((e,t,n,s,o)=>o.renderToken(e,t,n));this.md.renderer.rules.link_open=(t,n,s,o,i)=>{const r=t[n],a=r.attrIndex("href");if(a>=0){const e=r.attrs[a][1];(e.startsWith("/")||e.startsWith("file://"))&&r.attrPush(["class","file-link"])}return e(t,n,s,o,i)}}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}};function lI(){return"undefined"!=typeof window&&!0===window.__IDEA_MODE__}async function cI(){if(!(await async function(){try{const e=Za(),t=await fetch(`${e}/api/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"ide.hasIdeEnvironment"})});if(!t.ok)return console.warn("[JetBrainsApi] Capabilities check failed:",t.status),{supported:!1,version:""};const n=await t.json(),s=n.data?.hasIde??!1;return console.log("[JetBrainsApi] Backend has IDE environment:",s),{supported:s,version:s?"1.0":""}}catch(e){return console.warn("[JetBrainsApi] Failed to check capabilities:",e),{supported:!1,version:""}}}()).supported)return console.log("[JetBrainsApi] Backend does not support JetBrains integration"),!1;const e=lI();return console.log(`[JetBrainsApi] JetBrains integration enabled (inIde: ${e}, backend supported: true)`),!0}const uI=new class{constructor(){De(this,"enabled",!1)}async init(){return!!(await cI())&&(this.enabled=await Kc.connect(),this.enabled&&console.log("[JetBrainsBridge] Initialized with RSocket"),this.enabled)}isEnabled(){return this.enabled&&Kc.isConnected()}async openFile(e){return!!this.enabled&&Kc.openFile(e)}async showDiff(e){return!!this.enabled&&Kc.showDiff(e)}async showMultiEditDiff(e){return!!this.enabled&&Kc.showMultiEditDiff(e)}async showEditPreviewDiff(e){return!!this.enabled&&Kc.showEditPreviewDiff(e)}async showMarkdown(e){return!!this.enabled&&Kc.showMarkdown(e)}async getProjectPath(){return this.enabled?Kc.getProjectPath():null}async getTheme(){return this.enabled?Kc.getTheme():null}async getLocale(){return this.enabled?Kc.getLocale():"en-US"}async setLocale(e){return!!this.enabled&&Kc.setLocale(e)}onThemeChange(e){return Kc.onThemeChange(e)}onSessionCommand(e){return Kc.onSessionCommand(e)}};const dI={background:"#1e1e1e",foreground:"#d4d4d4",panelBackground:"#252526",borderColor:"#3c3c3c",textFieldBackground:"#3c3c3c",selectionBackground:"#264f78",selectionForeground:"#ffffff",linkColor:"#3794ff",errorColor:"#f14c4c",warningColor:"#cca700",successColor:"#89d185",separatorColor:"#3c3c3c",hoverBackground:"#2a2d2e",accentColor:"#0e639c",infoBackground:"#2d2d2d",codeBackground:"#1e1e1e",secondaryForeground:"#858585"},pI={background:"#ffffff",foreground:"#24292e",panelBackground:"#fafbfc",borderColor:"#e1e4e8",textFieldBackground:"#ffffff",selectionBackground:"#d2e7ff",selectionForeground:"#0b3d91",linkColor:"#0366d6",errorColor:"#d73a49",warningColor:"#ffc107",successColor:"#28a745",separatorColor:"#e1e4e8",hoverBackground:"#f3f4f6",accentColor:"#0366d6",infoBackground:"#f5f5f5",codeBackground:"#f8f9fa",secondaryForeground:"#6a737d"};const hI=new class{constructor(){De(this,"currentTheme",null),De(this,"listeners",new Set),De(this,"initialized",!1),De(this,"themeMode","system"),De(this,"hasIdeBridge",!1),De(this,"_unsubscribeTheme",null),De(this,"loadedFonts",new Set),De(this,"ideaBuiltinFonts",["JetBrains Mono","Fira Code","Droid Sans","Droid Sans Mono","Droid Serif","Inconsolata","Inter"])}async initialize(){if(this.initialized)return;if(this.initialized=!0,console.log("ðŸŽ¨ Initializing theme service..."),"undefined"==typeof window)return void this.setTheme("system");const e=this.getInitialThemeFromUrl();return e?(console.log("ðŸŽ¨ [URL] Applying initial theme from URL"),this.setTheme(e),this.hasIdeBridge=!0,await this.loadFontsFromBackend(e),void this.bindJetBrainsThemeAsync()):(this.setTheme("system"),uI.isEnabled()?(console.log("ðŸŽ¨ [Unified] Using IDEA theme (backend supports JetBrains)"),void(await this.bindJetBrainsTheme())):(console.log("ðŸŽ¨ [Fallback] Using system theme (no JetBrains backend)"),void this.watchSystemTheme()))}getInitialThemeFromUrl(){try{const e=window;if(e.__initialTheme)return console.log("ðŸŽ¨ [URL] Using pre-parsed theme from window.__initialTheme"),e.__initialTheme;const t=new URLSearchParams(window.location.search).get("initialTheme");if(!t)return null;const n=decodeURIComponent(t),s=JSON.parse(n);return console.log("ðŸŽ¨ [URL] Found initial theme in URL params"),s}catch(e){return console.warn("ðŸŽ¨ [URL] Failed to parse initial theme:",e),null}}async loadFontsFromBackend(e){const t=[];if(e.fontFamily){const n=this.extractPrimaryFont(e.fontFamily);n&&!this.isSystemFont(n)&&t.push(n)}if(e.editorFontFamily){const n=this.extractPrimaryFont(e.editorFontFamily);!n||this.isSystemFont(n)||t.includes(n)||t.push(n)}0!==t.length?(console.log("ðŸ”¤ [Font] Loading fonts:",t),await Promise.all(t.map(e=>this.loadFont(e)))):console.log("ðŸ”¤ [Font] No custom fonts to load")}extractPrimaryFont(e){return e.split(",").map(e=>e.trim().replace(/['"]/g,""))[0]||null}isSystemFont(e){return["sans-serif","serif","monospace","cursive","fantasy","system-ui","ui-sans-serif","ui-serif","ui-monospace","ui-rounded","Arial","Helvetica","Times New Roman","Times","Courier New","Courier","Verdana","Georgia","Palatino","Garamond","Bookman","Comic Sans MS","Trebuchet MS","Arial Black","Impact","Consolas","Monaco","Lucida Console","Lucida Sans Typewriter","Menlo","SF Mono","Segoe UI","Tahoma","Geneva","Microsoft YaHei","Microsoft YaHei UI","å¾®è½¯é›…é»‘","SimHei","é»‘ä½“","SimSun","å®‹ä½“","PingFang SC","Hiragino Sans GB","STHeiti","WenQuanYi Micro Hei"].some(t=>t.toLowerCase()===e.toLowerCase())}isIdeaBuiltinFont(e){return this.ideaBuiltinFonts.some(t=>t.toLowerCase()===e.toLowerCase())}isFontAvailable(e){const t=document.createElement("canvas").getContext("2d");if(!t)return!1;const n="abcdefghijklmnopqrstuvwxyz0123456789";t.font="72px monospace";const s=t.measureText(n).width;t.font=`72px "${e}", monospace`;return s!==t.measureText(n).width}async loadFont(e){if(this.loadedFonts.has(e))console.log(`ðŸ”¤ [Font] Already loaded: ${e}`);else{if(this.isFontAvailable(e))return console.log(`ðŸ”¤ [Font] Already available in system: ${e}`),void this.loadedFonts.add(e);if(this.isIdeaBuiltinFont(e))try{const t=`${this.getServerUrl()}/api/font/${encodeURIComponent(e)}`;console.log(`ðŸ”¤ [Font] Downloading IDEA builtin font: ${t}`);const n=await fetch(t);if(!n.ok)return void(404===n.status?console.log(`ðŸ”¤ [Font] Not found on server: ${e} (using fallback)`):console.warn(`ðŸ”¤ [Font] Failed to load ${e}: ${n.status}`));const s=await n.blob(),o=URL.createObjectURL(s),i=n.headers.get("Content-Type")||"font/ttf",r=this.getFormatFromMimeType(i),a=new FontFace(e,`url(${o})`,{style:"normal",weight:"400"});await a.load(),document.fonts.add(a),this.loadedFonts.add(e),console.log(`âœ… [Font] Loaded: ${e} (format: ${r})`)}catch(t){console.warn(`ðŸ”¤ [Font] Error loading ${e}:`,t)}else console.log(`ðŸ”¤ [Font] Not an IDEA builtin font, skip download: ${e}`)}}getFormatFromMimeType(e){return{"font/ttf":"truetype","font/otf":"opentype","font/woff":"woff","font/woff2":"woff2","application/x-font-ttf":"truetype","application/x-font-opentype":"opentype"}[e]||"truetype"}getServerUrl(){const e=window;return e.__serverUrl?e.__serverUrl:"http://localhost:8765"}bindJetBrainsThemeAsync(){setTimeout(async()=>{try{this._unsubscribeTheme=uI.onThemeChange(e=>{e&&(this.setTheme(e),console.log("ðŸŽ¨ [IDE] Theme updated via RSocket"),this.loadFontsFromBackend(e))}),console.log("ðŸŽ¨ [IDE] Theme change listener registered")}catch(e){console.warn("ðŸŽ¨ [IDE] Failed to bind theme listener:",e)}},100)}async bindJetBrainsTheme(){try{const e=await uI.getTheme();e&&(this.setTheme(e),this.hasIdeBridge=!0,console.log("ðŸŽ¨ [IDE] âœ… Theme loaded via RSocket"),await this.loadFontsFromBackend(e)),this._unsubscribeTheme=uI.onThemeChange(e=>{e&&(this.setTheme(e),console.log("ðŸŽ¨ [IDE] Theme updated via RSocket"),this.loadFontsFromBackend(e))})}catch(e){console.warn("ðŸŽ¨ [IDE] Failed to get theme via RSocket:",e),this.watchSystemTheme()}}setTheme(e){let t;if("object"==typeof e)t=e,console.log("ðŸŽ¨ [IDE] Applying IDE theme");else if(this.themeMode=e,"system"===e){const e=this.detectSystemTheme();t=e?dI:pI,console.log("ðŸŽ¨ [System] Detected:",e?"dark":"light")}else t="dark"===e?dI:pI,console.log("ðŸŽ¨ [User] Selected:",e);this.applyTheme(t)}toggleTheme(){if(this.hasIdeBridge)return void console.log("ðŸŽ¨ Toggle theme not available in IDE mode");const e="dark"===this.themeMode?"light":"dark";this.setTheme(e)}getThemeMode(){return this.themeMode}getCurrentTheme(){return this.currentTheme}hasIde(){return this.hasIdeBridge}onThemeChange(e){return this.listeners.add(e),this.currentTheme&&e(this.currentTheme),()=>this.listeners.delete(e)}detectSystemTheme(){return window.matchMedia?.("(prefers-color-scheme: dark)").matches??!1}watchSystemTheme(){window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{"system"!==this.themeMode||this.hasIdeBridge||(console.log("ðŸŽ¨ [System] Theme changed:",e.matches?"dark":"light"),this.setTheme("system"))})}applyTheme(e){this.currentTheme=e,this.injectCssVariables(e),this.notifyListeners(e)}notifyListeners(e){this.listeners.forEach(t=>{try{t(e)}catch(n){console.error("âŒ Theme listener error:",n)}})}injectCssVariables(e){const t=document.documentElement,n={"--theme-background":e.background,"--theme-foreground":e.foreground,"--theme-panel-background":e.panelBackground,"--theme-border":e.borderColor,"--theme-text-field-background":e.textFieldBackground,"--theme-selection-background":e.selectionBackground,"--theme-selection-foreground":e.selectionForeground,"--theme-link":e.linkColor,"--theme-error":e.errorColor,"--theme-warning":e.warningColor,"--theme-success":e.successColor,"--theme-separator":e.separatorColor,"--theme-hover-background":e.hoverBackground,"--theme-accent":e.accentColor,"--theme-info-background":e.infoBackground,"--theme-code-background":e.codeBackground,"--theme-secondary-foreground":e.secondaryForeground,"--theme-card-background":e.panelBackground,"--theme-pending":e.pendingColor||e.accentColor,"--theme-running":e.runningColor||e.successColor};e.fontFamily&&(n["--theme-font-family"]=e.fontFamily),e.fontSize&&(n["--theme-font-size"]=`${e.fontSize}px`),e.editorFontFamily&&(n["--theme-editor-font-family"]=e.editorFontFamily),e.editorFontSize&&(n["--theme-editor-font-size"]=`${e.editorFontSize}px`),Object.entries(n).forEach(([e,n])=>{t.style.setProperty(e,n)}),console.log("âœ… Theme CSS variables injected",e.fontFamily?`(font: ${e.fontFamily})`:"")}};const fI=new class{constructor(){De(this,"highlighter",null),De(this,"initialized",!1),De(this,"initPromise",null)}async init(){if(!this.initialized)return this.initPromise||(this.initPromise=(async()=>{try{console.log("ðŸŽ¨ Initializing syntax highlighter...");const{createHighlighter:e}=await en(async()=>{const{createHighlighter:e}=await import("./shiki.js").then(e=>e.i);return{createHighlighter:e}},[],import.meta.url);this.highlighter=await e({themes:["github-light","github-dark"],langs:["javascript","typescript","python","java","kotlin","go","rust","cpp","c","csharp","php","ruby","swift","bash","shell","json","xml","html","css","scss","sql","yaml","markdown","dockerfile","vue","jsx","tsx"]}),this.initialized=!0,console.log("âœ… Syntax highlighter initialized")}catch(e){throw console.error("âŒ Failed to initialize highlighter:",e),e}})()),this.initPromise}async highlight(e,t){if(await this.init(),!this.highlighter)return this.escapeHtml(e);try{const n=this.isDarkTheme()?"github-dark":"github-light",s=this.normalizeLanguage(t);return this.highlighter.codeToHtml(e,{lang:s,theme:n})}catch(n){return console.warn(`Failed to highlight ${t}:`,n),`<pre><code>${this.escapeHtml(e)}</code></pre>`}}isDarkTheme(){const e=hI.getCurrentTheme();return e?this.isColorDark(e.background):window.matchMedia?.("(prefers-color-scheme: dark)").matches??!1}isColorDark(e){const t=e.replace("#","");return.2126*parseInt(t.substring(0,2),16)+.7152*parseInt(t.substring(2,4),16)+.0722*parseInt(t.substring(4,6),16)<128}normalizeLanguage(e){const t=e.toLowerCase().trim(),n={js:"javascript",ts:"typescript",py:"python",kt:"kotlin",sh:"bash",yml:"yaml",md:"markdown",cs:"csharp","c++":"cpp",h:"c",hpp:"cpp"}[t]||t;return["javascript","typescript","python","java","kotlin","go","rust","cpp","c","csharp","php","ruby","swift","bash","shell","json","xml","html","css","scss","sql","yaml","markdown","dockerfile","vue","jsx","tsx"].includes(n)?n:"text"}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}},mI=["innerHTML"],gI=Ze({__name:"MarkdownRenderer",props:{content:{}},setup(e){const{t:t}=cu(),n=e,s=Ge(""),o=Ge(!1);let i=!1,r="";async function a(){if(o.value)i=!0;else try{o.value=!0;const e=n.content;let t=aI.render(e);t=await async function(e){const t=(new DOMParser).parseFromString(e,"text/html"),n=t.querySelectorAll(".code-block-wrapper");for(const o of n){const e=o.getAttribute("data-lang")||"text",t=o.querySelector("code");if(t){const n=t.textContent||"";try{const t=await fI.highlight(n,e),s=o.querySelector(".code-content");s&&(s.innerHTML=t)}catch(s){console.warn(`Failed to highlight ${e}:`,s)}}}return t.body.innerHTML}(t),s.value=t,r=e}catch(e){console.error("Failed to render markdown:",e),s.value=`<p>${t("common.renderFailed")}: ${e}</p>`}finally{o.value=!1,i&&(i=!1,n.content!==r&&await a())}}function l(e){const t=e.target;if(t.classList.contains("copy-btn")){e.preventDefault();const n=t.getAttribute("data-code");if(n){!async function(e){try{await navigator.clipboard.writeText(e)}catch(t){console.error("Failed to copy:",t)}}(decodeURIComponent(n)),function(e){const t=e.innerHTML;e.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',e.classList.add("copied"),setTimeout(()=>{e.innerHTML=t,e.classList.remove("copied")},2e3)}(t)}return}if("A"===t.tagName){const n=t.getAttribute("href");if(n&&(n.startsWith("/")||n.startsWith("file://"))){e.preventDefault();const t=n.replace("file://","");Ic("ide.openFile",{filePath:t})}}}return ot(async()=>{await fI.init(),await a()}),Ke(()=>n.content,a),(e,t)=>(st(),Qe("div",{class:"markdown-body",onClick:l,innerHTML:s.value},null,8,mI))}}),yI={key:0,class:"row-spacer"},vI={class:"message-wrapper"},bI={class:"content-header"},kI={key:0,class:"context-tags"},wI=["title"],SI={class:"tag-file-name"},CI={key:0,class:"tag-line-range"},TI=["title","onClick"],EI={class:"tag-file-name"},II=["src","alt","onClick"],xI={key:1,class:"header-spacer"},AI={class:"action-buttons"},NI=["title"],MI={key:0},RI={key:1},_I=["innerHTML"],OI={key:1,class:"inline-images"},DI=["src","alt","onClick"],BI=Ze({__name:"UserMessageBubble",props:{message:{}},setup(e){const t=e,{t:n}=cu(),s=Ge(),o=Ge(!0),i=Ge(!1);function r(){pt(()=>{if(s.value){const e=s.value,t=e.style.maxHeight;e.style.maxHeight="none";const n=e.scrollHeight;e.style.maxHeight=t;const o=55;i.value=n>o}})}ot(r),Ke(()=>t.message.content,r,{deep:!0});const a=Ge(!1);async function l(){try{await navigator.clipboard.writeText(w.value),a.value=!0,setTimeout(()=>{a.value=!1},2e3)}catch(e){console.error("Failed to copy:",e)}}const c=Ge(!1),u=Ge(!1),d=Ge(),p=Ge(),h=Ge([]);function f(){c.value=!0,h.value=t.message.contexts?[...t.message.contexts]:[],pt(()=>{d.value&&t.message.content&&d.value.setContent(t.message.content)})}function m(){c.value=!1,h.value=[]}async function g(e){const n=t.message.uuid;if(!n)return console.warn("[UserMessageBubble] æ¶ˆæ¯æ²¡æœ‰ uuidï¼Œæ— æ³•ç¼–è¾‘é‡å‘"),void m();const s=lu().currentTab;if(!s)return console.warn("[UserMessageBubble] æ²¡æœ‰æ´»åŠ¨çš„ tab"),void m();const o=s.projectPath.value;if(console.log("[UserMessageBubble] é¡¹ç›®è·¯å¾„:",o),!o)return console.warn("[UserMessageBubble] é¡¹ç›®è·¯å¾„ä¸ºç©ºï¼Œæ— æ³•ç¼–è¾‘é‡å‘"),void m();const i=[...h.value];m();try{await s.editAndResendMessage(n,{contexts:i,contents:e},o)}catch(r){console.error("[UserMessageBubble] ç¼–è¾‘é‡å‘å¤±è´¥:",r)}}function y(e){h.value.push(e)}function v(e){const t=h.value.findIndex(t=>t.uri===e.uri);-1!==t&&h.value.splice(t,1)}xt(p,()=>{c.value&&m()});const b=We(()=>{const e=t.message.contexts;return e&&Array.isArray(e)?e.filter(e=>"file"===e.type||"image"===e.type&&e.base64Data):[]});function k(e){if("image"===e.type&&e.base64Data){return`data:${e.mimeType||"image/png"};base64,${e.base64Data}`}return""}const w=We(()=>{const e=t.message.content;return e&&Array.isArray(e)?e.filter(e=>{if("text"===e.type&&"text"in e){const t=e.text?.trim()||"";return!function(e){return/^@file:\/\/.+$/.test(e)}(t)&&(!oc(t)&&(!t.startsWith("<diff-old-content>")&&!t.startsWith("<diff-new-content>")))}return!1}).map(e=>{if("text"===e.type&&"text"in e){let t=e.text;return ql(t)&&(t=ec(t)),t}return""}).join("\n"):""}),S=We(()=>{const e=t.message.content;if(e&&Array.isArray(e))for(const t of e)if("text"===t.type&&"text"in t){const e=t.text||"";if(ql(e))return Ql(e)||void 0}}),C=We(()=>{if(!w.value)return"";return function(e){const t=function(e){const t=[],n=/https?:\/\/[^\s<>"{}|\\^`]+/g;let s;for(;null!==(s=n.exec(e));)t.push({start:s.index,end:s.index+s[0].length,text:s[0],href:s[0],type:"url"});const o=/@([.\w-/\\]+\.\w+)/g;for(;null!==(s=o.exec(e));){const e=s.index,n=s.index+s[0].length;t.some(t=>e<t.end&&n>t.start)||t.push({start:e,end:n,text:s[0],href:s[1],type:"file"})}const i=/(?:^|[\s(])([/\\][\w\-.@/\\]+\.\w+|[A-Z]:[/\\][\w\-.@/\\]+\.\w+)/gm;for(;null!==(s=i.exec(e));){const e=s[1],n=s.index+s[0].indexOf(e),o=n+e.length;t.some(e=>n<e.end&&o>e.start)||t.push({start:n,end:o,text:e,href:e,type:"file"})}return t.sort((e,t)=>e.start-t.start),t}(e);if(0===t.length)return{html:_u(e),hasLinks:!1};const n=[];let s=0;for(const o of t){o.start>s&&n.push(_u(e.slice(s,o.start)));const t="file"===o.type?"linkified-link file-link":"linkified-link",i=o.type,r=_u(o.href),a=_u(o.text);n.push(`<a href="${r}" class="${t}" data-link-type="${i}">${a}</a>`),s=o.end}return s<e.length&&n.push(_u(e.slice(s))),{html:n.join(""),hasLinks:!0}}(w.value).html});We(()=>{const e=w.value;return e?e.length>100?e.substring(0,100)+"...":e:""});const T=We(()=>{if(t.message.openFile){const e={path:t.message.openFile.path};if(t.message.selectedLines){const n=t.message.selectedLines;e.startLine=n.start,e.endLine=n.end,e.startColumn=n.startColumn,e.endColumn=n.endColumn,e.selectedContent=n.content}return e}return t.message.currentOpenFile?t.message.currentOpenFile:S.value}),E=We(()=>!!T.value);function I(e){const t=e.replace(/\\/g,"/").split("/");return t[t.length-1]||e}const x=We(()=>{const e=T.value;return e?I(e.path):""}),A=We(()=>{const e=T.value;if(!e)return"";if(e.startLine&&e.endLine){const t=e.startColumn||1,n=e.endColumn||1;return`:${e.startLine}:${t}-${e.endLine}:${n}`}if(e.line){const t=e.column||1;return`:${e.line}:${t}`}return""});We(()=>{const e=T.value;if(!e)return"";const t=I(e.path);return e.startLine&&e.endLine?`${t}:${e.startLine}-${e.endLine}`:e.line?`${t}:${e.line}`:t});const N=We(()=>{const e=T.value;if(!e)return"";let t="";return t=e.startLine&&e.endLine?`${e.path}:${e.startLine}-${e.endLine}`:e.line?`${e.path}:${e.line}`:e.path,e.selectedContent?`${t}\n\né€‰ä¸­å†…å®¹:\n${e.selectedContent}`:t});function M(){const e=T.value;e&&Ic("ide.openFile",{filePath:e.path,line:e.startLine||e.line||1,column:e.startColumn||e.column||1})}function R(e){e.stopPropagation();const t=function(e){const t=e.target;if("A"!==t.tagName)return null;const n=t.getAttribute("href"),s=t.getAttribute("data-link-type")||"url";return n?{href:n,type:s}:null}(e);var n,s,o;t?(e.preventDefault(),n=t.href,s=t.type,o=e=>{Ic("ide.openFile",{filePath:e})},"url"===s?window.open(n,"_blank","noopener,noreferrer"):"file"===s&&o&&o(n)):O.value&&B()}const _=We(()=>{const e=t.message.content;return e&&Array.isArray(e)?e.filter(e=>"image"===e.type):[]}),O=We(()=>{const e=t.message.content;if(!e||!Array.isArray(e))return!1;let n=0,s=0;for(const t of e)if("text"===t.type&&"text"in t){const e=t.text||"";n+=e.length,s+=e.split("\n").length}return s>3||n>150}),D=We(()=>{const e=lu().currentTab;if(!e)return 0;const n=e.displayItems,s=n.findIndex(e=>e.id===t.message.id);if(s<=0)return 0;for(let t=s-1;t>=0;t--){const e=n[t];if("assistantText"===e.displayType&&e.stats?.inputTokens)return e.stats.inputTokens}return 0});function B(){o.value=!o.value}function L(e){return"url"===e.source.type&&e.source.url?e.source.url:"base64"===e.source.type&&e.source.data?`data:${e.source.media_type};base64,${e.source.data}`:""}const F=Ge(!1),P=Ge(""),$=Ge("");function U(){F.value=!1}return(e,r)=>(st(),Qe(lt,null,[tt("div",{class:dt(["user-message-container",{"is-replay":t.message.isReplay,"is-editing":c.value,[t.message.style||""]:t.message.isReplay&&t.message.style}]),onMouseenter:r[0]||(r[0]=e=>u.value=!0),onMouseleave:r[1]||(r[1]=e=>u.value=!1)},[c.value?(st(),Qe("div",{key:0,ref_key:"editorContainerRef",ref:p,class:"inline-editor-container"},[kt(rI,{ref_key:"chatInputRef",ref:d,inline:!0,contexts:h.value,"show-context-controls":!0,"show-model-selector":!1,"show-permission-controls":!1,onSend:g,onCancel:m,onContextAdd:y,onContextRemove:v},null,8,["contexts"])],512)):(st(),Qe(lt,{key:1},[t.message.isReplay?qe("",!0):(st(),Qe("div",yI)),tt("div",vI,[t.message.isReplay?qe("",!0):rt((st(),Qe("button",{key:0,class:"edit-button",title:"Edit and resend message",onClick:f},[...r[2]||(r[2]=[tt("span",{class:"edit-icon"},"âœï¸",-1)])],512)),[[At,u.value&&t.message.uuid&&!t.message.isStreaming]]),tt("div",{class:dt(["message-content",{"bubble-style":!t.message.isReplay}])},[tt("div",bI,[E.value||b.value.length>0?(st(),Qe("div",kI,[E.value?(st(),Qe("span",{key:0,class:"file-tag",title:N.value,onClick:et(M,["stop"])},[tt("span",SI,ut(x.value),1),A.value?(st(),Qe("span",CI,ut(A.value),1)):qe("",!0)],8,wI)):qe("",!0),(st(!0),Qe(lt,null,ct(b.value,(e,t)=>{return st(),Qe(lt,{key:`ctx-${t}`},["file"===e.type?(st(),Qe("span",{key:0,class:"file-tag file-ref",title:e.fullPath||e.uri,onClick:et(t=>function(e){const t=e.fullPath||e.path||e.uri?.replace(/^file:\/\//,"");t&&Ic("ide.openFile",{filePath:t})}(e),["stop"])},[r[3]||(r[3]=tt("span",{class:"tag-prefix"},"@",-1)),tt("span",EI,ut((n=e,I(n.fullPath||n.path||n.uri?.replace(/^file:\/\//,"")||""))),1)],8,TI)):"image"===e.type&&e.base64Data?(st(),Qe("img",{key:1,src:k(e),alt:`Context image ${t+1}`,class:"context-thumb-inline",onClick:et(t=>function(e){const t=k(e);t&&(P.value=t,$.value=e.name||"Context image",F.value=!0)}(e),["stop"])},null,8,II)):qe("",!0)],64);var n}),128))])):(st(),Qe("div",xI)),tt("div",AI,[tt("button",{class:"action-btn",title:ht(n)("common.copy"),onClick:et(l,["stop"])},[a.value?(st(),Qe("span",MI,"âœ“")):(st(),Qe("span",RI,"ðŸ“‹"))],8,NI),i.value?(st(),Qe("button",{key:0,class:"action-btn",onClick:et(B,["stop"])},ut(o.value?ht(n)("common.expand")+" â–¾":ht(n)("common.collapse")+" â–´"),1)):qe("",!0)])]),tt("div",{ref_key:"contentRef",ref:s,class:dt(["message-body",{collapsed:o.value&&i.value}])},[w.value?(st(),Qe("div",{key:0,class:dt(["message-text",{"use-markdown":t.message.isReplay}])},[t.message.isReplay?(st(),Je(gI,{key:0,content:w.value},null,8,["content"])):(st(),Qe("span",{key:1,innerHTML:C.value,onClick:R},null,8,_I))],2)):qe("",!0),_.value.length>0?(st(),Qe("div",OI,[(st(!0),Qe(lt,null,ct(_.value,(e,t)=>(st(),Qe("img",{key:`img-${t}`,src:L(e),alt:`Image ${t+1}`,class:"inline-thumb",onClick:et(t=>function(e){const t=L(e);t&&(P.value=t,$.value=function(e,t){if("url"===e.source.type&&e.source.url){const n=e.source.url.split("/");return n[n.length-1]||`image-${t+1}`}return`image.${e.source.media_type.split("/")[1]||"png"}`}(e,0),F.value=!0)}(e),["stop"])},null,8,DI))),128))])):qe("",!0)],2)],2),!t.message.isReplay&&D.value>0?(st(),Je(od,{key:1,"session-token-usage":{inputTokens:D.value,outputTokens:0}},null,8,["session-token-usage"])):qe("",!0)])],64))],34),kt(Lu,{visible:F.value,"image-src":P.value,"image-alt":$.value,onClose:U},null,8,["visible","image-src","image-alt"])],64))}}),LI=ju(BI,[["__scopeId","data-v-ea39222b"]]);const FI=new class{constructor(){De(this,"handlers",new Map),De(this,"initialized",!1)}isAvailable(){return lI()&&uI.isEnabled()}isInitialized(){return this.initialized}register(e,t){this.handlers.set(e,t)}registerAll(e){Object.entries(e).forEach(([e,t])=>{this.handlers.set(e,t)})}intercept(e){if(console.log("[ToolShowInterceptor] intercept called:",{toolType:e.toolType,isAvailable:this.isAvailable(),hasHandler:this.handlers.has(e.toolType),initialized:this.initialized,handlersCount:this.handlers.size,isError:e.result?.is_error}),e.result?.is_error)return console.log("[ToolShowInterceptor] Tool execution failed, passing through to show error"),!1;if(!this.isAvailable())return console.log("[ToolShowInterceptor] Not available, passing through"),!1;const t=this.handlers.get(e.toolType);if(!t)return console.log(`[ToolShowInterceptor] No handler for ${e.toolType}, passing through`),!1;const n={openFile:e=>uI.openFile(e),showDiff:e=>uI.showDiff(e),showMultiEditDiff:e=>uI.showMultiEditDiff(e)};try{return console.log(`[ToolShowInterceptor] Calling handler for ${e.toolType}`),t(e,n),!0}catch(s){return console.error(`[ToolShowInterceptor] Handler error for ${e.toolType}:`,s),!1}}init(){this.initialized?console.log("[ToolShowInterceptor] Already initialized, skipping"):(this.registerDefaultHandlers(),this.initialized=!0,console.log("âœ… ToolShowInterceptor initialized with handlers:",Array.from(this.handlers.keys())))}registerDefaultHandlers(){this.register("Read",(e,t)=>{t.openFile({filePath:e.input.file_path||e.input.path||"",line:e.input.offset?void 0:1,startOffset:e.input.offset,endOffset:e.input.offset&&e.input.limit?e.input.offset+e.input.limit-1:void 0})}),this.register("Write",(e,t)=>{t.openFile({filePath:e.input.file_path||e.input.path||""})}),this.register("Edit",(e,t)=>{const n=e.input.file_path||e.input.path||"";t.showDiff({filePath:n,oldContent:e.input.old_string||"",newContent:e.input.new_string||"",title:`Edit: ${n}`})}),this.register("MultiEdit",(e,t)=>{t.showMultiEditDiff({filePath:e.input.file_path||e.input.path||"",edits:(e.input.edits||[]).map(e=>({oldString:e.old_string||"",newString:e.new_string||"",replaceAll:e.replace_all||!1}))})})}};const PI=["innerHTML"],$I={key:1,class:"tool-icon"},UI={class:"action-type"},VI={key:2,class:"primary-info loading"},WI={key:3,class:"primary-info"},GI={key:4,class:"secondary-info"},zI={key:0,class:"line-changes-badge badge-remove"},HI={key:1,class:"line-changes-badge badge-add"},KI={key:2,class:"line-changes-badge badge-read"},jI={key:7,class:"background-hint"},YI={key:0,class:"spinner spinner-parsing"},ZI={key:1,class:"spinner spinner-running"},XI={key:2,class:"dot"},JI={key:0,class:"error-message-box"},QI={class:"error-header"},qI={class:"error-title"},ex={class:"error-content"},tx=ju(Ze({__name:"CompactToolCard",props:{displayInfo:{},isExpanded:{type:Boolean,default:!1},hasDetails:{type:Boolean,default:!1},clickable:{type:Boolean,default:!0},toolCall:{},supportsBackground:{type:Boolean,default:!1}},emits:["click","toggle"],setup(e,{emit:t}){const{t:n}=cu(),s=lu(),o=Ge(!1);let i=null;const r=e,a=t,l=We(()=>r.clickable&&(r.hasDetails||"pending"!==r.displayInfo.status)),c=We(()=>{const e=r.displayInfo?.icon;return e&&e.trim().startsWith("<svg")});function u(){if(l.value){if(r.toolCall){if(FI.intercept({toolType:r.toolCall.toolType,input:r.toolCall.input,result:r.toolCall.result}))return}r.isExpanded||s.switchToBrowseMode(),a("toggle"),a("click")}}return Ke(()=>r.displayInfo?.status,e=>{i&&(clearTimeout(i),i=null),o.value=!1,!r.supportsBackground||"pending"!==e&&e||(i=setTimeout(()=>{"pending"!==r.displayInfo?.status&&r.displayInfo?.status||(o.value=!0)},5e3))},{immediate:!0}),Xe(()=>{i&&(clearTimeout(i),i=null)}),(t,s)=>{return st(),Qe("div",{class:dt(["compact-tool-card",[`status-${e.displayInfo?.status||"pending"}`,{clickable:l.value,expanded:e.isExpanded}]])},[tt("div",{class:"card-content",onClick:u},[c.value?(st(),Qe("span",{key:0,class:"tool-icon",innerHTML:e.displayInfo?.icon},null,8,PI)):(st(),Qe("span",$I,ut(e.displayInfo?.icon||"ðŸ”§"),1)),tt("span",UI,ut(e.displayInfo?.actionType||"Unknown"),1),e.displayInfo?.isInputLoading?(st(),Qe("span",VI,ut(ht(n)("tools.parsingParams")),1)):e.displayInfo?.primaryInfo?(st(),Qe("span",WI,ut(e.displayInfo.primaryInfo),1)):qe("",!0),e.displayInfo?.secondaryInfo?(st(),Qe("span",GI,ut(e.displayInfo.secondaryInfo),1)):qe("",!0),e.displayInfo?(st(),Qe(lt,{key:5},[e.displayInfo.removedLines?(st(),Qe("span",zI," -"+ut(e.displayInfo.removedLines),1)):qe("",!0),e.displayInfo.addedLines?(st(),Qe("span",HI," +"+ut(e.displayInfo.addedLines),1)):qe("",!0),!e.displayInfo.readLines||e.displayInfo.addedLines||e.displayInfo.removedLines?e.displayInfo.lineChanges?(st(),Qe("span",{key:3,class:dt(["line-changes-badge",(i=e.displayInfo.lineChanges,i?i.startsWith("+")?"badge-add":i.startsWith("-")?"badge-remove":"":"")])},ut(e.displayInfo.lineChanges),3)):qe("",!0):(st(),Qe("span",KI,ut(e.displayInfo.readLines)+" lines ",1))],64)):qe("",!0),t.$slots["header-actions"]?(st(),Qe("span",{key:6,class:"header-actions",onClick:s[0]||(s[0]=et(()=>{},["stop"]))},[Tt(t.$slots,"header-actions",{},void 0,!0)])):qe("",!0),o.value?(st(),Qe("span",jI,ut(ht(n)("tools.ctrlBToBackground")),1)):qe("",!0),tt("span",{class:dt(["status-indicator",`status-${e.displayInfo?.status||"pending"}`])},[e.displayInfo?.isInputLoading?(st(),Qe("span",YI)):e.displayInfo?.status&&"pending"!==e.displayInfo?.status?(st(),Qe("span",XI)):(st(),Qe("span",ZI))],2)]),e.isExpanded&&(e.hasDetails||e.displayInfo?.errorMessage)?(st(),Qe("div",{key:0,class:"expanded-content",onClick:s[1]||(s[1]=et(()=>{},["stop"]))},[Tt(t.$slots,"details",{},void 0,!0),e.displayInfo?.errorMessage?(st(),Qe("div",JI,[tt("div",QI,[s[2]||(s[2]=tt("span",{class:"error-icon"},"âš ï¸",-1)),tt("span",qI,ut(ht(n)("tools.error")),1)]),tt("pre",ex,ut(e.displayInfo.errorMessage),1)])):qe("",!0)])):qe("",!0)],2);var i}}}),[["__scopeId","data-v-b93e5414"]]),nx=(e,t)=>gn.global.t(e,t),sx='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"></polyline><line x1="12" y1="19" x2="20" y2="19"></line></svg>',ox={Read:"ðŸ“„",Write:"âœï¸",Edit:"âœï¸",MultiEdit:"âœï¸",Bash:"ðŸ’»",Grep:"ðŸ”",Glob:"ðŸ”",TodoWrite:"âœ…",WebSearch:"ðŸŒ",WebFetch:"ðŸŒ",AskUserQuestion:"â“",NotebookEdit:"ðŸ““",Task:"ðŸ“‹",SlashCommand:"âš¡",Skill:"ðŸŽ¯",BashOutput:"ðŸ“¤",KillShell:"ðŸ›‘",ListMcpResources:"ðŸ“š",ReadMcpResource:"ðŸ“–",ExitPlanMode:"âœ…",EnterPlanMode:"ðŸ“",mcp__terminal__Terminal:sx,mcp__terminal__TerminalRead:sx,mcp__terminal__TerminalList:sx,mcp__terminal__TerminalKill:sx,mcp__terminal__TerminalInterrupt:sx,mcp__terminal__TerminalTypes:sx,mcp__terminal__TerminalRename:sx,read:"ðŸ“„",write:"âœï¸",edit:"âœï¸","multi-edit":"âœï¸",bash:"ðŸ’»",grep:"ðŸ”",glob:"ðŸ”","codebase-retrieval":"ðŸ§ ","todo-write":"âœ…","web-search":"ðŸŒ","web-fetch":"ðŸŒ","ask-user-question":"â“","notebook-edit":"ðŸ““",task:"ðŸ“‹","slash-command":"âš¡",skill:"ðŸŽ¯","bash-output":"ðŸ“¤","kill-shell":"ðŸ›‘","list-mcp-resources":"ðŸ“š"},ix={Read:"Read",Write:"Write",Edit:"Edit",MultiEdit:"MultiEdit",Bash:"Bash",Grep:"Grep",Glob:"Glob",TodoWrite:"TodoWrite",WebSearch:"WebSearch",WebFetch:"WebFetch",AskUserQuestion:"AskUser",NotebookEdit:"Notebook",Task:"Task",SlashCommand:"Command",Skill:"Skill",BashOutput:"Output",KillShell:"Kill",ListMcpResources:"ListMCP",ReadMcpResource:"ReadMCP",ExitPlanMode:"ExitPlan",EnterPlanMode:"EnterPlan",mcp__terminal__Terminal:"Terminal",mcp__terminal__TerminalRead:"TerminalRead",mcp__terminal__TerminalList:"TerminalList",mcp__terminal__TerminalKill:"TerminalKill",mcp__terminal__TerminalInterrupt:"TerminalInterrupt",mcp__terminal__TerminalTypes:"TerminalTypes",mcp__terminal__TerminalRename:"TerminalRename",read:"Read",write:"Write",edit:"Edit","multi-edit":"MultiEdit",bash:"Bash",grep:"Grep",glob:"Glob","codebase-retrieval":"Codebase","todo-write":"TodoWrite","web-search":"WebSearch","web-fetch":"WebFetch","ask-user-question":"AskUser","notebook-edit":"Notebook",task:"Task","slash-command":"Command",skill:"Skill","bash-output":"Output","kill-shell":"Kill","list-mcp-resources":"ListMCP"};function rx(e,t){const n=e?.toolName||"",s=e?.input||{},o=ox[n]||"ðŸ”§",i=ix[n]||n||"Unknown",r=t?.is_error?"error":t?"success":"pending",a=!(t||s&&0!==Object.keys(s).length);let l,c,u,d="",p="";if(!a)switch(n){case"read":case"Read":d=function(e){const t=ux(e.path||e.file_path||"");let n="";if(e.view_range&&Array.isArray(e.view_range)){const[t,s]=e.view_range;n=`:${t}-${s}`}else if(void 0!==e.offset&&void 0!==e.limit){n=`:${e.offset}-${e.offset+e.limit-1}`}else void 0!==e.offset&&(n=`:${e.offset}+`);return t+n}(s),p=s.path||s.file_path||"";break;case"write":case"Write":if(d=function(e){const t=ux(e.path||e.file_path||""),n=e.content||e.file_content||"";if(!n)return t;const s=n.split("\n").length;return`${t} (${nx("tools.writeTool.lines",{n:s})})`}(s),p=s.path||s.file_path||"",s?.content||s?.file_content){const e=s.content||s.file_content||"";c=(e?e.toString().split(/\r?\n/).length:0)||void 0}break;case"edit":case"Edit":if(d=function(e){const t=ux(e.file_path||e.path||""),n=e.old_str_start_line_number_1||e.old_str_start_line_number;if(n)return`${t}:${n}`;return t}(s),p=s.file_path||s.path||"",l=function(e){const t=e.old_string||e.old_str,n=e.new_string||e.new_str;if(!t||!n)return;const s=t.split("\n").length,o=n.split("\n").length-s;return 0===o?void 0:o>0?`+${o}`:`${o}`}(s),s){u=(s.old_string||s.old_str||"").toString().split(/\r?\n/).length||void 0,c=(s.new_string||s.new_str||"").toString().split(/\r?\n/).length||void 0}break;case"multi-edit":case"MultiEdit":{const e=s.edits?.length||0;d=`${ux(s.file_path||s.path||"")} (${nx("tools.multiEdit.changes",{n:e})})`,p=s.file_path||s.path||"";break}case"bash":case"Bash":d=ax(s.command||""),p=s.cwd||"";break;case"grep":case"Grep":d=function(e){const t=e.pattern||e.search_query_regex||"",n=e.path||e.glob||"";if(n)return`"${t}" in ${lx(n)}`;return`"${t}"`}(s),p="";break;case"glob":case"Glob":d=function(e){const t=e.pattern||"",n=e.path||"";if(n)return`${t} in ${lx(n)}`;return t}(s),p="";break;case"web-search":case"WebSearch":d=`"${s.query||""}"`,p="";break;case"web-fetch":case"WebFetch":d=function(e){if(!e)return"";try{const t=new URL(e),n="/"===t.pathname?"":t.pathname;return t.hostname+n}catch{return cx(e,50)}}(s.url||""),p="";break;case"todo-write":case"TodoWrite":{const e=s?.todos;d=s&&void 0!==e?nx("tools.todoTool.tasksCount",{n:e.length}):nx("common.loading"),p="";break}case"task":case"Task":d=cx(s.description||"Running task",40),p="";break;case"notebook-edit":case"NotebookEdit":d=ux(s.notebook_path||""),p=`Cell ${s.cell_number||0}`;break;case"ask-user-question":case"AskUserQuestion":{const e=s.questions||[];d=e.length>0?e[0].question:"Asking question",p=e.length>1?`+${e.length-1} more`:"";break}case"codebase-retrieval":d="Retrieving from: <> Codebase",p=s.information_request||"";break;case"bash-output":case"BashOutput":d=s.bash_id||s.shell_id||"",p="";break;case"kill-shell":case"KillShell":d=s.shell_id||"",p="";break;case"skill":case"Skill":d=s.skill||"",p="";break;case"slash-command":case"SlashCommand":d=s.command||"",p="";break;case"exit-plan-mode":case"ExitPlanMode":d="Exit plan mode",p="";break;case"enter-plan-mode":case"EnterPlanMode":d="Enter plan mode",p="";break;case"list-mcp-resources":case"ListMcpResources":d=s.server||"",p="";break;case"read-mcp-resource":case"ReadMcpResource":d=s.uri||"",p=s.server||"";break;case"mcp__terminal__Terminal":d=ax(s.command||""),p=s.session_id?`session: ${s.session_id}`:"";break;case"mcp__terminal__TerminalRead":d=s.session_id||"",p=s.search?`search: ${s.search}`:"";break;case"mcp__terminal__TerminalList":d="List sessions",p="";break;case"mcp__terminal__TerminalKill":{const e=s.session_ids;d=s.all?"all sessions":e&&e.length>0?1===e.length?e[0]:`${e.length} sessions`:"",p="";break}case"mcp__terminal__TerminalInterrupt":d=s.session_id||"",p="";break;case"mcp__terminal__TerminalTypes":d="Get shell types",p="";break;case"mcp__terminal__TerminalRename":d=s.session_id||"",p=s.new_name?`â†’ ${s.new_name}`:"";break;default:d=(h=s).path?ux(h.path):h.command?`$ ${h.command}`:h.query?h.query:h.message?h.message:"",p=function(e){return e.path?function(e){if(!e)return"";const t=e.split("/");return t.length<=1?"":t.slice(0,-1).join("/")}(e.path):e.cwd?e.cwd:e.description?e.description:""}(s)}var h;let f;if("error"===r&&t)if("string"==typeof t.content)f=t.content;else if(Array.isArray(t.content)){const e=t.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n");e&&(f=e)}return{icon:o,actionType:i,primaryInfo:d,secondaryInfo:p,lineChanges:l,addedLines:c,removedLines:u,readLines:undefined,status:r,isInputLoading:a,errorMessage:f}}function ax(e){if(!e)return"";return e.length<=50?e:e.substring(0,47)+"..."}function lx(e,t=30){if(!e||e.length<=t)return e;const n=e.split(/[\\/]/),s=n[n.length-1];return s&&s.length<t-4?".../"+s:e.substring(0,t-3)+"..."}function cx(e,t){return!e||e.length<=t?e:e.substring(0,t-3)+"..."}function ux(e){if(!e)return"";const t=e.split(/[\\/]/);return t[t.length-1]||e}const dx=["innerHTML"],px=ju(Ze({__name:"CodeSnippet",props:{code:{},language:{},startLine:{default:1},showLineNumbers:{type:Boolean,default:!0}},setup(e){const t=e,n=Ge(""),s=Ge();async function o(){if(t.code)try{const e=await fI.highlight(t.code,t.language);n.value=e}catch(e){console.warn("Failed to highlight code:",e),n.value=`<pre><code>${function(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}(t.code)}</code></pre>`}else n.value=""}return ot(o),Ke(()=>[t.code,t.language],o),(t,o)=>(st(),Qe("div",{class:dt(["code-snippet-wrapper",{"with-line-numbers":e.showLineNumbers}]),style:it({"--start-line":e.startLine})},[tt("div",{class:"code-container",ref_key:"codeContainer",ref:s},[tt("div",{class:"code-content",innerHTML:n.value},null,8,dx)],512)],6))}}),[["__scopeId","data-v-c69f671e"]]),hx={key:0,class:"content-preview"},fx=["title"],mx={class:"code-wrapper"},gx=ju(Ze({__name:"ReadToolDisplay",props:{toolCall:{}},setup(e){const{t:t}=cu(),n=e,s=Ge(!1),o=We(()=>rx(n.toolCall,n.toolCall.result)),i=We(()=>n.toolCall.input.path||n.toolCall.input.file_path||""),r=We(()=>({toolType:"Read",input:n.toolCall.input,result:n.toolCall.result})),a=We(()=>{const e=n.toolCall.result;return!(!e||e.is_error)&&!!c.value});function l(e){const t=e.split("\n");let n=1,s=!1;return{content:t.map(e=>{const t=e.match(/^\s*(\d+)â†’/);if(t){const o=parseInt(t[1],10);return s||(n=o,s=!0),e.substring(t[0].length)}return e}).join("\n"),startLine:n}}const c=We(()=>{const e=n.toolCall.result;if(!e||e.is_error)return"";const t=e.content;let s="";s="string"==typeof t?t:Array.isArray(t)?t.filter(e=>"text"===e.type).map(e=>e.text).join("\n"):JSON.stringify(t,null,2);const{content:o}=l(s),i=o.replace(/<system-reminder>[\s\S]*?<\/system-reminder>/g,"").split("\n");for(;i.length>0&&""===i[i.length-1].trim();)i.pop();return i.join("\n")}),u=We(()=>a.value&&c.value?c.value.split("\n").length:0),d=We(()=>({...o.value,readLines:u.value||void 0})),p=We(()=>{const e=n.toolCall.input.offset;if("number"==typeof e&&e>0)return e;const t=n.toolCall.result;if(!t||t.is_error)return 1;const s=t.content;let o="";o="string"==typeof s?s:Array.isArray(s)?s.filter(e=>"text"===e.type).map(e=>e.text).join("\n"):JSON.stringify(s,null,2);const{startLine:i}=l(o);return i}),h=We(()=>{const e=i.value;return{js:"javascript",ts:"typescript",kt:"kotlin",java:"java",py:"python",sh:"shell",bash:"shell",md:"markdown",json:"json",css:"css",html:"html",xml:"xml"}[e.split(".").pop()?.toLowerCase()||""]||"plaintext"});async function f(){c.value&&await navigator.clipboard.writeText(c.value)}return(e,n)=>(st(),Je(tx,{"display-info":d.value,"is-expanded":s.value,"has-details":a.value,"tool-call":r.value,onToggle:n[0]||(n[0]=e=>s.value=!s.value)},{details:St(()=>[a.value?(st(),Qe("div",hx,[tt("button",{class:"copy-btn",title:ht(t)("common.copy"),onClick:f},[...n[1]||(n[1]=[tt("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[tt("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),tt("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1)])],8,fx),tt("div",mx,[kt(px,{code:c.value,language:h.value,"start-line":p.value},null,8,["code","language","start-line"])])])):qe("",!0)]),_:1},8,["display-info","is-expanded","has-details","tool-call"]))}}),[["__scopeId","data-v-efbab191"]]),yx={class:"write-tool-details"},vx={class:"content-preview"},bx=["title"],kx={class:"code-wrapper"},wx=ju(Ze({__name:"WriteToolDisplay",props:{toolCall:{}},setup(e){const{t:t}=cu(),n=e,s=Ge(!1),o=We(()=>rx(n.toolCall,n.toolCall.result)),i=We(()=>({toolType:"Write",input:n.toolCall.input,result:n.toolCall.result})),r=We(()=>n.toolCall.input.content||""),a=We(()=>r.value?r.value.split("\n").length:0),l=We(()=>({...o.value,addedLines:a.value||o.value.addedLines})),c=We(()=>{const e=r.value.split("\n");let t=0;for(const n of e){if(""!==n&&"\r"!==n)break;t++}return t}),u=We(()=>{const e=r.value.replace(/^[\r\n]+/,"");return e.length<=500?e:e.substring(0,500)+"\n\n... ("+t("tools.contentTruncated")+")"}),d=We(()=>c.value+1),p=We(()=>{const e=n.toolCall.input.path||n.toolCall.input.file_path||"";return{js:"javascript",ts:"typescript",kt:"kotlin",java:"java",py:"python",sh:"shell",bash:"shell",md:"markdown",json:"json",css:"css",html:"html",xml:"xml",txt:"plaintext"}[e.split(".").pop()?.toLowerCase()||""]||"plaintext"});async function h(){await navigator.clipboard.writeText(r.value)}return(e,n)=>(st(),Je(tx,{"display-info":l.value,"is-expanded":s.value,"has-details":!0,"tool-call":i.value,onToggle:n[0]||(n[0]=e=>s.value=!s.value)},{details:St(()=>[tt("div",yx,[tt("div",vx,[tt("button",{class:"copy-btn",title:ht(t)("common.copy"),onClick:et(h,["stop"])},[...n[1]||(n[1]=[tt("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[tt("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),tt("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1)])],8,bx),tt("div",kx,[kt(px,{code:u.value,language:p.value,"start-line":d.value},null,8,["code","language","start-line"])])])])]),_:1},8,["display-info","is-expanded","tool-call"]))}}),[["__scopeId","data-v-ec79ab86"]]);class Sx{diff(e,t,n={}){let s;"function"==typeof n?(s=n,n={}):"callback"in n&&(s=n.callback);const o=this.castInput(e,n),i=this.castInput(t,n),r=this.removeEmpty(this.tokenize(o,n)),a=this.removeEmpty(this.tokenize(i,n));return this.diffWithOptionsObj(r,a,n,s)}diffWithOptionsObj(e,t,n,s){var o;const i=e=>(e=this.postProcess(e,n),s?void setTimeout(function(){s(e)},0):e),r=t.length,a=e.length;let l=1,c=r+a;null!=n.maxEditLength&&(c=Math.min(c,n.maxEditLength));const u=null!==(o=n.timeout)&&void 0!==o?o:1/0,d=Date.now()+u,p=[{oldPos:-1,lastComponent:void 0}];let h=this.extractCommon(p[0],t,e,0,n);if(p[0].oldPos+1>=a&&h+1>=r)return i(this.buildValues(p[0].lastComponent,t,e));let f=-1/0,m=1/0;const g=()=>{for(let s=Math.max(f,-l);s<=Math.min(m,l);s+=2){let o;const l=p[s-1],c=p[s+1];l&&(p[s-1]=void 0);let u=!1;if(c){const e=c.oldPos-s;u=c&&0<=e&&e<r}const d=l&&l.oldPos+1<a;if(u||d){if(o=!d||u&&l.oldPos<c.oldPos?this.addToPath(c,!0,!1,0,n):this.addToPath(l,!1,!0,1,n),h=this.extractCommon(o,t,e,s,n),o.oldPos+1>=a&&h+1>=r)return i(this.buildValues(o.lastComponent,t,e))||!0;p[s]=o,o.oldPos+1>=a&&(m=Math.min(m,s-1)),h+1>=r&&(f=Math.max(f,s+1))}else p[s]=void 0}l++};if(s)!function e(){setTimeout(function(){if(l>c||Date.now()>d)return s(void 0);g()||e()},0)}();else for(;l<=c&&Date.now()<=d;){const e=g();if(e)return e}}addToPath(e,t,n,s,o){const i=e.lastComponent;return i&&!o.oneChangePerToken&&i.added===t&&i.removed===n?{oldPos:e.oldPos+s,lastComponent:{count:i.count+1,added:t,removed:n,previousComponent:i.previousComponent}}:{oldPos:e.oldPos+s,lastComponent:{count:1,added:t,removed:n,previousComponent:i}}}extractCommon(e,t,n,s,o){const i=t.length,r=n.length;let a=e.oldPos,l=a-s,c=0;for(;l+1<i&&a+1<r&&this.equals(n[a+1],t[l+1],o);)l++,a++,c++,o.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return c&&!o.oneChangePerToken&&(e.lastComponent={count:c,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=a,l}equals(e,t,n){return n.comparator?n.comparator(e,t):e===t||!!n.ignoreCase&&e.toLowerCase()===t.toLowerCase()}removeEmpty(e){const t=[];for(let n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t}castInput(e,t){return e}tokenize(e,t){return Array.from(e)}join(e){return e.join("")}postProcess(e,t){return e}get useLongestToken(){return!1}buildValues(e,t,n){const s=[];let o;for(;e;)s.push(e),o=e.previousComponent,delete e.previousComponent,e=o;s.reverse();const i=s.length;let r=0,a=0,l=0;for(;r<i;r++){const e=s[r];if(e.removed)e.value=this.join(n.slice(l,l+e.count)),l+=e.count;else{if(!e.added&&this.useLongestToken){let s=t.slice(a,a+e.count);s=s.map(function(e,t){const s=n[l+t];return s.length>e.length?s:e}),e.value=this.join(s)}else e.value=this.join(t.slice(a,a+e.count));a+=e.count,e.added||(l+=e.count)}}return s}}const Cx=new class extends Sx{constructor(){super(...arguments),this.tokenize=Tx}equals(e,t,n){return n.ignoreWhitespace?(n.newlineIsToken&&e.includes("\n")||(e=e.trim()),n.newlineIsToken&&t.includes("\n")||(t=t.trim())):n.ignoreNewlineAtEof&&!n.newlineIsToken&&(e.endsWith("\n")&&(e=e.slice(0,-1)),t.endsWith("\n")&&(t=t.slice(0,-1))),super.equals(e,t,n)}};function Tx(e,t){t.stripTrailingCr&&(e=e.replace(/\r\n/g,"\n"));const n=[],s=e.split(/(\n|\r\n)/);s[s.length-1]||s.pop();for(let o=0;o<s.length;o++){const e=s[o];o%2&&!t.newlineIsToken?n[n.length-1]+=e:n.push(e)}return n}const Ex={class:"diff-viewer"},Ix={class:"diff-code-block"},xx=Ze({__name:"DiffViewer",props:{oldContent:{},newContent:{}},setup(e){const t=e,n=We(()=>{const e=(n=t.oldContent,s=t.newContent,Cx.diff(n,s,o));var n,s,o;const i=[];return e.forEach(e=>{const t=e.added?"diff-added":e.removed?"diff-removed":"diff-unchanged",n=e.value.split("\n");""===n[n.length-1]&&n.pop(),n.forEach(e=>{i.push({content:e,class:t})})}),i});return(e,t)=>(st(),Qe("div",Ex,[tt("pre",Ix,[tt("code",null,[(st(!0),Qe(lt,null,ct(n.value,(e,t)=>(st(),Qe("span",{key:t,class:dt([e.class,"diff-line"])},ut(e.content),3))),128))])])]))}}),Ax=ju(xx,[["__scopeId","data-v-ac23a1a3"]]),Nx={class:"edit-tool-details"},Mx={key:0,class:"replace-mode"},Rx={class:"badge"},_x=Ze({__name:"EditToolDisplay",props:{toolCall:{}},setup(e){const{t:t}=cu(),n=e,s=Ge(!1),o=We(()=>rx(n.toolCall,n.toolCall.result)),i=We(()=>({toolType:"Edit",input:n.toolCall.input,result:n.toolCall.result})),r=We(()=>n.toolCall.input.old_string||""),a=We(()=>n.toolCall.input.new_string||""),l=We(()=>n.toolCall.input.replace_all||!1);return(e,n)=>(st(),Je(tx,{"display-info":o.value,"is-expanded":s.value,"has-details":!0,"tool-call":i.value,onToggle:n[0]||(n[0]=e=>s.value=!s.value)},{details:St(()=>[tt("div",Nx,[kt(Ax,{"old-content":r.value,"new-content":a.value},null,8,["old-content","new-content"]),l.value?(st(),Qe("div",Mx,[tt("span",Rx,ut(ht(t)("tools.replaceAll")),1)])):qe("",!0)])]),_:1},8,["display-info","is-expanded","tool-call"]))}}),Ox=ju(_x,[["__scopeId","data-v-7cf611e3"]]),Dx={class:"multi-edit-details"},Bx={class:"edits-list"},Lx=["onClick"],Fx={class:"edit-number"},Px={key:0,class:"badge replace-all"},$x={class:"expand-icon"},Ux={key:0,class:"edit-content"},Vx={class:"edit-preview"},Wx={class:"diff-section old"},Gx=["title","onClick"],zx={class:"diff-content"},Hx={class:"diff-section new"},Kx=["title","onClick"],jx={class:"diff-content"},Yx=Ze({__name:"MultiEditToolDisplay",props:{toolCall:{}},setup(e){const{t:t}=cu(),n=e,s=Ge(!1),o=Ge(new Set),i=We(()=>n.toolCall.input.edits||[]),r=We(()=>rx(n.toolCall,n.toolCall.result)),a=We(()=>({toolType:"MultiEdit",input:n.toolCall.input,result:n.toolCall.result}));async function l(e){await navigator.clipboard.writeText(e||"")}return(e,n)=>(st(),Je(tx,{"display-info":r.value,"is-expanded":s.value,"has-details":i.value.length>0,"tool-call":a.value,onToggle:n[0]||(n[0]=e=>s.value=!s.value)},{details:St(()=>[tt("div",Dx,[tt("div",Bx,[(st(!0),Qe(lt,null,ct(i.value,(e,s)=>(st(),Qe("div",{key:s,class:"edit-item"},[tt("div",{class:"edit-header",onClick:e=>function(e){const t=new Set(o.value);t.has(e)?t.delete(e):t.add(e),o.value=t}(s)},[tt("span",Fx,ut(ht(t)("tools.changeNumber",{number:s+1})),1),e.replace_all?(st(),Qe("span",Px,ut(ht(t)("tools.replaceAll")),1)):qe("",!0),tt("span",$x,ut(o.value.has(s)?"â–²":"â–¼"),1)],8,Lx),o.value.has(s)?(st(),Qe("div",Ux,[tt("div",Vx,[tt("div",Wx,[tt("button",{class:"copy-btn",title:ht(t)("common.copy"),onClick:t=>l(e.old_string)},[...n[1]||(n[1]=[tt("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[tt("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),tt("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1)])],8,Gx),tt("pre",zx,ut(e.old_string),1)]),n[3]||(n[3]=tt("div",{class:"diff-arrow"}," â†’ ",-1)),tt("div",Hx,[tt("button",{class:"copy-btn",title:ht(t)("common.copy"),onClick:t=>l(e.new_string)},[...n[2]||(n[2]=[tt("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[tt("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),tt("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1)])],8,Kx),tt("pre",jx,ut(e.new_string),1)])])])):qe("",!0)]))),128))])])]),_:1},8,["display-info","is-expanded","has-details","tool-call"]))}}),Zx=ju(Yx,[["__scopeId","data-v-2863d750"]]),Xx={class:"bash-tool-display"},Jx={class:"bash-details"},Qx={class:"command-section"},qx={class:"command-text"},eA={key:0,class:"cwd"},tA={key:1,class:"timeout"},nA={key:0,class:"output-section"},sA={key:0,class:"output stdout"},oA={key:1,class:"output stderr"},iA={key:1,class:"no-output"},rA=Ze({__name:"BashToolDisplay",props:{toolCall:{}},setup(e){const t=e,n=Ge(!1),s=We(()=>!!t.toolCall.parentToolUseId),o=We(()=>rx(t.toolCall,t.toolCall.result)),i=We(()=>t.toolCall.input.command||""),r=We(()=>t.toolCall.input.cwd||""),a=We(()=>t.toolCall.input.timeout),l=We(()=>{if(!a.value)return"";return`${a.value/1e3}s`}),c=We(()=>{const e=t.toolCall.result;return e?e.is_error?"":"string"==typeof e.content?e.content:JSON.stringify(e.content):""}),u=We(()=>{const e=t.toolCall.result;return e&&e.is_error?"string"==typeof e.content?e.content:JSON.stringify(e.content):""});return(e,t)=>(st(),Qe("div",Xx,[kt(tx,{"display-info":o.value,"is-expanded":n.value,"has-details":!0,"supports-background":!s.value,onClick:t[0]||(t[0]=e=>n.value=!n.value)},{details:St(()=>[tt("div",Jx,[tt("div",Qx,[tt("pre",qx,ut(i.value),1),r.value?(st(),Qe("div",eA,"cwd: "+ut(r.value),1)):qe("",!0),l.value?(st(),Qe("div",tA,"timeout: "+ut(l.value),1)):qe("",!0)]),c.value||u.value?(st(),Qe("div",nA,[c.value?(st(),Qe("pre",sA,ut(c.value),1)):qe("",!0),u.value?(st(),Qe("pre",oA,ut(u.value),1)):qe("",!0)])):(st(),Qe("div",iA,"No output"))])]),_:1},8,["display-info","is-expanded","supports-background"])]))}}),aA=ju(rA,[["__scopeId","data-v-10896439"]]),lA={class:"bashoutput-details"},cA={class:"params-section"},uA={class:"info-row"},dA={class:"value"},pA={key:0,class:"info-row"},hA={class:"value"},fA={key:0,class:"result-section"},mA={class:"result-content"},gA=Ze({__name:"BashOutputToolDisplay",props:{toolCall:{}},setup(e){const t=e,n=Ge(!1),s=We(()=>rx(t.toolCall,t.toolCall.result)),o=We(()=>t.toolCall.input?.bash_id||t.toolCall.input?.shell_id||""),i=We(()=>t.toolCall.input?.filter||""),r=We(()=>{const e=t.toolCall.result;return!e||e.is_error?"":"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n"):JSON.stringify(e.content,null,2)}),a=We(()=>{const e=t.toolCall.result;return e&&!e.is_error&&r.value}),l=We(()=>!!o.value);return(e,t)=>(st(),Je(tx,{"display-info":s.value,"is-expanded":n.value,"has-details":l.value,onClick:t[0]||(t[0]=e=>n.value=!n.value)},{details:St(()=>[tt("div",lA,[tt("div",cA,[tt("div",uA,[t[1]||(t[1]=tt("span",{class:"label"},"Shell ID:",-1)),tt("code",dA,ut(o.value),1)]),i.value?(st(),Qe("div",pA,[t[2]||(t[2]=tt("span",{class:"label"},"Filter:",-1)),tt("code",hA,ut(i.value),1)])):qe("",!0)]),a.value?(st(),Qe("div",fA,[t[3]||(t[3]=tt("div",{class:"section-title"},"Output",-1)),tt("pre",mA,ut(r.value),1)])):qe("",!0)])]),_:1},8,["display-info","is-expanded","has-details"]))}}),yA=ju(gA,[["__scopeId","data-v-ce84aa18"]]),vA={class:"killshell-details"},bA={class:"params-section"},kA={class:"info-row"},wA={class:"value"},SA={key:0,class:"result-section"},CA={class:"result-content"},TA=Ze({__name:"KillShellToolDisplay",props:{toolCall:{}},setup(e){const t=e,n=Ge(!1),s=We(()=>rx(t.toolCall,t.toolCall.result)),o=We(()=>t.toolCall.input?.shell_id||""),i=We(()=>{const e=t.toolCall.result;return!e||e.is_error?"":"string"==typeof e.content?e.content:JSON.stringify(e.content,null,2)}),r=We(()=>{const e=t.toolCall.result;return e&&!e.is_error&&i.value}),a=We(()=>!!o.value);return(e,t)=>(st(),Je(tx,{"display-info":s.value,"is-expanded":n.value,"has-details":a.value,onClick:t[0]||(t[0]=e=>n.value=!n.value)},{details:St(()=>[tt("div",vA,[tt("div",bA,[tt("div",kA,[t[1]||(t[1]=tt("span",{class:"label"},"Shell ID:",-1)),tt("code",wA,ut(o.value),1)])]),r.value?(st(),Qe("div",SA,[t[2]||(t[2]=tt("div",{class:"section-title"},"Result",-1)),tt("pre",CA,ut(i.value),1)])):qe("",!0)])]),_:1},8,["display-info","is-expanded","has-details"]))}}),EA=ju(TA,[["__scopeId","data-v-7ff8a759"]]),IA={class:"grep-details"},xA={class:"params-section"},AA={class:"info-row"},NA={class:"value"},MA={key:0,class:"info-row"},RA={class:"value path"},_A={key:1,class:"info-row"},OA={class:"value"},DA={key:2,class:"info-row"},BA={class:"value"},LA={key:3,class:"info-row"},FA={class:"value"},PA={key:4,class:"options-row"},$A={key:0,class:"result-section"},UA={class:"result-content"},VA=Ze({__name:"GrepToolDisplay",props:{toolCall:{}},setup(e){const t=e,n=Ge(!1),s=We(()=>rx(t.toolCall,t.toolCall.result)),o=We(()=>t.toolCall.input?.pattern||""),i=We(()=>t.toolCall.input?.path||""),r=We(()=>t.toolCall.input?.glob||""),a=We(()=>t.toolCall.input?.type||""),l=We(()=>t.toolCall.input?.output_mode||""),c=We(()=>({content:"content",files_with_matches:"files only",count:"count"}[l.value]||l.value)),u=We(()=>{const e=[],n=t.toolCall.input;return n?.["-i"]&&e.push("case insensitive"),n?.["-n"]&&e.push("line numbers"),n?.multiline&&e.push("multiline"),e}),d=We(()=>{const e=t.toolCall.result;return!e||e.is_error?"":"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n"):JSON.stringify(e.content,null,2)}),p=We(()=>{const e=t.toolCall.result;return e&&!e.is_error&&d.value}),h=We(()=>!!o.value);return(e,t)=>(st(),Je(tx,{"display-info":s.value,"is-expanded":n.value,"has-details":h.value,onClick:t[0]||(t[0]=e=>n.value=!n.value)},{details:St(()=>[tt("div",IA,[tt("div",xA,[tt("div",AA,[t[1]||(t[1]=tt("span",{class:"label"},"Pattern:",-1)),tt("code",NA,ut(o.value),1)]),i.value?(st(),Qe("div",MA,[t[2]||(t[2]=tt("span",{class:"label"},"Path:",-1)),tt("span",RA,ut(i.value),1)])):qe("",!0),r.value?(st(),Qe("div",_A,[t[3]||(t[3]=tt("span",{class:"label"},"Glob:",-1)),tt("code",OA,ut(r.value),1)])):qe("",!0),a.value?(st(),Qe("div",DA,[t[4]||(t[4]=tt("span",{class:"label"},"Type:",-1)),tt("span",BA,ut(a.value),1)])):qe("",!0),l.value?(st(),Qe("div",LA,[t[5]||(t[5]=tt("span",{class:"label"},"Mode:",-1)),tt("span",FA,ut(c.value),1)])):qe("",!0),u.value.length>0?(st(),Qe("div",PA,[(st(!0),Qe(lt,null,ct(u.value,e=>(st(),Qe("span",{key:e,class:"option-badge"},ut(e),1))),128))])):qe("",!0)]),p.value?(st(),Qe("div",$A,[t[6]||(t[6]=tt("div",{class:"section-title"},"Results",-1)),tt("pre",UA,ut(d.value),1)])):qe("",!0)])]),_:1},8,["display-info","is-expanded","has-details"]))}}),WA=ju(VA,[["__scopeId","data-v-661e6979"]]),GA={class:"glob-details"},zA={class:"params-section"},HA={class:"info-row"},KA={class:"value"},jA={key:0,class:"info-row"},YA={class:"value path"},ZA={key:0,class:"result-section"},XA={class:"result-content"},JA=Ze({__name:"GlobToolDisplay",props:{toolCall:{}},setup(e){const t=e,n=Ge(!1),s=We(()=>rx(t.toolCall,t.toolCall.result)),o=We(()=>t.toolCall.input?.pattern||""),i=We(()=>t.toolCall.input?.path||""),r=We(()=>{const e=t.toolCall.result;return!e||e.is_error?"":"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n"):JSON.stringify(e.content,null,2)}),a=We(()=>{const e=t.toolCall.result;return e&&!e.is_error&&r.value}),l=We(()=>!!o.value);return(e,t)=>(st(),Je(tx,{"display-info":s.value,"is-expanded":n.value,"has-details":l.value,onClick:t[0]||(t[0]=e=>n.value=!n.value)},{details:St(()=>[tt("div",GA,[tt("div",zA,[tt("div",HA,[t[1]||(t[1]=tt("span",{class:"label"},"Pattern:",-1)),tt("code",KA,ut(o.value),1)]),i.value?(st(),Qe("div",jA,[t[2]||(t[2]=tt("span",{class:"label"},"Path:",-1)),tt("span",YA,ut(i.value),1)])):qe("",!0)]),a.value?(st(),Qe("div",ZA,[t[3]||(t[3]=tt("div",{class:"section-title"},"Matched Files",-1)),tt("pre",XA,ut(r.value),1)])):qe("",!0)])]),_:1},8,["display-info","is-expanded","has-details"]))}}),QA=ju(JA,[["__scopeId","data-v-83c15d0b"]]),qA={class:"websearch-details"},eN={class:"params-section"},tN={class:"info-row"},nN={class:"value query"},sN={key:0,class:"info-row"},oN={class:"domain-list"},iN={key:1,class:"info-row"},rN={class:"domain-list"},aN={key:0,class:"result-section"},lN={class:"result-content"},cN=Ze({__name:"WebSearchToolDisplay",props:{toolCall:{}},setup(e){const t=e,n=Ge(!1),s=We(()=>rx(t.toolCall,t.toolCall.result)),o=We(()=>t.toolCall.input?.query||""),i=We(()=>t.toolCall.input?.allowed_domains||[]),r=We(()=>t.toolCall.input?.blocked_domains||[]),a=We(()=>{const e=t.toolCall.result;return!e||e.is_error?"":"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n"):JSON.stringify(e.content,null,2)}),l=We(()=>{const e=t.toolCall.result;return e&&!e.is_error&&a.value}),c=We(()=>!!o.value);return(e,t)=>(st(),Je(tx,{"display-info":s.value,"is-expanded":n.value,"has-details":c.value,onClick:t[0]||(t[0]=e=>n.value=!n.value)},{details:St(()=>[tt("div",qA,[tt("div",eN,[tt("div",tN,[t[1]||(t[1]=tt("span",{class:"label"},"Query:",-1)),tt("span",nN,'"'+ut(o.value)+'"',1)]),i.value.length>0?(st(),Qe("div",sN,[t[2]||(t[2]=tt("span",{class:"label"},"Allowed:",-1)),tt("div",oN,[(st(!0),Qe(lt,null,ct(i.value,(e,t)=>(st(),Qe("span",{key:t,class:"domain-tag allowed"},ut(e),1))),128))])])):qe("",!0),r.value.length>0?(st(),Qe("div",iN,[t[3]||(t[3]=tt("span",{class:"label"},"Blocked:",-1)),tt("div",rN,[(st(!0),Qe(lt,null,ct(r.value,(e,t)=>(st(),Qe("span",{key:t,class:"domain-tag blocked"},ut(e),1))),128))])])):qe("",!0)]),l.value?(st(),Qe("div",aN,[t[4]||(t[4]=tt("div",{class:"section-title"},"Results",-1)),tt("pre",lN,ut(a.value),1)])):qe("",!0)])]),_:1},8,["display-info","is-expanded","has-details"]))}}),uN=ju(cN,[["__scopeId","data-v-a9652623"]]),dN={class:"webfetch-details"},pN={class:"params-section"},hN={class:"info-row"},fN=["href"],mN={key:0,class:"info-row"},gN={class:"value"},yN={key:0,class:"result-section"},vN={class:"result-content"},bN=ju(Ze({__name:"WebFetchToolDisplay",props:{toolCall:{}},setup(e){const t=e,n=Ge(!1),s=We(()=>rx(t.toolCall,t.toolCall.result)),o=We(()=>t.toolCall.input?.url||""),i=We(()=>t.toolCall.input?.prompt||""),r=We(()=>{const e=t.toolCall.result;return!e||e.is_error?"":"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n"):JSON.stringify(e.content,null,2)}),a=We(()=>{const e=t.toolCall.result;return e&&!e.is_error&&r.value}),l=We(()=>!!o.value);return(e,t)=>(st(),Je(tx,{"display-info":s.value,"is-expanded":n.value,"has-details":l.value,onClick:t[0]||(t[0]=e=>n.value=!n.value)},{details:St(()=>[tt("div",dN,[tt("div",pN,[tt("div",hN,[t[1]||(t[1]=tt("span",{class:"label"},"URL:",-1)),tt("a",{href:o.value,target:"_blank",class:"value link"},ut(o.value),9,fN)]),i.value?(st(),Qe("div",mN,[t[2]||(t[2]=tt("span",{class:"label"},"Prompt:",-1)),tt("span",gN,ut(i.value),1)])):qe("",!0)]),a.value?(st(),Qe("div",yN,[t[3]||(t[3]=tt("div",{class:"section-title"},"Content",-1)),tt("pre",vN,ut(r.value),1)])):qe("",!0)])]),_:1},8,["display-info","is-expanded","has-details"]))}}),[["__scopeId","data-v-860935f7"]]),kN={class:"todo-list"},wN={class:"todo-text"},SN={class:"todo-status"},CN=ju(Ze({__name:"TodoWriteDisplay",props:{toolCall:{}},setup(e){const{t:t}=cu(),n=e,s=Ge(!0),o=We(()=>rx(n.toolCall,n.toolCall.result)),i=We(()=>n.toolCall.input?.todos||[]);function r(){s.value=!s.value}return(e,n)=>(st(),Je(tx,{"display-info":o.value,"is-expanded":s.value,"has-details":i.value.length>0,onClick:r},{details:St(()=>[tt("div",kN,[(st(!0),Qe(lt,null,ct(i.value,(e,s)=>{return st(),Qe("div",{key:s,class:dt(["todo-item",e.status])},[n[0]||(n[0]=tt("span",{class:"status-dot"},null,-1)),tt("span",wN,ut(e.content),1),tt("span",SN,ut((o=e.status,{pending:t("tools.todoTool.pending"),in_progress:t("tools.todoTool.inProgress"),completed:t("tools.todoTool.completed")}[o]||o)),1)],2);var o}),128))])]),_:1},8,["display-info","is-expanded","has-details"]))}}),[["__scopeId","data-v-6988fa42"]]),TN={class:"assistant-text"},EN={class:"message-content"},IN=["title"],xN={class:"stat-item duration"},AN={class:"stat-item tokens"},NN={class:"stat-item tokens"},MN=ju(Ze({__name:"AssistantTextDisplay",props:{message:{}},setup(e){const t=e,n=We(()=>t.message.isLastInMessage&&t.message.stats),s=We(()=>t.message.stats||{requestDuration:0,inputTokens:0,outputTokens:0}),o=We(()=>{if(!t.message.stats)return"";const e=t.message.stats;return`è¯·æ±‚è€—æ—¶: ${i(e.requestDuration)}\nä¸Šè¡Œ: ${e.inputTokens.toLocaleString()} tokens\nä¸‹è¡Œ: ${e.outputTokens.toLocaleString()} tokens`});function i(e){if(e<=0)return"0s";if(e<1e3)return`${e}ms`;const t=Math.floor(e/1e3);if(t<60)return`${t}s`;return`${Math.floor(t/60)}m ${t%60}s`}function r(e){return e<1e3?e.toString():e<1e4?(e/1e3).toFixed(1)+"k":Math.round(e/1e3)+"k"}return(t,a)=>(st(),Qe("div",TN,[tt("div",EN,[kt(gI,{content:e.message.content},null,8,["content"])]),n.value?(st(),Qe("div",{key:0,class:"message-stats",title:o.value},[tt("span",xN,ut(i(s.value.requestDuration)),1),a[2]||(a[2]=tt("span",{class:"stat-separator"},"â€¢",-1)),tt("span",AN,[Nt(" â†‘ "+ut(r(s.value.inputTokens))+" ",1),a[0]||(a[0]=tt("span",{class:"stat-label"},"tokens",-1))]),a[3]||(a[3]=tt("span",{class:"stat-separator"},"/",-1)),tt("span",NN,[Nt(" â†“ "+ut(r(s.value.outputTokens))+" ",1),a[1]||(a[1]=tt("span",{class:"stat-label"},"tokens",-1))])],8,IN)):qe("",!0)]))}}),[["__scopeId","data-v-d8b114d8"]]),RN={class:"thinking-header"},_N={class:"thinking-label"},ON={key:0,class:"expand-hint"},DN={key:0,class:"thinking-content"},BN=ju(Ze({__name:"ThinkingDisplay",props:{thinking:{}},setup(e){const t=e,{t:n}=cu(),s=lu(),o=We(()=>!!t.thinking.signature),i=Ge(!1),r=Ge(!1);let a=null;const l=Ge(!1);function c(){a&&clearTimeout(a),a=setTimeout(()=>{r.value=!0},3e3)}function u(){l.value=!0,a&&(clearTimeout(a),a=null)}function d(){l.value=!1,o.value&&!r.value&&c()}Ke(o,e=>{e?l.value||c():(r.value=!1,a&&(clearTimeout(a),a=null))},{immediate:!0}),Xe(()=>{a&&clearTimeout(a)});const p=We(()=>!!o.value&&(!!r.value&&!i.value));function h(){if(o.value){const e=p.value;i.value=!i.value,e&&s.switchToBrowseMode()}}return(t,s)=>(st(),Qe("div",{class:dt(["thinking-display",{collapsed:p.value,expandable:o.value}]),onClick:h,onMouseenter:u,onMouseleave:d},[tt("div",RN,[s[0]||(s[0]=tt("span",{class:"thinking-icon"},"ðŸ§ ",-1)),tt("span",_N,ut(p.value?ht(n)("chat.thinkingCollapsed"):ht(n)("chat.thinkingLabel")),1),o.value?(st(),Qe("span",ON,ut(p.value?"â–¶":"â–¼"),1)):qe("",!0)]),p.value?qe("",!0):(st(),Qe("div",DN,[kt(gI,{content:e.thinking.content,class:"markdown-content"},null,8,["content"])]))],34))}}),[["__scopeId","data-v-390d1288"]]),LN={class:"message-header"},FN={class:"level-icon"},PN={class:"level-name"},$N={class:"message-content"},UN=ju(Ze({__name:"SystemMessageDisplay",props:{message:{}},setup(e){const t=e,n=We(()=>{switch(t.message.level){case"info":default:return"â„¹ï¸";case"warning":return"âš ï¸";case"error":return"âŒ"}}),s=We(()=>{switch(t.message.level){case"info":return"Info";case"warning":return"Warning";case"error":return"Error";default:return"System"}});return(t,o)=>(st(),Qe("div",{class:dt(["system-message",`level-${e.message.level}`])},[tt("div",LN,[tt("span",FN,ut(n.value),1),tt("span",PN,ut(s.value),1)]),tt("div",$N,ut(e.message.content),1)],2))}}),[["__scopeId","data-v-3fc8c59e"]]),VN={class:"error-result"},WN={class:"error-header"},GN={class:"error-title"},zN={class:"error-content"},HN={class:"error-message"},KN=ju(Ze({__name:"ErrorResultDisplay",props:{errorMessage:{}},setup(e){const{t:t}=cu();return(n,s)=>(st(),Qe("div",VN,[tt("div",WN,[s[0]||(s[0]=tt("span",{class:"error-icon"},"âŒ",-1)),tt("span",GN,ut(ht(t)("tools.error")),1)]),tt("div",zN,[tt("pre",HN,ut(e.errorMessage),1)])]))}}),[["__scopeId","data-v-7613f47b"]]),jN={class:"compact-summary-wrapper"},YN={class:"card-header"},ZN={class:"icon"},XN={class:"title"},JN={class:"subtitle"},QN={class:"header-buttons"},qN=["title"],eM={key:0},tM={key:1},nM={key:0,class:"card-content"},sM={key:0,class:"token-stats expanded"},oM={class:"token-label"},iM={class:"token-value"},rM=["innerHTML"],aM={key:1,class:"card-preview"},lM={key:0,class:"token-stats"},cM={class:"token-label"},uM={class:"token-value"},dM={class:"preview-text"},pM=ju(Ze({__name:"CompactSummaryCard",props:{content:{},preTokens:{},trigger:{}},setup(e){cu();const t=e,n=Ge(!1),s=Ge(!1);function o(){n.value=!n.value}async function i(){try{await navigator.clipboard.writeText(r.value),s.value=!0,setTimeout(()=>{s.value=!1},2e3)}catch(e){console.error("Failed to copy:",e)}}const r=We(()=>t.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n")),a=We(()=>{let e=r.value;return e.startsWith("This session is being continued")&&(e=e.replace(/^This session is being continued[^:]*:\s*/i,"")),e.length>100?e.substring(0,100)+"...":e});function l(e){return e>=1e3?(e/1e3).toFixed(1)+"k":e.toString()}const c=We(()=>{let e=r.value;return e=e.replace(/^### (.*?)$/gm,"<h4>$1</h4>"),e=e.replace(/^## (.*?)$/gm,"<h3>$1</h3>"),e=e.replace(/^# (.*?)$/gm,"<h2>$1</h2>"),e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/`([^`]+)`/g,"<code>$1</code>"),e=e.replace(/```(\w*)\n([\s\S]*?)```/g,'<pre><code class="lang-$1">$2</code></pre>'),e=e.replace(/\n/g,"<br>"),e=e.replace(/<br>- (.*?)(?=<br>|$)/g,"<br><li>$1</li>"),e=e.replace(/<br>\d+\. (.*?)(?=<br>|$)/g,"<br><li>$1</li>"),e});return(t,r)=>(st(),Qe("div",jN,[tt("div",{class:dt(["compact-summary-card",{expanded:n.value}])},[tt("div",YN,[tt("div",{class:"header-left",onClick:o},[tt("span",ZN,ut(n.value?"ðŸ“–":"ðŸ“¦"),1),tt("span",XN,ut(t.$t("compact.contextRestored")),1),tt("span",JN,ut(t.$t("compact.sessionSummary")),1)]),tt("div",QN,[tt("button",{class:"action-button",title:t.$t("common.copy"),onClick:et(i,["stop"])},[s.value?(st(),Qe("span",eM,"âœ“")):(st(),Qe("span",tM,"ðŸ“‹"))],8,qN),tt("button",{class:"expand-button",onClick:o},ut(n.value?t.$t("compact.collapse")+" â–´":t.$t("compact.expand")+" â–¾"),1)])]),n.value?(st(),Qe("div",nM,[e.preTokens?(st(),Qe("div",sM,[tt("span",oM,ut(t.$t("compact.originalTokens"))+":",1),tt("span",iM,ut(l(e.preTokens)),1)])):qe("",!0),tt("div",{class:"summary-text",innerHTML:c.value},null,8,rM)])):(st(),Qe("div",aM,[e.preTokens?(st(),Qe("div",lM,[tt("span",cM,ut(t.$t("compact.originalTokens"))+":",1),tt("span",uM,ut(l(e.preTokens)),1)])):qe("",!0),tt("span",dM,ut(a.value),1)]))],2)]))}}),[["__scopeId","data-v-8cc14a51"]]),hM={class:"icon"},fM={class:"command"},mM=ju(Ze({__name:"LocalCommandOutput",props:{command:{},outputType:{}},setup:e=>(t,n)=>(st(),Qe("div",{class:dt(["local-command-output",e.outputType])},[tt("span",hM,ut("stdout"===e.outputType?"âœ“":"âœ—"),1),tt("span",fM,ut(e.command),1)],2))}),[["__scopeId","data-v-4028ae3e"]]),gM={class:"display-item-renderer"},yM={key:8,class:"unknown-item"},vM=ju(Ze({__name:"DisplayItemRenderer",props:{source:{}},setup(e){const t=e,n=We(()=>t.source);return(e,t)=>(st(),Qe("div",gM,["userMessage"===n.value.displayType?(st(),Je(LI,{key:0,message:n.value},null,8,["message"])):"assistantText"===n.value.displayType?(st(),Je(MN,{key:1,message:n.value},null,8,["message"])):"thinking"===n.value.displayType?(st(),Je(BN,{key:2,thinking:n.value},null,8,["thinking"])):"toolCall"===n.value.displayType?(st(),Je(g_,{key:3,"tool-call":n.value},null,8,["tool-call"])):"systemMessage"===n.value.displayType?(st(),Je(UN,{key:4,message:n.value},null,8,["message"])):"errorResult"===n.value.displayType?(st(),Je(KN,{key:5,"error-message":n.value.message},null,8,["error-message"])):"compactSummary"===n.value.displayType?(st(),Je(pM,{key:6,content:n.value.content,"pre-tokens":n.value.preTokens,trigger:n.value.trigger},null,8,["content","pre-tokens","trigger"])):"localCommandOutput"===n.value.displayType?(st(),Je(mM,{key:7,command:n.value.command,"output-type":n.value.outputType},null,8,["command","output-type"])):(st(),Qe("div",yM,[tt("span",null,"Unknown item displayType: "+ut(n.value.displayType??"undefined"),1)]))]))}}),[["__scopeId","data-v-0a5e9382"]]),bM={class:"task-details"},kM={class:"params-section"},wM={key:0,class:"prompt-section"},SM={class:"section-header-row"},CM=["title"],TM={class:"prompt-content"},EM={key:0,class:"subagent-section"},IM={class:"expand-icon"},xM={class:"item-count"},AM={key:0,class:"subagent-container"},NM={key:0,class:"loading-hint"},MM={key:1,class:"subagent-list"},RM={key:1,class:"result-section"},_M={class:"section-header-row"},OM=["title"],DM={class:"result-content"},BM=ju(Ze({__name:"TaskToolDisplay",props:{toolCall:{}},setup(e){const t=e,n=Ge(!1),s=Ge(!0),o=We(()=>!!t.toolCall.parentToolUseId),i=Ge(!1),r=Ge(!1);async function a(){if(k.value)try{await navigator.clipboard.writeText(k.value),i.value=!0,setTimeout(()=>{i.value=!1},2e3)}catch(e){console.error("å¤åˆ¶å¤±è´¥:",e)}}async function l(){if(S.value)try{await navigator.clipboard.writeText(S.value),r.value=!0,setTimeout(()=>{r.value=!1},2e3)}catch(e){console.error("å¤åˆ¶å¤±è´¥:",e)}}const c=Mt("projectPath"),u=Mt("aiAgentService"),d=Ge(!1),p=Ge(!1),h=We(()=>t.toolCall.agentId),f=We(()=>t.toolCall.id);Ke([n,()=>c?.value],([e,n])=>{console.log("[TaskToolDisplay] watch è§¦å‘:",{isExpanded:e,agentId:h.value,path:n,subagentHistoryLoaded:d.value,toolCallId:t.toolCall.id,hasResult:!!t.toolCall.result}),e&&h.value&&n&&!d.value&&async function(){if(!h.value||!f.value)return void console.log("[TaskToolDisplay] ç¼ºå°‘ agentId æˆ– toolUseIdï¼Œè·³è¿‡åŠ è½½");if(d.value||p.value)return;if(!c?.value||!u)return void console.warn("[TaskToolDisplay] ç¼ºå°‘ projectPath æˆ– aiAgentService",{projectPath:c?.value,hasAiAgentService:!!u});if((t.toolCall.subagentMessages||[]).length>0)d.value=!0;else{console.log("[TaskToolDisplay] å¼€å§‹åŠ è½½å­ä»£ç†åŽ†å²:",{agentId:h.value,projectPath:c.value}),p.value=!0;try{const e=await u.loadSubagentHistory(h.value,c.value);console.log("[TaskToolDisplay] åŠ è½½åˆ°å­ä»£ç†æ¶ˆæ¯:",e.length);const n=new Map;for(const s of e){s.parentToolUseId=f.value;const e=Hl(s);if(!e)continue;const o=pc(e,n).filter(e=>"userMessage"!==e.displayType);o.length>0&&(t.toolCall.subagentMessages||(t.toolCall.subagentMessages=[]),t.toolCall.subagentMessages.push(...o))}d.value=!0,console.log("[TaskToolDisplay] å­ä»£ç†åŽ†å²åŠ è½½å®Œæˆï¼Œå…±:",t.toolCall.subagentMessages?.length||0,"é¡¹")}catch(e){console.error("[TaskToolDisplay] åŠ è½½å­ä»£ç†åŽ†å²å¤±è´¥:",e)}finally{p.value=!1}}}()},{immediate:!0});const m=We(()=>rx(t.toolCall,t.toolCall.result)),g=We(()=>t.toolCall.agentName||t.toolCall.input?.subagent_type||""),y=We(()=>{const e=m.value;if(!n.value){const t=[];return v.value&&t.push(v.value),b.value&&t.push(`[${b.value}]`),g.value&&t.push(`Agent: ${g.value}`),{...e,secondaryInfo:t.join(" Â· ")}}return g.value?{...e,secondaryInfo:`Agent: ${g.value}`}:e}),v=We(()=>t.toolCall.input?.description||""),b=We(()=>t.toolCall.input?.model||""),k=We(()=>t.toolCall.input?.prompt||""),w=We(()=>t.toolCall.subagentMessages||[]),S=We(()=>{const e=t.toolCall.result;return!e||e.is_error?"":"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n"):JSON.stringify(e.content,null,2)}),C=We(()=>{const e=t.toolCall.result;return e&&!e.is_error&&S.value}),T=We(()=>!!v.value||!!k.value);return(e,t)=>(st(),Je(tx,{"display-info":y.value,"is-expanded":n.value,"has-details":T.value,"supports-background":!o.value,onClick:t[1]||(t[1]=e=>n.value=!n.value)},{details:St(()=>[tt("div",bM,[tt("div",kM,[k.value?(st(),Qe("div",wM,[tt("div",SM,[t[2]||(t[2]=tt("div",{class:"section-title"},"Prompt",-1)),tt("button",{class:"copy-btn",onClick:et(a,["stop"]),title:i.value?"å·²å¤åˆ¶":"å¤åˆ¶æç¤ºè¯"},ut(i.value?"âœ“":"ðŸ“‹"),9,CM)]),tt("div",TM,[kt(gI,{content:k.value},null,8,["content"])])])):qe("",!0)]),w.value.length>0||p.value?(st(),Qe("div",EM,[tt("div",{class:"section-header",onClick:t[0]||(t[0]=et(e=>s.value=!s.value,["stop"]))},[tt("span",IM,ut(s.value?"â–¼":"â–¶"),1),t[3]||(t[3]=tt("span",{class:"section-title"},"Process",-1)),tt("span",xM,"("+ut(w.value.length)+")",1)]),s.value?(st(),Qe("div",AM,[p.value?(st(),Qe("div",NM,"Loading...")):(st(),Qe("div",MM,[(st(!0),Qe(lt,null,ct(w.value,e=>(st(),Je(vM,{key:e.id,source:e},null,8,["source"]))),128))]))])):qe("",!0)])):qe("",!0),C.value?(st(),Qe("div",RM,[tt("div",_M,[t[4]||(t[4]=tt("div",{class:"section-title"},"Result",-1)),tt("button",{class:"copy-btn",onClick:et(l,["stop"]),title:r.value?"å·²å¤åˆ¶":"å¤åˆ¶ç»“æžœ"},ut(r.value?"âœ“":"ðŸ“‹"),9,OM)]),tt("div",DM,[kt(gI,{content:S.value},null,8,["content"])])])):qe("",!0)])]),_:1},8,["display-info","is-expanded","has-details","supports-background"]))}}),[["__scopeId","data-v-f0803e66"]]),LM={class:"askuser-details"},FM={class:"question-header"},PM={class:"question-badge"},$M={class:"question-text"},UM={key:0,class:"options-list"},VM={class:"option-label"},WM={key:0,class:"option-desc"},GM={key:0,class:"result-section"},zM={class:"result-content"},HM=ju(Ze({__name:"AskUserQuestionDisplay",props:{toolCall:{}},setup(e){const t=e,n=Ge(!0),s=We(()=>rx(t.toolCall,t.toolCall.result)),o=We(()=>t.toolCall.input?.questions||[]),i=We(()=>{const e=t.toolCall.result;return!e||e.is_error?"":"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n"):JSON.stringify(e.content,null,2)}),r=We(()=>{const e=t.toolCall.result;return e&&!e.is_error&&i.value}),a=We(()=>o.value.length>0);return(e,t)=>(st(),Je(tx,{"display-info":s.value,"is-expanded":n.value,"has-details":a.value,onClick:t[0]||(t[0]=e=>n.value=!n.value)},{details:St(()=>[tt("div",LM,[(st(!0),Qe(lt,null,ct(o.value,(e,t)=>(st(),Qe("div",{key:t,class:"question-item"},[tt("div",FM,[tt("span",PM,"Q"+ut(t+1),1),tt("span",$M,ut(e.question),1)]),e.options&&e.options.length>0?(st(),Qe("div",UM,[(st(!0),Qe(lt,null,ct(e.options,(e,t)=>(st(),Qe("div",{key:t,class:"option-item"},[tt("span",VM,ut(e.label||e),1),e.description?(st(),Qe("span",WM,ut(e.description),1)):qe("",!0)]))),128))])):qe("",!0)]))),128)),r.value?(st(),Qe("div",GM,[t[1]||(t[1]=tt("div",{class:"section-title"},"Answer",-1)),tt("pre",zM,ut(i.value),1)])):qe("",!0)])]),_:1},8,["display-info","is-expanded","has-details"]))}}),[["__scopeId","data-v-882df7b6"]]),KM={class:"notebook-details"},jM={class:"params-section"},YM={class:"info-row"},ZM={class:"value path"},XM={class:"info-row"},JM={class:"value"},QM={class:"info-row"},qM={class:"value badge"},eR={key:0,class:"source-section"},tR={class:"source-content"},nR={key:0,class:"result-section"},sR={class:"result-content"},oR=ju(Ze({__name:"NotebookEditToolDisplay",props:{toolCall:{}},setup(e){const t=e,n=Ge(!1),s=We(()=>rx(t.toolCall,t.toolCall.result)),o=We(()=>t.toolCall.input?.notebook_path||""),i=We(()=>t.toolCall.input?.cell_id||t.toolCall.input?.cell_number||0),r=We(()=>t.toolCall.input?.new_source||""),a=We(()=>t.toolCall.input?.cell_type||"code"),l=We(()=>t.toolCall.input?.edit_mode||"replace"),c=We(()=>{const e=t.toolCall.result;return!e||e.is_error?"":"string"==typeof e.content?e.content:JSON.stringify(e.content,null,2)}),u=We(()=>{const e=t.toolCall.result;return e&&!e.is_error&&c.value}),d=We(()=>!!o.value);return(e,t)=>(st(),Je(tx,{"display-info":s.value,"is-expanded":n.value,"has-details":d.value,onClick:t[0]||(t[0]=e=>n.value=!n.value)},{details:St(()=>[tt("div",KM,[tt("div",jM,[tt("div",YM,[t[1]||(t[1]=tt("span",{class:"label"},"Path:",-1)),tt("span",ZM,ut(o.value),1)]),tt("div",XM,[t[2]||(t[2]=tt("span",{class:"label"},"Cell:",-1)),tt("span",JM,"#"+ut(i.value)+" ("+ut(a.value)+")",1)]),tt("div",QM,[t[3]||(t[3]=tt("span",{class:"label"},"Mode:",-1)),tt("span",qM,ut(l.value),1)]),r.value?(st(),Qe("div",eR,[t[4]||(t[4]=tt("div",{class:"section-title"},"New Content",-1)),tt("pre",tR,ut(r.value),1)])):qe("",!0)]),u.value?(st(),Qe("div",nR,[t[5]||(t[5]=tt("div",{class:"section-title"},"Result",-1)),tt("pre",sR,ut(c.value),1)])):qe("",!0)])]),_:1},8,["display-info","is-expanded","has-details"]))}}),[["__scopeId","data-v-04cc687c"]]),iR={class:"exitplan-details"},rR={key:0,class:"params-section"},aR={class:"plan-content"},lR={key:1,class:"error-section"},cR={class:"error-content"},uR={key:2,class:"result-section"},dR={class:"result-content"},pR=ju(Ze({__name:"ExitPlanModeToolDisplay",props:{toolCall:{}},setup(e){const t=e,{t:n}=cu(),s=Ge(!1),o=We(()=>rx(t.toolCall,t.toolCall.result)),i=We(()=>t.toolCall.input?.plan||""),r=We(()=>{const e=t.toolCall.result;return!e||e.is_error?"":"string"==typeof e.content?e.content:JSON.stringify(e.content,null,2)}),a=We(()=>{const e=t.toolCall.result;return e&&e.is_error?"string"==typeof e.content?e.content:JSON.stringify(e.content,null,2):""}),l=We(()=>{const e=t.toolCall.result;return e&&!e.is_error&&r.value}),c=We(()=>{const e=t.toolCall.result;return e&&e.is_error}),u=We(()=>!!i.value||!!l.value||!!c.value);async function d(){if(!i.value)return;await uI.showMarkdown({content:i.value,title:n("permission.planPreviewTitle")})||console.warn("[ExitPlanModeToolDisplay] Failed to open plan in IDEA")}return(e,t)=>(st(),Je(tx,{"display-info":o.value,"is-expanded":s.value,"has-details":u.value,onClick:t[0]||(t[0]=e=>s.value=!s.value)},{"header-actions":St(()=>[ht(lI)()&&i.value?(st(),Qe("button",{key:0,class:"btn-view-idea",onClick:et(d,["stop"])},ut(ht(n)("permission.viewInIdea")),1)):qe("",!0)]),details:St(()=>[tt("div",iR,[i.value?(st(),Qe("div",rR,[t[1]||(t[1]=tt("div",{class:"section-title"},"Plan",-1)),tt("div",aR,[kt(gI,{content:i.value},null,8,["content"])])])):qe("",!0),c.value?(st(),Qe("div",lR,[t[2]||(t[2]=tt("div",{class:"section-title"},"Error",-1)),tt("pre",cR,ut(a.value),1)])):l.value?(st(),Qe("div",uR,[t[3]||(t[3]=tt("div",{class:"section-title"},"Result",-1)),tt("pre",dR,ut(r.value),1)])):qe("",!0)])]),_:1},8,["display-info","is-expanded","has-details"]))}}),[["__scopeId","data-v-3fbabea4"]]),hR={class:"enterplan-details"},fR={key:0,class:"result-section"},mR={class:"result-content"},gR=ju(Ze({__name:"EnterPlanModeToolDisplay",props:{toolCall:{}},setup(e){const t=e,n=Ge(!1),s=We(()=>rx(t.toolCall,t.toolCall.result)),o=We(()=>{const e=t.toolCall.result;return!e||e.is_error?"":"string"==typeof e.content?e.content:JSON.stringify(e.content,null,2)}),i=We(()=>{const e=t.toolCall.result;return e&&!e.is_error&&o.value}),r=We(()=>!!i.value);return(e,t)=>(st(),Je(tx,{"display-info":s.value,"is-expanded":n.value,"has-details":r.value,onClick:t[0]||(t[0]=e=>n.value=!n.value)},{details:St(()=>[tt("div",hR,[i.value?(st(),Qe("div",fR,[t[1]||(t[1]=tt("div",{class:"section-title"},"Result",-1)),tt("pre",mR,ut(o.value),1)])):qe("",!0)])]),_:1},8,["display-info","is-expanded","has-details"]))}}),[["__scopeId","data-v-62a4dcb1"]]),yR={class:"skill-details"},vR={class:"params-section"},bR={class:"info-row"},kR={class:"value"},wR={key:0,class:"result-section"},SR={class:"result-content"},CR=ju(Ze({__name:"SkillToolDisplay",props:{toolCall:{}},setup(e){const t=e,n=Ge(!1),s=We(()=>rx(t.toolCall,t.toolCall.result)),o=We(()=>t.toolCall.input?.skill||""),i=We(()=>{const e=t.toolCall.result;return!e||e.is_error?"":"string"==typeof e.content?e.content:JSON.stringify(e.content,null,2)}),r=We(()=>{const e=t.toolCall.result;return e&&!e.is_error&&i.value}),a=We(()=>!!o.value);return(e,t)=>(st(),Je(tx,{"display-info":s.value,"is-expanded":n.value,"has-details":a.value,onClick:t[0]||(t[0]=e=>n.value=!n.value)},{details:St(()=>[tt("div",yR,[tt("div",vR,[tt("div",bR,[t[1]||(t[1]=tt("span",{class:"label"},"Skill:",-1)),tt("code",kR,ut(o.value),1)])]),r.value?(st(),Qe("div",wR,[t[2]||(t[2]=tt("div",{class:"section-title"},"Result",-1)),tt("pre",SR,ut(i.value),1)])):qe("",!0)])]),_:1},8,["display-info","is-expanded","has-details"]))}}),[["__scopeId","data-v-debd079b"]]),TR={class:"slashcmd-details"},ER={class:"params-section"},IR={class:"info-row"},xR={class:"value"},AR={key:0,class:"result-section"},NR={class:"result-content"},MR=ju(Ze({__name:"SlashCommandToolDisplay",props:{toolCall:{}},setup(e){const t=e,n=Ge(!1),s=We(()=>rx(t.toolCall,t.toolCall.result)),o=We(()=>t.toolCall.input?.command||""),i=We(()=>{const e=t.toolCall.result;return!e||e.is_error?"":"string"==typeof e.content?e.content:JSON.stringify(e.content,null,2)}),r=We(()=>{const e=t.toolCall.result;return e&&!e.is_error&&i.value}),a=We(()=>!!o.value);return(e,t)=>(st(),Je(tx,{"display-info":s.value,"is-expanded":n.value,"has-details":a.value,onClick:t[0]||(t[0]=e=>n.value=!n.value)},{details:St(()=>[tt("div",TR,[tt("div",ER,[tt("div",IR,[t[1]||(t[1]=tt("span",{class:"label"},"Command:",-1)),tt("code",xR,ut(o.value),1)])]),r.value?(st(),Qe("div",AR,[t[2]||(t[2]=tt("div",{class:"section-title"},"Result",-1)),tt("pre",NR,ut(i.value),1)])):qe("",!0)])]),_:1},8,["display-info","is-expanded","has-details"]))}}),[["__scopeId","data-v-0e13ea04"]]),RR={class:"mcp-details"},_R={class:"params-section"},OR={class:"info-row"},DR={class:"value"},BR={key:0,class:"result-section"},LR={class:"result-content"},FR=ju(Ze({__name:"ListMcpResourcesToolDisplay",props:{toolCall:{}},setup(e){const t=e,n=Ge(!1),s=We(()=>rx(t.toolCall,t.toolCall.result)),o=We(()=>t.toolCall.input?.server||""),i=We(()=>{const e=t.toolCall.result;return!e||e.is_error?"":"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n"):JSON.stringify(e.content,null,2)}),r=We(()=>{const e=t.toolCall.result;return e&&!e.is_error&&i.value}),a=We(()=>!!o.value);return(e,t)=>(st(),Je(tx,{"display-info":s.value,"is-expanded":n.value,"has-details":a.value,onClick:t[0]||(t[0]=e=>n.value=!n.value)},{details:St(()=>[tt("div",RR,[tt("div",_R,[tt("div",OR,[t[1]||(t[1]=tt("span",{class:"label"},"Server:",-1)),tt("code",DR,ut(o.value),1)])]),r.value?(st(),Qe("div",BR,[t[2]||(t[2]=tt("div",{class:"section-title"},"Resources",-1)),tt("pre",LR,ut(i.value),1)])):qe("",!0)])]),_:1},8,["display-info","is-expanded","has-details"]))}}),[["__scopeId","data-v-98662776"]]),PR={class:"mcp-details"},$R={class:"params-section"},UR={class:"info-row"},VR={class:"value"},WR={class:"info-row"},GR={class:"value uri"},zR={key:0,class:"result-section"},HR={class:"result-content"},KR=ju(Ze({__name:"ReadMcpResourceToolDisplay",props:{toolCall:{}},setup(e){const t=e,n=Ge(!1),s=We(()=>rx(t.toolCall,t.toolCall.result)),o=We(()=>t.toolCall.input?.server||""),i=We(()=>t.toolCall.input?.uri||""),r=We(()=>{const e=t.toolCall.result;return!e||e.is_error?"":"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n"):JSON.stringify(e.content,null,2)}),a=We(()=>{const e=t.toolCall.result;return e&&!e.is_error&&r.value}),l=We(()=>!!o.value||!!i.value);return(e,t)=>(st(),Je(tx,{"display-info":s.value,"is-expanded":n.value,"has-details":l.value,onClick:t[0]||(t[0]=e=>n.value=!n.value)},{details:St(()=>[tt("div",PR,[tt("div",$R,[tt("div",UR,[t[1]||(t[1]=tt("span",{class:"label"},"Server:",-1)),tt("code",VR,ut(o.value),1)]),tt("div",WR,[t[2]||(t[2]=tt("span",{class:"label"},"URI:",-1)),tt("span",GR,ut(i.value),1)])]),a.value?(st(),Qe("div",zR,[t[3]||(t[3]=tt("div",{class:"section-title"},"Content",-1)),tt("pre",HR,ut(r.value),1)])):qe("",!0)])]),_:1},8,["display-info","is-expanded","has-details"]))}}),[["__scopeId","data-v-a281130b"]]),jR={class:"generic-details"},YR={class:"params-section"},ZR={class:"params-content"},XR={key:0,class:"result-section"},JR={class:"result-content"},QR=ju(Ze({__name:"GenericMcpToolDisplay",props:{toolCall:{}},setup(e){const t=e,n=Ge(!1),s=We(()=>rx(t.toolCall,t.toolCall.result)),o=We(()=>t.toolCall.input||{}),i=We(()=>{try{return JSON.stringify(o.value,null,2)}catch{return String(o.value)}}),r=We(()=>{const e=t.toolCall.result;return!e||e.is_error?"":"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n"):JSON.stringify(e.content,null,2)}),a=We(()=>{const e=t.toolCall.result;return e&&!e.is_error&&r.value}),l=We(()=>Object.keys(o.value).length>0);return(e,t)=>(st(),Je(tx,{"display-info":s.value,"is-expanded":n.value,"has-details":l.value,onClick:t[0]||(t[0]=e=>n.value=!n.value)},{details:St(()=>[tt("div",jR,[tt("div",YR,[t[1]||(t[1]=tt("div",{class:"section-title"},"Params",-1)),tt("pre",ZR,ut(i.value),1)]),a.value?(st(),Qe("div",XR,[t[2]||(t[2]=tt("div",{class:"section-title"},"Result",-1)),tt("pre",JR,ut(r.value),1)])):qe("",!0)])]),_:1},8,["display-info","is-expanded","has-details"]))}}),[["__scopeId","data-v-47d05305"]]),qR={class:"jetbrains-tool-details"},e_={class:"params-section"},t_={class:"params-list"},n_={class:"param-key"},s_={class:"param-value"},o_={key:0,class:"result-section"},i_={class:"result-content"},r_=ju(Ze({__name:"JetBrainsMcpToolDisplay",props:{toolCall:{}},setup(e){const t=e,n=Ge(!1),s=We(()=>rx(t.toolCall,t.toolCall.result)),o=We(()=>t.toolCall.input||{});function i(e){return null==e?"null":"object"==typeof e?JSON.stringify(e):String(e)}const r=We(()=>{const e=t.toolCall.result;return!e||e.is_error?"":"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n"):JSON.stringify(e.content,null,2)}),a=We(()=>{const e=t.toolCall.result;return e&&!e.is_error&&r.value}),l=We(()=>Object.keys(o.value).length>0||a.value);return(e,t)=>(st(),Je(tx,{"display-info":s.value,"is-expanded":n.value,"has-details":l.value,onClick:t[0]||(t[0]=e=>n.value=!n.value)},{details:St(()=>[tt("div",qR,[tt("div",e_,[t[1]||(t[1]=tt("div",{class:"section-title"},"Params",-1)),tt("div",t_,[(st(!0),Qe(lt,null,ct(o.value,(e,t)=>(st(),Qe("div",{key:t,class:"param-row"},[tt("span",n_,ut(t)+":",1),tt("span",s_,ut(i(e)),1)]))),128))])]),a.value?(st(),Qe("div",o_,[t[2]||(t[2]=tt("div",{class:"section-title"},"Result",-1)),tt("div",i_,[kt(gI,{content:r.value},null,8,["content"])])])):qe("",!0)])]),_:1},8,["display-info","is-expanded","has-details"]))}}),[["__scopeId","data-v-92fcf685"]]),a_={class:"terminal-tool-details"},l_={class:"params-section"},c_={class:"params-list"},u_={class:"param-key"},d_={class:"param-value"},p_={key:0,class:"result-section"},h_={class:"result-content"},f_=ju(Ze({__name:"TerminalMcpToolDisplay",props:{toolCall:{}},setup(e){const t=e,n=Ge(!1),s=We(()=>rx(t.toolCall,t.toolCall.result)),o=We(()=>t.toolCall.input||{});function i(e){return null==e?"null":"object"==typeof e?JSON.stringify(e):String(e)}const r=We(()=>{const e=t.toolCall.result;return!e||e.is_error?"":"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.filter(e=>"text"===e.type).map(e=>e.text).join("\n"):JSON.stringify(e.content,null,2)}),a=We(()=>{const e=r.value;if(!e)return"";const n=function(e){try{return JSON.parse(e)}catch{const t=e.match(/^\{(.+)\}$/);if(t){const e={},n=t[1].split(/, (?=[a-z_]+=)/);for(const t of n){const n=t.indexOf("=");if(n>0){const s=t.substring(0,n);let o=t.substring(n+1);"true"===o?o=!0:"false"===o?o=!1:/^\d+$/.test(o)&&(o=parseInt(o)),e[s]=o}}return e}return null}}(e);if(!n)return"```\n"+e+"\n```";return function(e,t){const n=[];if(!0===t.success)n.push("**Status:** âœ… Success");else if(!1===t.success)return n.push("**Status:** âŒ Failed"),t.error&&n.push(`**Error:** ${t.error}`),n.join("\n\n");if(!e.includes("Terminal")||e.includes("Read")||e.includes("List")||e.includes("Kill")||e.includes("Types")||e.includes("Rename")||e.includes("Interrupt"))if(e.includes("TerminalRead"))if(t.session_id&&n.push(`**Session:** \`${t.session_id}\``),t.status&&n.push("**Status:** "+("running"===t.status?"ðŸ”„ Running":"â¸ï¸ Idle")),t.matches&&Array.isArray(t.matches)){n.push(`**Matches:** ${t.match_count||t.matches.length}`),n.push("");for(const e of t.matches)n.push(`- Line ${e.line_number}: \`${e.line}\``)}else t.output&&(t.line_count&&n.push(`**Lines:** ${t.line_count}`),n.push(""),n.push("**Output:**"),n.push("```"),n.push(t.output),n.push("```"));else if(e.includes("TerminalList")){if(n.push(`**Sessions:** ${t.count||0}`),t.sessions&&Array.isArray(t.sessions)){n.push("");for(const e of t.sessions){const t=e.is_running?"ðŸ”„":"â¸ï¸";n.push(`- ${t} \`${e.id}\` (${e.name||"unnamed"}) - ${e.shell_type||"unknown"}`)}}}else if(e.includes("TerminalKill"))t.killed&&Array.isArray(t.killed)&&n.push(`**Killed:** ${t.killed.join(", ")||"none"}`),t.failed&&Array.isArray(t.failed)&&t.failed.length>0&&n.push(`**Failed:** ${t.failed.join(", ")}`),t.message&&n.push(`**Message:** ${t.message}`);else if(e.includes("TerminalTypes")){if(n.push(`**Platform:** ${t.platform||"unknown"}`),n.push(`**Default:** ${t.default_type||"unknown"}`),t.types&&Array.isArray(t.types)){n.push(""),n.push("**Available Types:**");for(const e of t.types){const t=e.is_default?" â­":"";n.push(`- **${e.display_name||e.name}**${t}`)}}}else if(e.includes("TerminalRename"))t.session_id&&n.push(`**Session:** \`${t.session_id}\``),t.new_name&&n.push(`**New Name:** ${t.new_name}`),t.message&&n.push(`**Message:** ${t.message}`);else if(e.includes("TerminalInterrupt"))t.session_id&&n.push(`**Session:** \`${t.session_id}\``),t.message&&n.push(`**Message:** ${t.message}`);else for(const[s,o]of Object.entries(t))"success"!==s&&("object"==typeof o?(n.push(`**${s}:**`),n.push("```json"),n.push(JSON.stringify(o,null,2)),n.push("```")):n.push(`**${s}:** ${o}`));else t.session_id&&n.push(`**Session:** \`${t.session_id}\``),t.session_name&&n.push(`**Name:** ${t.session_name}`),t.background&&n.push("**Mode:** Background"),t.message&&n.push(`**Message:** ${t.message}`),t.output&&(n.push(""),n.push("**Output:**"),n.push("```"),n.push(t.output),n.push("```")),t.truncated&&n.push(`> âš ï¸ Output truncated (${t.total_lines||"?"} lines, ${t.total_chars||"?"} chars)`);return n.join("\n")}(t.toolCall.toolName||"",n)});const l=We(()=>{const e=t.toolCall.result;return e&&!e.is_error&&r.value}),c=We(()=>Object.keys(o.value).length>0||l.value);return(e,t)=>(st(),Je(tx,{"display-info":s.value,"is-expanded":n.value,"has-details":c.value,onClick:t[0]||(t[0]=e=>n.value=!n.value)},{details:St(()=>[tt("div",a_,[tt("div",l_,[t[1]||(t[1]=tt("div",{class:"section-title"},"Params",-1)),tt("div",c_,[(st(!0),Qe(lt,null,ct(o.value,(e,t)=>(st(),Qe("div",{key:t,class:"param-row"},[tt("span",u_,ut(t)+":",1),tt("span",d_,ut(i(e)),1)]))),128))])]),l.value?(st(),Qe("div",p_,[t[2]||(t[2]=tt("div",{class:"section-title"},"Result",-1)),tt("div",h_,[kt(gI,{content:a.value},null,8,["content"])])])):qe("",!0)])]),_:1},8,["display-info","is-expanded","has-details"]))}}),[["__scopeId","data-v-fd3c639b"]]),m_={class:"tool-call-display"},g_=ju(Ze({__name:"ToolCallDisplay",props:{toolCall:{}},setup(e){const t=e,n=We(()=>t.toolCall.toolName?.startsWith("mcp__jetbrains__")),s=We(()=>t.toolCall.toolName?.startsWith("mcp__terminal__"));return(t,o)=>(st(),Qe("div",m_,[e.toolCall.toolType===ht(Kl).READ?(st(),Je(gx,{key:0,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).WRITE?(st(),Je(wx,{key:1,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).EDIT?(st(),Je(Ox,{key:2,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).MULTI_EDIT?(st(),Je(Zx,{key:3,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).BASH?(st(),Je(aA,{key:4,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).BASH_OUTPUT?(st(),Je(yA,{key:5,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).KILL_SHELL?(st(),Je(EA,{key:6,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).GREP?(st(),Je(WA,{key:7,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).GLOB?(st(),Je(QA,{key:8,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).WEB_SEARCH?(st(),Je(uN,{key:9,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).WEB_FETCH?(st(),Je(bN,{key:10,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).TODO_WRITE?(st(),Je(CN,{key:11,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).TASK?(st(),Je(BM,{key:12,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).ASK_USER_QUESTION?(st(),Je(HM,{key:13,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).NOTEBOOK_EDIT?(st(),Je(oR,{key:14,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).EXIT_PLAN_MODE?(st(),Je(pR,{key:15,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).ENTER_PLAN_MODE?(st(),Je(gR,{key:16,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).SKILL?(st(),Je(CR,{key:17,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).SLASH_COMMAND?(st(),Je(MR,{key:18,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).LIST_MCP_RESOURCES?(st(),Je(FR,{key:19,"tool-call":e.toolCall},null,8,["tool-call"])):e.toolCall.toolType===ht(Kl).READ_MCP_RESOURCE?(st(),Je(KR,{key:20,"tool-call":e.toolCall},null,8,["tool-call"])):n.value?(st(),Je(r_,{key:21,"tool-call":e.toolCall},null,8,["tool-call"])):s.value?(st(),Je(f_,{key:22,"tool-call":e.toolCall},null,8,["tool-call"])):(st(),Je(QR,{key:23,"tool-call":e.toolCall},null,8,["tool-call"]))]))}}),[["__scopeId","data-v-b8a43f46"]]),y_={class:"compact-tool-call-display"},v_=ju(Ze({__name:"CompactToolCallDisplay",props:{toolCalls:{}},setup:e=>(t,n)=>(st(),Qe("div",y_,[(st(!0),Qe(lt,null,ct(e.toolCalls,e=>(st(),Qe("div",{key:e.id,class:"tool-call-item"},[kt(g_,{"tool-call":e},null,8,["tool-call"])]))),128))]))}),[["__scopeId","data-v-61e893d3"]]),b_={class:"assistant-message-display"},k_={key:0,class:"model-display"},w_={class:"model-name"},S_={class:"ordered-elements"},C_={key:0,class:"content-item"},T_={key:0},E_={key:1,class:"thinking-item"},I_={class:"thinking-header"},x_={class:"thinking-label"},A_={class:"thinking-content"},N_={key:3,class:"status-item status-message-row"},M_={key:0,class:"jumping-dots-container"},R_={class:"status-text"},__=ju(Ze({__name:"AssistantMessageDisplay",props:{message:{},expandedTools:{default:()=>new Map}},emits:["expanded-change"],setup(e,{emit:t}){const n=e,s=t,{t:o}=cu();function i(e,t){return`${n.message.id}-${e.timestamp}-${t}-${e.displayType}`}function r(e){console.log("[AssistantMessageDisplay] é“¾æŽ¥ç‚¹å‡»:",e)}function a(e,t){console.log("[AssistantMessageDisplay] ä»£ç æ“ä½œ: è¯­è¨€=",t)}function l(e,t){s("expanded-change",e,t)}return(t,n)=>{return st(),Qe("div",b_,[e.message.model?(st(),Qe("div",k_,[n[0]||(n[0]=tt("span",{class:"model-label"},"AI",-1)),tt("span",w_,ut((s=e.message.model,{DEFAULT:"é»˜è®¤",OPUS:"Opus",SONNET:"Sonnet",OPUS_PLAN:"Opus Plan"}[s]||s)),1)])):qe("",!0),tt("div",S_,[(st(!0),Qe(lt,null,ct(e.message.orderedElements,(t,s)=>{return st(),Qe("div",{key:i(t,s),class:"timeline-element"},["content"===t.displayType?(st(),Qe("div",C_,[(c=t.content,c&&c.trim().length>0?(st(),Qe("div",T_,[kt(gI,{content:t.content,class:"markdown-content",onLinkClick:r,onCodeAction:a},null,8,["content"])])):qe("",!0))])):"thinking"===t.displayType?(st(),Qe("div",E_,[tt("div",I_,[n[1]||(n[1]=tt("span",{class:"thinking-icon"},"ðŸ’­",-1)),tt("span",x_,ut(ht(o)("chat.thinkingLabel")),1)]),tt("div",A_,[kt(gI,{content:t.content,class:"markdown-content"},null,8,["content"])])])):"toolCall"===t.displayType?(st(),Je(v_,{key:2,"tool-calls":[t.toolCall],"expanded-tools":e.expandedTools,class:"tool-call-item",onExpandedChange:l},null,8,["tool-calls","expanded-tools"])):"status"===t.displayType?(st(),Qe("div",N_,[t.isStreaming?(st(),Qe("div",M_,[...n[2]||(n[2]=[tt("span",{class:"jumping-dot"},null,-1),tt("span",{class:"jumping-dot"},null,-1),tt("span",{class:"jumping-dot"},null,-1)])])):qe("",!0),tt("span",R_,ut(t.status),1)])):qe("",!0)]);var c}),128))])]);var s}}}),[["__scopeId","data-v-402e2d14"]]);const O_={class:"message-header"},D_={class:"role-icon"},B_={class:"role-name"},L_={class:"timestamp"},F_={class:"message-content"},P_=Ze({__name:"MessageDisplay",props:{source:{},index:{}},setup(e){const t=e,n=We(()=>t.source),s=Ge(new Map),o=lu();function i(e,t){s.value.set(e,t)}const r=We(()=>{const e=n.value,t=o.currentMessages,s=e.content.filter(e=>"tool_result"===e.type),i=[];let r="";console.log(`ðŸ” [MessageDisplay] å¤„ç†æ¶ˆæ¯å†…å®¹ï¼Œå…± ${e.content.length} ä¸ªå—`),console.log("ðŸ” [MessageDisplay] å®Œæ•´ content æ•°æ®:",JSON.stringify(e.content,null,2)),e.content.forEach((n,o)=>{if(console.log(`  [${o}] type="${n.type}"`),console.log(`  [${o}] å—æ•°æ®:`,n),"text"===n.type)console.log(`    âœ… æ·»åŠ æ–‡æœ¬å—ï¼Œé•¿åº¦=${n.text?.length||0}`),i.push({type:"content",content:n.text,timestamp:e.timestamp}),r&&(r+="\n\n"),r+=n.text;else if("tool_use"===n.type||n.type.endsWith("_tool_use")){if("mcp__user_interaction__AskUserQuestion"===n.toolName)return;const o=s.find(e=>e.tool_use_id===n.id);console.log(`    ðŸ”§ æ·»åŠ å·¥å…·è°ƒç”¨: toolName=${n.toolName}, id=${n.id}, type=${n.type}, hasResult=${!!o}`);const r={toolType:(a=n).toolType,compactSummary:void 0,toolDetail:{parameters:a.input,toolType:a.toolType},toolResult:a.result};console.log(`    âœ… æž„å»º viewModel: toolType=${r.toolDetail?.toolType}, summary="${r.compactSummary}"`);const l=function(e,t){for(let n=t.length-1;n>=0;n--){const s=t[n];if(s.content)for(const t of s.content)if("tool_result"===t.type){const n=t;if(n.tool_use_id===e)return{status:n.is_error?"error":"success",result:n}}}return{status:"running"}}(n.id,t),c=l.result?.content,u=function(e){switch(e){case"running":return"RUNNING";case"success":return"SUCCESS";case"error":return"FAILED"}}(l.status);i.push({displayType:"toolCall",toolCall:{id:n.id,toolName:n.toolName,viewModel:r,displayName:n.toolName,status:u,result:c?{type:u===pl.FAILED?"failure":"success",output:"string"==typeof c?c:JSON.stringify(c),error:u===pl.FAILED?"string"==typeof c?c:JSON.stringify(c):void 0}:void 0,startTime:e.timestamp,endTime:c?e.timestamp:void 0},timestamp:e.timestamp})}else if("thinking"===n.type){const t=n.thinking||"";console.log(`    ðŸ’­ æ·»åŠ æ€è€ƒé“¾å—ï¼Œé•¿åº¦=${t.length}`),console.log(`    ðŸ’­ æ€è€ƒå†…å®¹é¢„è§ˆ: "${t.substring(0,100)}${t.length>100?"...":""}"`),i.push({type:"thinking",content:t,timestamp:e.timestamp})}else"tool_result"===n.type?console.log(`    â­ï¸ è·³è¿‡ tool_result å—: tool_use_id=${n.tool_use_id}`):console.log(`    âš ï¸ æœªçŸ¥å—ç±»åž‹: ${n.type}`);var a}),console.log(`ðŸ“Š [MessageDisplay] æž„é€ å®Œæˆï¼ŒorderedElements å…± ${i.length} ä¸ªå…ƒç´ `);const a={user:Nu.USER,assistant:Nu.ASSISTANT,system:Nu.SYSTEM};return{id:e.id,role:a[e.role]||Nu.ASSISTANT,timestamp:e.timestamp,contexts:[],model:void 0,status:e.isStreaming?Mu.STREAMING:Mu.COMPLETE,isStreaming:e.isStreaming||!1,isError:!1,orderedElements:i,isCompactSummary:!1}}),a=We(()=>{switch(n.value.role){case"user":return"ðŸ‘¤";case"assistant":return"ðŸ¤–";case"system":return"âš™ï¸";default:return"ðŸ’¬"}}),l=We(()=>{switch(n.value.role){case"user":return"ä½ ";case"assistant":return"Claude";case"system":return"ç³»ç»Ÿ";default:return"æœªçŸ¥"}}),c=We(()=>new Date(n.value.timestamp).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})),u=We(()=>n.value.content.filter(e=>"text"===e.type).map(e=>"text"===e.type&&"text"in e?e.text:"").join("\n\n"));return(e,t)=>"user"===n.value.role?(st(),Je(LI,{key:0,message:n.value},null,8,["message"])):"assistant"===n.value.role?(st(),Je(__,{key:1,message:r.value,"expanded-tools":s.value,onExpandedChange:i},null,8,["message","expanded-tools"])):(st(),Qe("div",{key:2,class:dt(["message",`message-${n.value.role}`])},[tt("div",O_,[tt("span",D_,ut(a.value),1),tt("span",B_,ut(l.value),1),tt("span",L_,ut(c.value),1)]),tt("div",F_,[u.value?(st(),Je(gI,{key:0,content:u.value},null,8,["content"])):qe("",!0)])],2))}}),$_=ju(P_,[["__scopeId","data-v-ac43b6e2"]]),U_={key:0,class:"loading-indicator"},V_={key:1,class:"empty-state"},W_={class:"empty-content"},G_={class:"shortcut-hints"},z_={class:"shortcut-item"},H_={class:"shortcut-desc"},K_={class:"shortcut-item"},j_={class:"shortcut-desc"},Y_={class:"shortcut-item"},Z_={class:"shortcut-desc"},X_={class:"shortcut-item"},J_={class:"shortcut-desc"},Q_={class:"shortcut-item"},q_={class:"shortcut-desc"},eO={class:"shortcut-item"},tO={class:"shortcut-desc"},nO={class:"shortcut-item"},sO={class:"shortcut-desc"},oO={class:"shortcut-item"},iO={class:"shortcut-desc"},rO={key:0,class:"streaming-indicator"},aO={class:"streaming-stats"},lO=["title"],cO={key:0,class:"new-message-badge"},uO=Ze({__name:"MessageList",props:{messages:{},displayItems:{},isLoading:{type:Boolean,default:!1},isStreaming:{type:Boolean,default:!1},streamingStartTime:{default:0},inputTokens:{default:0},outputTokens:{default:0},contentVersion:{default:0},connectionStatus:{default:"DISCONNECTED"},hasMoreHistory:{type:Boolean,default:!1}},emits:["load-more-history"],setup(e,{emit:t}){const{t:n}=cu(),s=lu(),o=e,i=t,r=Ge(),a=Ge(),l=We({get:()=>s.currentTab?.uiState.scrollState??{...Xc},set:e=>{s.currentTab&&s.currentTab.saveUiState({scrollState:{...l.value,...e}})}}),c=We(()=>"browse"===l.value.mode&&P.value.length>0),u=We(()=>l.value.newMessageCount);function d(){const e=a.value?.$el;if(!e||0===P.value.length)return null;const t=e.clientHeight,n=.3*t,s=e.querySelectorAll("[data-index]");let o=null,i=0,r=-1;for(const a of s){const t=a.getBoundingClientRect(),s=e.getBoundingClientRect(),l=t.top-s.top,c=t.bottom-s.top;if(l<=n&&c>=n){o=a,i=l,r=parseInt(a.getAttribute("data-index")||"-1",10);break}}if(!o&&s.length>0){o=s[0];const t=o.getBoundingClientRect(),n=e.getBoundingClientRect();i=t.top-n.top,r=parseInt(o.getAttribute("data-index")||"-1",10)}if(r<0||r>=P.value.length)return null;return{itemId:P.value[r].id,offsetFromViewportTop:i,viewportHeight:t,savedAt:Date.now()}}let p=null;function h(){if(p&&(clearTimeout(p),p=null),"browse"===l.value.mode&&!m.value){const e=d();e&&(l.value={...l.value,anchor:e},console.log(`ðŸ’¾ [Scroll] Saved anchor immediately: item=${e.itemId}`))}}const f=Ge(0),m=Ge(!1),g=Ge(!1),y=Ge(!1),v=Ge(!1),b=Ge(0),k=Ge(0),w=Ge(!1),S=Ge(0);let C=null;function T(e){const t=Math.floor(e/1e3);if(t<60)return`${t}s`;const n=Math.floor(t/60),s=t%60;if(n<60)return`${n}m${s}s`;return`${Math.floor(n/60)}h${n%60}m${s}s`}function E(e){return e<1e3?`${e}`:`${(e/1e3).toFixed(1)}k`}const I=We(()=>`esc to interrupt Â· ${T(S.value)} â†‘${E(o.inputTokens)} â†“${E(o.outputTokens)}`);function x(){if(null!==C)return;const e=o.streamingStartTime||Date.now();S.value=Date.now()-e,C=window.setInterval(()=>{S.value=Date.now()-e},100)}function A(){null!==C&&(clearInterval(C),C=null)}function N(e){if(!m.value&&e.deltaY<0&&"follow"===l.value.mode){const e=d();l.value={mode:"browse",anchor:e,newMessageCount:0},console.log("ðŸ”„ [Scroll] Switched to browse mode (wheel up)")}}function M(e){const t=a.value?.$el;if(!t)return;const n=t.getBoundingClientRect();e.clientX>n.right-20&&(g.value=!0,console.log("ðŸ”„ [Scroll] User started dragging scrollbar"))}function R(){g.value&&(g.value=!1,console.log("ðŸ”„ [Scroll] User stopped dragging scrollbar"))}function _(){g.value=!0}function O(){setTimeout(()=>{g.value=!1},150)}We(()=>T(S.value)),Ke(()=>o.isStreaming,e=>{e?x():A()},{immediate:!0}),Ke(()=>o.streamingStartTime,()=>{o.isStreaming&&(A(),x())}),Ke(()=>o.outputTokens,()=>{o.isStreaming&&"follow"===l.value.mode&&!g.value&&G()}),Ke(()=>o.contentVersion,()=>{o.isStreaming&&"follow"===l.value.mode&&!g.value&&G()}),Ke(()=>l.value.mode,async(e,t)=>{"follow"===e&&"browse"===t&&(console.log("ðŸ”„ [Scroll] Mode changed to follow, scrolling to bottom"),await pt(),U(),await pt(),G())});let D=!1;function B(){if(D)return;const e=a.value?.$el;e&&(e.addEventListener("wheel",N,{passive:!0}),e.addEventListener("pointerdown",M,{passive:!0}),e.addEventListener("touchstart",_,{passive:!0}),window.addEventListener("pointerup",R),window.addEventListener("touchend",O),D=!0,console.log("ðŸ”„ [Scroll] User interaction listeners added"))}function L(){document.hidden&&h()}function F(e){s.currentTabId===e&&(h(),console.log(`ðŸ’¾ [Scroll] Saved anchor before tab switch from ${e}`))}ot(()=>{o.isStreaming&&x(),pt(()=>{B()}),document.addEventListener("visibilitychange",L),s.registerBeforeTabSwitch(F)}),Xe(()=>{A();const e=a.value?.$el;e&&(e.removeEventListener("wheel",N),e.removeEventListener("pointerdown",M),e.removeEventListener("touchstart",_)),window.removeEventListener("pointerup",R),window.removeEventListener("touchend",O),document.removeEventListener("visibilitychange",L),s.unregisterBeforeTabSwitch(F)}),Ke(()=>s.currentTabId,async(e,t)=>{if(!e||e===t)return;if(t){const e=s.tabs.find(e=>e.tabId===t);if(e){const n=e.uiState.scrollState;"browse"===n.mode&&n.anchor&&console.log(`ðŸ’¾ [Scroll] Using saved anchor for old tab ${t}: item=${n.anchor.itemId}`)}}m.value=!0;const n=s.currentTab?.uiState.scrollState;if(await pt(),await new Promise(e=>requestAnimationFrame(()=>requestAnimationFrame(e))),"browse"===n?.mode)if(n.anchor)await async function(e){const t=a.value?.$el;if(!t)return;const n=P.value.findIndex(t=>t.id===e.itemId);if(-1===n)return console.log("ðŸ”„ [Scroll] Anchor item not found, scrolling to bottom"),void z();const s=100*n-e.offsetFromViewportTop;t.scrollTop=Math.max(0,s),await pt(),a.value?.forceUpdate?.(),await pt(),await new Promise(e=>requestAnimationFrame(e));const o=t.querySelector(`[data-index="${n}"]`);if(o){const n=o.getBoundingClientRect(),s=t.getBoundingClientRect(),i=n.top-s.top-e.offsetFromViewportTop;t.scrollTop+=i}f.value=t.scrollTop,t.scrollHeight-t.scrollTop-t.clientHeight<50&&(l.value={mode:"follow",anchor:null,newMessageCount:0}),console.log(`ðŸ”„ [Scroll] Restored to item ${e.itemId} (index=${n})`)}(n.anchor);else{const e=a.value?.$el;e&&(f.value=e.scrollTop),console.log("ðŸ”„ [Scroll] Browse mode without anchor, keeping current position")}else{await K();const e=a.value?.$el;e&&(f.value=e.scrollTop),s.currentTab&&(l.value={mode:"follow",anchor:null,newMessageCount:0})}await pt(),m.value=!1,console.log(`ðŸ”„ [Scroll] Tab switched to ${e}, mode=${n?.mode??"follow"}`)});const P=We(()=>o.displayItems||o.messages||[]),$=We(()=>o.displayItems?vM:$_);function U(){a.value&&a.value.forceUpdate?.()}Ke(()=>P.value.length,(e,t)=>{e>0&&0===t&&pt(()=>{B()})}),Ke(()=>P.value.length,async(e,t)=>{const n=e-t;if(console.log(`ðŸ“œ [Scroll] displayMessages.length changed: ${t} -> ${e}, added=${n}, mode=${l.value.mode}, isTabSwitching=${m.value}, historyLoadInProgress=${y.value}`),m.value)console.log("ðŸ“œ [Scroll] Skipped: isTabSwitching");else{if(0===t&&e>0)return await pt(),z(),void U();if(y.value)return await pt(),void U();if(n>0)if("browse"===l.value.mode){const e=l.value.newMessageCount;l.value={...l.value,newMessageCount:e+n};const t=a.value?.$el,s=t?.scrollTop??0;await pt(),U(),await pt(),t&&(t.scrollTop=s)}else await pt(),U(),await pt(),G();else await pt(),U()}}),Ke(()=>o.isLoading,async(e,t)=>{if(e&&"follow"===l.value.mode&&(await pt(),z()),!e&&t)if(y.value){await pt();const e=a.value?.$el;if(e){const t=e.scrollHeight-b.value;e.scrollTop=k.value+t}y.value=!1,v.value=!1}else w.value||(w.value=!0,await pt(),U(),await async function(){await pt(),await pt();let e=0;const t=10;let n=0;for(;e<t;){if(H()){console.log("âœ… è§†å£å·²å¡«æ»¡ï¼Œåœæ­¢è‡ªåŠ¨åŠ è½½");break}if(!o.hasMoreHistory){console.log("ðŸ“­ æ²¡æœ‰æ›´å¤šåŽ†å²æ¶ˆæ¯ï¼Œåœæ­¢åŠ è½½ï¼ˆæ¶ˆæ¯æ•°é‡ä¸è¶³ä»¥å¡«æ»¡è§†å£ï¼‰");break}if(n>=kc){console.log(`ðŸ“Š å·²è‡ªåŠ¨åŠ è½½ ${n} æ¡æ¶ˆæ¯ï¼Œè¾¾åˆ°ä¸Šé™ 200ï¼Œåœæ­¢åŠ è½½`);break}console.log(`ðŸ“ è§†å£æœªå¡«æ»¡ä¸”æœ‰æ›´å¤šåŽ†å²ï¼Œè‡ªåŠ¨åŠ è½½ç¬¬ ${e+1} æ‰¹...`),i("load-more-history"),await pt(),await new Promise(e=>setTimeout(e,300)),n+=50,e++}e>=t&&console.warn("âš ï¸ è¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°ï¼Œåœæ­¢è‡ªåŠ¨åŠ è½½")}(),await K(),v.value=!1,y.value=!1,l.value={mode:"follow",anchor:null,newMessageCount:0})});let V=null;function W(){V||(V=requestAnimationFrame(()=>{V=null,function(){if(!a.value)return;if(m.value)return;const e=a.value.$el;if(!e)return;const t=e.scrollTop,n=e.scrollHeight,s=e.clientHeight,r=n-t-s;t<500&&o.hasMoreHistory&&!o.isLoading&&!y.value&&!v.value?(console.log("âœ… [æ‡’åŠ è½½] è§¦å‘åŠ è½½æ›´å¤šåŽ†å²"),v.value=!0,y.value=!0,b.value=n,k.value=t,i("load-more-history")):t>750&&(y.value||(v.value=!1));const c=r<50,u=t<f.value,h=Math.abs(t-f.value)>5;if(f.value=t,"follow"===l.value.mode){if(u&&h){const e=d();l.value={mode:"browse",anchor:e,newMessageCount:0},console.log("ðŸ”„ [Scroll] Switched to browse mode (scrolling up)")}}else c&&!u?(l.value={mode:"follow",anchor:null,newMessageCount:0},console.log("ðŸ”„ [Scroll] Switched to follow mode (reached bottom)")):c||(p&&clearTimeout(p),p=window.setTimeout(()=>{if("browse"===l.value.mode&&!m.value){const e=d();e&&(l.value={...l.value,anchor:e},console.log(`ðŸ’¾ [Scroll] Saved anchor: item=${e.itemId}`))}},50))}()}))}function G(){a.value?a.value.scrollToBottom():r.value&&(r.value.scrollTop=r.value.scrollHeight)}function z(){G(),l.value={mode:"follow",anchor:null,newMessageCount:0,isNearBottom:!0},console.log("ðŸ”„ [Scroll] User clicked scroll to bottom")}function H(){if(!a.value)return!1;const e=a.value.$el;return e.scrollHeight>e.clientHeight}async function K(e=10,t=100){let n=0;const s=async()=>{if(!a.value)return!1;a.value.scrollToBottom(),await pt();const e=a.value.$el;if(!e)return!1;const t=e.scrollTop;return e.scrollHeight-t-e.clientHeight<10};if(!(await s()))return new Promise(o=>{const i=setInterval(async()=>{n++;const t=await s();(t||n>=e)&&(clearInterval(i),!t&&n>=e&&console.warn("âš ï¸ æ»šåŠ¨åˆ°åº•éƒ¨å¤±è´¥ï¼Œå·²é‡è¯•",e,"æ¬¡"),o())},t)})}return(t,s)=>(st(),Qe("div",{ref_key:"wrapperRef",ref:r,class:"message-list-wrapper"},[e.isLoading?(st(),Qe("div",U_,[s[0]||(s[0]=tt("div",{class:"loading-spinner"},null,-1)),tt("span",null,ut(ht(n)("chat.loadingHistory")),1)])):0===P.value.length?(st(),Qe("div",V_,[tt("div",W_,[tt("div",G_,[tt("div",z_,[s[1]||(s[1]=tt("kbd",{class:"keyboard-key"},"Enter",-1)),tt("span",H_,ut(ht(n)("chat.welcomeScreen.sendHint")),1)]),tt("div",K_,[s[2]||(s[2]=tt("kbd",{class:"keyboard-key"},"Shift",-1)),s[3]||(s[3]=Nt(" + ",-1)),s[4]||(s[4]=tt("kbd",{class:"keyboard-key"},"Enter",-1)),tt("span",j_,ut(ht(n)("chat.welcomeScreen.newLineHint")),1)]),tt("div",Y_,[s[5]||(s[5]=tt("kbd",{class:"keyboard-key"},"Esc",-1)),tt("span",Z_,ut(ht(n)("chat.welcomeScreen.stopHint")),1)]),tt("div",X_,[s[6]||(s[6]=tt("kbd",{class:"keyboard-key"},"Tab",-1)),tt("span",J_,ut(ht(n)("chat.welcomeScreen.toggleThinkingHint")),1)]),tt("div",Q_,[s[7]||(s[7]=tt("kbd",{class:"keyboard-key"},"Shift",-1)),s[8]||(s[8]=Nt(" + ",-1)),s[9]||(s[9]=tt("kbd",{class:"keyboard-key"},"Tab",-1)),tt("span",q_,ut(ht(n)("chat.welcomeScreen.switchModeHint")),1)]),tt("div",eO,[s[10]||(s[10]=tt("kbd",{class:"keyboard-key"},"Ctrl",-1)),s[11]||(s[11]=Nt(" + ",-1)),s[12]||(s[12]=tt("kbd",{class:"keyboard-key"},"Enter",-1)),tt("span",tO,ut(ht(n)("chat.welcomeScreen.interruptHint")),1)]),tt("div",nO,[s[13]||(s[13]=tt("kbd",{class:"keyboard-key"},"Ctrl",-1)),s[14]||(s[14]=Nt(" + ",-1)),s[15]||(s[15]=tt("kbd",{class:"keyboard-key"},"J",-1)),tt("span",sO,ut(ht(n)("chat.welcomeScreen.newLineHint")),1)]),tt("div",oO,[s[16]||(s[16]=tt("kbd",{class:"keyboard-key"},"Ctrl",-1)),s[17]||(s[17]=Nt(" + ",-1)),s[18]||(s[18]=tt("kbd",{class:"keyboard-key"},"U",-1)),tt("span",iO,ut(ht(n)("chat.welcomeScreen.clearToLineStartHint")),1)])])])])):(st(),Je(ht(Rt),{key:2,ref_key:"scrollerRef",ref:a,class:"message-list",items:P.value,"min-item-size":60,buffer:200,"key-field":"id",onScroll:W},{default:St(({item:e,index:t,active:n})=>[kt(ht(_t),{item:e,active:n,"data-index":t,"size-dependencies":[e.content,e.status,e.result,e.input],"emit-resize":!0},{default:St(()=>[(st(),Je(Ot($.value),{source:e},null,8,["source"]))]),_:2},1032,["item","active","data-index","size-dependencies"])]),after:St(()=>[e.isStreaming?(st(),Qe("div",rO,[s[19]||(s[19]=tt("span",{class:"generating-text"},"Generating",-1)),s[20]||(s[20]=tt("span",{class:"bouncing-dots"},[tt("span",{class:"dot"},"."),tt("span",{class:"dot"},"."),tt("span",{class:"dot"},".")],-1)),tt("span",aO,"("+ut(I.value)+")",1)])):qe("",!0)]),_:1},8,["items"])),kt(Dt,{name:"fade-slide"},{default:St(()=>[c.value?(st(),Qe("button",{key:0,class:"scroll-to-bottom-btn",title:ht(n)("chat.scrollToBottom"),onClick:z},[s[21]||(s[21]=tt("span",{class:"btn-icon"},"â†“",-1)),u.value>0?(st(),Qe("span",cO,ut(u.value),1)):qe("",!0)],8,lO)):qe("",!0)]),_:1})],512))}}),dO=ju(uO,[["__scopeId","data-v-fcee57f1"]]),pO=["title","onClick","onDblclick","onMouseup"],hO=["title"],fO={key:0,class:"spinner connecting"},mO={key:1,class:"spinner generating"},gO={key:2,class:"dot-solid"},yO=["onBlur","onKeyup"],vO={key:1,class:"tab-name"},bO=["title","onClick"],kO={key:0,class:"tab-placeholder"},wO=ju(Ze({__name:"SessionTabs",props:{sessions:{},currentSessionId:{},canClose:{type:Boolean,default:!0}},emits:["switch","close","reorder","toggle-list","rename"],setup(e,{emit:t}){const n=e,s=t,{t:o}=cu(),i=Ge([...n.sessions]),r=Ge(null),a=Ge(""),l=Ge(null),c=Ge(!1),u=Ge(!1),d=Ge(!1);let p=null;function h(){const e=l.value;e&&(c.value=e.scrollWidth>e.clientWidth,u.value=e.scrollLeft>0,d.value=e.scrollLeft+e.clientWidth<e.scrollWidth-1)}function f(){const e=l.value;e&&e.scrollBy({left:-120,behavior:"smooth"})}function m(){const e=l.value;e&&e.scrollBy({left:120,behavior:"smooth"})}function g(e){const t=a.value.trim();t&&t!==e.name&&s("rename",e.id,t),y()}function y(){r.value=null,a.value=""}function v(e){s("close",e)}function b(){const e=i.value.map(e=>e.id);s("reorder",e)}function k(e){return"CONNECTED"===e.connectionStatus?o("chat.connectionStatus.connected"):"CONNECTING"===e.connectionStatus?o("chat.connectionStatus.connecting"):"DISCONNECTED"===e.connectionStatus?o("chat.connectionStatus.disconnected"):"ERROR"===e.connectionStatus?e.error||o("chat.connectionStatus.error")||"è¿žæŽ¥é”™è¯¯":o("chat.connectionStatus.disconnected")}function w(e){const t=[],n=e.backendType??ml;t.push(`åŽç«¯: ${Gl(n)}`);const s=function(e){return e.sessionId||e.resumeFromSessionId||null}(e);return s&&t.push(`ä¼šè¯: ${s}`),t.push(`çŠ¶æ€: ${k(e)}`),t.join(" | ")}return ot(()=>{pt(()=>{requestAnimationFrame(()=>{h()}),l.value&&(p=new ResizeObserver(()=>{requestAnimationFrame(h)}),p.observe(l.value))})}),ft(()=>{p?.disconnect()}),Ke(()=>n.sessions,(e,t)=>{const n=e.length>(t?.length||0);i.value=[...e],pt(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{h(),n&&l.value&&l.value.scrollTo({left:l.value.scrollWidth,behavior:"smooth"})})})})},{deep:!0}),(t,p)=>(st(),Qe("div",{class:dt(["session-tabs",{"has-overflow":c.value}])},[c.value&&u.value?(st(),Qe("button",{key:0,class:"scroll-indicator scroll-left",onClick:f}," â€¹ ")):qe("",!0),tt("div",{ref_key:"scrollContainer",ref:l,class:"tabs-scroll",onScroll:h},[kt(ht(Bt),{modelValue:i.value,"onUpdate:modelValue":p[2]||(p[2]=e=>i.value=e),animation:200,delay:150,"delay-on-touch-only":!0,"item-key":"id",class:"draggable-tabs",onEnd:b},{item:St(({element:t})=>[tt("div",{class:dt(["session-tab",{active:t.id===e.currentSessionId,generating:t.isGenerating,connecting:"CONNECTING"===t.connectionStatus,error:"ERROR"===t.connectionStatus}]),title:w(t),onClick:e=>function(e){e.id!==n.currentSessionId&&s("switch",e.id)}(t),onDblclick:et(e=>function(e){r.value=e.id,a.value=e.name||"",pt(()=>{const e=document.querySelector(".tab-name-input");e?.focus(),e?.select()})}(t),["stop"]),onMouseup:et(e=>v(t.id),["middle","prevent"])},[tt("span",{class:dt(["status-indicator",{connecting:"CONNECTING"===t.connectionStatus,generating:t.isGenerating,connected:"CONNECTED"===t.connectionStatus,disconnected:"DISCONNECTED"===t.connectionStatus,error:"ERROR"===t.connectionStatus}]),title:k(t)},["CONNECTING"===t.connectionStatus?(st(),Qe("span",fO)):t.isGenerating?(st(),Qe("span",mO)):(st(),Qe("span",gO))],10,hO),r.value===t.id?rt((st(),Qe("input",{key:0,"onUpdate:modelValue":p[0]||(p[0]=e=>a.value=e),class:"tab-name-input",onBlur:e=>g(t),onKeyup:[Lt(e=>g(t),["enter"]),Lt(y,["escape"])],onClick:p[1]||(p[1]=et(()=>{},["stop"]))},null,40,yO)),[[at,a.value]]):(st(),Qe("span",vO,ut(t.name||ht(o)("session.unnamed")),1)),e.canClose?(st(),Qe("button",{key:2,class:"close-btn",type:"button",title:ht(o)("session.close")||"å…³é—­ä¼šè¯",onClick:et(e=>v(t.id),["stop"])}," Ã— ",8,bO)):qe("",!0)],42,pO)]),_:1},8,["modelValue"]),0===e.sessions.length?(st(),Qe("span",kO,ut(ht(o)("session.empty")||"æš‚æ— æ´»åŠ¨ä¼šè¯"),1)):qe("",!0)],544),c.value&&d.value?(st(),Qe("button",{key:1,class:"scroll-indicator scroll-right",onClick:m}," â€º ")):qe("",!0)],2))}}),[["__scopeId","data-v-2952b79f"]]),SO=["title"],CO=["width","height"],TO=["width","height"],EO=["width","height"],IO=ju(Ze({__name:"BackendIcon",props:{type:{},size:{default:14},title:{default:""}},setup:e=>(t,n)=>(st(),Qe("span",{class:dt(["backend-icon",e.type]),title:e.title},["claude"===e.type?(st(),Qe("svg",{key:0,viewBox:"0 0 24 24",fill:"currentColor",width:e.size,height:e.size},[...n[0]||(n[0]=[tt("path",{d:"m4.7144 15.9555 4.7174-2.6471.079-.2307-.079-.1275h-.2307l-.7893-.0486-2.6956-.0729-2.3375-.0971-2.2646-.1214-.5707-.1215-.5343-.7042.0546-.3522.4797-.3218.686.0608 1.5179.1032 2.2767.1578 1.6514.0972 2.4468.255h.3886l.0546-.1579-.1336-.0971-.1032-.0972L6.973 9.8356l-2.55-1.6879-1.3356-.9714-.7225-.4918-.3643-.4614-.1578-1.0078.6557-.7225.8803.0607.2246.0607.8925.686 1.9064 1.4754 2.4893 1.8336.3643.3035.1457-.1032.0182-.0728-.164-.2733-1.3539-2.4467-1.445-2.4893-.6435-1.032-.17-.6194c-.0607-.255-.1032-.4674-.1032-.7285L6.287.1335 6.6997 0l.9957.1336.419.3642.6192 1.4147 1.0018 2.2282 1.5543 3.0296.4553.8985.2429.8318.091.255h.1579v-.1457l.1275-1.706.2368-2.0947.2307-2.6957.0789-.7589.3764-.9107.7468-.4918.5828.2793.4797.686-.0668.4433-.2853 1.8517-.5586 2.9021-.3643 1.9429h.2125l.2429-.2429.9835-1.3053 1.6514-2.0643.7286-.8196.85-.9046.5464-.4311h1.0321l.759 1.1293-.34 1.1657-1.0625 1.3478-.8804 1.1414-1.2628 1.7-.7893 1.36.0729.1093.1882-.0183 2.8535-.607 1.5421-.2794 1.8396-.3157.8318.3886.091.3946-.3278.8075-1.967.4857-2.3072.4614-3.4364.8136-.0425.0304.0486.0607 1.5482.1457.6618.0364h1.621l3.0175.2247.7892.522.4736.6376-.079.4857-1.2142.6193-1.6393-.3886-3.825-.9107-1.3113-.3279h-.1822v.1093l1.0929 1.0686 2.0035 1.8092 2.5075 2.3314.1275.5768-.3218.4554-.34-.0486-2.2039-1.6575-.85-.7468-1.9246-1.621h-.1275v.17l.4432.6496 2.3436 3.5214.1214 1.0807-.17.3521-.6071.2125-.6679-.1214-1.3721-1.9246L14.38 17.959l-1.1414-1.9428-.1397.079-.674 7.2552-.3156.3703-.7286.2793-.6071-.4614-.3218-.7468.3218-1.4753.3886-1.9246.3157-1.53.2853-1.9004.17-.6314-.0121-.0425-.1397.0182-1.4328 1.9672-2.1796 2.9446-1.7243 1.8456-.4128.164-.7164-.3704.0667-.6618.4008-.5889 2.386-3.0357 1.4389-1.882.929-1.0868-.0062-.1579h-.0546l-6.3385 4.1164-1.1293.1457-.4857-.4554.0608-.7467.2307-.2429 1.9064-1.3114Z"},null,-1)])],8,CO)):"codex"===e.type?(st(),Qe("svg",{key:1,viewBox:"0 0 24 24",fill:"currentColor",width:e.size,height:e.size},[...n[1]||(n[1]=[tt("path",{d:"M22.282 9.821a5.985 5.985 0 0 0-.516-4.91 6.046 6.046 0 0 0-6.51-2.9A6.065 6.065 0 0 0 4.981 4.18a5.985 5.985 0 0 0-3.998 2.9 6.046 6.046 0 0 0 .743 7.097 5.98 5.98 0 0 0 .51 4.911 6.051 6.051 0 0 0 6.515 2.9A5.985 5.985 0 0 0 13.26 24a6.056 6.056 0 0 0 5.772-4.206 5.99 5.99 0 0 0 3.997-2.9 6.056 6.056 0 0 0-.747-7.073zM13.26 22.43a4.476 4.476 0 0 1-2.876-1.04l.141-.081 4.779-2.758a.795.795 0 0 0 .392-.681v-6.737l2.02 1.168a.071.071 0 0 1 .038.052v5.583a4.504 4.504 0 0 1-4.494 4.494zM3.6 18.304a4.47 4.47 0 0 1-.535-3.014l.142.085 4.783 2.759a.771.771 0 0 0 .78 0l5.843-3.369v2.332a.08.08 0 0 1-.033.062L9.74 19.95a4.5 4.5 0 0 1-6.14-1.646zM2.34 7.896a4.485 4.485 0 0 1 2.366-1.973V11.6a.766.766 0 0 0 .388.676l5.815 3.355-2.02 1.168a.076.076 0 0 1-.071 0l-4.83-2.786A4.504 4.504 0 0 1 2.34 7.896zm16.597 3.855l-5.833-3.387L15.119 7.2a.076.076 0 0 1 .071 0l4.83 2.791a4.494 4.494 0 0 1-.676 8.105v-5.678a.79.79 0 0 0-.407-.667zm2.01-3.023l-.141-.085-4.774-2.782a.776.776 0 0 0-.785 0L9.409 9.23V6.897a.066.066 0 0 1 .028-.061l4.83-2.787a4.5 4.5 0 0 1 6.68 4.66zm-12.64 4.135l-2.02-1.164a.08.08 0 0 1-.038-.057V6.075a4.5 4.5 0 0 1 7.375-3.453l-.142.08L8.704 5.46a.795.795 0 0 0-.393.681zm1.097-2.365l2.602-1.5 2.607 1.5v2.999l-2.597 1.5-2.607-1.5z"},null,-1)])],8,TO)):(st(),Qe("svg",{key:2,viewBox:"0 0 24 24",fill:"currentColor",width:e.size,height:e.size},[...n[2]||(n[2]=[tt("path",{d:"M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13A2.5 2.5 0 0 0 5 15.5 2.5 2.5 0 0 0 7.5 18a2.5 2.5 0 0 0 2.5-2.5A2.5 2.5 0 0 0 7.5 13m9 0a2.5 2.5 0 0 0-2.5 2.5 2.5 2.5 0 0 0 2.5 2.5 2.5 2.5 0 0 0 2.5-2.5 2.5 2.5 0 0 0-2.5-2.5z"},null,-1)])],8,EO))],10,SO))}),[["__scopeId","data-v-6b6e1ec7"]]),xO=["title"],AO={class:"theme-icon"},NO=ju(Ze({__name:"ThemeSwitcher",setup(e){const t=Ge("system");let n=null;function s(){const e=hI.getCurrentTheme();if(!e)return!1;const t=e.background.replace("#","");return.2126*parseInt(t.substring(0,2),16)+.7152*parseInt(t.substring(2,4),16)+.0722*parseInt(t.substring(4,6),16)<128}const o=Ge(!1);ot(()=>{o.value=s(),t.value=hI.getThemeMode(),n=hI.onThemeChange(()=>{o.value=s(),t.value=hI.getThemeMode()})}),Xe(()=>{n?.()});const i=We(()=>"system"===t.value?"ðŸ–¥ï¸":o.value?"ðŸŒ™":"â˜€ï¸"),r=We(()=>`Theme: ${{system:"System",light:"Light",dark:"Dark"}[t.value]}`);function a(){hI.setTheme({system:"light",light:"dark",dark:"system"}[t.value])}return(e,t)=>(st(),Qe("button",{class:"theme-switcher icon-btn",type:"button",title:r.value,onClick:a},[tt("span",AO,ut(i.value),1)],8,xO))}}),[["__scopeId","data-v-270fe53b"]]),MO={class:"language-switcher"},RO=["title"],_O={class:"lang-code"},OO={class:"lang-label"},DO={key:0,class:"check-mark"},BO=ju(Ze({__name:"LanguageSwitcher",setup(e){const{locale:t}=Ye(),n=[{value:"zh-CN",label:"ä¸­æ–‡",code:"ä¸­"},{value:"en-US",label:"English",code:"EN"},{value:"ko-KR",label:"í•œêµ­ì–´",code:"í•œ"},{value:"ja-JP",label:"æ—¥æœ¬èªž",code:"æ—¥"}],s=We(()=>{const e=n.find(e=>e.value===t.value);return e?.code||"EN"}),o=We(()=>{const e=n.find(e=>e.value===t.value);return e?.label||"English"});function i(e){e!==t.value&&yn(e)}return(e,r)=>(st(),Qe("div",MO,[kt(ht(Ft),{trigger:"click",onCommand:i},{dropdown:St(()=>[kt(ht(Pt),null,{default:St(()=>[(st(),Qe(lt,null,ct(n,e=>kt(ht($t),{key:e.value,command:e.value,class:dt({active:ht(t)===e.value})},{default:St(()=>[tt("span",OO,ut(e.label),1),ht(t)===e.value?(st(),Qe("span",DO,"âœ“")):qe("",!0)]),_:2},1032,["command","class"])),64))]),_:1})]),default:St(()=>[tt("button",{class:"lang-btn",type:"button",title:o.value},[tt("span",_O,ut(s.value),1)],8,RO)]),_:1})]))}}),[["__scopeId","data-v-af69eb69"]]),LO={class:"mcp-popup"},FO={class:"popup-header"},PO={class:"popup-title"},$O={key:1,class:"popup-title"},UO={class:"popup-content"},VO={key:0,class:"empty-state"},WO={key:0,class:"loading-state"},GO={key:1,class:"error-state"},zO={key:2,class:"empty-state"},HO={key:3,class:"tool-list"},KO=["onClick"],jO={class:"tool-header"},YO={class:"tool-name"},ZO={key:0,class:"tool-details"},XO={class:"tool-info-row"},JO={class:"tool-full-name"},QO={class:"tool-info-row"},qO={class:"tool-description"},eD={class:"tool-params-section"},tD={key:0,class:"params-list"},nD={class:"param-name"},sD={class:"param-type"},oD={key:0,class:"param-desc"},iD={key:1,class:"param-default"},rD={key:1,class:"no-params"},aD={key:0,class:"empty-state"},lD={key:1,class:"server-list"},cD=["onClick"],uD={class:"server-name"},dD={class:"server-status"},pD=["onClick","disabled"],hD={key:0,width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},fD={key:1,class:"spinner"},mD={key:0,class:"arrow-icon",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},gD=ju(Ze({__name:"McpStatusPopup",props:{visible:{type:Boolean},servers:{},isConnected:{type:Boolean}},emits:["close"],setup(e,{emit:t}){const n=e,s=t,o=lu(),i=Ge(null),r=Ge([]),a=Ge(!1),l=Ge(null),c=Ge(null),u=Ge(null);function d(e){switch(e){case"connected":return"status-connected";case"sdk":return"status-sdk";case"failed":return"status-failed";default:return"status-unknown"}}async function p(e){if(console.log("[McpStatusPopup] selectServer:",e.name,"status:",e.status),"connected"===e.status){i.value=e.name,a.value=!0,r.value=[],c.value=null;try{const t=o.currentTab?.session;if(console.log("[McpStatusPopup] session:",t?"exists":"null","isConnected:",t?.isConnected),t?.isConnected){console.log("[McpStatusPopup] è°ƒç”¨ getMcpTools:",e.name);const n=await t.getMcpTools(e.name);console.log("[McpStatusPopup] getMcpTools ç»“æžœ:",n),r.value=n.tools}else c.value="Session æœªè¿žæŽ¥",console.warn("[McpStatusPopup] Session æœªè¿žæŽ¥ï¼Œæ— æ³•èŽ·å–å·¥å…·")}catch(t){console.error("[McpStatusPopup] Failed to get tools:",t),c.value=t instanceof Error?t.message:"èŽ·å–å·¥å…·å¤±è´¥"}finally{a.value=!1}}else console.log("[McpStatusPopup] æœåŠ¡å™¨çŠ¶æ€ä¸æ˜¯ connectedï¼Œè·³è¿‡")}function h(){i.value=null,r.value=[],l.value=null}function f(e){if(!e.inputSchema?.properties)return[];const t=new Set(e.inputSchema.required||[]);return Object.entries(e.inputSchema.properties).map(([e,n])=>({name:e,type:n.type||"any",required:t.has(e),description:n.description,default:n.default})).sort((e,t)=>e.required!==t.required?e.required?-1:1:e.name.localeCompare(t.name))}function m(){s("close")}return Ke(()=>n.visible,e=>{e||(i.value=null,r.value=[],l.value=null,c.value=null)}),(t,n)=>e.visible?(st(),Qe("div",{key:0,class:"mcp-popup-overlay",onClick:et(m,["self"])},[tt("div",LO,[tt("div",FO,[i.value?(st(),Qe(lt,{key:0},[tt("button",{class:"back-btn",onClick:h,title:"Back"},[...n[2]||(n[2]=[tt("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[tt("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1)])]),tt("span",PO,ut(i.value),1)],64)):(st(),Qe("span",$O,"MCP Servers")),tt("div",{class:"popup-actions"},[tt("button",{class:"close-btn",onClick:m,title:"Close"},"Ã—")])]),tt("div",UO,[e.isConnected?i.value?(st(),Qe(lt,{key:1},[a.value?(st(),Qe("div",WO," åŠ è½½ä¸­... ")):c.value?(st(),Qe("div",GO,[tt("span",null,ut(c.value),1),tt("button",{class:"retry-btn",onClick:n[0]||(n[0]=e=>p({name:i.value,status:"connected"}))},"é‡è¯•")])):0===r.value.length?(st(),Qe("div",zO,[n[3]||(n[3]=Nt(" No tools available ",-1)),tt("button",{class:"retry-btn",onClick:n[1]||(n[1]=e=>p({name:i.value,status:"connected"}))},"åˆ·æ–°")])):(st(),Qe("div",HO,[(st(!0),Qe(lt,null,ct(r.value,e=>(st(),Qe("div",{key:e.name,class:dt(["tool-item",{expanded:l.value===e.name}]),onClick:t=>{return n=e.name,void(l.value=l.value===n?null:n);var n}},[tt("div",jO,[tt("span",YO,ut(e.name),1),n[4]||(n[4]=tt("svg",{class:"expand-icon",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[tt("path",{d:"M6 9l6 6 6-6"})],-1))]),l.value===e.name?(st(),Qe("div",ZO,[tt("div",XO,[n[5]||(n[5]=tt("span",{class:"info-label"},"Full name:",-1)),tt("code",JO,"mcp__"+ut(i.value)+"__"+ut(e.name),1)]),tt("div",QO,[n[6]||(n[6]=tt("span",{class:"info-label"},"Description:",-1)),tt("p",qO,ut(e.description||"No description"),1)]),tt("div",eD,[n[7]||(n[7]=tt("span",{class:"info-label"},"Parameters:",-1)),f(e).length>0?(st(),Qe("div",tD,[(st(!0),Qe(lt,null,ct(f(e),e=>(st(),Qe("div",{key:e.name,class:"param-item"},[tt("span",nD,ut(e.name),1),tt("span",{class:dt(["param-required",{required:e.required}])}," ("+ut(e.required?"required":"optional")+") ",3),tt("span",sD,": "+ut(e.type),1),e.description?(st(),Qe("span",oD," - "+ut(e.description),1)):qe("",!0),void 0!==e.default?(st(),Qe("span",iD," [default: "+ut(JSON.stringify(e.default))+"] ",1)):qe("",!0)]))),128))])):(st(),Qe("div",rD,"No parameters defined"))])])):qe("",!0)],10,KO))),128))]))],64)):(st(),Qe(lt,{key:2},[0===e.servers.length?(st(),Qe("div",aD," No MCP servers configured ")):(st(),Qe("div",lD,[(st(!0),Qe(lt,null,ct(e.servers,e=>(st(),Qe("div",{key:e.name,class:dt(["server-item",{clickable:"connected"===e.status}]),onClick:t=>p(e)},[tt("span",{class:dt(["status-dot",d(e.status)])},null,2),tt("span",uD,ut(e.name),1),tt("span",dD,ut(e.status),1),tt("button",{class:dt(["reconnect-btn",{loading:u.value===e.name}]),onClick:et(t=>async function(e){console.log("[McpStatusPopup] reconnectServer:",e.name),u.value=e.name;try{const t=o.currentTab?.session;if(!t?.isConnected)return void console.warn("[McpStatusPopup] Session æœªè¿žæŽ¥ï¼Œæ— æ³•é‡è¿ž MCP");const n=await t.reconnectMcp(e.name);console.log("[McpStatusPopup] reconnectMcp ç»“æžœ:",n),n.success&&i.value===e.name&&await p({...e,status:"connected"})}catch(t){console.error("[McpStatusPopup] Failed to reconnect:",t)}finally{u.value=null}}(e),["stop"]),disabled:null!==u.value,title:"é‡è¿ž"},[u.value!==e.name?(st(),Qe("svg",hD,[...n[8]||(n[8]=[tt("path",{d:"M1 4v6h6M23 20v-6h-6"},null,-1),tt("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"},null,-1)])])):(st(),Qe("span",fD))],10,pD),"connected"===e.status?(st(),Qe("svg",mD,[...n[9]||(n[9]=[tt("path",{d:"M9 18l6-6-6-6"},null,-1)])])):qe("",!0)],10,cD))),128))]))],64)):(st(),Qe("div",VO," æœªè¿žæŽ¥ "))])])])):qe("",!0)}}),[["__scopeId","data-v-84bcb51a"]]),yD={class:"backend-selector"},vD={class:"selector-container"},bD=["value"],kD=["value"],wD={key:0,class:"info-message"},SD={key:1,class:"backend-info"},CD={class:"backend-details"},TD={class:"backend-name"},ED={class:"backend-description"},ID=ju(Ze({__name:"BackendSelector",props:{modelValue:{},isSessionActive:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const n=t,s=We(()=>Wl());function o(e){const t=e.target;n("update:modelValue",t.value)}function i(e){const t=Vl(e);return e===ml?"Anthropic Claude - å¼ºå¤§çš„ä»£ç åŠ©æ‰‹ï¼Œæ”¯æŒæ‰©å±•æ€è€ƒå’Œå­ä»»åŠ¡":e===gl?"OpenAI Codex - ä»£ç ç”Ÿæˆä¸“å®¶ï¼Œæ”¯æŒæ²™ç›’æ¨¡å¼":t.displayName}return(t,n)=>(st(),Qe("div",yD,[n[1]||(n[1]=tt("div",{class:"selector-label"},"åŽç«¯é€‰æ‹©",-1)),tt("div",vD,[tt("select",{value:e.modelValue,onChange:o,class:"backend-select"},[(st(!0),Qe(lt,null,ct(s.value,e=>(st(),Qe("option",{key:e,value:e},ut(ht(Gl)(e)),9,kD))),128))],40,bD)]),e.isSessionActive?(st(),Qe("div",wD,[...n[0]||(n[0]=[tt("span",{class:"info-icon"},"â„¹ï¸",-1),tt("span",null,"åˆ‡æ¢åŽç«¯å°†é‡ç½®å½“å‰ä¼šè¯",-1)])])):qe("",!0),e.modelValue?(st(),Qe("div",SD,[kt(IO,{type:e.modelValue,size:24,class:"backend-icon-svg"},null,8,["type"]),tt("div",CD,[tt("div",TD,ut(ht(Gl)(e.modelValue)),1),tt("div",ED,ut(i(e.modelValue)),1)])])):qe("",!0)]))}}),[["__scopeId","data-v-757a5c8e"]]),xD={class:"dialog-container"},AD={class:"dialog-body"},ND=ju(Ze({__name:"NewSessionDialog",props:{isSessionActive:{type:Boolean,default:!1},currentBackend:{}},emits:["confirm","cancel"],setup(e,{emit:t}){const n=e,s=t,o=Ge(n.currentBackend);function i(){s("confirm",o.value)}function r(){s("cancel")}return Ke(()=>n.currentBackend,e=>{o.value=e}),(t,n)=>(st(),Qe("div",{class:"dialog-overlay",onClick:et(r,["self"])},[tt("div",xD,[tt("div",{class:"dialog-header"},[n[1]||(n[1]=tt("h3",{class:"dialog-title"},"æ–°å»ºä¼šè¯",-1)),tt("button",{class:"close-btn",type:"button",onClick:r}," Ã— ")]),tt("div",AD,[kt(ID,{modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=e=>o.value=e),"is-session-active":e.isSessionActive},null,8,["modelValue","is-session-active"])]),tt("div",{class:"dialog-footer"},[tt("button",{class:"btn btn-secondary",type:"button",onClick:r}," å–æ¶ˆ "),tt("button",{class:"btn btn-primary",type:"button",onClick:i}," ç¡®è®¤ ")])])]))}}),[["__scopeId","data-v-03307dde"]]),MD={class:"chat-header"},RD={class:"header-actions"},_D={key:0,class:"backend-menu"},OD=["onClick"],DD={key:0,class:"check-mark"},BD=ju(Ze({__name:"ChatHeader",emits:["toggle-history"],setup(e,{emit:t}){const n=Ge(!1),s=Ge(null),o=Ge(!1),i=Ge(!1),r=We(()=>Wl());function a(){i.value=!i.value}function l(e){e.target.closest(".backend-switcher")||(i.value=!1)}function c(){n.value=!1,s.value=null}ot(()=>{document.addEventListener("click",l)}),ft(()=>{document.removeEventListener("click",l)}),Ke(n,async e=>{if(e&&d.currentTab?.session?.isConnected){s.value=[];try{const e=await d.currentTab.session.getMcpStatus();s.value=e.servers,console.log("ðŸ”Œ getMcpStatus result:",e)}catch(t){console.error("[ChatHeader] getMcpStatus failed:",t)}}});const u=t,d=lu(),p=yu(),h=We(()=>d.activeTabs),f=We(()=>d.currentTabId),m=We(()=>d.currentTab?.backendType.value??ml),g=We(()=>{const e=d.currentTab;if(!e)return!1;const t=e.connectionState.status;return t===hl.CONNECTING||t===hl.CONNECTED}),y=We(()=>null!==s.value?s.value:d.currentTab?.mcpServers.value??[]),v=We(()=>d.currentTab?.connectionState.status===hl.CONNECTED),b=We(()=>h.value.map(e=>({id:e.tabId,name:e.name.value,sessionId:e.sessionId.value,resumeFromSessionId:e.resumeFromSessionId?.value??null,isGenerating:e.isGenerating.value,isConnected:e.connectionState.status===hl.CONNECTED,connectionStatus:e.connectionState.status,error:e.connectionState.lastError,backendType:e.backendType?.value??ml})));async function k(e){e!==f.value&&await d.switchTab(e)}async function w(e){if(h.value.length<=1)await d.resetCurrentTab();else{if(e===f.value){const t=h.value.find(t=>t.tabId!==e);t&&await d.switchTab(t.tabId)}await d.closeTab(e)}}function S(){o.value=!0}async function C(e){o.value=!1;const t=d.currentTab,n=t?.isGenerating.value??!1,s=t?.connectionState.status===hl.CONNECTING;n||s?await d.createTab({backendType:e}):(e!==m.value&&await d.switchTabBackend(t,e),await d.resetCurrentTab())}function T(){o.value=!1}function E(e){d.updateTabOrder(e)}function I(e,t){const n=h.value.find(t=>t.tabId===e);n&&(n.rename(t),n.session?.isConnected?n.sendTextMessageDirect(`/rename ${t}`).then(()=>{p.success(`Rename success: "${t}"`)}).catch(e=>{console.error("[ChatHeader] å‘é€ /rename å‘½ä»¤å¤±è´¥:",e),p.error("Rename failed")}):p.success(`Rename success: "${t}"`))}return(e,t)=>(st(),Qe("div",MD,[kt(wO,{sessions:b.value,"current-session-id":f.value,"can-close":!0,onSwitch:k,onClose:w,onReorder:E,onToggleList:t[0]||(t[0]=e=>u("toggle-history")),onRename:I},null,8,["sessions","current-session-id"]),tt("div",RD,[tt("button",{class:"icon-btn",type:"button",title:"History",onClick:t[1]||(t[1]=e=>u("toggle-history"))}," ðŸ“‹ "),tt("button",{class:"new-session-btn",type:"button",title:"New Session",onClick:S},[...t[3]||(t[3]=[tt("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[tt("path",{d:"M7 1v12M1 7h12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)])]),tt("div",{class:"backend-switcher",onClick:a},[kt(IO,{type:m.value,size:16},null,8,["type"]),t[4]||(t[4]=tt("svg",{class:"dropdown-arrow",width:"8",height:"8",viewBox:"0 0 8 8",fill:"currentColor"},[tt("path",{d:"M1 2.5L4 5.5L7 2.5",stroke:"currentColor","stroke-width":"1.5",fill:"none","stroke-linecap":"round"})],-1)),i.value?(st(),Qe("div",_D,[(st(!0),Qe(lt,null,ct(r.value,e=>(st(),Qe("div",{key:e,class:dt(["backend-menu-item",{active:e===m.value}]),onClick:et(t=>async function(e){if(i.value=!1,e===m.value)return;const t=d.currentTab;t&&(await d.switchTabBackend(t,e),await d.resetCurrentTab(),p.success(`å·²åˆ‡æ¢åˆ° ${Gl(e)}`))}(e),["stop"])},[kt(IO,{type:e,size:14},null,8,["type"]),tt("span",null,ut(ht(Gl)(e)),1),e===m.value?(st(),Qe("span",DD,"âœ“")):qe("",!0)],10,OD))),128))])):qe("",!0)]),tt("button",{class:"icon-btn server-btn",type:"button",title:"MCP Servers",onClick:t[2]||(t[2]=e=>n.value=!0)},[...t[5]||(t[5]=[Ut('<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-dcd09c06><rect x="2" y="2" width="20" height="8" rx="2" data-v-dcd09c06></rect><rect x="2" y="14" width="20" height="8" rx="2" data-v-dcd09c06></rect><circle cx="6" cy="6" r="1" fill="currentColor" data-v-dcd09c06></circle><circle cx="6" cy="18" r="1" fill="currentColor" data-v-dcd09c06></circle></svg>',1)])]),kt(NO),kt(BO)]),kt(gD,{visible:n.value,servers:y.value,"is-connected":v.value,onClose:c},null,8,["visible","servers","is-connected"]),o.value?(st(),Je(ND,{key:0,"is-session-active":g.value,"current-backend":m.value,onConfirm:C,onCancel:T},null,8,["is-session-active","current-backend"])):qe("",!0)]))}}),[["__scopeId","data-v-dcd09c06"]]),LD={key:0,class:"session-overlay"},FD={class:"overlay-panel"},PD={class:"overlay-header"},$D={class:"overlay-title"},UD={class:"session-count"},VD=["aria-label"],WD={class:"overlay-body"},GD={key:0,class:"state-block"},zD={key:1,class:"state-block empty"},HD={class:"session-group"},KD={class:"session-group-header"},jD={key:0,class:"session-group-empty"},YD=["title","onClick"],ZD={class:"session-item-main"},XD={class:"session-name"},JD={key:0,class:"session-current-mark"},QD={class:"session-meta"},qD={class:"session-group"},eB={class:"session-group-header"},tB={key:0,class:"session-group-empty"},nB=["title","onClick"],sB={class:"session-item-main"},oB={class:"session-name"},iB={class:"session-meta"},rB={class:"session-item-actions"},aB=["title","onClick"],lB=["title","onClick"],cB={class:"session-list-footer"},uB={key:0,class:"loading-text"},dB={key:2,class:"scroll-hint"},pB={key:3,class:"no-more-text"},hB=ju(Ze({__name:"SessionListOverlay",props:{visible:{type:Boolean},sessions:{},currentSessionId:{default:null},loading:{type:Boolean,default:!1},loadingMore:{type:Boolean,default:!1},hasMore:{type:Boolean,default:!0}},emits:["close","select-session","load-more","delete-session"],setup(e,{emit:t}){const{t:n}=Ye(),s=e,o=t,i=We(()=>s.sessions.filter(e=>e.isActive||e.isConnected)),r=We(()=>new Set(i.value.map(e=>e.id))),a=We(()=>s.sessions.filter(e=>!r.value.has(e.id)&&e.id!==s.currentSessionId));function l(){o("close")}function c(e){o("select-session",e)}function u(e){const t=Date.now()-e,s=Math.floor(t/6e4),o=Math.floor(t/36e5),i=Math.floor(t/864e5);return s<1?n("time.justNow"):s<60?n("time.minutesAgo",{n:s}):o<24?n("time.hoursAgo",{n:o}):i<7?n("time.daysAgo",{n:i}):new Date(e).toLocaleDateString(void 0,{month:"short",day:"numeric"})}function d(e){"Escape"===e.key&&s.visible&&o("close")}const p=Ge(null),h=Ge(!1);function f(){const e=p.value;h.value=!!e&&e.scrollHeight>e.clientHeight+10}function m(){if(!s.hasMore||s.loading||s.loadingMore)return;const e=p.value;if(!e)return;e.scrollHeight-e.scrollTop-e.clientHeight<160&&o("load-more")}return Ke(()=>s.visible,e=>{e?(window.addEventListener("keydown",d),pt(()=>{p.value?.addEventListener("scroll",m,{passive:!0}),f()})):(window.removeEventListener("keydown",d),p.value?.removeEventListener("scroll",m))},{immediate:!0}),Ke(()=>s.sessions.length,()=>{pt(f)}),ft(()=>{window.removeEventListener("keydown",d),p.value?.removeEventListener("scroll",m)}),(t,n)=>(st(),Je(nt,{to:"body"},[kt(Dt,{name:"session-overlay"},{default:St(()=>[e.visible?(st(),Qe("div",LD,[tt("div",{class:"overlay-backdrop",onClick:l}),tt("div",FD,[tt("div",PD,[tt("h3",$D,[Nt(ut(t.$t("session.history"))+" ",1),tt("span",UD,"("+ut(a.value.length)+")",1)]),tt("button",{class:"close-btn",type:"button","aria-label":t.$t("common.close"),onClick:l},"âœ•",8,VD)]),tt("div",WD,[e.loading?(st(),Qe("div",GD,[n[1]||(n[1]=tt("span",{class:"spinner"},null,-1)),tt("span",null,ut(t.$t("common.loading")),1)])):0===e.sessions.length?(st(),Qe("div",zD,[n[2]||(n[2]=tt("span",{class:"empty-icon"},"ðŸ“­",-1)),tt("span",null,ut(t.$t("session.noHistory")),1)])):(st(),Qe("div",{key:2,ref_key:"sessionListRef",ref:p,class:"session-list"},[tt("div",HD,[tt("div",KD,ut(t.$t("session.active")),1),0===i.value.length?(st(),Qe("div",jD,ut(t.$t("session.noActive")),1)):qe("",!0),(st(!0),Qe(lt,null,ct(i.value,s=>(st(),Qe("button",{key:s.id,type:"button",class:dt(["session-item",{active:s.id===e.currentSessionId}]),title:s.id,onClick:e=>c(s.id)},[n[4]||(n[4]=tt("span",{class:"session-status-icon active"},"ðŸŸ¢",-1)),tt("div",ZD,[tt("div",XD,[tt("span",null,ut(s.name||t.$t("session.unnamed")),1),s.id===e.currentSessionId?(st(),Qe("span",JD,"âœ“")):qe("",!0)]),tt("div",QD,[tt("span",null,ut(u(s.timestamp)),1),n[3]||(n[3]=tt("span",null,"Â·",-1)),tt("span",null,ut(s.messageCount)+" "+ut(t.$t("session.messages")),1)])])],10,YD))),128))]),tt("div",qD,[tt("div",eB,ut(t.$t("session.historySection")),1),0===a.value.length?(st(),Qe("div",tB,ut(t.$t("session.noHistory")),1)):qe("",!0),(st(!0),Qe(lt,null,ct(a.value,s=>(st(),Qe("div",{key:s.id,class:"session-item-wrapper"},[tt("button",{type:"button",class:dt(["session-item",{active:s.id===e.currentSessionId}]),title:s.id,onClick:e=>c(s.id)},[n[6]||(n[6]=tt("span",{class:"session-status-icon history"},"ðŸ“",-1)),tt("div",sB,[tt("div",oB,[tt("span",null,ut(s.name||t.$t("session.unnamed")),1)]),tt("div",iB,[tt("span",null,ut(u(s.timestamp)),1),n[5]||(n[5]=tt("span",null,"Â·",-1)),tt("span",null,ut(s.messageCount)+" "+ut(t.$t("session.messages")),1)])])],10,nB),tt("div",rB,[tt("button",{type:"button",class:"item-action-btn copy-btn",title:t.$t("common.copySessionId"),onClick:et(e=>async function(e){try{await navigator.clipboard.writeText(e)}catch(t){console.error("Failed to copy sessionId:",t)}}(s.id),["stop"])},[...n[7]||(n[7]=[tt("svg",{viewBox:"0 0 24 24",width:"14",height:"14",fill:"none",stroke:"currentColor","stroke-width":"2"},[tt("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),tt("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1)])],8,aB),tt("button",{type:"button",class:"item-action-btn delete-btn",title:t.$t("common.delete"),onClick:et(e=>{return t=s.id,void o("delete-session",t);var t},["stop"])},[...n[8]||(n[8]=[tt("svg",{viewBox:"0 0 24 24",width:"14",height:"14",fill:"none",stroke:"currentColor","stroke-width":"2"},[tt("polyline",{points:"3 6 5 6 21 6"}),tt("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,lB)])]))),128))]),tt("div",cB,[e.loadingMore?(st(),Qe("span",uB,[n[9]||(n[9]=tt("span",{class:"footer-spinner"},null,-1)),Nt(" "+ut(t.$t("common.loading")),1)])):e.hasMore&&!h.value?(st(),Qe("button",{key:1,type:"button",class:"load-more-btn",onClick:n[0]||(n[0]=e=>o("load-more"))},ut(t.$t("session.loadMore")),1)):e.hasMore&&h.value?(st(),Qe("span",dB,ut(t.$t("session.scrollToLoadMore")),1)):(st(),Qe("span",pB,ut(t.$t("common.noMore")),1))])],512))])])])):qe("",!0)]),_:1})]))}}),[["__scopeId","data-v-8e4bd15f"]]),fB={key:0,class:"pending-queue"},mB={class:"queue-header"},gB={class:"queue-title"},yB={class:"queue-list"},vB={class:"item-index"},bB={class:"item-content"},kB=["src","onClick"],wB={key:1,class:"item-text"},SB={class:"item-actions"},CB=["title","onClick"],TB=["title","onClick"],EB=["title","onClick"],IB=["src"],xB=ju(Ze({__name:"PendingMessageQueue",emits:["edit","remove","force-send"],setup(e,{emit:t}){const{t:n}=cu(),s=lu(),o=We(()=>s.messageQueue),i=t,r=Ge(null);function a(){r.value=null}function l(e){const t=[];if(e.ideContext){const n=e.ideContext,s=function(e){const t=e.replace(/\\/g,"/").split("/");return t[t.length-1]||e}(n.relativePath);if(n.hasSelection&&n.startLine&&n.endLine){const e=n.startColumn||1,o=n.endColumn||1;t.push({type:"text",text:`[${s}:${n.startLine}:${e}-${n.endLine}:${o}]`})}else if(n.line){const e=n.column||1;t.push({type:"text",text:`[${s}:${n.line}:${e}]`})}else t.push({type:"text",text:`[${s}]`})}if(e.contexts?.length)for(const n of e.contexts)if("file"===n.type){const e=n.uri?.split("/").pop()||n.uri;t.push({type:"text",text:`[@${e}]`})}else if("image"===n.type&&n.base64Data){const e=n.mimeType||"image/png";t.push({type:"image",src:`data:${e};base64,${n.base64Data}`})}for(const n of e.contents)if("text"===n.type&&"text"in n){const e=n.text.trim();e&&t.push({type:"text",text:e})}else if("image"===n.type&&"source"in n){const e=n.source;if("base64"===e?.type&&e.data){const n=e.media_type||"image/png";t.push({type:"image",src:`data:${n};base64,${e.data}`})}}return 0===t.length&&t.push({type:"text",text:"(ç©ºæ¶ˆæ¯)"}),t}return(e,t)=>o.value.length>0?(st(),Qe("div",fB,[tt("div",mB,[t[1]||(t[1]=tt("span",{class:"queue-icon"},"ðŸ“‹",-1)),tt("span",gB,ut(ht(n)("chat.pendingQueue",{count:o.value.length})),1)]),tt("div",yB,[(st(!0),Qe(lt,null,ct(o.value,(e,s)=>(st(),Qe("div",{key:e.id,class:"queue-item"},[tt("span",vB,ut(s+1)+".",1),tt("div",bB,[(st(!0),Qe(lt,null,ct(l(e),(e,t)=>(st(),Qe(lt,{key:t},["image"===e.type?(st(),Qe("img",{key:0,src:e.src,class:"item-image-thumb",alt:"å›¾ç‰‡",onClick:t=>{return n=e.src,void(r.value=n);var n}},null,8,kB)):(st(),Qe("span",wB,ut(e.text),1))],64))),128))]),tt("div",SB,[tt("button",{class:"action-btn force-send-btn",title:ht(n)("chat.interruptAndSend"),onClick:t=>i("force-send",e.id)},[...t[2]||(t[2]=[tt("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"},[tt("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),tt("polyline",{points:"5 12 12 5 19 12"})],-1)])],8,CB),tt("button",{class:"action-btn edit-btn",title:ht(n)("common.edit"),onClick:t=>i("edit",e.id)},[...t[3]||(t[3]=[tt("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[tt("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),tt("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,TB),tt("button",{class:"action-btn delete-btn",title:ht(n)("common.delete"),onClick:t=>i("remove",e.id)},[...t[4]||(t[4]=[Ut('<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-17700cd9><polyline points="3 6 5 6 21 6" data-v-17700cd9></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" data-v-17700cd9></path><line x1="10" y1="11" x2="10" y2="17" data-v-17700cd9></line><line x1="14" y1="11" x2="14" y2="17" data-v-17700cd9></line></svg>',1)])],8,EB)])]))),128))]),r.value?(st(),Qe("div",{key:0,class:"image-preview-overlay",onClick:a},[tt("button",{class:"preview-close-btn",onClick:a},"Ã—"),tt("img",{src:r.value,class:"preview-image",alt:"é¢„è§ˆå›¾ç‰‡",onClick:t[0]||(t[0]=et(()=>{},["stop"]))},null,8,IB)])):qe("",!0)])):qe("",!0)}}),[["__scopeId","data-v-17700cd9"]]),AB={class:"compacting-card"},NB={class:"text"},MB=ju(Ze({__name:"CompactingCard",setup:e=>(e,t)=>(st(),Qe("div",AB,[t[0]||(t[0]=tt("div",{class:"spinner"},null,-1)),tt("span",NB,ut(e.$t("compact.compacting")),1)]))}),[["__scopeId","data-v-36eea99e"]]),RB={class:"permission-card"},_B={class:"permission-header"},OB={class:"tool-icon"},DB={class:"tool-name"},BB={class:"permission-label"},LB={class:"permission-content"},FB={key:0,class:"command-preview"},PB={class:"file-info"},$B={class:"file-path"},UB={key:0,class:"content-preview"},VB={class:"content-text"},WB={class:"file-info"},GB={class:"file-path"},zB={key:0,class:"edit-preview"},HB={class:"edit-section"},KB={class:"edit-label"},jB={class:"edit-text old"},YB={class:"edit-section"},ZB={class:"edit-label"},XB={class:"edit-text new"},JB={class:"file-info"},QB={class:"file-path"},qB={class:"multi-edit-info"},eL={class:"edit-count"},tL={class:"plan-info"},nL={class:"plan-label"},sL={key:0,class:"plan-expanded-content"},oL={key:1,class:"plan-error"},iL={key:0,class:"params-preview"},rL={key:1,class:"no-params-hint"},aL={class:"permission-options"},lL=["onClick"],cL={class:"deny-inline"},uL=["placeholder"],dL={class:"shortcut-hint"},pL=ju(Ze({__name:"ToolPermissionInteractive",setup(e){const{t:t}=cu(),n=lu(),s=Ge(null),o=Ge(""),i=Ge(!1),r=We(()=>c.value&&c.value.input.plan||"");function a(){i.value=!i.value}async function l(){if(!r.value)return;await uI.showMarkdown({content:r.value,title:t("permission.planPreviewTitle")})||console.warn("[ToolPermission] Failed to open plan in IDEA")}const c=We(()=>{const e=n.getCurrentPendingPermissions();return e.length>0?e[0]:null}),u=We(()=>"ExitPlanMode"===c.value?.toolName);async function d(e){if(c.value){n.respondPermission(c.value.id,{approved:!0});const t=n.currentTab;t&&(await t.setPermissionMode(e),"bypassPermissions"===e&&(t.skipPermissions.value=!0))}}function p(){c.value&&n.respondPermission(c.value.id,{approved:!1,denyReason:o.value||void 0})}async function h(){if(!c.value)return;const e=c.value.input;await uI.showEditPreviewDiff({filePath:e.file_path||"",edits:[{oldString:e.old_string||"",newString:e.new_string||"",replaceAll:e.replace_all||!1}],title:`${t("permission.editPreviewTitle")}: ${e.file_path}`})||console.warn("[ToolPermission] Failed to show edit preview")}async function f(){if(!c.value)return;const e=c.value.input;if(!e.file_path||!e.edits)return;await uI.showEditPreviewDiff({filePath:e.file_path,edits:e.edits.map(e=>({oldString:e.old_string||"",newString:e.new_string||"",replaceAll:e.replace_all||!1})),title:`${t("permission.multiEditPreviewTitle")}: ${e.file_path}`})||console.warn("[ToolPermission] Failed to show multi-edit preview")}function m(e){return{Bash:"Terminal",Write:"Write File",Edit:"Edit File",Read:"Read File",MultiEdit:"Multi Edit",Glob:"Find Files",Grep:"Search Content"}[e]||e}function g(e,t=200){return e?e.length<=t?e:e.substring(0,t)+"...":""}function y(e){try{return JSON.stringify(e,null,2)}catch{return String(e)}}return Ke(c,e=>{e&&(o.value="",pt(()=>{s.value?.focus()}))}),(e,v)=>{return c.value?(st(),Qe("div",{key:0,ref_key:"containerRef",ref:s,class:"permission-request",tabindex:"0",onKeydown:Lt(p,["esc"])},[tt("div",RB,[tt("div",_B,[tt("span",OB,ut((k=c.value.toolName,{Bash:"ðŸ–¥",Write:"ðŸ“",Edit:"âœï¸",Read:"ðŸ“–",MultiEdit:"ðŸ“‹",Glob:"ðŸ”",Grep:"ðŸ”Ž"}[k]||"ðŸ”§")),1),tt("span",DB,ut(m(c.value.toolName)||c.value.toolName||"Unknown Tool"),1),tt("span",BB,ut(ht(t)("permission.needsAuth")),1)]),tt("div",LB,["Bash"===c.value.toolName?(st(),Qe("pre",FB,ut(c.value.input.command),1)):"Write"===c.value.toolName?(st(),Qe(lt,{key:1},[tt("div",PB,[v[4]||(v[4]=tt("span",{class:"file-icon"},"ðŸ“„",-1)),tt("span",$B,ut(c.value.input.file_path),1)]),c.value.input.content?(st(),Qe("div",UB,[tt("pre",VB,ut(g(c.value.input.content)),1)])):qe("",!0)],64)):"Edit"===c.value.toolName?(st(),Qe(lt,{key:2},[tt("div",WB,[v[5]||(v[5]=tt("span",{class:"file-icon"},"âœï¸",-1)),tt("span",GB,ut(c.value.input.file_path),1),ht(lI)()?(st(),Qe("button",{key:0,class:"btn-preview",onClick:h},ut(ht(t)("permission.viewInIdea")),1)):qe("",!0)]),c.value.input.old_string?(st(),Qe("div",zB,[tt("div",HB,[tt("span",KB,ut(ht(t)("permission.replace"))+":",1),tt("pre",jB,ut(g(c.value.input.old_string)),1)]),tt("div",YB,[tt("span",ZB,ut(ht(t)("permission.with"))+":",1),tt("pre",XB,ut(g(c.value.input.new_string||"")),1)])])):qe("",!0)],64)):"MultiEdit"===c.value.toolName?(st(),Qe(lt,{key:3},[tt("div",JB,[v[6]||(v[6]=tt("span",{class:"file-icon"},"ðŸ“‹",-1)),tt("span",QB,ut(c.value.input.file_path),1),ht(lI)()?(st(),Qe("button",{key:0,class:"btn-preview",onClick:f},ut(ht(t)("permission.viewInIdea")),1)):qe("",!0)]),tt("div",qB,[tt("span",eL,ut(c.value.input.edits?.length||0)+" "+ut(ht(t)("permission.edits")),1)])],64)):u.value?(st(),Qe(lt,{key:4},[tt("div",tL,[v[7]||(v[7]=tt("span",{class:"plan-icon"},"ðŸ“‹",-1)),tt("span",nL,ut(ht(t)("permission.planReady")),1),tt("button",{class:"btn-preview",onClick:a},ut(i.value?ht(t)("permission.collapse"):ht(t)("permission.expand")),1),ht(lI)()&&r.value?(st(),Qe("button",{key:0,class:"btn-preview",onClick:l},ut(ht(t)("permission.viewInIdea")),1)):qe("",!0)]),i.value&&r.value?(st(),Qe("div",sL,[kt(gI,{content:r.value},null,8,["content"])])):i.value&&!r.value?(st(),Qe("div",oL,ut(ht(t)("permission.noPlanContent")),1)):qe("",!0)],64)):(st(),Qe(lt,{key:5},[(b=c.value.input,b&&Object.keys(b).length>0?(st(),Qe("pre",iL,ut(y(c.value.input)),1)):(st(),Qe("div",rL,ut(ht(t)("permission.noParams")),1)))],64))]),tt("div",aL,[tt("button",{class:"btn-option btn-allow",onClick:v[0]||(v[0]=e=>u.value?d("default"):void(c.value&&n.respondPermission(c.value.id,{approved:!0})))},ut(ht(t)("permission.allow")),1),u.value?(st(),Qe(lt,{key:0},[tt("button",{class:"btn-option btn-allow-rule",onClick:v[1]||(v[1]=e=>d("acceptEdits"))}," Allow, with Accept Edits "),tt("button",{class:"btn-option btn-allow-rule",onClick:v[2]||(v[2]=e=>d("bypassPermissions"))}," Allow, with Bypass ")],64)):qe("",!0),(st(!0),Qe(lt,null,ct(c.value.permissionSuggestions,(e,s)=>(st(),Qe("button",{key:s,class:"btn-option btn-allow-rule",onClick:t=>function(e){if(c.value){if("setMode"===e.type&&e.mode&&(n.setLocalPermissionMode(e.mode),"bypassPermissions"===e.mode)){const e=n.currentTab;e&&(e.skipPermissions.value=!0)}n.respondPermission(c.value.id,{approved:!0,permissionUpdates:[e]})}}(e)},ut(ht(t)("permission.allow"))+"ï¼Œ"+ut(function(e){const n=t(`permission.destination.${e.destination||"session"}`);switch(e.type){case"addRules":if(e.rules?.length){const s=e.rules[0];return s.ruleContent?t("permission.suggestion.rememberWithRuleTo",{tool:s.toolName,rule:s.ruleContent,dest:n}):t("permission.suggestion.rememberTo",{tool:s.toolName,dest:n})}break;case"replaceRules":return t("permission.suggestion.replaceTo",{dest:n});case"removeRules":return e.rules?.length?t("permission.suggestion.removeFrom",{tool:e.rules[0].toolName,dest:n}):t("permission.suggestion.removeRulesFrom",{dest:n});case"setMode":{const n=t(`permission.mode.${e.mode||"default"}`);return t("permission.suggestion.switchTo",{mode:n})}case"addDirectories":if(e.directories?.length)return t("permission.suggestion.addDirTo",{dir:e.directories[0],dest:n});break;case"removeDirectories":if(e.directories?.length)return t("permission.suggestion.removeDirFrom",{dir:e.directories[0],dest:n})}return t("permission.suggestion.applyTo",{dest:n})}(e)),9,lL))),128)),tt("div",cL,[rt(tt("input",{"onUpdate:modelValue":v[3]||(v[3]=e=>o.value=e),class:"deny-input",placeholder:ht(t)("permission.denyReasonPlaceholder"),onKeydown:Lt(p,["enter"])},null,40,uL),[[at,o.value]]),tt("button",{class:"btn-option btn-deny",onClick:p},ut(ht(t)("permission.deny")),1)])]),tt("div",dL,ut(ht(t)("permission.escToDeny")),1)])],544)):qe("",!0);var b,k}}}),[["__scopeId","data-v-e1328066"]]),hL={key:0,class:"ask-user-container"},fL={class:"ask-user-card"},mL={class:"ask-user-header"},gL={class:"ask-user-title"},yL={class:"questions-container"},vL={class:"question-label"},bL={class:"question-header-tag"},kL={class:"question-text"},wL={class:"options-container"},SL={class:"checkbox-indicator"},CL=["checked","onChange"],TL={class:"option-content"},EL={class:"option-label"},IL={key:0,class:"option-description"},xL={class:"option-item option-other-multi"},AL={class:"checkbox-indicator"},NL=["onUpdate:modelValue","placeholder","onInput"],ML=["onClick"],RL={class:"radio-indicator"},_L={class:"option-content"},OL={class:"option-label"},DL={key:0,class:"option-description"},BL={class:"option-item option-other-single"},LL={class:"radio-indicator"},FL=["onUpdate:modelValue","placeholder","onFocus","onKeydown"],PL=["onClick"],$L={class:"ask-user-actions"},UL=["disabled"],VL=ju(Ze({__name:"AskUserQuestionInteractive",setup(e){const t=lu(),n=e=>e.header||e.question,s=We(()=>{const e=t.getCurrentPendingQuestions();return e.length>0?e[0]:null}),o=Ve({}),i=Ve({}),r=Ve({}),a=Ve({}),l=Ve({}),c=We(()=>s.value?.questions.some(e=>e.multiSelect)??!1);function u(e){a[e]?.trim()&&(o[e]=a[e].trim(),c.value||f())}function d(e,t){return i[e]?.includes(t)??!1}function p(e){const t=[...i[e]||[]],n=l[e]?.trim();n&&t.push(n),o[e]=t.join(", ")}Ke(s,e=>{e&&(Object.keys(o).forEach(e=>delete o[e]),Object.keys(i).forEach(e=>delete i[e]),Object.keys(r).forEach(e=>delete r[e]),Object.keys(a).forEach(e=>delete a[e]),Object.keys(l).forEach(e=>delete l[e]),e.questions.forEach(e=>{e.multiSelect&&(i[n(e)]=[])}))});const h=We(()=>!!s.value&&s.value.questions.every(e=>{const t=n(e),s=o[t];return s&&s.trim().length>0}));function f(){if(!s.value)return;if(!(Object.keys(o).length>0))return;const e={};for(const t of s.value.questions){const s=n(t),i=o[s];i&&(e[t.question]=i)}t.answerQuestion(s.value.id,e)}function m(){s.value&&t.cancelQuestion(s.value.id)}return(e,t)=>s.value?(st(),Qe("div",hL,[tt("div",fL,[tt("div",mL,[t[0]||(t[0]=tt("span",{class:"ask-user-icon"},"â“",-1)),tt("span",gL,ut(e.$t("askUser.title","Claude éœ€è¦æ‚¨çš„å›žç­”")),1)]),tt("div",yL,[(st(!0),Qe(lt,null,ct(s.value.questions,(t,h)=>(st(),Qe("div",{key:h,class:"question-block"},[tt("div",vL,[tt("span",bL,ut(t.header),1),tt("span",kL,ut(t.question),1)]),tt("div",wL,[t.multiSelect?(st(),Qe(lt,{key:0},[(st(!0),Qe(lt,null,ct(t.options,(e,s)=>(st(),Qe("label",{key:s,class:dt(["option-item option-checkbox",{selected:d(n(t),e.label)}])},[tt("span",SL,ut(d(n(t),e.label)?"[âˆš]":"[ ]"),1),tt("input",{type:"checkbox",checked:d(n(t),e.label),class:"hidden-input",onChange:s=>function(e,t){i[e]||(i[e]=[]);const n=i[e].indexOf(t);-1===n?i[e].push(t):i[e].splice(n,1),p(e)}(n(t),e.label)},null,40,CL),tt("span",TL,[tt("span",EL,ut(e.label),1),e.description?(st(),Qe("span",IL,ut(e.description),1)):qe("",!0)])],2))),128)),tt("div",xL,[tt("span",AL,ut(l[n(t)]?"[âˆš]":"[ ]"),1),rt(tt("input",{"onUpdate:modelValue":e=>l[n(t)]=e,type:"text",class:"other-input-inline",placeholder:e.$t("askUser.typeSomething","Type something"),onInput:e=>{p(n(t))}},null,40,NL),[[at,l[n(t)]]])])],64)):(st(),Qe(lt,{key:1},[(st(!0),Qe(lt,null,ct(t.options,(e,i)=>(st(),Qe("div",{key:i,class:dt(["option-item option-radio clickable",{selected:o[n(t)]===e.label}]),onClick:i=>function(e,t){o[e]=t,r[e]=!1;const i=s.value?.questions.filter(e=>!e.multiSelect).every(e=>o[n(e)])??!1;!c.value&&i&&f()}(n(t),e.label)},[tt("span",RL,ut(o[n(t)]===e.label?"(â—)":"( )"),1),tt("span",_L,[tt("span",OL,ut(e.label),1),e.description?(st(),Qe("span",DL,ut(e.description),1)):qe("",!0)])],10,ML))),128)),tt("div",BL,[tt("span",LL,ut(r[n(t)]?"(â—)":"( )"),1),rt(tt("input",{"onUpdate:modelValue":e=>a[n(t)]=e,type:"text",class:"other-input-inline",placeholder:e.$t("askUser.typeSomething","Type something"),onFocus:e=>{return s=n(t),r[s]=!0,void delete o[s];var s},onKeydown:Lt(e=>u(n(t)),["enter"])},null,40,FL),[[at,a[n(t)]]]),r[n(t)]&&a[n(t)]?(st(),Qe("button",{key:0,class:"btn-submit-inline",onClick:e=>u(n(t))}," â†µ ",8,PL)):qe("",!0)])],64))])]))),128))]),tt("div",$L,[tt("button",{class:"btn-cancel",onClick:m},ut(e.$t("askUser.cancel","å–æ¶ˆ")),1),c.value?(st(),Qe("button",{key:0,class:"btn-submit",disabled:!h.value,onClick:f},ut(e.$t("askUser.submit","Submit")),9,UL)):qe("",!0)])])])):qe("",!0)}}),[["__scopeId","data-v-1b2e2518"]]);const WL={class:"modern-chat-view"},GL={class:"chat-screen-content"},zL={class:"floating-overlay-container"},HL={key:0,class:"error-dialog"},KL={class:"error-content"},jL={class:"error-header"},YL={class:"error-title"},ZL={class:"error-message"},XL={class:"error-actions"},JL={key:1,class:"debug-panel"},QL={class:"debug-content"},qL={class:"debug-item"},eF={class:"debug-item"},tF={class:"debug-item"},nF={class:"debug-item"},sF={class:"debug-item"},oF={class:"debug-item"},iF={key:0,class:"toast-container"},rF={class:"toast-message"},aF=Ze({__name:"ModernChatView",props:{sessionId:{default:void 0},projectPath:{default:"/default/project"},showDebug:{type:Boolean,default:!1}},setup(e){const t=e;Vt("projectPath",We(()=>t.projectPath)),Vt("aiAgentService",Xa);const n=lu(),s=Yc(),{t:o}=cu(),{isInIde:i,detectEnvironment:r}=pu(),a=i;let l=null,c=null;const u=Ge(!1),d=Ge([]),p=Ge(!1),h=Ge(!1),f=Ge(!0),m=Ge(0),g=Ge(""),y=Ge(!1);let v=null;function b(e,t=2e3){g.value=e,y.value=!0,v&&clearTimeout(v),v=setTimeout(()=>{y.value=!1},t)}const k=Ge({contexts:[],isGenerating:!1,isLoadingHistory:!1,hasError:!1,errorMessage:void 0,actualModelId:void 0,selectedModel:"DEFAULT",selectedPermissionMode:"default",autoCleanupContexts:!1}),w=We(()=>n.currentDisplayItems),S=We(()=>k.value.isLoadingHistory||n.currentIsLoadingHistory),C=We(()=>n.currentHasMoreHistory),T=We(()=>n.currentTab?.isCompacting.value??!1);We(()=>function(e){const t={filesChanged:0,filesRead:0,toolsUsed:0,commandsRun:0,searchesPerformed:0};for(const n of e){if("toolCall"!==n.displayType)continue;const e=n;switch(t.toolsUsed++,e.toolType){case Kl.READ:t.filesRead++;break;case Kl.WRITE:case Kl.EDIT:case Kl.MULTI_EDIT:t.filesChanged++;break;case Kl.BASH:t.commandsRun++;break;case Kl.GREP:case Kl.GLOB:case Kl.WEB_SEARCH:t.searchesPerformed++}}return t}(w.value));const E=We(()=>{const e=n.activeTabs.map(e=>({id:e.tabId,name:e.name.value,timestamp:e.lastActiveAt.value,messageCount:e.displayItems.length,isGenerating:e.isGenerating.value,isConnected:e.isConnected.value,isActive:!0})),t=new Set(e.map(e=>e.id)),s=new Set(n.activeTabs.map(e=>e.sessionId.value).filter(e=>null!==e)),i=new Set(n.activeTabs.map(e=>e.resumeFromSessionId?.value??e.resumeFromSessionId??null).filter(e=>!!e)),r=d.value.filter(e=>!t.has(e.sessionId)&&!s.has(e.sessionId)&&!i.has(e.sessionId)).map(e=>({id:e.sessionId,name:e.customTitle||e.firstUserMessage||o("session.unnamed"),timestamp:e.timestamp,messageCount:e.messageCount,isGenerating:!1,isConnected:!1,isActive:!1}));return[...e,...r].sort((e,t)=>t.timestamp-e.timestamp)}),I=We(()=>{const e=n.currentTab?.stats.getLastMessageUsage();if(!e)return null;const t=e.cacheCreationTokens+e.cacheReadTokens,s=e.inputTokens+t;return{inputTokens:s,outputTokens:e.outputTokens,cacheCreationTokens:e.cacheCreationTokens,cacheReadTokens:e.cacheReadTokens,totalTokens:s}}),x=We({get:()=>n.currentTab?.uiState.inputText??"",set:e=>{n.currentTab&&(n.currentTab.uiState.inputText=e)}}),A=We({get:()=>n.currentTab?.uiState.contexts??[],set:e=>{n.currentTab&&(n.currentTab.uiState.contexts=e)}}),N=We(()=>{const e=n.currentTab?.connectionState.status;return"CONNECTED"===e?"CONNECTED":"CONNECTING"===e?"CONNECTING":"DISCONNECTED"}),M=We(()=>n.currentIsGenerating),R=We(()=>n.currentTab?.stats.getCurrentTracker()??null),_=We(()=>R.value?.requestStartTime??Date.now()),O=We(()=>R.value?.inputTokens??0),D=We(()=>R.value?.outputTokens??0),B=We(()=>n.currentTab?.stats.streamingContentVersion.value??0),L=Ge([]),F=Ge(!1),P=Ge();async function $(e,t){const s=Array.isArray(e)?e:[];console.log("handleSendMessage:",s.length,"content blocks",t?.isSlashCommand?"(slash command)":"");try{if(!n.currentTab){console.log("No active tab, creating new...");if(!(await n.createTab()))throw new Error("æ— æ³•åˆ›å»ºä¼šè¯")}if(!n.currentTab)return console.error("No active tab"),k.value.hasError=!0,void(k.value.errorMessage="å½“å‰æ²¡æœ‰æ¿€æ´»çš„ä¼šè¯");const e=t?.isSlashCommand?[]:[...A.value];n.currentTab&&(n.currentTab.uiState.contexts=[]),console.log("Sending message via currentTab",t?.isSlashCommand?"(no contexts for slash command)":`(${e.length} contexts)`),n.switchToFollowMode(),n.currentTab.sendMessage({contexts:e,contents:s,ideContext:t?.ideContext},{isSlashCommand:t?.isSlashCommand})}catch(i){console.error("Failed to send message:",i),k.value.hasError=!0,k.value.errorMessage=o("chat.error.sendMessageFailed",{message:i instanceof Error?i.message:o("chat.error.unknown")})}}async function U(e,t){const s=Array.isArray(e)?e:[];console.log("Force send:",s.length,"content blocks",t?.isSlashCommand?"(slash command)":"");const o=t?.isSlashCommand?[]:[...A.value];n.switchToFollowMode(),await(n.currentTab?.forceSendMessage({contexts:o,contents:s,ideContext:t?.ideContext},{isSlashCommand:t?.isSlashCommand})),n.currentTab&&(n.currentTab.uiState.contexts=[])}function V(e){console.log("Edit pending message:",e);const t=n.currentTab?.editQueueMessage(e);t&&n.currentTab&&(n.currentTab.uiState.contexts=[...t.contexts],P.value?.setContent(t.contents))}function W(e){console.log("Remove pending message:",e),n.currentTab?.removeFromQueue(e)}async function G(e){console.log("Force send pending message:",e);const t=n.currentTab?.editQueueMessage(e);t&&(n.switchToFollowMode(),await(n.currentTab?.forceSendMessage({contexts:t.contexts,contents:t.contents})))}async function z(){console.log("ðŸ›‘ Stopping generation via Esc key");try{n.currentTab?.clearQueue(),await(n.currentTab?.interrupt()),console.log("âœ… Interrupt request sent successfully")}catch(e){console.error("âŒ Failed to interrupt:",e)}k.value.isGenerating=!1}function H(e){console.log("Adding context:",e),n.currentTab&&(n.currentTab.uiState.contexts=[...A.value,e])}function K(e){console.log("Removing context:",e),n.currentTab&&(n.currentTab.uiState.contexts=A.value.filter(t=>t.uri!==e.uri))}function j(e){console.log("Changing auto cleanup contexts:",e),k.value.autoCleanupContexts=e}function Y(){console.log("Clearing error"),k.value.hasError=!1,k.value.errorMessage=void 0}async function Z(e=!1){if(p.value||h.value)return;if(e&&(d.value=[],m.value=0,f.value=!0),!f.value)return;0===m.value?p.value=!0:h.value=!0;try{const e=await Xa.getHistorySessions(10,m.value),t=[...d.value,...e],n=Array.from(new Map(t.map(e=>[e.sessionId,e])).values());d.value=n.sort((e,t)=>t.timestamp-e.timestamp),m.value+=e.length,f.value=10===e.length,console.log("ðŸ“‹ Loaded",e.length,"history sessions (total",d.value.length,")"),e.forEach((e,t)=>{console.log(`ðŸ“‹ [${t}] sessionId=${e.sessionId.substring(0,8)}... customTitle=${e.customTitle||"(æ— )"} firstMsg=${(e.firstUserMessage||"").substring(0,30)}...`)})}catch(t){console.error("â—Error loading history sessions:",t)}finally{p.value=!1,h.value=!1}}function X(){const e=!u.value;u.value=!u.value,e&&!p.value&&Z(!0)}async function J(){if(!S.value){k.value.isLoadingHistory=!0;try{await n.loadMoreHistory()}finally{k.value.isLoadingHistory=!1}}}async function Q(){await Z(!1)}async function q(e){u.value=!1,k.value.isLoadingHistory=!0;try{const t=n.tabs.find(t=>t.tabId===e||t.sessionId.value===e);if(t)await n.switchTab(t.tabId);else{const t=d.value.find(t=>t.sessionId===e);if(t){console.log("ðŸ”„ Resuming history session:",e);const s=t.customTitle||t.firstUserMessage;await n.resumeSession(e,s,t.projectPath,t.messageCount)}}const s=n.currentTab?.__historyPromise;s&&await s}finally{k.value.isLoadingHistory=!1}}async function ee(e){console.log("ðŸ—‘ï¸ Deleting session:",e);try{const t=await Xa.deleteHistorySession(e);t.success?(d.value=d.value.filter(t=>t.sessionId!==e),b(o("session.deleteSuccess")),console.log("âœ… Session deleted:",e)):(b(t.error||o("session.deleteFailed")),console.error("âŒ Failed to delete session:",t.error))}catch(t){console.error("âŒ Error deleting session:",t),b(o("session.deleteFailed"))}}return ot(async()=>{var e;console.log("ModernChatView mounted"),await r(),a.value&&(l=Au(n),e=e=>{"toggleHistory"===e.type?X():"openHistory"===e.type&&(u.value=!0)},vu.add(e),c=()=>vu.delete(e));try{if(t.sessionId){console.log("External session detected:",t.sessionId);const e=n.tabs.find(e=>e.tabId===t.sessionId||e.sessionId.value===t.sessionId);if(e)await n.switchTab(e.tabId);else{if(!(await n.resumeSession(t.sessionId)))throw new Error("æ— æ³•æ¢å¤æŒ‡å®šä¼šè¯")}return}if(!n.hasTabs){console.log("No existing tabs, creating default..."),a.value&&!s.ideSettings&&(console.log("Waiting for IDE settings to load..."),await s.loadIdeSettings(),console.log("IDE settings loaded, skipPermissions:",s.settings.skipPermissions));const[e]=await Promise.all([n.createTab(),Z(!0)]);console.log("Default tab created:",e.tabId)}}catch(i){console.error("Failed to initialize session:",i),k.value.hasError=!0,k.value.errorMessage=o("chat.error.initSessionFailed",{message:i instanceof Error?i.message:o("chat.error.unknown")})}}),ft(()=>{console.log("ModernChatView unmounting"),l?.(),l=null,c?.(),c=null}),Ke(()=>t.sessionId,async e=>{if(e){console.log("Session ID changed:",e);try{const t=n.tabs.find(t=>t.tabId===e||t.sessionId.value===e);if(t)return void(await n.switchTab(t.tabId));if(!(await n.resumeSession(e)))throw new Error("æ— æ³•æ¢å¤æŒ‡å®šä¼šè¯")}catch(t){console.error("Failed to switch session:",t),k.value.hasError=!0,k.value.errorMessage=o("chat.error.switchSessionFailed",{message:t instanceof Error?t.message:o("chat.error.unknown")})}}}),(t,s)=>(st(),Qe("div",WL,[kt(BD,{class:"chat-header-bar",onToggleHistory:X}),tt("div",GL,[kt(dO,{"display-items":w.value,"is-loading":S.value,"has-more-history":C.value,"is-streaming":M.value,"streaming-start-time":_.value,"input-tokens":O.value,"output-tokens":D.value,"content-version":B.value,"connection-status":N.value,class:"message-list-area",onLoadMoreHistory:J},null,8,["display-items","is-loading","has-more-history","is-streaming","streaming-start-time","input-tokens","output-tokens","content-version","connection-status"]),T.value?(st(),Je(MB,{key:0})):qe("",!0),kt(xB,{onEdit:V,onRemove:W,onForceSend:G}),tt("div",zL,[kt(pL),kt(VL)]),kt(rI,{ref_key:"chatInputRef",ref:P,modelValue:x.value,"onUpdate:modelValue":s[0]||(s[0]=e=>x.value=e),"pending-tasks":L.value,contexts:A.value,"is-generating":M.value,enabled:!0,"show-toast":b,"actual-model-id":ht(n).currentTab?.modelId.value||void 0,"selected-permission":ht(n).currentTab?.permissionMode.value||"default","skip-permissions":ht(n).currentTab?.skipPermissions.value??!1,"selected-model":k.value.selectedModel,"auto-cleanup-contexts":k.value.autoCleanupContexts,"message-history":[],"session-token-usage":I.value,"streaming-start-time":_.value,"streaming-input-tokens":O.value,"streaming-output-tokens":D.value,"show-context-controls":!0,"show-model-selector":!0,"show-permission-controls":!0,"show-send-button":!0,"backend-type":ht(n).currentBackendType,class:"input-area",onSend:$,onForceSend:U,onStop:z,onContextAdd:H,onContextRemove:K,onAutoCleanupChange:j},null,8,["modelValue","pending-tasks","contexts","is-generating","actual-model-id","selected-permission","skip-permissions","selected-model","auto-cleanup-contexts","session-token-usage","streaming-start-time","streaming-input-tokens","streaming-output-tokens","backend-type"])]),k.value.hasError?(st(),Qe("div",HL,[tt("div",{class:"error-overlay",onClick:Y}),tt("div",KL,[tt("div",jL,[tt("span",YL,ut(ht(o)("chat.error.title")),1)]),tt("div",ZL,ut(k.value.errorMessage||ht(o)("chat.error.unknown")),1),tt("div",XL,[tt("button",{class:"error-dismiss-btn",onClick:Y},ut(ht(o)("common.ok")),1)])])])):qe("",!0),e.showDebug?(st(),Qe("div",JL,[tt("div",{class:"debug-header",onClick:s[1]||(s[1]=e=>F.value=!F.value)},ut(ht(o)("chat.debug.title"))+" "+ut(F.value?"â–¼":"â–¶"),1),rt(tt("div",QL,[tt("div",qL,ut(ht(o)("chat.debug.sessionId"))+": "+ut(e.sessionId||ht(o)("chat.debug.notSet")),1),tt("div",eF,ut(ht(o)("chat.debug.projectPath"))+": "+ut(e.projectPath),1),tt("div",tF,ut(ht(o)("chat.debug.messageCount"))+": "+ut(w.value.length),1),tt("div",nF,ut(ht(o)("chat.debug.generating"))+": "+ut(k.value.isGenerating?ht(o)("common.yes"):ht(o)("common.no")),1),tt("div",sF,ut(ht(o)("chat.debug.pendingTasks"))+": "+ut(L.value.length),1),tt("div",oF,ut(ht(o)("chat.debug.contexts"))+": "+ut(A.value.length),1)],512),[[At,F.value]])])):qe("",!0),kt(hB,{visible:u.value,sessions:E.value,"current-session-id":ht(n).currentTabId,loading:p.value,"loading-more":h.value,"has-more":f.value,onClose:s[2]||(s[2]=e=>u.value=!1),onSelectSession:q,onLoadMore:Q,onDeleteSession:ee},null,8,["visible","sessions","current-session-id","loading","loading-more","has-more"]),kt(Dt,{name:"toast"},{default:St(()=>[y.value?(st(),Qe("div",iF,[tt("div",rF,ut(g.value),1)])):qe("",!0)]),_:1})]))}}),lF=ju(aF,[["__scopeId","data-v-ca8304a5"]]),cF={class:"test-display-items"},uF={class:"test-section"},dF={class:"display-items-list"},pF={class:"test-section"},hF={key:0,class:"empty-state"},fF={key:1,class:"display-items-list"},mF={class:"test-section"},gF={class:"debug-info"},yF=ju(Ze({__name:"TestDisplayItems",setup(e){const t=lu(),n=We(()=>t.currentSessionId),s=We(()=>t.currentDisplayItems),o=We(()=>t.tabCount),i=We(()=>t.currentMessages.length),r=[{displayType:"userMessage",id:"mock-user-1",content:[{type:"text",text:"ä½ å¥½ï¼è¯·å¸®æˆ‘è¯»å– package.json æ–‡ä»¶"}],timestamp:Date.now()-1e4},{displayType:"assistantText",id:"mock-assistant-1",content:"å¥½çš„ï¼Œæˆ‘æ¥å¸®ä½ è¯»å– package.json æ–‡ä»¶ã€‚",timestamp:Date.now()-9e3},Ve({displayType:"toolCall",toolName:"Read",toolType:Kl.READ,id:"mock-tool-1",status:pl.SUCCESS,startTime:Date.now()-8e3,endTime:Date.now()-7e3,timestamp:Date.now()-8e3,input:{file_path:"package.json"},result:{type:"tool_result",content:'{\n  "name": "claude-code-plus",\n  "version": "1.0.0",\n  "description": "Claude Code Plus"\n}'}}),{displayType:"assistantText",id:"mock-assistant-2",content:'æˆ‘å·²ç»æˆåŠŸè¯»å–äº† package.json æ–‡ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ªåä¸º "claude-code-plus" çš„é¡¹ç›®ã€‚',timestamp:Date.now()-6e3},{displayType:"systemMessage",id:"mock-system-1",content:"ä¼šè¯å·²ä¿å­˜",level:"info",timestamp:Date.now()-5e3}];return(e,t)=>(st(),Qe("div",cF,[t[7]||(t[7]=tt("h1",null,"DisplayItem ç»„ä»¶æµ‹è¯•",-1)),tt("div",uF,[t[0]||(t[0]=tt("h2",null,"Mock æ•°æ®æµ‹è¯•",-1)),tt("div",dF,[(st(),Qe(lt,null,ct(r,e=>kt(vM,{key:e.id,source:e},null,8,["source"])),64))])]),tt("div",pF,[tt("h2",null,"å½“å‰ä¼šè¯çš„ DisplayItems ("+ut(s.value.length)+")",1),0===s.value.length?(st(),Qe("div",hF,[...t[1]||(t[1]=[tt("p",null,"æ²¡æœ‰æ¶ˆæ¯ã€‚è¯·åˆ›å»ºä¼šè¯å¹¶å‘é€æ¶ˆæ¯ã€‚",-1)])])):(st(),Qe("div",fF,[(st(!0),Qe(lt,null,ct(s.value,e=>(st(),Je(vM,{key:e.id,source:e},null,8,["source"]))),128))]))]),tt("div",mF,[t[6]||(t[6]=tt("h2",null,"è°ƒè¯•ä¿¡æ¯",-1)),tt("div",gF,[tt("p",null,[t[2]||(t[2]=tt("strong",null,"å½“å‰ä¼šè¯ ID:",-1)),Nt(" "+ut(n.value||"æ— "),1)]),tt("p",null,[t[3]||(t[3]=tt("strong",null,"ä¼šè¯æ•°é‡:",-1)),Nt(" "+ut(o.value),1)]),tt("p",null,[t[4]||(t[4]=tt("strong",null,"æ¶ˆæ¯æ•°é‡:",-1)),Nt(" "+ut(i.value),1)]),tt("p",null,[t[5]||(t[5]=tt("strong",null,"DisplayItems æ•°é‡:",-1)),Nt(" "+ut(s.value.length),1)])])])]))}}),[["__scopeId","data-v-258c62fd"]]),vF={class:"toast-container"},bF=["onClick"],kF={class:"toast-icon"},wF={class:"toast-content"},SF={class:"toast-message"},CF=["onClick"],TF=ju(Ze({__name:"ToastContainer",setup(e){const t=yu(),n=We(()=>t.toasts);function s(e){t.removeToast(e)}return(e,t)=>(st(),Qe("div",vF,[kt(Wt,{name:"toast",tag:"div"},{default:St(()=>[(st(!0),Qe(lt,null,ct(n.value,e=>(st(),Qe("div",{key:e.id,class:dt(["toast-item",`toast-${e.type}`]),onClick:t=>{s(e.id)}},[tt("div",kF,ut(ht(mu)[e.type]),1),tt("div",wF,[tt("span",SF,ut(e.message),1)]),tt("button",{class:"toast-close",title:"å…³é—­",onClick:et(t=>s(e.id),["stop"])}," âœ• ",8,CF)],10,bF))),128))]),_:1})]))}}),[["__scopeId","data-v-e149de36"]]),EF={class:"app"},IF={key:2,class:"debug-panel"},xF={class:"debug-content"},AF={class:"debug-item"},NF={class:"debug-item"},MF={class:"debug-item"},RF={class:"debug-item"},_F={class:"debug-item"},OF=ju(Ze({__name:"App",setup(e){const t=Ge(!1),n=Ge(!1),s=Ge(!1),o=Ge("unknown"),i=Ge("æœªåˆå§‹åŒ–"),r=Ge("1"===new URLSearchParams(window.location.search).get("test")),a=Ge(void 0),l=Ge(""),{detectEnvironment:c}=pu(),u=Yc();function d(){console.log("Testing bridge..."),alert("æ¡¥æŽ¥çŠ¶æ€: "+(t.value?"æ­£å¸¸":"æœªå°±ç»ª"))}function p(){console.log("Testing theme...");const e=hI.getCurrentTheme();e?alert(`ä¸»é¢˜ä¿¡æ¯:\n${JSON.stringify(e,null,2)}`):alert("å½“å‰æ²¡æœ‰å¯ç”¨çš„ä¸»é¢˜æ•°æ®")}function h(){console.log("Toggling theme..."),hI.toggleTheme()}return ot(async()=>{console.log("App mounted - ModernChatView loaded"),await c();try{await Ac(),t.value=!0;const n=xc();o.value=n,console.log(`Bridge ready, mode: ${n}`),console.log("Initializing theme service..."),i.value="åˆå§‹åŒ–ä¸­...",await hI.initialize(),i.value=hI.hasIde()?"IDE":"Web (ç³»ç»Ÿ)",console.log("Theme service initialized");const s=await Xa.hasIdeEnvironment();if(console.log(`ðŸ–¥ï¸ IDE environment detected: ${s}`),s){const t=await uI.init();if(console.log(`ðŸ”Œ JetBrains bridge initialized: ${t}`),t){try{const e=await uI.getLocale();if(e){const t=mn(e);gn.global.locale.value=t,console.log(`ðŸŒ Locale synced from IDE: ${e} -> ${t}`)}}catch(e){console.error("ðŸŒ Failed to sync IDE locale:",e)}console.log("Loading IDE settings..."),await u.loadIdeSettings(),u.initIdeSettingsListener(),console.log("IDE settings initialized")}else console.warn("âš ï¸ JetBrains bridge init failed, falling back to HTTP API"),await u.loadDefaultSettings(),console.log("Default settings loaded via HTTP API (fallback)")}else console.log("Loading default settings via HTTP API..."),await u.loadDefaultSettings(),console.log("Default settings loaded");hI.onThemeChange(()=>{i.value=hI.hasIde()?"IDE":"Web (ç³»ç»Ÿ)",console.log("Theme updated")});try{const e=await Ic("ide.getProjectPath",{});e.success&&e.data?.projectPath&&(l.value=e.data.projectPath,console.log("Project path:",l.value))}catch(e){console.error("Failed to get project path:",e),l.value="èŽ·å–å¤±è´¥"}try{const e=await Ic("node.detect",{});if(e.success&&e.data){const{found:t,path:n,version:s,error:o}=e.data;t?console.log(`âœ… Node.js detected: ${n} (${s})`):console.warn("âš ï¸ Node.js not detected:",o)}}catch(e){console.error("Failed to detect Node.js:",e)}setTimeout(()=>{const e=document.getElementById("app"),t=document.querySelector(".message-list-wrapper");console.log("DOM å…ƒç´ é«˜åº¦æ£€æŸ¥:"),console.log("  #app:",e?.offsetHeight||0,"px"),console.log("  .message-list-wrapper:",t?.offsetHeight||0,"px"),e&&0!==e.offsetHeight||console.error("#app é«˜åº¦ä¸º 0 - å¯èƒ½å¯¼è‡´ç•Œé¢ç©ºç™½!")},1e3)}catch(e){console.error("Failed to initialize:",e),i.value=`é”™è¯¯: ${e}`}}),Xe(()=>{u.cleanupIdeSettingsListener()}),(e,c)=>(st(),Qe("div",EF,[kt(TF),r.value?(st(),Je(yF,{key:0})):(st(),Je(lF,{key:1,"session-id":a.value,"project-path":l.value,class:"main-chat-view"},null,8,["session-id","project-path"])),n.value?(st(),Qe("div",IF,[tt("div",{class:"debug-title",onClick:c[0]||(c[0]=e=>s.value=!s.value)}," è°ƒè¯•ä¿¡æ¯ "+ut(s.value?"â–¼":"â–¶"),1),rt(tt("div",xF,[tt("div",AF,[c[1]||(c[1]=tt("strong",null,"è¿è¡Œæ¨¡å¼:",-1)),Nt(" "+ut(o.value),1)]),tt("div",NF,[c[2]||(c[2]=tt("strong",null,"æ¡¥æŽ¥çŠ¶æ€:",-1)),Nt(" "+ut(t.value?"å·²è¿žæŽ¥":"è¿žæŽ¥ä¸­"),1)]),tt("div",MF,[c[3]||(c[3]=tt("strong",null,"ä¸»é¢˜æ¥æº:",-1)),Nt(" "+ut(i.value),1)]),tt("div",RF,[c[4]||(c[4]=tt("strong",null,"Session:",-1)),Nt(" "+ut(a.value||"é»˜è®¤"),1)]),tt("div",_F,[c[5]||(c[5]=tt("strong",null,"é¡¹ç›®è·¯å¾„:",-1)),Nt(" "+ut(l.value||"æœªè®¾ç½®"),1)]),tt("button",{class:"debug-button",onClick:d}," æµ‹è¯•æ¡¥æŽ¥ "),tt("button",{class:"debug-button",onClick:p}," æµ‹è¯•ä¸»é¢˜ "),ht(hI).hasIde()?qe("",!0):(st(),Qe("button",{key:0,class:"debug-button",onClick:h}," åˆ‡æ¢ä¸»é¢˜ "))],512),[[At,s.value]])])):qe("",!0)]))}}),[["__scopeId","data-v-3550a98b"]]);function DF(){const e=function(){const e=new URLSearchParams(window.location.search).get("scrollMultiplier");if(e){const t=parseFloat(e);if(!isNaN(t)&&t>0)return t}return 1}();e<=1?console.log("ðŸ–±ï¸ Scroll boost disabled (multiplier <= 1)"):(console.log(`ðŸ–±ï¸ Scroll boost enabled with multiplier: ${e}`),document.addEventListener("wheel",t=>{let n=t.target;for(;n&&n!==document.body;){const s=getComputedStyle(n).overflowY;if(("auto"===s||"scroll"===s)&&n.scrollHeight>n.clientHeight)return t.preventDefault(),void(n.scrollTop+=t.deltaY*e);n=n.parentElement}document.body.scrollHeight>document.body.clientHeight&&(t.preventDefault(),document.body.scrollTop+=t.deltaY*e,document.documentElement.scrollTop+=t.deltaY*e)},{passive:!1}))}globalThis.Buffer=tn.Buffer,console.log("ðŸš€ Initializing Vue application...");const BF=()=>{const e=window.innerHeight;e>0&&(document.documentElement.style.setProperty("--app-viewport-height",`${e}px`),console.log(`ðŸ“ Viewport height updated: ${e}px`))};BF(),window.addEventListener("resize",BF),window.addEventListener("orientationchange",BF);if([50,100,200,500,1e3].forEach(e=>{setTimeout(()=>{BF(),window.dispatchEvent(new Event("resize"))},e)}),"undefined"!=typeof ResizeObserver){new ResizeObserver(()=>{BF()}).observe(document.body)}window.__serverUrl||(window.__serverUrl=Za(),console.log("ðŸ”§ Bootstrap: Backend URL resolved to",window.__serverUrl)),async function(){const e=vn(),t=function(e){return{"zh-CN":Zt,"en-US":Kt,"ko-KR":Yt,"ja-JP":jt}[e]||Kt}(e);DF();const n=await async function(){return uI.init()}();n&&(lI()&&uI.isEnabled()?(FI.init(),console.log("[ToolShowInterceptor] Initialized in IDE plugin mode")):console.log("[ToolShowInterceptor] Skipped - browser mode or no JetBrains bridge"));const s=Gt(OF),o=zt();s.use(o),s.use(gn),s.use(Ht,{locale:t,size:"default",zIndex:3e3}),s.mount("#app"),console.log("âœ… Vue application mounted with locale:",e),n&&console.log("âœ… JetBrains IDE integration enabled")}().catch(e=>{console.error("âŒ Failed to initialize app:",e);const t=Gt(OF),n=zt();t.use(n),t.use(gn),t.use(Ht,{locale:Kt,size:"default",zIndex:3e3}),t.mount("#app")});
