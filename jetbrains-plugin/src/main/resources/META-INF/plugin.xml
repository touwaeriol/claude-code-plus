<idea-plugin require-restart="false">
    <id>com.claudecodeplus</id>
    <name>Claude Code Plus</name>
    <vendor email="liuxiongfenglove@gmail.com" url="https://github.com/touwaeriol/claude-code-plus">Claude Code Plus Team</vendor>

    <!-- version is set from gradle.properties via pluginVersion -->

    <description><![CDATA[
    <h2>Claude Code Plus - Advanced AI Programming Assistant</h2>

    <p>Claude Code Plus is an enhanced IntelliJ IDEA plugin that integrates Claude AI directly into your development environment, providing intelligent code assistance and natural language interaction.</p>

    <h3>Key Features:</h3>
    <ul>
        <li><b>AI-Powered Conversations:</b> Chat with Claude AI directly in your IDE</li>
        <li><b>Smart Context Management:</b> Reference files and code snippets with @ mentions</li>
        <li><b>MCP Protocol Support:</b> Configure and use Model Context Protocol services</li>
        <li><b>Multi-Session Support:</b> Manage multiple chat sessions simultaneously</li>
        <li><b>Export Capabilities:</b> Save conversation history in multiple formats</li>
        <li><b>Rich Markdown Display:</b> Beautiful rendering of code and formatted text</li>
        <li><b>Tool Integration:</b> View and interact with Claude's tool usage</li>
        <li><b>Dark Theme Support:</b> Fully compatible with IntelliJ's dark themes</li>
    </ul>

    <h3>Requirements:</h3>
    <ul>
        <li>IntelliJ IDEA 2024.2 - 2025.3.x (Build 242-253)</li>
        <li>Claude CLI installed and configured</li>
    </ul>
    
    <h3>Support & Feedback:</h3>
    <ul>
        <li><b>Report Issues:</b> <a href="https://github.com/touwaeriol/claude-code-plus/issues">GitHub Issues</a></li>
        <li><b>Documentation:</b> <a href="https://github.com/touwaeriol/claude-code-plus">GitHub Repository</a></li>
        <li><b>Feature Requests:</b> <a href="https://github.com/touwaeriol/claude-code-plus/issues/new">Submit a request</a></li>
    </ul>
    
    <p>We welcome your feedback and contributions! Please report any bugs or suggestions on our GitHub Issues page.</p>
    ]]></description>

    <!-- change-notes is auto-generated from CHANGELOG.md via build.gradle.kts -->

    <depends>com.intellij.modules.platform</depends>
    <!-- Java plugin dependency for PsiClass, PsiMethod, ClassInheritorsSearch, etc. -->
    <depends optional="true" config-file="plugin-withJava.xml">com.intellij.java</depends>
    <!-- Git plugin dependency for Git MCP (VCS integration) -->
    <depends optional="true" config-file="plugin-withGit.xml">Git4Idea</depends>

    <idea-version since-build="242.0" until-build="253.*"/>
    
    
    
    <extensions defaultExtensionNs="com.intellij">
        <!-- Native Swing UI Tool Window -->
        <toolWindow id="Claude Code Plus"
                    anchor="right"
                    icon="/icons/claude-code-simple.svg"
                    factoryClass="com.asakii.plugin.ui.NativeToolWindowFactory"/>

        <!-- application-level service -->
        <applicationService
            serviceImplementation="com.asakii.settings.McpSettingsService"/>

        <applicationService
            serviceImplementation="com.asakii.settings.AgentSettingsService"/>

        <!-- Settings Page -->
        <applicationConfigurable
            parentId="tools"
            instance="com.asakii.settings.ClaudeCodePlusConfigurable"
            id="com.asakii.settings"
            displayName="Claude Code Plus"/>

        <!-- MCP Settings (child of Claude Code Plus) -->
        <applicationConfigurable
            parentId="com.asakii.settings"
            instance="com.asakii.settings.McpConfigurable"
            id="com.asakii.settings.mcp"
            displayName="MCP"/>

        <!-- Claude Code Settings (child of Claude Code Plus) -->
        <applicationConfigurable
            parentId="com.asakii.settings"
            instance="com.asakii.settings.ClaudeCodeConfigurable"
            id="com.asakii.settings.claudecode"
            displayName="Claude Code"/>

        <!-- Git Generate Settings (child of Claude Code Plus) -->
        <applicationConfigurable
            parentId="com.asakii.settings"
            instance="com.asakii.settings.GitGenerateConfigurable"
            id="com.asakii.settings.gitgenerate"
            displayName="Git Generate"/>

        <applicationService
            serviceImplementation="com.asakii.plugin.services.ClaudeCodePlusBackgroundService"/>

        <!-- project-level service -->
        <projectService
            serviceImplementation="com.asakii.plugin.services.ProjectSessionStateService"/>

        <!-- HTTP Server Service (Auto-starts with project) -->
        <projectService
            serviceImplementation="com.asakii.server.HttpServerProjectService"/>

        <!-- Tool Window Listener -->
        <toolWindow.listener
            topic="com.intellij.openapi.wm.ex.ToolWindowManagerListener"
            implementation="com.asakii.plugin.listeners.ClaudeToolWindowListener"/>
        
        <!-- Notification Group -->
        <notificationGroup id="Claude Code Plus Notifications"
                          displayType="BALLOON"
                          isLogByDefault="true"/>

        <!-- VCS Checkin Handler for Git MCP -->
        <checkinHandlerFactory
            implementation="com.asakii.plugin.vcs.ClaudeCheckinHandlerFactory"/>

        <!-- Generate Commit Message Service -->
        <projectService
            serviceImplementation="com.asakii.plugin.vcs.GenerateCommitMessageService"/>

        <!-- Language Analysis Service - Default implementation (Noop) -->
        <!-- When Java plugin is available, plugin-withJava.xml will override with JavaLanguageAnalysisService -->
        <projectService
            serviceInterface="com.asakii.plugin.services.LanguageAnalysisService"
            serviceImplementation="com.asakii.plugin.services.NoopLanguageAnalysisService"
            overrides="false"/>

        <!-- Git Branch Service - Default implementation (Noop) -->
        <!-- When Git4Idea is available, plugin-withGit.xml will override with GitBranchServiceImpl -->
        <projectService
            serviceInterface="com.asakii.plugin.services.GitBranchService"
            serviceImplementation="com.asakii.plugin.services.NoopGitBranchService"
            overrides="false"/>
    </extensions>

    <!-- Terminal Plugin Extensions -->
    <extensions defaultExtensionNs="org.jetbrains.plugins.terminal">
        <localTerminalCustomizer
            implementation="com.asakii.plugin.mcp.tools.terminal.TerminalShellCustomizer"/>
    </extensions>

    <actions>
        <!-- Generate Commit Message Action - adds button to commit message toolbar -->
        <action id="com.asakii.plugin.vcs.GenerateCommitMessageAction"
                class="com.asakii.plugin.vcs.GenerateCommitMessageAction"
                text="Generate Commit Message"
                description="Use Claude AI to generate commit message"
                icon="/icons/claude-ai.svg">
            <add-to-group group-id="Vcs.MessageActionGroup" anchor="first"/>
        </action>
    </actions>

    <!-- JCEF Debug Port Initializer 已改为懒加载模式，支持动态插件 -->
</idea-plugin>
