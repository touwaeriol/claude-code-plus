# Codex Settings UI Preview

## 设置界面预览

这是 Codex Backend 设置界面在 IDEA Settings 对话框中的样子：

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ Settings                                                              × □ ▢  │
├─────────────────────┬───────────────────────────────────────────────────────┤
│                     │                                                       │
│ Appearance & Behav. │  Codex Backend                                        │
│ Keymap              │                                                       │
│ Editor              │  ┌─────────────────────────────────────────────┐     │
│ Plugins             │  │ Codex 二进制路径:                             │     │
│ Version Control     │  │ [/usr/local/bin/codex              ] [浏览]  │     │
│ Build, Exec., Depl. │  │                                                │     │
│ Languages & Framew. │  │ [自动检测]                                     │     │
│ Tools               │  └─────────────────────────────────────────────┘     │
│  ▼ Claude Code Plus │                                                       │
│    ▸ Terminal MCP   │  ──────────────────────────────────────────────      │
│    ● Codex Backend  │                                                       │
│  ▸ External Tools   │  ┌─────────────────────────────────────────────┐     │
│  ▸ Terminal         │  │ 模型提供者:                                   │     │
│                     │  │ [OpenAI                              ▼]      │     │
│                     │  │                                                │     │
│                     │  └─────────────────────────────────────────────┘     │
│                     │                                                       │
│                     │  ──────────────────────────────────────────────      │
│                     │                                                       │
│                     │  ┌─────────────────────────────────────────────┐     │
│                     │  │ 默认沙箱模式:                                 │     │
│                     │  │ [WorkspaceWrite                      ▼]      │     │
│                     │  │ 工作区写入 - 允许在工作区内修改文件          │     │
│                     │  └─────────────────────────────────────────────┘     │
│                     │                                                       │
│                     │  ──────────────────────────────────────────────      │
│                     │                                                       │
│                     │  ┌─────────────────────────────────────────────┐     │
│                     │  │ [测试连接]                                    │     │
│                     │  │                                                │     │
│                     │  │ ✓ 连接成功: Codex v1.0.0                      │     │
│                     │  └─────────────────────────────────────────────┘     │
│                     │                                                       │
│                     │                                                       │
│                     │                                                       │
│                     │                              [Cancel]  [OK]  [Apply] │
└─────────────────────┴───────────────────────────────────────────────────────┘
```

---

## UI 组件详解

### 1. Codex 二进制路径 Section

```
┌─────────────────────────────────────────────┐
│ Codex 二进制路径:                             │
│ [/usr/local/bin/codex              ] [浏览]  │
│                                                │
│ [自动检测]                                     │
└─────────────────────────────────────────────┘
```

**组件**:
- **文本输入框**: 显示 Codex 二进制文件的完整路径
- **浏览按钮**: 打开文件选择器，选择可执行文件
- **自动检测按钮**: 自动搜索常见位置并填充路径

**交互**:
1. 用户可以手动输入路径
2. 点击"浏览"选择文件
3. 点击"自动检测"自动查找

---

### 2. 模型提供者 Section

```
┌─────────────────────────────────────────────┐
│ 模型提供者:                                   │
│ [OpenAI                              ▼]      │
└─────────────────────────────────────────────┘
```

**下拉框选项**:
- OpenAI
- Ollama
- Anthropic
- Custom

**用途**: 配置 Codex 使用的 LLM 提供者

---

### 3. 默认沙箱模式 Section

```
┌─────────────────────────────────────────────┐
│ 默认沙箱模式:                                 │
│ [WorkspaceWrite                      ▼]      │
│ 工作区写入 - 允许在工作区内修改文件          │
└─────────────────────────────────────────────┘
```

**下拉框选项**:
- **ReadOnly**: 只读模式 - 仅允许读取文件
- **WorkspaceWrite**: 工作区写入 - 允许在工作区内修改文件
- **FullAccess**: 完全访问 - 允许所有文件操作

**特性**: 选择不同的沙箱模式时，下方的说明文本会动态更新

---

### 4. 测试连接 Section

```
┌─────────────────────────────────────────────┐
│ [测试连接]                                    │
│                                                │
│ ✓ 连接成功: Codex v1.0.0                      │
└─────────────────────────────────────────────┘
```

**状态指示**:
- **🔵 蓝色**: "正在测试连接..." (进行中)
- **🟢 绿色**: "✓ 连接成功: Codex v1.0.0" (成功)
- **🔴 红色**: "✗ 连接失败: ..." (失败)

**可能的状态消息**:
- `✗ 请先指定 Codex 二进制文件路径`
- `✗ 文件不存在: /path/to/codex`
- `✗ 文件不可执行: /path/to/codex`
- `✓ 连接成功: Codex v1.0.0`
- `✗ 连接失败 (退出码: 1): Error message`
- `✗ 测试失败: Exception message`

---

## 状态演示

### 状态 1: 初始状态（未配置）

```
Codex 二进制路径: [                                      ] [浏览]
                 [自动检测]

模型提供者:       [OpenAI                              ▼]

默认沙箱模式:     [WorkspaceWrite                      ▼]
                 工作区写入 - 允许在工作区内修改文件

[测试连接]
(空白状态标签)
```

### 状态 2: 自动检测中

```
Codex 二进制路径: [                                      ] [浏览]
                 [自动检测]

模型提供者:       [OpenAI                              ▼]

默认沙箱模式:     [WorkspaceWrite                      ▼]
                 工作区写入 - 允许在工作区内修改文件

[测试连接]
🔵 正在检测 Codex 二进制文件...
```

### 状态 3: 自动检测成功

```
Codex 二进制路径: [/usr/local/bin/codex              ] [浏览]
                 [自动检测]

模型提供者:       [OpenAI                              ▼]

默认沙箱模式:     [WorkspaceWrite                      ▼]
                 工作区写入 - 允许在工作区内修改文件

[测试连接]
🟢 ✓ 已自动检测到 Codex: /usr/local/bin/codex
```

### 状态 4: 自动检测失败

```
Codex 二进制路径: [                                      ] [浏览]
                 [自动检测]

模型提供者:       [OpenAI                              ▼]

默认沙箱模式:     [WorkspaceWrite                      ▼]
                 工作区写入 - 允许在工作区内修改文件

[测试连接]
🔴 ✗ 未检测到 Codex 二进制文件，请手动选择
```

### 状态 5: 测试连接成功

```
Codex 二进制路径: [/usr/local/bin/codex              ] [浏览]
                 [自动检测]

模型提供者:       [OpenAI                              ▼]

默认沙箱模式:     [WorkspaceWrite                      ▼]
                 工作区写入 - 允许在工作区内修改文件

[测试连接]
🟢 ✓ 连接成功: Codex v1.0.0
```

### 状态 6: 测试连接失败

```
Codex 二进制路径: [/invalid/path/codex                ] [浏览]
                 [自动检测]

模型提供者:       [OpenAI                              ▼]

默认沙箱模式:     [WorkspaceWrite                      ▼]
                 工作区写入 - 允许在工作区内修改文件

[测试连接]
🔴 ✗ 文件不存在: /invalid/path/codex
```

---

## 交互流程

### 流程 1: 首次配置

1. 用户打开 Settings > Tools > Codex Backend
2. 点击"自动检测"按钮
3. 如果检测成功：
   - 路径字段自动填充
   - 状态显示绿色成功消息
4. 如果检测失败：
   - 状态显示红色失败消息
   - 用户点击"浏览"手动选择文件
5. 选择模型提供者（默认 OpenAI）
6. 选择沙箱模式（默认 WorkspaceWrite）
7. 点击"测试连接"验证配置
8. 点击"Apply" 或 "OK" 保存设置

### 流程 2: 修改配置

1. 用户打开 Settings > Codex Backend
2. 设置从 `CodexSettings` 自动加载
3. 用户修改路径/提供者/沙箱模式
4. 点击"测试连接"验证新配置
5. 点击"Apply" 保存修改

### 流程 3: 重置配置

1. 用户修改了设置但未保存
2. 点击"Reset" 按钮
3. 所有字段恢复到保存的值
4. 状态标签清空

---

## 颜色方案

| 状态 | 颜色 | RGB | 含义 |
|------|------|-----|------|
| 进行中 | 🔵 蓝色 | `(0, 0, 255)` | 正在执行操作 |
| 成功 | 🟢 绿色 | `(0, 128, 0)` | 操作成功完成 |
| 失败 | 🔴 红色 | `(255, 0, 0)` | 操作失败或错误 |
| 默认 | ⚪ 灰色 | `(128, 128, 128)` | 空闲状态 |

---

## 键盘导航

- **Tab**: 在字段间切换焦点
- **Enter** (在路径字段): 无操作
- **Enter** (在按钮): 激活按钮
- **Ctrl+Alt+S**: 打开 Settings 对话框（IDEA 全局快捷键）

---

## 可访问性

- ✅ 所有字段都有标签
- ✅ 按钮有清晰的文本描述
- ✅ 状态消息使用颜色 + 符号（✓/✗）
- ✅ 沙箱模式有详细的说明文本
- ✅ 支持键盘导航

---

## 平台差异

### Windows
```
Codex 二进制路径: [C:\Program Files\Codex\codex.exe  ] [浏览...]
```

### macOS
```
Codex 二进制路径: [/usr/local/bin/codex              ] [浏览...]
```

### Linux
```
Codex 二进制路径: [/usr/bin/codex                     ] [浏览...]
```

---

## 验证规则

1. **路径验证**:
   - 不能为空（测试连接时）
   - 文件必须存在
   - 文件必须可执行

2. **模型提供者验证**:
   - 必须选择一个有效的提供者

3. **沙箱模式验证**:
   - 必须选择一个有效的沙箱模式

---

## 错误消息示例

| 场景 | 错误消息 |
|------|----------|
| 未配置路径 | `✗ 请先指定 Codex 二进制文件路径` |
| 文件不存在 | `✗ 文件不存在: /path/to/codex` |
| 文件不可执行 | `✗ 文件不可执行: /path/to/codex` |
| 连接失败 | `✗ 连接失败 (退出码: 1): Error: command not found` |
| 测试异常 | `✗ 测试失败: java.io.IOException: No such file` |
| 未检测到 | `✗ 未检测到 Codex 二进制文件，请手动选择` |

---

## 成功消息示例

| 场景 | 成功消息 |
|------|----------|
| 自动检测成功 | `✓ 已自动检测到 Codex: /usr/local/bin/codex` |
| 测试连接成功 | `✓ 连接成功: Codex v1.0.0` |

---

## 与其他设置的集成

在 Settings 对话框中的位置：

```
Settings
├── Tools
│   ├── Claude Code Plus
│   │   ├── Terminal MCP
│   │   └── Codex Backend  ← 这里
│   ├── External Tools
│   └── Terminal
```

可选的其他位置：

```
Settings
├── AI Backends (自定义父级)
│   ├── Claude
│   └── Codex  ← 这里
```

---

## 总结

这个设置界面提供了：

✅ **直观的 UI**: 清晰的布局和标签
✅ **自动化**: 自动检测功能
✅ **验证**: 实时测试连接
✅ **反馈**: 颜色编码的状态消息
✅ **帮助**: 沙箱模式的详细说明
✅ **可访问性**: 键盘导航和清晰的标签
✅ **持久化**: 自动保存和加载设置

符合 IntelliJ Platform 的设计规范和用户体验标准。
